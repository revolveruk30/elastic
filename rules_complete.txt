process where event.type in ("start", "process_started") and process.args : ( "/Users/*/Library/Application Support/Google/Chrome/Default/Login Data", "/Users/*/Library/Application Support/Google/Chrome/Default/Cookies", "/Users/*/Library/Application Support/Google/Chrome/Profile*/Cookies", "/Users/*/Library/Cookies*", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/cookies.sqlite", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/key*.db", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/logins.json", "Login Data", "Cookies.binarycookies", "key4.db", "key3.db", "logins.json", "cookies.sqlite" )

process where event.type in ("start", "process_started") and process.args : ( "/Users/*/Library/Application Support/Google/Chrome/Default/Login Data", "/Users/*/Library/Application Support/Google/Chrome/Default/Cookies", "/Users/*/Library/Cookies*", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/cookies.sqlite", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/key*.db", "/Users/*/Library/Application Support/Firefox/Profiles/*.default/logins.json", "Login Data", "Cookies.binarycookies", "key4.db", "key3.db", "logins.json", "cookies.sqlite" )

process where event.type in ("start", "process_started") and process.args : ( "/Users/*/Library/Keychains/*", "/Library/Keychains/*", "/Network/Library/Keychains/*", "System.keychain", "login.keychain-db", "login.keychain" ) and not process.args : ("find-certificate", "add-trusted-cert", "set-keychain-settings", "delete-certificate", "/Users/*/Library/Keychains/openvpn.keychain-db", "show-keychain-info", "lock-keychain", "set-key-partition-list", "import", "find-identity") and not process.parent.executable : ( "/Applications/OpenVPN Connect/OpenVPN Connect.app/Contents/MacOS/OpenVPN Connect", "/Applications/Microsoft Defender.app/Contents/MacOS/wdavdaemon_enterp rise.app/Contents/MacOS/wdavdaemon_enterprise", "/opt/jc/bin/jumpcloud-agent" ) and not process.executable : "/opt/jc/bin/jumpcloud-agent"

process where event.type in ("start", "process_started") and process.args : ( "/Users/*/Library/Keychains/*", "/Library/Keychains/*", "/Network/Library/Keychains/*", "System.keychain", "login.keychain-db", "login.keychain" ) and not process.args : ("find-certificate", "add-trusted-cert", "set-keychain-settings", "delete-certificate", "/Users/*/Library/Keychains/openvpn.keychain-db", "show-keychain-info", "lock-keychain", "set-key-partition-list", "import", "find-identity") and not process.parent.executable : "/Applications/OpenVPN Connect/OpenVPN Connect.app/Contents/MacOS/OpenVPN Connect"

process where event.type in ("start", "process_started") and process.args : ( "/Users/*/Library/Keychains/*", "/Library/Keychains/*", "/Network/Library/Keychains/*", "System.keychain", "login.keychain-db", "login.keychain" )

event.category:process and event.type:(start or process_started) and process.name:(zip or tar or gzip or 7za or hdiutil) and process.args:("/Library/Keychains/" or "/Network/Library/Keychains/" or "~/Library/Keychains/")

event.action:"modified-user-account" and event.code:"4738" and message:"'Don't Expire Password' - Enabled" and not user.id:"S-1-5-18"

process where event.type == "start" and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and (process.name : "whoami.exe" or (process.name : "net1.exe" and not process.parent.name : "net.exe"))

process where event.type in ("start", "process_started") and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and (process.name : "whoami.exe" or (process.name : "net1.exe" and not process.parent.name : "net.exe"))

process where event.type in ("start", "process_started") and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and (process.name : "whoami.exe" or (process.name : "net1.exe" and not process.parent.name : "net.exe"))

process where event.type in ("start", "process_started") and (process.Ext.token.integrity_level_name : "System" or winlog.event_data.IntegrityLevel : "System") and process.name : "whoami.exe" or (process.name : "net1.exe" and not process.parent.name : "net.exe")

process where event.type in ("start", "process_started") and user.id in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and process.name : "whoami.exe" or (process.name : "net1.exe" and not process.parent.name : "net.exe")

event.category:process and event.type:(start or process_started) and (process.name:(whoami.exe or net.exe) or process.name:net1.exe and not process.parent.name:net.exe) and user.name:SYSTEM

event.category:process and event.type:(start or process_started) and (process.name:net.exe or process.name:net1.exe and not process.parent.name:net.exe) and user.name:SYSTEM

(process.name:net.exe or process.name:net1.exe and not process.parent.name:net.exe) and user.name:SYSTEM and event.action:"Process Create (rule: ProcessCreate)"

sequence by host.id with maxspan=5m [authentication where event.action == "logged-in" and /* event 4624 need to be logged */ winlog.logon.type : "Network" and event.outcome == "success" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1"] by winlog.event_data.TargetLogonId /* event 4724 need to be logged */ [iam where event.action == "reset-password" and ( /* This rule is very noisy if not scoped to privileged accounts, duplicate the rule and add your own naming convention and accounts of interest here. */ winlog.event_data.TargetUserName: ("*Admin*", "*super*", "*SVC*", "*DC0*", "*service*", "*DMZ*", "*ADM*") or winlog.event_data.TargetSid : "S-1-5-21-*-500" ) ] by winlog.event_data.SubjectLogonId

sequence by host.id with maxspan=5m [authentication where event.action == "logged-in" and /* event 4624 need to be logged */ winlog.logon.type : "Network" and event.outcome == "success" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1"] by winlog.event_data.TargetLogonId /* event 4724 need to be logged */ [iam where event.action == "reset-password"] by winlog.event_data.SubjectLogonId

sequence by host.id with maxspan=5m [authentication where event.action == "logged-in" and /* event 4624 need to be logged */ winlog.logon.type : "Network" and event.outcome == "success" and source.ip != null and not source.ip in ("127.0.0.1", "::1")] by winlog.event_data.TargetLogonId /* event 4724 need to be logged */ [iam where event.action == "reset-password"] by winlog.event_data.SubjectLogonId

process where event.type == "start" and process.name : "attrib.exe" and process.args : "+h"

process where event.type in ("start", "process_started") and process.name : "attrib.exe" and process.args : "+h"

event.category:process and event.type:(start or process_started) and process.name:attrib.exe and process.args:+h

event.action:"Process Create (rule: ProcessCreate)" and process.name:attrib.exe and process.args:+h

event.action:"Process Create (rule: ProcessCreate)" and process.name:"attrib.exe" and process.args:"+h"

process where event.type == "start" and (process.name : "AdFind.exe" or process.pe.original_file_name == "AdFind.exe") and process.args : ("objectcategory=computer", "(objectcategory=computer)", "objectcategory=person", "(objectcategory=person)", "objectcategory=subnet", "(objectcategory=subnet)", "objectcategory=group", "(objectcategory=group)", "objectcategory=organizationalunit", "(objectcategory=organizationalunit)", "objectcategory=attributeschema", "(objectcategory=attributeschema)", "domainlist", "dcmodes", "adinfo", "dclist", "computers_pwnotreqd", "trustdmp")

process where event.type in ("start", "process_started") and (process.name : "AdFind.exe" or process.pe.original_file_name == "AdFind.exe") and process.args : ("objectcategory=computer", "(objectcategory=computer)", "objectcategory=person", "(objectcategory=person)", "objectcategory=subnet", "(objectcategory=subnet)", "objectcategory=group", "(objectcategory=group)", "objectcategory=organizationalunit", "(objectcategory=organizationalunit)", "objectcategory=attributeschema", "(objectcategory=attributeschema)", "domainlist", "dcmodes", "adinfo", "dclist", "computers_pwnotreqd", "trustdmp")

process where event.type in ("start", "process_started") and (process.name : "AdFind.exe" or process.pe.original_file_name == "AdFind.exe") and process.args : ("objectcategory=computer", "(objectcategory=computer)", "objectcategory=person", "(objectcategory=person)", "objectcategory=subnet", "(objectcategory=subnet)", "objectcategory=group", "(objectcategory=group)", "objectcategory=organizationalunit", "(objectcategory=organizationalunit)", "objectcategory=attributeschema", "(objectcategory=attributeschema)", "domainlist", "dcmodes", "adinfo", "dclist", "computers_pwnotreqd", "trustdmp")

event.dataset:okta.system and event.action:group.privilege.grant

event.module:okta and event.dataset:okta.system and event.action:group.privilege.grant

event.dataset:okta.system and event.action:user.account.privilege.grant

event.action:"Directory Service Changes" and event.code:5136 and winlog.event_data.ObjectDN:CN=AdminSDHolder,CN=System*

any where event.action == "Directory Service Changes" and event.code == "5136" and winlog.event_data.AttributeLDAPDisplayName : "dSHeuristics" and length(winlog.event_data.AttributeValue) &gt; 15 and winlog.event_data.AttributeValue regex~ "[0-9]{15}([1-9a-f]).*"

any where event.action == "Directory Service Changes" and event.code == "5136" and length(winlog.event_data.AttributeValue) &gt; 15 and winlog.event_data.AttributeValue regex~ "[0-9]{15}([1-9a-f]).*"

file where event.type == "creation" and file.path : ("?:\\Program Files (x86)\\Adobe\\Acrobat Reader DC\\Reader\\AcroCEF\\RdrCEF.exe", "?:\\Program Files\\Adobe\\Acrobat Reader DC\\Reader\\AcroCEF\\RdrCEF.exe") and not process.name : "msiexec.exe"

event.category:file and event.type:creation and file.path:("C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe" or "C:\Program Files\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe") and not process.name:msiexec.exe

file.path:("C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe" or "C:\Program Files\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe") and event.action:"File created (rule: FileCreate)" and not process.name:msiexec.exe

file.path:("C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe" or "C:\Program Files\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe") and event.action:"File created (rule: FileCreate)" and not process.name:msiexeec.exe

event.kind:alert and event.module:endgame and (event.action:behavior_protection_event or endgame.event_subtype_full:behavior_protection_event)

event.kind:alert and event.module:endgame and event.action:rules_engine_event

event.agent_id_status:agent_id_mismatch

event.agent_id_status:*

sequence by host.id, process.entity_id with maxspan=30s [process where event.type == "start" and process.name == "osascript"] [network where event.type != "end" and process.name == "osascript" and destination.ip != "::1" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by host.id, process.entity_id with maxspan=30s [process where event.type == "start" and process.name == "osascript"] [network where event.type != "end" and process.name == "osascript" and destination.ip != "::1" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.0/8", "169.254.0.0/16", "224.0.0.0/4", "FE80::/10", "FF00::/8") ]

process where event.type in ("start", "process_started") and process.name : "osascript" and process.command_line : "osascript*with administrator privileges"

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:ADD_APPLICATION

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:ADD_APPLICATION

event.dataset:"google_workspace.admin" and event.category:"iam" and event.type:"change" and event.action:"CHANGE_APPLICATION_SETTING" and google_workspace.admin.application.name:"Google Workspace Marketplace" and google_workspace.admin.old_value: *allowed*false* and google_workspace.admin.new_value: *allowed*true*

iam where event.action == "scheduled-task-created" and /* excluding tasks created by the computer account */ not user.name : "*$" and /* TaskContent is not parsed, exclude by full taskname noisy ones */ not winlog.event_data.TaskName : ("\\OneDrive Standalone Update Task-S-1-5-21*", "\\Hewlett-Packard\\HP Web Products Detection", "\\Hewlett-Packard\\HPDeviceCheck")

iam where event.action == "scheduled-task-updated" and /* excluding tasks created by the computer account */ not user.name : "*$" and not winlog.event_data.TaskName : ("\\User_Feed_Synchronization-*", "\\OneDrive Reporting Task-S-1-5-21*", "\\Hewlett-Packard\\HP Web Products Detection", "\\Hewlett-Packard\\HPDeviceCheck")

event.dataset:okta.system and event.action:user.mfa.attempt_bypass

event.module:okta and event.dataset:okta.system and event.action:user.mfa.attempt_bypass

event.dataset:o365.audit and event.provider:(AzureActiveDirectory or Exchange) and event.category:authentication and event.action:(UserLoginFailed or PasswordLogonInitialAuthUsingPassword) and not o365.audit.LogonError:(UserAccountNotFound or EntitlementGrantsNotFound or UserStrongAuthEnrollmentRequired or UserStrongAuthClientAuthNRequired or InvalidReplyTo)

event.dataset:o365.audit and event.provider:(AzureActiveDirectory or Exchange) and event.category:authentication and event.action:(UserLoginFailed or PasswordLogonInitialAuthUsingPassword) and not o365.audit.LogonError:(UserAccountNotFound or EntitlementGrantsNotFound or UserStrongAuthEnrollmentRequired or UserStrongAuthClientAuthNRequired or InvalidReplyTo) and event.outcome:success

event.dataset:o365.audit and event.provider:(AzureActiveDirectory or Exchange) and event.category:authentication and event.action:(UserLoginFailed or PasswordLogonInitialAuthUsingPassword) and not o365.audit.LogonError:(UserAccountNotFound or EntitlementGrantsNotFound or UserStrongAuthEnrollmentRequired or UserStrongAuthClientAuthNRequired or InvalidReplyTo) and event.outcome:failure

event.dataset:o365.audit and event.provider:AzureActiveDirectory and event.category:authentication and event.action:UserLoginFailed and event.outcome:failure

event.dataset:okta.system and event.action:user.account.lock

event.dataset:okta.system and event.action:user.account.lock

event.dataset:okta.system and event.action:system.api_token.create

event.module:okta and event.dataset:okta.system and event.action:system.api_token.create

event.dataset:okta.system and event.action:application.lifecycle.deactivate

event.dataset:okta.system and event.action:zone.deactivate

event.dataset:okta.system and event.action:policy.lifecycle.deactivate

event.module:okta and event.dataset:okta.system and event.action:policy.lifecycle.deactivate

event.dataset:okta.system and event.action:policy.rule.deactivate

event.module:okta and event.dataset:okta.system and event.action:policy.rule.deactivate

event.dataset:okta.system and event.action:user.mfa.factor.deactivate

event.module:okta and event.dataset:okta.system and event.action:user.mfa.factor.deactivate

event.dataset:okta.system and event.action:application.lifecycle.delete

event.dataset:okta.system and event.action:zone.delete

event.dataset:okta.system and event.action:policy.lifecycle.delete

event.module:okta and event.dataset:okta.system and event.action:policy.lifecycle.delete

event.dataset:okta.system and event.action:policy.rule.delete

event.category:process and event.type:(start or process_started) and process.args:(spctl and "--master-disable")

event.category:process and event.type:(start or process_started) and process.args:(spctl and "--master-disable")

event.category:process and event.type:(start or process_started) and ((process.name:service and process.args:stop) or (process.name:chkconfig and process.args:off) or (process.name:systemctl and process.args:(disable or stop or kill))) and process.args:(syslog or rsyslog or "syslog-ng")

event.action:(executed or process_started) and ((process.name:service and process.args:stop) or (process.name:chkconfig and process.args:off) or (process.name:systemctl and process.args:(disable or stop or kill))) and process.args:(syslog or rsyslog or "syslog-ng")

event.category:process and event.type:(start or process_started) and process.name:dsenableroot and not process.args:"-d"

event.category:process and event.type:(start or process_started) and process.name:security and process.args:"add-trusted-cert" and not pr ocess.parent.executable:("/Library/Bitdefender/AVP/product/bin/BDCoreI ssues" or "/Applications/Bitdefender/SecurityNetworkInstallerApp.app/C ontents/MacOS/SecurityNetworkInstallerApp" )

event.category:process and event.type:(start or process_started) and process.name:security and process.args:"add-trusted-cert"

event.dataset:okta.system and event.action:application.lifecycle.update

event.dataset:okta.system and event.action:(zone.update or network_zone.rule.disabled or zone.remove_blacklist)

event.dataset:okta.system and event.action:(zone.update or zone.deactivate or zone.delete or network_zone.rule.disabled or zone.remove_blacklist)

event.module:okta and event.dataset:okta.system and event.action:(zone.update or zone.deactivate or zone.delete or network_zone.rule.disabled or zone.remove_blacklist)

event.dataset:okta.system and event.action:policy.lifecycle.update

event.module:okta and event.dataset:okta.system and event.action:policy.lifecycle.update

event.dataset:okta.system and event.action:policy.rule.update

event.dataset:okta.system and event.action:(policy.rule.update or policy.rule.delete)

event.module:okta and event.dataset:okta.system and event.action:(policy.rule.update or policy.rule.delete)

process where event.type in ("start", "process_started") and ( process.name : "mount_smbfs" or (process.name : "open" and process.args : "smb://*") or (process.name : "mount" and process.args : "smbfs") or (process.name : "osascript" and process.command_line : "osascript*mount volume*smb://*") ) and not process.parent.executable : "/Applications/Google Drive.app/Contents/MacOS/Google Drive"

process where event.type in ("start", "process_started") and ( process.name : "mount_smbfs" or (process.name : "open" and process.args : "smb://*") or (process.name : "mount" and process.args : "smbfs") or (process.name : "osascript" and process.command_line : "osascript*mount volume*smb://*") )

process where event.type in ("start", "process_started") and process.name : "xattr" and ( (process.args : "com.apple.quarantine" and process.args : ("-d", "-w")) or (process.args : "-c") or (process.command_line : ("/bin/bash -c xattr -c *", "/bin/zsh -c xattr -c *", "/bin/sh -c xattr -c *")) ) and not process.args_count &gt; 12

process where event.type in ("start", "process_started") and process.args : "xattr" and ( (process.args : "com.apple.quarantine" and process.args : ("-d", "-w")) or (process.args : "-c" and process.command_line : ( "/bin/bash -c xattr -c *", "/bin/zsh -c xattr -c *", "/bin/sh -c xattr -c *" ) ) )

process where event.type in ("start", "process_started") and process.name == "xattr" and process.args == "com.apple.quarantine" and process.args == "-d"

event.dataset:okta.system and event.action:user.mfa.factor.reset_all

event.module:okta and event.dataset:okta.system and event.action:user.mfa.factor.reset_all

event.dataset:okta.system and event.action:system.api_token.revoke

event.module:okta and event.dataset:okta.system and event.action:system.api_token.revoke

event.category:process and event.type:(start or process_started) and process.name:kextunload and process.args:("/System/Library/Extensions/EndpointSecurity.kext" or "EndpointSecurity.kext")

event.category:file and not event.type:deletion and file.path:(/Library/Security/SecurityAgentPlugins/* and not /Library/Security/SecurityAgentPlugins/TeamViewerAuthPlugin.bundle/*) and not process.name:shove and process.code_signature.trusted:true

event.category:file and not event.type:deletion and file.path:(/Library/Security/SecurityAgentPlugins/* and not /Library /Security/SecurityAgentPlugins/TeamViewerAuthPlugin.bundle/Contents/*)

event.dataset:aws.cloudtrail and event.provider:secretsmanager.amazonaws.com and event.action:GetSecretValue

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:CreateTrail and event.outcome:success

event.action:CreateTrail and event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:DeleteTrail and event.outcome:success

event.action:DeleteTrail and event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:StopLogging and event.outcome:success

event.action:StopLogging and event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:UpdateTrail and event.outcome:success

event.action:UpdateTrail and event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:monitoring.amazonaws.com and event.action:DeleteAlarms and event.outcome:success

event.action:DeleteAlarms and event.dataset:aws.cloudtrail and event.provider:monitoring.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com and event.action:DeleteLogGroup and event.outcome:success

event.action:DeleteLogGroup and event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com and event.action:DeleteLogStream and event.outcome:success

event.action:DeleteLogStream and event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:config.amazonaws.com and event.action:(DeleteConfigRule or DeleteOrganizationConfigRule or DeleteConfigurationAggregator or DeleteConfigurationRecorder or DeleteConformancePack or DeleteOrganizationConformancePack or DeleteDeliveryChannel or DeleteRemediationConfiguration or DeleteRetentionConfiguration)

event.dataset: aws.cloudtrail and event.action: DeleteConfigRule and event.provider: config.amazonaws.com

event.dataset:aws.cloudtrail and event.provider:config.amazonaws.com and event.action:StopConfigurationRecorder and event.outcome:success

event.action:StopConfigurationRecorder and event.dataset:aws.cloudtrail and event.provider:config.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:(DeleteDBCluster or DeleteGlobalCluster or DeleteDBInstance) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:(DeleteDBCluster or DeleteGlobalCluster or DeleteDBInstance) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:(DeleteDBCluster or DeleteGlobalCluster) and event.outcome:success

event.action:(DeleteDBCluster or DeleteGlobalCluster) and event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:DisableEbsEncryptionByDefault and event.outcome:success

event.action:DisableEbsEncryptionByDefault and event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(CreateTrafficMirrorFilter or CreateTrafficMirrorFilterRule or CreateTrafficMirrorSession or CreateTrafficMirrorTarget) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(CreateTrafficMirrorFilter or CreateTrafficMirrorFilterRule or CreateTrafficMirrorSession or CreateTrafficMirrorTarget) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(CreateNetworkAcl or CreateNetworkAclEntry) and event.outcome:success

event.action:(CreateNetworkAcl or CreateNetworkAclEntry) and event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(DeleteNetworkAcl or DeleteNetworkAclEntry) and event.outcome:success

event.action:(DeleteNetworkAcl or DeleteNetworkAclEntry) and event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:ModifySnapshotAttribute

event.module:aws and event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:ModifySnapshotAttribute

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:CreateInstanceExportTask and event.outcome:failure

event.dataset:aws.cloudtrail and event.provider:elasticfilesystem.amazonaws.com and event.action:(DeleteMountTarget or DeleteFileSystem) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:elasticfilesystem.amazonaws.com and event.action:(DeleteMountTarget or DeleteFileSystem) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:elasticache.amazonaws.com and event.action:"Create Cache Security Group" and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:elasticache.amazonaws.com and event.action:"Create Cache Security Group" and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:elasticache.amazonaws.com and event.action:("Delete Cache Security Group" or "Authorize Cache Security Group Ingress" or "Revoke Cache Security Group Ingress" or "AuthorizeCacheSecurityGroupEgress" or "RevokeCacheSecurityGroupEgress") and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:elasticache.amazonaws.com and event.action:("Delete Cache Security Group" or "Authorize Cache Security Group Ingress" or "Revoke Cache Security Group Ingress" or "AuthorizeCacheSecurityGroupEgress" or "RevokeCacheSecurityGroupEgress") and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:eventbridge.amazonaws.com and event.action:(DeleteRule or DisableRule) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:eventbridge.amazonaws.com and event.action:(DeleteRule or DisableRule) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ssm.amazonaws.com and event.action:SendCommand and event.outcome:success

event.module:aws and event.dataset:aws.cloudtrail and event.provider:ssm.amazonaws.com and event.action:SendCommand and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:guardduty.amazonaws.com and event.action:DeleteDetector and event.outcome:success

event.action:DeleteDetector and event.dataset:aws.cloudtrail and event.provider:guardduty.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:UpdateAssumeRolePolicy and event.outcome:success

event.module:aws and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:UpdateAssumeRolePolicy and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:UpdateAssumeRolePolicy and aws.cloudtrail.error_code:MalformedPolicyDocumentException and event.outcome:failure

event.module:aws and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:UpdateAssumeRolePolicy and aws.cloudtrail.error_code:MalformedPolicyDocumentException and event.outcome:failure

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:(DeactivateMFADevice or DeleteVirtualMFADevice) and event.outcome:success

event.action:DeactivateMFADevice and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:CreateGroup and event.outcome:success

event.action:CreateGroup and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:DeleteGroup and event.outcome:success

event.action:DeleteGroup and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and event.action:PasswordRecoveryRequested and event.outcome:success

event.action:PasswordRecoveryRequested and event.provider:signin.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:AddUserToGroup and event.outcome:success

event.action:AddUserToGroup and event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and event.action:ConsoleLogin and aws.cloudtrail.user_identity.type:Root and event.outcome:failure

event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and event.action:ConsoleLogin and aws.cloudtrail.user_identity.type:Root and event.outcome:success

event.action:ConsoleLogin and event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and aws.cloudtrail.user_identity.type:Root and event.outcome:success

event.action:ConsoleLogin and event.module:aws and event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and aws.cloudtrail.user_identity.type:Root and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:(CreateDBCluster or CreateGlobalCluster) and event.outcome:success

event.action:(CreateDBCluster or CreateGlobalCluster) and event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:(StopDBCluster or StopDBInstance) and event.outcome:success

event.action:(StopDBCluster or StopDBInstance) and event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:CreateDBInstance and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:CreateDBSecurityGroup and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:DeleteDBSecurityGroup and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:StartExportTask and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com and event.action:RestoreDBInstanceFromDBSnapshot and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:redshift.amazonaws.com and event.action:CreateCluster and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and event.action:ConsoleLogin and aws.cloudtrail.user_identity.type:Root and aws.cloudtrail.console_login.additional_eventdata.mfa_used:false and event.outcome:success

event.module:aws and event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.com and event.action:ConsoleLogin and aws.cloudtrail.user_identity.type:Root and aws.cloudtrail.console_login.additional_eventdata.mfa_used:false and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.com and event.action:DisableDomainTransferLock and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.com and event.action:TransferDomainToAnotherAwsAccount and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.com and event.action:AssociateVPCWithHostedZone and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.com and event.action:AssociateVPCWithHostedZone and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:(CreateRoute or CreateRouteTable) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:(CreateRoute or CreateRouteTable) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:cloudtrail.amazonaws.com and event.action:(ReplaceRoute or ReplaceRouteTableAssociation or DeleteRouteTable or DeleteRoute or DisassociateRouteTable) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:s3.amazonaws.com and event.action:(DeleteBucketPolicy or DeleteBucketReplication or DeleteBucketCors or DeleteBucketEncryption or DeleteBucketLifecycle) and event.outcome:success

event.action:(DeleteBucketPolicy or DeleteBucketReplication or DeleteBucketCors or DeleteBucketEncryption or DeleteBucketLifecycle) and event.dataset:aws.cloudtrail and event.provider:s3.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:(iam.amazonaws.com or sts.amazonaws.com) and event.action:(Assumerolewithsaml or UpdateSAMLProvider) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:(iam.amazonaws.com or sts.amazonaws.com) and event.action:(Assumerolewithsaml or UpdateSAMLProvider) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(AuthorizeSecurityGroupEgress or CreateSecurityGroup or ModifyInstanceAttribute or ModifySecurityGroupRules or RevokeSecurityGroupEgress or RevokeSecurityGroupIngress) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:(AuthorizeSecurityGroupEgress or CreateSecurityGroup or ModifyInstanceAttribute or ModifySecurityGroupRules or RevokeSecurityGroupEgress or RevokeSecurityGroupIngress) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com and event.action:(AuthorizeSecurityGroupEgress or CreateSecurityGroup or ModifyInstanceAttribute or ModifySecurityGroupRules or RevokeSecurityGroupEgress or RevokeSecurityGroupIngress) and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com and event.action:AssumedRole and aws.cloudtrail.user_identity.session_context.session_issuer.type:Role and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com and event.action:AssumedRole and aws.cloudtrail.user_identity.session_context.session_issuer.type:Role and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com and event.action:GetSessionToken and aws.cloudtrail.user_identity.type:IAMUser and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com and event.action:GetSessionToken and aws.cloudtrail.user_identity.type:IAMUser and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:DeleteFlowLogs and event.outcome:success

event.action:DeleteFlowLogs and event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.outcome:success

event.dataset:aws.cloudtrail and event.action:DeleteWebACL and event.outcome:success

event.action:DeleteWebACL and event.dataset:aws.cloudtrail and event.outcome:success

event.dataset:aws.cloudtrail and event.provider:(waf.amazonaws.com or waf-regional.amazonaws.com or wafv2.amazonaws.com) and event.action:(DeleteRule or DeleteRuleGroup) and event.outcome:success

event.dataset:aws.cloudtrail and event.action:(DeleteRule or DeleteRuleGroup) and event.outcome:success

event.module:aws and event.dataset:aws.cloudtrail and event.action:(DeleteRule or DeleteRuleGroup) and event.outcome:success

event.dataset:azure.signinlogs and (azure.signinlogs.properties.risk_level_during_signin:high or azure.signinlogs.properties.risk_level_aggregated:high) and event.outcome:(success or Success)

event.dataset:azure.signinlogs and azure.signinlogs.properties.risk_level_during_signin:high and event.outcome:(success or Success)

event.dataset:azure.signinlogs and azure.signinlogs.properties.risk_state:("confirmedCompromised" or "atRisk") and event.outcome:(success or Success)

event.dataset:azure.signinlogs and azure.signinlogs.properties.app_display_name:"Azure Active Directory PowerShell" and azure.signinlogs.properties.token_issuer_type:AzureAD and event.outcome:(success or Success)

event.dataset:azure.auditlogs and azure.auditlogs.properties.category:RoleManagement and azure.auditlogs.operation_name:"Add member to role" and azure.auditlog s.properties.target_resources.0.modified_properties.1.new_value:"\"Glo bal Administrator\""

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.SECURITY/ALERTSSUPPRESSIONRULES/WRITE" and event.outcome: "success"

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.SECURITY/ALERTSSUPPRESSIONRULES/WRITE" and event.outcome: "success"

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Update application - Certificates and secrets management" and event.outcome:(success or Success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ( "MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE" or "MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE" or "MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION" ) and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION) and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION) and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_ name:"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_ name:"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ( "MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION" or "MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE" ) and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE) and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION or MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE) and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name:( "MICROSOFT.STORAGE/STORAGEACC OUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MANAGEOWNERSHIP/ACTION" or "M ICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MODIFYP ERMISSIONS/ACTION") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name:( "MICROSOFT.STORAGE/STORAGEACC OUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MANAGEOWNERSHIP/ACTION" or "M ICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MODIFYP ERMISSIONS/ACTION") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION and event.outcome:Success

event.dataset:(azure.activitylogs or azure.auditlogs) and event.action:"Update conditional access policy" and event.outcome:(Success or success)

event.dataset:(azure.activitylogs or azure.auditlogs) and ( azure.activitylogs.operation_name:"Update policy" or azure.auditlogs.operation_name:"Update policy" ) and event.outcome:(Success or success)

event.dataset:(azure.activitylogs or azure.auditlogs) and ( azure.activitylogs.operation_name:"Update policy" or azure.auditlogs.operation_name:"Update policy" ) and event.outcome:success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE and event.outcome:Success

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Invite external user" and azure.auditlogs.properties.target_resources.*.display_name:guest and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Invite external user" and azure.auditlogs.properties.target_resources.*.display_name:guest and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.NETWORK/FRONTDOORWEBAPPLICATIONFIREWALLPOLICIES/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ( "MICROSOFT.NETWORK/*/STARTPACKETCAPTURE/ACTION" or "MICROSOFT.NETWORK/*/VPNCONNECTIONS/STARTPACKETCAPTURE/ACTION" or "MICROSOFT.NETWORK/*/PACKETCAPTURES/WRITE" ) and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ( "MICROSOFT.NETWORK/*/STARTPACKETCAPTURE/ACTION" or "MICROSOFT.NETWORK/*/VPNCONNECTIONS/STARTPACKETCAPTURE/ACTION" or "MICROSOFT.NETWORK/*/PACKETCAPTURES/WRITE" ) and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.properties.category:RoleManagement and azure.auditlogs.operation_name:("Add eligible member to role in PIM completed (permanent)" or "Add member to role in PIM completed (timebound)") and azure.auditlogs.properties.target_resources.*.display_name:"Global Administrator" and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.properties.category:RoleManagement and azure.auditlogs.operation_name:("Add eligible member to role in PIM completed (permanent)" or "Add member to role in PIM completed (timebound)") and azure.auditlogs.properties.target_resources.*.display_name:"Global Administrator" and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name:"MICROSOFT.KEYVAULT/VAULTS/WRITE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name:MICROSOFT.KEYVAULT/VAULTS/WRITE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name:MICROSOFT.KEYVAULT/VAULTS/WRITE and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ("MICROSOFT.KUBERNETES/CONN ECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE" or "MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUS TERROLEBINDINGS/WRITE") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name: ("MICROSOFT.KUBERNETES/CONN ECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE" or "MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUS TERROLEBINDINGS/WRITE") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE and event.outcome:Success

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Update role setting in PIM" and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Update role setting in PIM" and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE and event.outcome:Success

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add service principal" and event.outcome:(success or Success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add service principal credentials" and event.outcome:(success or Success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add service principal credentials." and event.outcome:(success or Success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :"MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION" and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION and event.outcome:Success

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :("MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION" or "MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE" or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE" or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE" or "MICROSOFT.NETWORK/VIRTUALHUBS/DELETE" or "MICROSOFT.NETWORK/VIRTUALHUBS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :("MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION" or "MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE" or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE" or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE" or "MICROSOFT.NETWORK/VIRTUALHUBS/DELETE" or "MICROSOFT.NETWORK/VIRTUALHUBS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE") and event.outcome:(Success or success)

event.dataset:azure.activitylogs and azure.activitylogs.operation_name :("MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE" or "MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION" or "MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE"or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE" or "MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE" or "MICROSOFT.NETWORK/VIRTUALHUBS/DELETE" or "MICROSOFT.NETWORK/VIRTUALHUBS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE" or "MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE") and event.outcome:(Success or success)

event.category:process and event.type:(start or process_started) and process.name:(base16 or base32 or base32plain or base32hex)

event.action:(executed or process_started) and process.name:(base16 or base32 or base32plain or base32hex)

event.category:file and event.type:change and process.name:(* and not (sudo or vim or zsh or env or nano or bash or Terminal or xpcproxy or login or cat or cp or launchctl or java)) and not process.executable:(/Applications/* or /private/var/folders/* or /usr/local/*) and file.path:(/private/etc/rc.local or /etc/rc.local or /home/*/.profile or /home/*/.profile1 or /home/*/.bash_profile or /home/*/.bash_profile1 or /home/*/.bashrc or /Users/*/.bash_profile or /Users/*/.zshenv)

process where event.type == "start" and event.action == "exec" and user.name == "root" and process.executable : ( "/dev/shm/*", "/run/shm/*", "/var/run/*", "/var/lock/*" ) and not process.executable : ( "/var/run/docker/*")

process where event.type == "start" and event.action == "exec" and user.name == "root" and process.executable : ( "/dev/shm/*", "/run/shm/*", "/var/run/*", "/var/lock/*" ) and not process.executable : ( "/var/run/docker/*")

process where event.type == "start" and event.action == "exec" and user.name == "root" and process.executable : ( "/dev/shm/*", "/run/shm/*", "/var/run/*", "/var/lock/*" )

process where event.type != "end" and process.executable : "/usr/sbin/tc" and process.args : "filter" and process.args : "add" and process.args : "bpf" and not process.parent.executable: "/usr/sbin/libvirtd"

process where event.type == "start" and process.parent.name : "eventvwr.exe" and not process.executable : ("?:\\Windows\\SysWOW64\\mmc.exe", "?:\\Windows\\System32\\mmc.exe", "?:\\Windows\\SysWOW64\\WerFault.exe", "?:\\Windows\\System32\\WerFault.exe")

process where event.type in ("start", "process_started") and process.parent.name : "eventvwr.exe" and not process.executable : ("?:\\Windows\\SysWOW64\\mmc.exe", "?:\\Windows\\System32\\mmc.exe", "?:\\Windows\\SysWOW64\\WerFault.exe", "?:\\Windows\\System32\\WerFault.exe")

process where event.type in ("start", "process_started") and process.parent.name : "eventvwr.exe" and not process.executable : ("?:\\Windows\\SysWOW64\\mmc.exe", "?:\\Windows\\System32\\mmc.exe", "?:\\Windows\\SysWOW64\\WerFault.exe", "?:\\Windows\\System32\\WerFault.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:eventvwr.exe and not process.executable:("C:\Windows\SysWOW64\mmc.exe" or "C:\Windows\System32\mmc.exe")

process.parent.name:eventvwr.exe and event.action:"Process Create (rule: ProcessCreate)" and not process.executable:("C:\Windows\SysWOW64\mmc.exe" or "C:\Windows\System32\mmc.exe")

process where event.type == "start" and (process.executable : "/usr/sbin/chkconfig" and process.args : "--add") or (process.args : "*chkconfig" and process.args : "--add")

process where event.type == "start" and (process.executable : "/usr/sbin/chkconfig" and process.args : "--add") or (process.args : "*chkconfig" and process.args : "--add")

process where event.action == "start" and (process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name == "PowerShell.EXE") and (process.args : "*Clear-History*" or (process.args : ("*Remove- Item*", "rm") and process.args : ("*ConsoleHost_history.txt*", "*(Get- PSReadlineOption).HistorySavePath*")) or (process.args : "*Set- PSReadlineOption*" and process.args : "*SaveNothing*"))

process where event.type == "start" and ( (process.name : "wevtutil.exe" or process.pe.original_file_name == "wevtutil.exe") and process.args : ("/e:false", "cl", "clear-log") ) or ( process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "Clear-EventLog" )

process where event.type in ("process_started", "start") and (process.name : "wevtutil.exe" or process.pe.original_file_name == "wevtutil.exe") and process.args : ("/e:false", "cl", "clear-log") or process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "Clear-EventLog"

process where event.type in ("process_started", "start") and (process.name : "wevtutil.exe" or process.pe.original_file_name == "wevtutil.exe") and process.args : ("/e:false", "cl", "clear-log") or process.name : "powershell.exe" and process.args : "Clear- EventLog"

event.category:process and event.type:(process_started or start) and (process.name:"wevtutil.exe" or process.pe.original_file_name:"wevtutil.exe") and process.args:("/e:false" or cl or "clear-log") or process.name:"powershell.exe" and process.args:"Clear-EventLog"

event.category:process and event.type:(start or process_started) and process.name:wevtutil.exe and process.args:cl or process.name:powershell.exe and process.args:Clear-EventLog

event.action:"Process Create (rule: ProcessCreate)" and process.name:wevtutil.exe and process.args:cl or process.name:powershell.exe and process.args:Clear-EventLog

event.action:"Process Create (rule: ProcessCreate)" and (process.name:"wevtutil.exe" and process.args:"cl") or (process.name:"powershell.exe" and process.args:"Clear-EventLog")

event.category:(network OR network_traffic) AND type:(tls OR http) AND network.transport:tcp AND destination.domain:/[a-z]{3}.stage.[0-9]{8}\..*/

event.category:(network OR network_traffic) AND type:(tls OR http) AND network.transport:tcp AND destination.domain:/[a-z]{3}.stage.[0-9]{8}\..*/

process where event.type == "start" and process.name: ("cmd.exe", "powershell.exe") and process.parent.name: ( "ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe", "NetFlowService*.exe", "SolarWinds.Administration*.exe", "SolarWinds.Collector.Service*.exe", "SolarwindsDiagnostics*.exe" )

process where event.type in ("start", "process_started") and process.name: ("cmd.exe", "powershell.exe") and process.parent.name: ( "ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe", "NetFlowService*.exe", "SolarWinds.Administration*.exe", "SolarWinds.Collector.Service*.exe", "SolarwindsDiagnostics*.exe" )

sequence by process.entity_id [process where process.name : "cmd.exe" and event.type == "start"] [network where process.name : "cmd.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name : "cmd.exe" and event.type == "start"] [network where process.name : "cmd.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:cmd.exe and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:cmd.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:cmd.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:10.0.0.0/8 and not destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16

process where event.type == "start" and process.name : ("cmd.exe", "powershell.exe") and process.parent.name : "rundll32.exe" and process.parent.command_line != null and /* common FPs can be added here */ not process.parent.args : ("C:\\Windows\\System32\\SHELL32.dll,RunAsNewUser_RunDLL", "C:\\WINDOWS\\*.tmp,zzzzInvokeManagedCustomActionOutOfProc")

process where event.type in ("start", "process_started") and process.name : ("cmd.exe", "powershell.exe") and process.parent.name : "rundll32.exe" and /* common FPs can be added here */ not process.parent.args : "C:\\Windows\\System32\\SHELL32.dll,RunAsNewUser_RunDLL"

registry where (registry.path : "HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll", "C:\\*\\scrobj.dll") and not registry.path : "*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general COM Registry changes on Users Hive is less noisy and worth alerting */ (registry.path : ("HKEY_USERS\\*Classes\\*\\InprocServer32\\", "HKEY_USERS\\*Classes\\*\\LocalServer32\\", "HKEY_USERS\\*Classes\\*\\DelegateExecute\\", "HKEY_USERS\\*Classes\\*\\TreatAs\\", "HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and not (process.executable : "?:\\Program Files*\\Veeam\\Backup and Replication\\Console\\veeam.backup.shell.exe" and registry.path : "HKEY_USERS\\S-1-5-21-*_Classes\\CLSID\\*\\LocalServer32\\") and /* not necessary but good for filtering privileged installations */ user.domain != "NT AUTHORITY" ) and /* removes false-positives generated by OneDrive and Teams */ not process.name : ("OneDrive.exe","OneDriveSetup.exe","FileSyncConfig.exe","Teams.exe") and /* Teams DLL loaded by regsvr */ not (process.name: "regsvr32.exe" and registry.data.strings : "*Microsoft.Teams.*.dll")

registry where (registry.path : "HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll", "C:\\*\\scrobj.dll") and not registry.path : "*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general COM Registry changes on Users Hive is less noisy and worth alerting */ (registry.path : ("HKEY_USERS\\*Classes\\*\\InprocServer32\\", "HKEY_USERS\\*Classes\\*\\LocalServer32\\", "HKEY_USERS\\*Classes\\*\\DelegateExecute\\", "HKEY_USERS\\*Classes\\*\\TreatAs\\", "HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and not (process.executable : "?:\\Program Files*\\Veeam\\Backup and Replication\\Console\\veeam.backup.shell.exe" and registry.path : "HKEY_USERS\\S-1-5-21-*_Classes\\CLSID\\*\\LocalServer32\\") and /* not necessary but good for filtering privileged installations */ user.domain != "NT AUTHORITY" ) and /* removes false-positives generated by OneDrive and Teams */ not process.name : ("OneDrive.exe","OneDriveSetup.exe","FileSyncConfig.exe","Teams.exe") and /* Teams DLL loaded by regsvr */ not (process.name: "regsvr32.exe" and registry.data.strings : "*Microsoft.Teams.*.dll")

registry where /* uncomment once length is stable length(bytes_written_string) &gt; 0 and */ (registry.path : "HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll", "C:\\*\\scrobj.dll") and not registry.path : "*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general COM Registry changes on Users Hive is less noisy and worth alerting */ (registry.path : ("HKEY_USERS\\*Classes\\*\\InprocServer32\\", "HKEY_USERS\\*Classes\\*\\LocalServer32\\", "HKEY_USERS\\*Classes\\*\\DelegateExecute\\", "HKEY_USERS\\*Classes\\*\\TreatAs\\", "HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and not (process.executable : "?:\\Program Files*\\Veeam\\Backup and Replication\\Console\\veeam.backup.shell.exe" and registry.path : "HKEY_USERS\\S-1-5-21-*_Classes\\CLSID\\*\\LocalServer32\\") and /* not necessary but good for filtering privileged installations */ user.domain != "NT AUTHORITY")

registry where /* uncomment once length is stable length(bytes_written_string) &gt; 0 and */ (registry.path : "HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll", "C:\\*\\scrobj.dll") and not registry.path : "*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general COM Registry changes on Users Hive is less noisy and worth alerting */ (registry.path : ("HKEY_USERS\\*Classes\\*\\InprocServer32\\", "HKEY_USERS\\*Classes\\*\\LocalServer32\\", "HKEY_USERS\\*Classes\\*\\DelegateExecute\\", "HKEY_USERS\\*Classes\\*\\TreatAs\\", "HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and /* not necessary but good for filtering privileged installations */ user.domain != "NT AUTHORITY")

registry where /* uncomment once length is stable length(bytes_written_string) &gt; 0 and */ (registry.path : "HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll", "C:\\*\\scrobj.dll") and not registry.path : "*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general COM Registry changes on Users Hive is less noisy and worth alerting */ (registry.path : ("HKEY_USERS\\*Classes\\*\\InprocXServer32\\", "HKEY_USERS\\*Classes\\*\\LocalServer32\\", "HKEY_USERS\\*Classes\\*\\DelegateExecute\\", "HKEY_USERS\\*Classes\\*\\TreatAs\\", "HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and /* not necessary but good for filtering privileged installations */ user.domain != "NT AUTHORITY")

process where event.type == "start" and process.name : "conhost.exe" and process.parent.name : ("lsass.exe", "services.exe", "smss.exe", "winlogon.exe", "explorer.exe", "dllhost.exe", "rundll32.exe", "regsvr32.exe", "userinit.exe", "wininit.exe", "spoolsv.exe", "ctfmon.exe") and not (process.parent.name : "rundll32.exe" and process.parent.args : ("?:\\Windows\\Installer\\MSI*.tmp,zzzzInvokeMan agedCustomActionOutOfProc", "?:\\WINDOWS\\system32\\PcaSvc.dll,PcaPatchSdbTask", "?:\\WINDOWS\\system32\\davclnt.dll,DavSetCookie"))

process where event.type in ("start", "process_started") and process.name : "conhost.exe" and process.parent.name : ("svchost.exe", "lsass.exe", "services.exe", "smss.exe", "winlogon.exe", "explorer.exe", "dllhost.exe", "rundll32.exe", "regsvr32.exe", "userinit.exe", "wininit.exe", "spoolsv.exe", "wermgr.exe", "csrss.exe", "ctfmon.exe")

event.category:process and event.type:(start or process_started) and process.name:conhost.exe and process.parent.name:(svchost.exe or lsass.exe or services.exe or smss.exe or winlogon.exe or explorer.exe or dllhost.exe or rundll32.exe or regsvr32.exe or userinit.exe or wininit.exe or spoolsv.exe or wermgr.exe or csrss.exe or ctfmon.exe)

network where network.protocol == "dns" and /* Add new free SSL certificate provider domains here */ dns.question.name : ("*letsencrypt.org", "*.sslforfree.com", "*.zerossl.com", "*.freessl.org") and /* Native Windows process paths that are unlikely to have network connections to domains secured using free SSL certificates */ process.executable : ("C:\\Windows\\System32\\*.exe", "C:\\Windows\\System\\*.exe", "C:\\Windows\\SysWOW64\\*.exe", "C:\\Windows\\Microsoft.NET\\Framework*\\*.exe", "C:\\Windows\\explorer.exe", "C:\\Windows\\notepad.exe") and /* Insert noisy false positives here */ not process.name : ("svchost.exe", "MicrosoftEdge*.exe", "msedge.exe")

network where network.protocol == "dns" and /* Add new free SSL certificate provider domains here */ dns.question.name : ("*letsencrypt.org", "*.sslforfree.com", "*.zerossl.com", "*.freessl.org") and /* Native Windows process paths that are unlikely to have network connections to domains secured using free SSL certificates */ process.executable : ("C:\\Windows\\System32\\*.exe", "C:\\Windows\\System\\*.exe", "C:\\Windows\\SysWOW64\\*.exe", "C:\\Windows\\Microsoft.NET\\Framework*\\*.exe", "C:\\Windows\\explorer.exe", "C:\\Windows\\notepad.exe") and /* Insert noisy false positives here */ not process.name : ("svchost.exe", "MicrosoftEdge*.exe", "msedge.exe")

network where network.protocol == "dns" and process.name != null and user.id not in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and /* Add new WebSvc domains here */ dns.question.name : ( "raw.githubusercontent.*", "*.pastebin.*", "*drive.google.*", "*docs.live.*", "*api.dropboxapi.*", "*dropboxusercontent.*", "*onedrive.*", "*4shared.*", "*.file.io", "*filebin.net", "*slack-files.com", "*ghostbin.*", "*ngrok.*", "*portmap.*", "*serveo.net", "*localtunnel.me", "*pagekite.me", "*localxpose.io", "*notabug.org", "rawcdn.githack.*", "paste.nrecom.net", "zerobin.net", "controlc.com", "requestbin.net", "cdn.discordapp.com", "discordapp.com", "discord.com" ) and /* Insert noisy false positives here */ not process.executable : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\WWAHost.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\System32\\MicrosoftEdgeCP.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Users\\*\\AppData\\Loc al\\Google\\Chrome\\Application\\chrome.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe", "?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe", "?:\\Windows\\system32\\mobsync.exe", "?:\\Windows\\SysWOW64\\mobsync.exe", "?:\\Users\\*\\AppData\\Local\\Discord\\app-*\\Discord.exe" )

network where network.protocol == "dns" and process.name != null and user.id not in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and /* Add new WebSvc domains here */ dns.question.name : ( "raw.githubusercontent.*", "*.pastebin.*", "*drive.google.*", "*docs.live.*", "*api.dropboxapi.*", "*dropboxusercontent.*", "*onedrive.*", "*4shared.*", "*.file.io", "*filebin.net", "*slack-files.com", "*ghostbin.*", "*ngrok.*", "*portmap.*", "*serveo.net", "*localtunnel.me", "*pagekite.me", "*localxpose.io", "*notabug.org", "rawcdn.githack.*", "paste.nrecom.net", "zerobin.net", "controlc.com", "requestbin.net", "cdn.discordapp.com", "discordapp.com", "discord.com" ) and /* Insert noisy false positives here */ not process.executable : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\WWAHost.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\System32\\MicrosoftEdgeCP.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Users\\*\\AppData\\Loc al\\Google\\Chrome\\Application\\chrome.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe", "?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe", "?:\\Windows\\system32\\mobsync.exe", "?:\\Windows\\SysWOW64\\mobsync.exe", "?:\\Users\\*\\AppData\\Local\\Discord\\-*\\Discord.exe" )

network where network.protocol == "dns" and process.name != null and user.id not in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and /* Add new WebSvc domains here */ dns.question.name : ( "raw.githubusercontent.*", "*.pastebin.*", "*drive.google.*", "*docs.live.*", "*api.dropboxapi.*", "*dropboxusercontent.*", "*onedrive.*", "*4shared.*", "*.file.io", "*filebin.net", "*slack-files.com", "*ghostbin.*", "*ngrok.*", "*portmap.*", "*serveo.net", "*localtunnel.me", "*pagekite.me", "*localxpose.io", "*notabug.org", "rawcdn.githack.*", "paste.nrecom.net", "zerobin.net", "controlc.com", "requestbin.net" ) and /* Insert noisy false positives here */ not process.executable : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\WWAHost.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\System32\\MicrosoftEdgeCP.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Users\\*\\AppData\\Loc al\\Google\\Chrome\\Application\\chrome.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe", "?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe", "?:\\Windows\\system32\\mobsync.exe", "?:\\Windows\\SysWOW64\\mobsync.exe" )

network where network.protocol == "dns" and /* Add new WebSvc domains here */ dns.question.name : ( "*.githubusercontent.*", "*.pastebin.*", "*drive.google.*", "*docs.live.*", "*api.dropboxapi.*", "*dropboxusercontent.*", "*onedrive.*", "*4shared.*", "*.file.io", "*filebin.net", "*slack-files.com", "*ghostbin.*", "*ngrok.*", "*portmap.*", "*serveo.net", "*localtunnel.me", "*pagekite.me", "*localxpose.io", "*notabug.org" ) and /* Insert noisy false positives here */ not process.name : ( "MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe", "Dropbox.exe", "slack.exe", "svchost.exe", "thunderbird.exe", "outlook.exe", "OneDrive.exe" )

network where network.protocol == "dns" and /* Add new WebSvc domains here */ wildcard(dns.question.name, "*.githubusercontent.*", "*.pastebin.*", "*drive.google.*", "*docs.live.*", "*api.dropboxapi.*", "*dropboxusercontent.*", "*onedrive.*", "*4shared.*", "*.file.io", "*filebin.net", "*slack-files.com", "*ghostbin.*", "*ngrok.*", "*portmap.*", "*serveo.net", "*localtunnel.me", "*pagekite.me", "*localxpose.io", "*notabug.org" ) and /* Insert noisy false positives here */ not process.name in ("MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe", "Dropbox.exe", "slack.exe", "svchost.exe", "thunderbird.exe", "outlook.exe", "OneDrive.exe")

sequence by process.entity_id [process where process.name == "telnet" and event.type == "start"] [network where process.name == "telnet" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name == "telnet" and event.type == "start"] [network where process.name == "telnet" and not cidrmatch(destination.ip, "127.0.0.0/8", "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "FE80::/10", "::1/128")]

event.category:network and event.type:(connection or start) and process.name:telnet and not destination.ip:(127.0.0.0/8 or 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10" or "::1/128")

event.action:("connected-to" or "network_flow") and process.name:telnet and not destination.ip:(127.0.0.0/8 or 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10" or "::1/128")

sequence by process.entity_id [process where process.name == "telnet" and event.type == "start"] [network where process.name == "telnet" and cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name == "telnet" and event.type == "start"] [network where process.name == "telnet" and cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "FE80::/10") and not cidrmatch(destination.ip, "127.0.0.0/8", "::1/128")]

event.category:network and event.type:(connection or start) and process.name:telnet and destination.ip:((10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10") and not (127.0.0.0/8 or "::1/128"))

event.action:("connected-to" or "network_flow") and process.name:telnet and destination.ip:((10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10") and not (127.0.0.0/8 or "::1/128"))

process where event.type == "start" and process.executable : ("?:\\Windows\\SysWOW64\\control.exe", "?:\\Windows\\System32\\control.exe") and process.command_line : ("*.jpg*", "*.png*", "*.gif*", "*.bmp*", "*.jpeg*", "*.TIFF*", "*.inf*", "*.cpl:*/*", "*../../..*", "*/AppData/Local/*", "*:\\Users\\Public\\*", "*\\AppData\\Local\\*")

process where event.type in ("start", "process_started") and process.executable : ("?:\\Windows\\SysWOW64\\control.exe", "?:\\Windows\\System32\\control.exe") and process.command_line : ("*.jpg*", "*.png*", "*.gif*", "*.bmp*", "*.jpeg*", "*.TIFF*", "*.inf*", "*.cpl:*/*", "*../../..*", "*/AppData/Local/*", "*:\\Users\\Public\\*", "*\\AppData\\Local\\*")

process where event.type in ("start", "process_started") and process.executable : ("?:\\Windows\\SysWOW64\\control.exe", "?:\\Windows\\System32\\control.exe") and process.command_line : ("*.jpg*", "*.png*", "*.gif*", "*.bmp*", "*.jpeg*", "*.TIFF*", "*.inf*", "*.dat*", "*.cpl:*/*", "*../../..*", "*/AppData/Local/*", "*:\\Users\\Public\\*", "*\\AppData\\Local\\*")

registry where registry.path : "HKLM\\SAM\\SAM\\Domains\\Account\\Users\\Names\\*$\\"

process where event.type in ("start", "process_started") and process.working_directory in ("/tmp", "/var/tmp", "/dev/shm") and process.args regex~ """\.[a-z0-9_\-][a-z0-9_\-\.]{1,254}""" and not process.name in ("ls", "find", "grep")

process where event.type in ("start", "process_started") and process.working_directory in ("/tmp", "/var/tmp", "/dev/shm") and process.args regex~ """\.[a-z0-9_\-][a-z0-9_\-\.]{1,254}""" and not process.name in ("ls", "find")

event.category:process AND event.type:(start or process_started) AND process.working_directory:("/tmp" or "/var/tmp" or "/dev/shm") AND process.args:/\.[a-zA-Z0-9_\-][a-zA-Z0-9_\-\.]{1,254}/ AND NOT process.name:(ls or find)

file where event.type != "deletion" and file.path : ( "/System/Library/LaunchAgents/.*.plist", "/Library/LaunchAgents/.*.plist", "/Users/*/Library/LaunchAgents/.*.plist", "/System/Library/LaunchDaemons/.*.plist", "/Library/LaunchDaemons/.*.plist" )

file where event.type != "deletion" and file.path : ( "/System/Library/LaunchAgents/.*.plist", "/Library/LaunchAgents/.*.plist", "/Users/*/Library/LaunchAgents/.*.plist", "/System/Library/LaunchDaemons/.*.plist", "/Library/LaunchDaemons/.*.plist" )

process where event.type in ("start", "process_started") and process.name : "osascript" and process.command_line : "osascript*login item*hidden:true*"

file where event.action : "creation" and file.extension == "so" and file.name : ".*.so"

file where event.action : "creation" and file.extension == "so" and file.name : ".*.so"

file where event.type != "deletion" and file.path : ("?:\\Windows\\S YSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\ScheduledTasks\\Sche duledTasks.xml", "?:\\Windows\\SYSVOL\\domain\\Policies \\*\\MACHINE\\Preferences\\Services\\Services.xml") and not process.name : "dfsrs.exe"

file where event.type != "deletion" and file.path : ("?:\\Windows\\S YSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\ScheduledTasks\\Sche duledTasks.xml", "?:\\Windows\\SYSVOL\\domain\\Policies \\*\\MACHINE\\Preferences\\Preferences\\Services\\Services.xml") and not process.name : "dfsrs.exe"

event.category:file and not event.type:deletion and file.path:(C\:\\Wi ndows\\SYSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\ScheduledTas ks\\ScheduledTasks.xml or C\:\\Windows\\SYSVOL\\domain\\Policies\\*\\M ACHINE\\Preferences\\Preferences\\Services\\Services.xml) and not process.name:dfsrs.exe

file where event.type != "deletion" and file.name : ("ntds_capi_*.pfx", "ntds_capi_*.pvk")

event.category:file and not event.type:deletion and file.name:(ntds_capi_*.pfx or ntds_capi_*.pvk)

registry where event.type in ("creation", "change") and registry.path : ( "HKLM\\Software\\Microsoft\\SystemCertific ates\\Root\\Certificates\\*\\Blob", "HKLM\\Software\\Microsoft\\ SystemCertificates\\AuthRoot\\Certificates\\*\\Blob", "HKLM\\Sof tware\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\*\ \Blob", "HKLM\\Software\\Policies\\Microsoft\\SystemCertificates \\AuthRoot\\Certificates\\*\\Blob" ) and not process.executable : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\*.exe", "?:\\Windows\\SysWOW64\\*.exe", "?:\\Windows\\Sysmon64.exe", "?:\\Windows\\Sysmon.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Windows\\WinSxS\\*.exe", "?:\\Windows\\UUS\\amd64\\MoUsoCoreWorker.exe")

registry where event.type in ("creation", "change") and registry.path : ( "HKLM\\Software\\Microsoft\\SystemCertific ates\\Root\\Certificates\\*\\Blob", "HKLM\\Software\\Microsoft\\ SystemCertificates\\AuthRoot\\Certificates\\*\\Blob", "HKLM\\Sof tware\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\*\ \Blob", "HKLM\\Software\\Policies\\Microsoft\\SystemCertificates \\AuthRoot\\Certificates\\*\\Blob" )

process where event.type == "start" and process.pe.original_file_name == "reg.exe" and process.args : ("save", "export") and process.args : ("hklm\\sam", "hklm\\security")

process where event.type in ("start", "process_started") and process.pe.original_file_name == "reg.exe" and process.args : ("save", "export") and process.args : ("hklm\\sam", "hklm\\security")

process where event.type in ("start", "process_started") and process.pe.original_file_name == "reg.exe" and process.args : ("save", "export") and process.args : ("hklm\\sam", "hklm\\security") and not process.parent.executable : "C:\\Program Files*\\Rapid7\\Insight Agent\\components\\insight_agent\\*\\ir_agent.exe"

process where event.type in ("start", "process_started") and process.pe.original_file_name == "reg.exe" and process.args : ("save", "export") and process.args : ("hklm\\sam", "hklm\\security") and not process.parent.executable : "C:\\Program Files*\\Rapid7\\Insight Agent\\components\\insight_agent\\*\\ir_agent.exe"

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:cred_theft_event or endgame.event_subtype_full:cred_theft_event)

event.kind:alert and event.module:endgame and event.action:cred_theft_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:cred_theft_event or endgame.event_subtype_full:cred_theft_event)

event.kind:alert and event.module:endgame and event.action:cred_theft_event and endgame.metadata.type:prevention

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:token_manipulation_event or endgame.event_subtype_full:token_manipulation_event)

event.kind:alert and event.module:endgame and event.action:token_manipulation_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:token_manipulation_event or endgame.event_subtype_full:token_manipulation_event)

event.kind:alert and event.module:endgame and event.action:token_manipulation_event and endgame.metadata.type:prevention

event.dataset:cyberarkpas.audit and event.type:error

event.dataset:cyberarkpas.audit and event.code:(4 or 22 or 24 or 31 or 38 or 57 or 60 or 130 or 295 or 300 or 302 or 308 or 319 or 344 or 346 or 359 or 361 or 378 or 380 or 411) and not event.type:error

event.category:(network or network_traffic) and (tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83 or tls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C or tls .server.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD1 6D3CF9D94D390C)

event.category:(network or network_traffic) and (tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83 or tls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C or tls.s erver.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD16D 3CF9D94D390C)

process where event.type == "start" and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "deletejournal" and process.args : "usn"

process where event.type in ("start", "process_started") and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "deletejournal" and process.args : "usn"

process where event.type in ("start", "process_started") and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "deletejournal" and process.args : "usn"

event.category:process and event.type:(start or process_started) and process.name:fsutil.exe and process.args:(deletejournal and usn)

event.action:"Process Create (rule: ProcessCreate)" and process.name:fsutil.exe and process.args:(deletejournal and usn)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"fsutil.exe" and process.args:("usn" and "deletejournal")

process where event.type == "start" and (process.name : "wbadmin.exe" or process.pe.original_file_name == "WBADMIN.EXE") and process.args : "catalog" and process.args : "delete"

process where event.type in ("start", "process_started") and (process.name : "wbadmin.exe" or process.pe.original_file_name == "WBADMIN.EXE") and process.args : "catalog" and process.args : "delete"

event.category:process and event.type:(start or process_started) and process.name:wbadmin.exe and process.args:(catalog and delete)

event.action:"Process Create (rule: ProcessCreate)" and process.name:wbadmin.exe and process.args:(catalog and delete)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"wbadmin.exe" and process.args:("delete" and "catalog")

sequence by process.entity_id [process where event.type == "start" and host.os.name == "Windows" and process.pid != 4 and not (process.executable : "D:\\EnterpriseCare\\tools\\jre.1\\bin\\java.exe" and process.args : "com.emeraldcube.prism.launcher.Invoker") and not (process.executable : "C:\\Docusnap 11\\Tools\\nmap\\nmap.exe" and process.args : "smb-os-discovery.nse") and not process.executable : ("?:\\Program Files\\SentinelOne\\Sentinel Agent *\\Ranger\\SentinelRanger.exe", "?:\\Program Files\\Ivanti\\Security Controls\\ST.EngineHost.exe", "?:\\Program Files (x86)\\Fortinet\\FSAE\\collectoragent.exe", "?:\\Program Files (x86)\\Nmap\\nmap.exe", "?:\\Program Files\\Azure Advanced Threat Protection Sensor\\*\\Microsoft.Tri.Sensor.exe", "?:\\Program Files\\CloudMatters\\auvik\\AuvikService-release-*\\AuvikService.exe", "?:\\Program Files\\uptime software\\uptime\\UptimeDataCollector.exe", "?:\\Program Files\\CloudMatters\\auvik\\AuvikAgentService.exe", "?:\\Program Files\\Rumble\\rumble-agent-*.exe")] [network where destination.port == 445 and process.pid != 4 and not cidrmatch(destination.ip, "127.0.0.1", "::1")]

sequence by process.entity_id [process where event.type == "start" and process.pid != 4] [network where destination.port == 445 and process.pid != 4 and not cidrmatch(destination.ip, "127.0.0.1", "::1")]

event.category:network and event.type:connection and destination.port:445 and not process.pid:4 and not destination.ip:(127.0.0.1 or "::1")

event.action:"Network connection detected (rule: NetworkConnect)" and destination.port:445 and not process.pid:4 and not destination.ip:(127.0.0.1 or "::1")

event.action:"Network connection detected (rule: NetworkConnect)" and destination.port:445 and not process.pid:4 and not destination.ip:("127.0.0.1" or "::1")

process where event.type == "start" and ((process.name:"logman.exe" or process.pe.original_file_name == "Logman.exe") and process.args : "EventLog-*" and process.args : ("stop", "delete")) or ((process.name : ("pwsh.exe", "powershell.exe", "powershell_ise.exe") or process.pe.original_file_name in ("pwsh.exe", "powershell.exe", "powershell_ise.exe")) and process.args : "Set-Service" and process.args: "EventLog" and process.args : "Disabled") or ((process.name:"auditpol.exe" or process.pe.original_file_name == "AUDITPOL.EXE") and process.args : "/success:disable")

process where event.type in ("start", "process_started") and ((process.name:"logman.exe" or process.pe.original_file_name == "Logman.exe") and process.args : "EventLog-*" and process.args : ("stop", "delete")) or ((process.name : ("pwsh.exe", "powershell.exe", "powershell_ise.exe") or process.pe.original_file_name in ("pwsh.exe", "powershell.exe", "powershell_ise.exe")) and process.args : "Set-Service" and process.args: "EventLog" and process.args : "Disabled") or ((process.name:"auditpol.exe" or process.pe.original_file_name == "AUDITPOL.EXE") and process.args : "/success:disable")

process where event.type in ("start", "process_started") and ((process.name:"logman.exe" or process.pe.original_file_name == "Logman.exe") and process.args : "EventLog-*" and process.args : ("stop", "delete")) or ((process.name : ("pwsh.exe", "powershell.exe", "powershell_ise.exe") or process.pe.original_file_name in ("pwsh.exe", "powershell.exe", "powershell_ise.exe")) and process.args : "Set-Service" and process.args: "EventLog" and process.args : "Disabled") or ((process.name:"auditpol.exe" or process.pe.original_file_name == "AUDITPOL.EXE") and process.args : "/success:disable")

process where event.type == "start" and process.name : "netsh.exe" and ( (process.args : "disable" and process.args : "firewall" and process.args : "set") or (process.args : "advfirewall" and process.args : "off" and process.args : "state") )

process where event.type in ("start", "process_started") and process.name : "netsh.exe" and (process.args : "disable" and process.args : "firewall" and process.args : "set") or (process.args : "advfirewall" and process.args : "off" and process.args : "state")

event.category:process and event.type:(start or process_started) and process.name:netsh.exe and process.args:(disable and firewall and set) or process.args:(advfirewall and off and state)

event.action:"Process Create (rule: ProcessCreate)" and process.name:netsh.exe and process.args:(disable and firewall and set) or process.args:(advfirewall and off and state)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"netsh.exe" and process.args:("firewall" and "set" and "disable") or process.args:("advfirewall" and "state" and "off")

registry where event.type == "change" and registry.path : ( "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\ \EnableLUA", "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion \\Policies\\System\\ConsentPromptBehaviorAdmin", "HKLM\\SOFTWARE \\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecure Desktop" ) and registry.data.strings : ("0", "0x00000000")

registry where event.type == "change" and registry.path : ( "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\ \EnableLUA", "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion \\Policies\\System\\ConsentPromptBehaviorAdmin", "HKLM\\SOFTWARE \\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecure Desktop" ) and registry.data.strings : "0"

process where event.type == "start" and (process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name in ("powershell.exe", "pwsh.dll", "powershell_ise.exe")) and process.args : "Set-MpPreference" and process.args : ("-Disable*", "Disabled", "NeverSend", "-Exclusion*")

process where event.type == "start" and (process.name : ("powershell.exe", "pwsh.exe") or process.pe.original_file_name == "PowerShell.EXE") and process.args : "Set-MpPreference" and process.args : ("-Disable*", "Disabled", "NeverSend", "-Exclusion*")

registry where event.type in ("creation", "change") and (registry.path : "*\\SOFTWARE\\Policies\\Microsoft\\Edge\\BuiltInDnsClientEnabled" and registry.data.strings : "1") or (registry.path : "*\\SOFTWARE\\Google\\Chrome\\DnsOverHttpsMode" and registry.data.strings : "secure") or (registry.path : "*\\SOFTWARE\\Policies\\Mozilla\\Firefox\\DNSOverHTTPS" and registry.data.strings : "1")

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:ADD_TRUSTED_DOMAINS

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:ADD_TRUSTED_DOMAINS

event.category:process and event.type:start and process.name:(defaults or mkpassdb) and process.args:(ShadowHashData or "-dump")

process where event.type in ("start", "process_started") and process.args : "dump-keychain" and process.args : "-d"

sequence by process.entity_id with maxspan=1m [process where event.type == "start" and process.name : ("cp", "rsync") and process.args : ("/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2", "/etc/ld.so.preload")] [file where event.action == "creation" and file.extension == "so"]

event.category:process and event.type:(start or process_started) and process.name:espl and process.args:eyJkZWJ1ZyI6*

process where /* net, sc or wmic stopping or deleting Elastic Agent on Windows */ (event.type == "start" and process.name : ("net.exe", "sc.exe", "wmic.exe","powershell.exe","taskkill.exe","PsKill.exe","Pro cessHacker.exe") and process.args : ("stopservice","uninstall", "stop", "disabled","Stop-Process","terminate","suspend") and process.args : ("elasticendpoint", "Elastic Agent","elastic- agent","elastic-endpoint")) or /* service or systemctl used to stop Elastic Agent on Linux */ (event.type == "end" and (process.name : ("systemctl", "service") and process.args : "elastic-agent" and process.args : "stop") or /* Unload Elastic Agent extension on MacOS */ (process.name : "kextunload" and process.args : "com.apple.iokit.EndpointSecurity" and event.action : "end"))

process where /* net, sc or wmic stopping or deleting Elastic Agent on Windows */ (event.type == "start" and process.name : ("net.exe", "sc.exe", "wmic.exe","powershell.exe","taskkill.exe","PsKill.exe","Pro cessHacker.exe") and process.args : ("stopservice","uninstall", "stop", "disabled","Stop-Process","terminate","suspend") and process.args : ("elasticendpoint", "Elastic Agent","elastic- agent","elastic-endpoint")) or /* service or systemctl used to stop Elastic Agent on Linux */ (event.type == "end" and (process.name : ("systemctl", "service") and process.args : "elastic-agent" and process.args : "stop") or /* Unload Elastic Agent extension on MacOS */ (process.name : "kextunload" and process.args : "com.apple.iokit.EndpointSecurity" and event.action : "end"))

process where /* net, sc or wmic stopping or deleting Elastic Agent on Windows */ (event.type == "start" and process.name : ("net.exe", "sc.exe", "wmic.exe","powershell.exe","taskkill.exe","PsKill.exe","Pro cessHacker.exe") and process.args : ("stopservice","uninstall", "stop", "disabled","Stop-Process","terminate","suspend") and process.args : ("elasticendpoint", "Elastic Agent","elastic- agent","elastic-endpoint")) or /* service or systemctl used to stop Elastic Agent on Linux */ (event.type == "end" and (process.name : ("systemctl","service") and process.args : ("elastic-agent", "stop")) or /* Unload Elastic Agent extension on MacOS */ (process.name : "kextunload" and process.args : "com.apple.iokit.EndpointSecurity" and event.action : "end"))

file where event.type != "deletion" and file.path : ("/private/etc/emond.d/rules/*.plist", "/etc/emon.d/rules/*.plist", "/private/var/db/emondClients/*")

file where event.type != "deletion" and file.path : ("/private/etc/emond.d/rules/*.plist", "/etc/emon.d/rules/*.plist")

process where event.type == "start" and process.name : "netsh.exe" and process.args : ("firewall", "advfirewall") and process.args : "group=Network Discovery" and process.args : "enable=Yes"

registry where /* update here with encoding combinations */ registry.data.strings : "TVqQAAMAAAAEAAAA*"

process where event.type == "start" and ((process.name:"rar.exe" or process.code_signature.subject_name == "win.rar GmbH" or process.pe.original_file_name == "Command line RAR") and process.args == "a" and process.args : ("-hp*", "-p*", "-dw", "-tb", "-ta", "/hp*", "/p*", "/dw", "/tb", "/ta")) or (process.pe.original_file_name in ("7z.exe", "7za.exe") and process.args == "a" and process.args : ("-p*", "-sdel")) /* uncomment if noisy for backup software related FPs */ /* not process.parent.executable : ("C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe") */

process where event.type in ("start", "process_started") and ((process.name:"rar.exe" or process.code_signature.subject_name == "win.rar GmbH" or process.pe.original_file_name == "Command line RAR") and process.args == "a" and process.args : ("-hp*", "-p*", "-dw", "-tb", "-ta", "/hp*", "/p*", "/dw", "/tb", "/ta")) or (process.pe.original_file_name in ("7z.exe", "7za.exe") and process.args == "a" and process.args : ("-p*", "-sdel")) /* uncomment if noisy for backup software related FPs */ /* not process.parent.executable : ("C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe") */

event.kind:alert and event.module:(endpoint and not endgame)

process where event.type == "start" and process.name : "nltest.exe" and process.args : ( "/DCLIST:*", "/DCNAME:*", "/DSGET*", "/LSAQUERYFTI:*", "/PARENTDOMAIN", "/DOMAIN_TRUSTS", "/BDC_QUERY:*")

process where event.type in ("start", "process_started") and process.name : "nltest.exe" and process.args : ( "/DCLIST:*", "/DCNAME:*", "/DSGET*", "/LSAQUERYFTI:*", "/PARENTDOMAIN", "/DOMAIN_TRUSTS", "/BDC_QUERY:*")

process where event.type == "start" and process.name: ( "arp.exe", "dsquery.exe", "dsget.exe", "gpresult.exe", "hostname.exe", "ipconfig.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "ping.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "reg.exe", "sc.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe" ) and process.parent.name:"wmiprvse.exe"

process where event.type in ("start", "process_started") and process.name: ( "arp.exe", "dsquery.exe", "dsget.exe", "gpresult.exe", "hostname.exe", "ipconfig.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "ping.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "reg.exe", "sc.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe" ) and process.parent.name:"wmiprvse.exe"

process where event.type == "start" and (((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and process.args : ("group", "user", "localgroup") and process.args : ("admin", "Domain Admins", "Remote Desktop Users", "Enterprise Admins", "Organization Management") and not process.args : "/add") or ((process.name : "wmic.exe" or process.pe.original_file_name == "wmic.exe") and process.args : ("group", "useraccount"))

process where event.type in ("start", "process_started") and (((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and process.args : ("group", "user", "localgroup") and process.args : ("admin", "Domain Admins", "Remote Desktop Users", "Enterprise Admins", "Organization Management") and not process.args : "/add") or ((process.name : "wmic.exe" or process.pe.original_file_name == "wmic.exe") and process.args : ("group", "useraccount"))

event.category:process and event.type:(start or process_started) and process.args:(kmod and list and sudo or sudo and (depmod or lsmod or modinfo))

event.action:executed and process.args:(kmod and list and sudo or sudo and (depmod or lsmod or modinfo))

iam where event.action == "user-member-enumerated" and /* excluding machine account */ not winlog.event_data.SubjectUserName: ("*$", "LOCAL SERVICE", "NETWORK SERVICE") and /* noisy and usual legit processes excluded */ not winlog.event_data.CallerProcessName: ("-", "?:\\Windows\\System32\\VSSVC.exe", "?:\\Windows\\System32\\SearchIndexer.exe", "?:\\Windows\\System32\\CompatTelRunner.exe", "?:\\Windows\\System32\\oobe\\msoobe.exe", "?:\\Windows\\System32\\net1.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\System32\\Netplwiz.exe", "?:\\Windows\\System32\\msiexec.exe", "?:\\Windows\\SysWOW64\\msiexec.exe", "?:\\Windows\\System32\\CloudExperienceHostBroker.exe", "?:\\Windows\\System32\\wbem\\WmiPrvSE.exe", "?:\\Windows\\System32\\SrTasks.exe", "?:\\Windows\\System32\\lsass.exe", "?:\\Windows\\System32\\diskshadow.exe", "?:\\Windows\\System32\\dfsrs.exe", "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\WindowsAzure\\*\\WaAppAgent.exe", "?:\\Windows\\System32\\vssadmin.exe", "?:\\Windows\\VeeamVssSupport\\VeeamGuestHelper.exe", "?:\\Windows\\System32\\dllhost.exe", "?:\\Windows\\System32\\mmc.exe", "?:\\Windows\\System32\\SettingSyncHost.exe", "?:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe", "?:\\Windows\\System32\\SystemSettingsAdminFlows.exe", "?:\\Windows\\Temp\\rubrik_vmware???\\snaptool.exe", "?:\\Windows\\System32\\inetsrv\\w3wp.exe", "?:\\$WINDOWS.~BT\\Sources\\*.exe", "?:\\Windows\\System32\\wsmprovhost.exe", "?:\\Windows\\System32\\spool\\drivers\\x64\\3\\x3jobt3?.exe", "?:\\Windows\\System32\\mstsc.exe", "?:\\Windows\\System32\\esentutl.exe", "?:\\Windows\\System32\\RecoveryDrive.exe", "?:\\Windows\\System32\\SystemPropertiesComputerName.exe") and /* privileged local groups */ (group.name:("admin*","RemoteDesktopUsers") or winlog.event_data.TargetSid:("S-1-5-32-544","S-1-5-32-555"))

iam where event.action == "user-member-enumerated" and /* noisy and usual legit processes excluded */ not winlog.event_data.CallerProcessName: ("?:\\Windows\\System32\\VSSVC.exe", "?:\\Windows\\System32\\SearchIndexer.exe", "?:\\Windows\\System32\\CompatTelRunner.exe", "?:\\Windows\\System32\\oobe\\msoobe.exe", "?:\\Windows\\System32\\net1.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\System32\\Netplwiz.exe", "?:\\Windows\\System32\\msiexec.exe", "?:\\Windows\\System32\\CloudExperienceHostBroker.exe", "?:\\Windows\\System32\\wbem\\WmiPrvSE.exe", "?:\\Windows\\System32\\SrTasks.exe", "?:\\Windows\\System32\\lsass.exe", "?:\\Windows\\System32\\diskshadow.exe", "?:\\Windows\\System32\\dfsrs.exe", "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe") and /* privileged local groups */ (group.name:("admin*","RemoteDesktopUsers") or winlog.event_data.TargetSid:("S-1-5-32-544","S-1-5-32-555"))

process where event.type in ("start", "process_started") and ( process.name : ("ldapsearch", "dsmemberutil") or (process.name : "dscl" and process.args : ("read", "-read", "list", "-list", "ls", "search", "-search") and process.args : ("/Active Directory/*", "/Users*", "/Groups*")) ) and not process.parent.executable : ("/Applications/NoMAD.app/Contents/MacOS/NoMAD", "/Applications/ZoomPresence.app/Contents/MacOS/ZoomPresence", "/Applications/Sourcetree.app/Contents/MacOS/Sourcetree", "/Library/Application Support/JAMF/Jamf.app/Contents/MacOS/JamfDaemon. app/Contents/MacOS/JamfDaemon", "/Applications/Jamf Connect.app/Contents/MacOS/Jamf Connect", "/usr/local/jamf/bin/jamf", "/Library/Application Support/AirWatch/hubd", "/opt/jc/bin/jumpcloud-agent", "/Applications/ESET Endpoint Antivirus.app/Contents/MacOS/esets_daemon", "/Applications/ESET Endpoint Security.app/Contents/MacOS/esets_daemon", "/Library/Pri vilegedHelperTools/com.fortinet.forticlient.uninstall_helper" )

process where event.type in ("start", "process_started") and not process.parent.executable : ("/Applications/NoMAD.app/Contents/MacOS/NoMAD", "/Applications/ZoomPresence.app/Contents/MacOS/ZoomPresence", "/Applications/Sourcetree.app/Contents/MacOS/Sourcetree", "/Library/Application Support/JAMF/Jamf.app/Contents/MacOS/JamfDaemon. app/Contents/MacOS/JamfDaemon", "/Applications/Jamf Connect.app/Contents/MacOS/Jamf Connect", "/usr/local/jamf/bin/jamf" ) and process.name : ("ldapsearch", "dsmemberutil") or (process.name : "dscl" and process.args : ("read", "-read", "list", "-list", "ls", "search", "-search") and process.args : ("/Active Directory/*", "/Users*", "/Groups*"))

process where event.type in ("start", "process_started") and not process.parent.executable : ("/Applications/NoMAD.app/Contents/MacOS/NoMAD", "/Applications/ZoomPresence.app/Contents/MacOS/ZoomPresence", "/Applications/Sourcetree.app/Contents/MacOS/Sourcetree", "/Library/Application Support/JAMF/Jamf.app/Contents/MacOS/JamfDaemon. app/Contents/MacOS/JamfDaemon", "/usr/local/jamf/bin/jamf" ) and process.name : ("ldapsearch", "dsmemberutil") or (process.name : "dscl" and process.args : ("read", "-read", "list", "-list", "ls", "search", "-search") and process.args : ("/Active Directory/*", "/Users*", "/Groups*"))

process where event.type in ("start", "process_started") and not process.parent.executable : ("/Applications/NoMAD.app/Contents/MacOS/NoMAD", "/Applications/ZoomPresence.app/Contents/MacOS/ZoomPresence") and process.name : ("ldapsearch", "dsmemberutil") or (process.name : "dscl" and process.args : ("read", "-read", "list", "-list", "ls", "search", "-search") and process.args : ("/Active Directory/*", "/Users*", "/Groups*"))

file where event.type == "creation" and file.extension : "exe" and file.name regex~ """.*\.(vbs|vbe|bat|js|cmd|wsh|ps1|pdf|docx?|xlsx?|pp tx?|txt|rtf|gif|jpg|png|bmp|hta|txt|img|iso)\.exe""" and not (process.executable : ("?:\\Windows\\System32\\msiexec.exe", "C:\\Users\\*\\QGIS_SCCM\\Files\\QGIS-OSGeo4W-*-Setup-x86_64.exe") and file.path : "?:\\Program Files\\QGIS *\\apps\\grass\\*.exe") and not process.executable : ("/bin/sh", "/usr/sbin/MailScanner", "/usr/bin/perl")

file where event.type == "creation" and file.extension : "exe" and file.name regex~ """.*\.(vbs|vbe|bat|js|cmd|wsh|ps1|pdf|docx?|xlsx?|pp tx?|txt|rtf|gif|jpg|png|bmp|hta|txt|img|iso)\.exe"""

file where event.type == "creation" and file.extension:"exe" and file.name: ( "*.vbs.exe", "*.vbe.exe", "*.bat.exe", "*.js.exe", "*.cmd.exe", "*.wsh.exe", "*.ps1.exe", "*.pdf.exe", "*.docx.exe", "*.doc.exe", "*.xlsx.exe", "*.xls.exe", "*.pptx.exe", "*.ppt.exe", "*.txt.exe", "*.rtf.exe", "*.gif.exe", "*.jpg.exe", "*.png.exe", "*.bmp.exe", "*.hta.exe", "*.txt.exe", "*.img.exe", "*.iso.exe" )

process where event.type == "start" and process.name : ("wscript.exe", "cscript.exe", "rundll32.exe", "regsvr32.exe", "cmstp.exe", "RegAsm.exe", "installutil.exe", "mshta.exe", "RegSvcs.exe", "powershell.exe", "pwsh.exe", "cmd.exe") and /* add suspicious execution paths here */ process.args : ("C:\\PerfLogs\\*", "C:\\Users\\Public\\*", "C:\\Windows\\Tasks\\*", "C:\\Intel\\*", "C:\\AMD\\Temp\\*", "C:\\Windows\\AppReadiness\\*", "C:\\Windows\\ServiceState\\*", "C:\\Windows\\security\\*", "C:\\Windows\\IdentityCRL\\*", "C:\\Windows\\Branding\\*", "C:\\Windows\\csc\\*", "C:\\Windows\\DigitalLocker\\*", "C:\\Windows\\en- US\\*", "C:\\Windows\\wlansvc\\*", "C:\\Windows\\Prefetch\\*", "C:\\Windows\\Fonts\\*", "C:\\Windows\\diagnostics\\*", "C:\\Windows\\TAPI\\*", "C:\\Windows\\INF\\*", "C:\\Windows\\System32\\Speech\\*", "C:\\windows\\tracing\\*", "c:\\windows\\IME\\*", "c:\\Windows\\Performance\\*", "c:\\windows\\intel\\*", "c:\\windows\\ms\\*", "C:\\Windows\\dot3svc\\*", "C:\\Windows\\panther\\*", "C:\\Windows\\RemotePackages\\*", "C:\\Windows\\OCR\\*", "C:\\Windows\\appcompat\\*", "C:\\Windows\\apppatch\\*", "C:\\Windows\\addins\\*", "C:\\Windows\\Setup\\*", "C:\\Windows\\Help\\*", "C:\\Windows\\SKB\\*", "C:\\Windows\\Vss\\*", "C:\\Windows\\servicing\\*", "C:\\Windows\\CbsTemp\\*", "C:\\Windows\\Logs\\*", "C:\\Windows\\WaaS\\*", "C:\\Windows\\twain_32\\*", "C:\\Windows\\ShellExperiences\\*", "C:\\Windows\\ShellComponents\\*", "C:\\Windows\\PLA\\*", "C:\\Windows\\Migration\\*", "C:\\Windows\\debug\\*", "C:\\Windows\\Cursors\\*", "C:\\Windows\\Containers\\*", "C:\\Windows\\Boot\\*", "C:\\Windows\\bcastdvr\\*", "C:\\Windows\\TextInput\\*", "C:\\Windows\\security\\*", "C:\\Windows\\schemas\\*", "C:\\Windows\\SchCache\\*", "C:\\Windows\\Resources\\*", "C:\\Windows\\rescache\\*", "C:\\Windows\\Provisioning\\*", "C:\\Windows\\PrintDialog\\*", "C:\\Windows\\PolicyDefinitions\\*", "C:\\Windows\\media\\*", "C:\\Windows\\Globalization\\*", "C:\\Windows\\L2Schemas\\*", "C:\\Windows\\LiveKernelReports\\*", "C:\\Windows\\ModemLogs\\*", "C:\\Windows\\ImmersiveControlPanel\\*", "C:\\$Recycle.Bin\\*") and /* noisy FP patterns */ not process.parent.executable : ("C:\\WINDOWS\\System32\\DriverStore\\File Repository\\*\\igfxCUIService*.exe", "C:\\Windows\\System32\\spacedeskService.exe", "C:\\Program Files\\Dell\\SupportAssistAgent\\SRE\\SRE.exe") and not (process.name : "rundll32.exe" and process.args : ("uxtheme.dll,#64", "PRINTUI.DLL,PrintUIEntry", "?:\\Windows\\System32\\FirewallControlPanel.dll,ShowNotificationDialo g", "?:\\WINDOWS\\system32\\Speech\\SpeechUX\\sapi.cpl", "?:\\Windows\\system32\\shell32.dll,OpenAs_RunDLL")) and not (process.name : "cscript.exe" and process.args : "?:\\WINDOWS\\system32\\calluxxprovider.vbs") and not (process.name : "cmd.exe" and process.args : "?:\\WINDOWS\\system32\\powercfg.exe" and process.args : "?:\\WINDOWS\\inf\\PowerPlan.log") and not (process.name : "regsvr32.exe" and process.args : "?:\\Windows\\Help\\OEM\\scripts\\checkmui.dll") and not (process.name : "cmd.exe" and process.parent.executable : ("?:\\Windows\\System32\\oobe\\windeploy.exe", "?:\\Program Files (x86)\\ossec-agent\\wazuh-agent.exe", "?:\\Windows\\System32\\igfxCUIService.exe", "?:\\Windows\\Temp\\IE*.tmp\\IE*-support\\ienrcore.exe"))

process where event.type in ("start", "process_started", "info") and process.name : ("wscript.exe", "cscript.exe", "rundll32.exe", "regsvr32.exe", "cmstp.exe", "RegAsm.exe", "installutil.exe", "mshta.exe", "RegSvcs.exe", "powershell.exe", "pwsh.exe", "cmd.exe") and /* add suspicious execution paths here */ process.args : ("C:\\PerfLogs\\*", "C:\\Users\\Public\\*", "C:\\Windows\\Tasks\\*", "C:\\Intel\\*", "C:\\AMD\\Temp\\*", "C:\\Windows\\AppReadiness\\*", "C:\\Windows\\ServiceState\\*", "C:\\Windows\\security\\*", "C:\\Windows\\IdentityCRL\\*", "C:\\Windows\\Branding\\*", "C:\\Windows\\csc\\*", "C:\\Windows\\DigitalLocker\\*", "C:\\Windows\\en- US\\*", "C:\\Windows\\wlansvc\\*", "C:\\Windows\\Prefetch\\*", "C:\\Windows\\Fonts\\*", "C:\\Windows\\diagnostics\\*", "C:\\Windows\\TAPI\\*", "C:\\Windows\\INF\\*", "C:\\Windows\\System32\\Speech\\*", "C:\\windows\\tracing\\*", "c:\\windows\\IME\\*", "c:\\Windows\\Performance\\*", "c:\\windows\\intel\\*", "c:\\windows\\ms\\*", "C:\\Windows\\dot3svc\\*", "C:\\Windows\\panther\\*", "C:\\Windows\\RemotePackages\\*", "C:\\Windows\\OCR\\*", "C:\\Windows\\appcompat\\*", "C:\\Windows\\apppatch\\*", "C:\\Windows\\addins\\*", "C:\\Windows\\Setup\\*", "C:\\Windows\\Help\\*", "C:\\Windows\\SKB\\*", "C:\\Windows\\Vss\\*", "C:\\Windows\\servicing\\*", "C:\\Windows\\CbsTemp\\*", "C:\\Windows\\Logs\\*", "C:\\Windows\\WaaS\\*", "C:\\Windows\\twain_32\\*", "C:\\Windows\\ShellExperiences\\*", "C:\\Windows\\ShellComponents\\*", "C:\\Windows\\PLA\\*", "C:\\Windows\\Migration\\*", "C:\\Windows\\debug\\*", "C:\\Windows\\Cursors\\*", "C:\\Windows\\Containers\\*", "C:\\Windows\\Boot\\*", "C:\\Windows\\bcastdvr\\*", "C:\\Windows\\TextInput\\*", "C:\\Windows\\security\\*", "C:\\Windows\\schemas\\*", "C:\\Windows\\SchCache\\*", "C:\\Windows\\Resources\\*", "C:\\Windows\\rescache\\*", "C:\\Windows\\Provisioning\\*", "C:\\Windows\\PrintDialog\\*", "C:\\Windows\\PolicyDefinitions\\*", "C:\\Windows\\media\\*", "C:\\Windows\\Globalization\\*", "C:\\Windows\\L2Schemas\\*", "C:\\Windows\\LiveKernelReports\\*", "C:\\Windows\\ModemLogs\\*", "C:\\Windows\\ImmersiveControlPanel\\*", "C:\\$Recycle.Bin\\*") and /* noisy FP patterns */ not process.parent.executable : ("C:\\WINDOWS\\System32\\DriverStore\\File Repository\\*\\igfxCUIService*.exe", "C:\\Windows\\System32\\spacedeskService.exe", "C:\\Program Files\\Dell\\SupportAssistAgent\\SRE\\SRE.exe") and not (process.name : "rundll32.exe" and process.args : ("uxtheme.dll,#64", "PRINTUI.DLL,PrintUIEntry", "?:\\Windows\\System32\\FirewallControlPanel.dll,ShowNotificationDialo g", "?:\\WINDOWS\\system32\\Speech\\SpeechUX\\sapi.cpl", "?:\\Windows\\system32\\shell32.dll,OpenAs_RunDLL")) and not (process.name : "cscript.exe" and process.args : "?:\\WINDOWS\\system32\\calluxxprovider.vbs") and not (process.name : "cmd.exe" and process.args : "?:\\WINDOWS\\system32\\powercfg.exe" and process.args : "?:\\WINDOWS\\inf\\PowerPlan.log") and not (process.name : "regsvr32.exe" and process.args : "?:\\Windows\\Help\\OEM\\scripts\\checkmui.dll") and not (process.name : "cmd.exe" and process.parent.executable : ("?:\\Windows\\System32\\oobe\\windeploy.exe", "?:\\Program Files (x86)\\ossec-agent\\wazuh-agent.exe", "?:\\Windows\\System32\\igfxCUIService.exe", "?:\\Windows\\Temp\\IE*.tmp\\IE*-support\\ienrcore.exe"))

process where event.type in ("start", "process_started", "info") and process.name : ("wscript.exe", "cscript.exe", "rundll32.exe", "regsvr32.exe", "cmstp.exe", "RegAsm.exe", "installutil.exe", "mshta.exe", "RegSvcs.exe", "powershell.exe", "pwsh.exe", "cmd.exe") and /* add suspicious execution paths here */ process.args : ("C:\\PerfLogs\\*", "C:\\Users\\Public\\*", "C:\\Users\\Default\\*", "C:\\Windows\\Tasks\\*", "C:\\Intel\\*", "C:\\AMD\\Temp\\*", "C:\\Windows\\AppReadiness\\*", "C:\\Windows\\ServiceState\\*", "C:\\Windows\\security\\*", "C:\\Windows\\IdentityCRL\\*", "C:\\Windows\\Branding\\*", "C:\\Windows\\csc\\*", "C:\\Windows\\DigitalLocker\\*", "C:\\Windows\\en- US\\*", "C:\\Windows\\wlansvc\\*", "C:\\Windows\\Prefetch\\*", "C:\\Windows\\Fonts\\*", "C:\\Windows\\diagnostics\\*", "C:\\Windows\\TAPI\\*", "C:\\Windows\\INF\\*", "C:\\Windows\\System32\\Speech\\*", "C:\\windows\\tracing\\*", "c:\\windows\\IME\\*", "c:\\Windows\\Performance\\*", "c:\\windows\\intel\\*", "c:\\windows\\ms\\*", "C:\\Windows\\dot3svc\\*", "C:\\Windows\\ServiceProfiles\\*", "C:\\Windows\\panther\\*", "C:\\Windows\\RemotePackages\\*", "C:\\Windows\\OCR\\*", "C:\\Windows\\appcompat\\*", "C:\\Windows\\apppatch\\*", "C:\\Windows\\addins\\*", "C:\\Windows\\Setup\\*", "C:\\Windows\\Help\\*", "C:\\Windows\\SKB\\*", "C:\\Windows\\Vss\\*", "C:\\Windows\\Web\\*", "C:\\Windows\\servicing\\*", "C:\\Windows\\CbsTemp\\*", "C:\\Windows\\Logs\\*", "C:\\Windows\\WaaS\\*", "C:\\Windows\\twain_32\\*", "C:\\Windows\\ShellExperiences\\*", "C:\\Windows\\ShellComponents\\*", "C:\\Windows\\PLA\\*", "C:\\Windows\\Migration\\*", "C:\\Windows\\debug\\*", "C:\\Windows\\Cursors\\*", "C:\\Windows\\Containers\\*", "C:\\Windows\\Boot\\*", "C:\\Windows\\bcastdvr\\*", "C:\\Windows\\assembly\\*", "C:\\Windows\\TextInput\\*", "C:\\Windows\\security\\*", "C:\\Windows\\schemas\\*", "C:\\Windows\\SchCache\\*", "C:\\Windows\\Resources\\*", "C:\\Windows\\rescache\\*", "C:\\Windows\\Provisioning\\*", "C:\\Windows\\PrintDialog\\*", "C:\\Windows\\PolicyDefinitions\\*", "C:\\Windows\\media\\*", "C:\\Windows\\Globalization\\*", "C:\\Windows\\L2Schemas\\*", "C:\\Windows\\LiveKernelReports\\*", "C:\\Windows\\ModemLogs\\*", "C:\\Windows\\ImmersiveControlPanel\\*", "C:\\$Recycle.Bin\\*") and not process.parent.executable : ("C:\\WIN DOWS\\System32\\DriverStore\\FileRepository\\*\\igfxCUIService*.exe", "C:\\Windows\\System32\\spacedeskService.exe", "C:\\Program Files\\Dell\\SupportAssistAgent\\SRE\\SRE.exe") and not (process.name : "rundll32.exe" and process.args : ("uxtheme.dll,#64", "PRINTUI.DLL,PrintUIEntry"))

process where event.type in ("start", "process_started", "info") and process.name : ("wscript.exe","cscript.exe","rundll32.exe","regsvr32.e xe","cmstp.exe","RegAsm.exe","installutil.exe","mshta.exe","RegSvcs.ex e", "powershell.exe", "pwsh.exe", "cmd.exe") and /* add suspicious execution paths here */ process.args : ("C:\\PerfLogs\\*","C:\\Users\\ Public\\*","C:\\Users\\Default\\*","C:\\Windows\\Tasks\\*","C:\\Intel\ \*", "C:\\AMD\\Temp\\*", "C:\\Windows\\AppReadiness\\*", "C:\\Window s\\ServiceState\\*","C:\\Windows\\security\\*","C:\\Windows\\IdentityC RL\\*","C:\\Windows\\Branding\\*","C:\\Windows\\csc\\*", "C:\\Windows\\DigitalLocker\\*","C:\\Windows\\en-US\\*","C:\\Windows\\ wlansvc\\*","C:\\Windows\\Prefetch\\*","C:\\Windows\\Fonts\\*", "C:\\ Windows\\diagnostics\\*","C:\\Windows\\TAPI\\*","C:\\Windows\\INF\\*", "C:\\Windows\\System32\\Speech\\*","C:\\windows\\tracing\\*", "c:\\wi ndows\\IME\\*","c:\\Windows\\Performance\\*","c:\\windows\\intel\\*"," c:\\windows\\ms\\*","C:\\Windows\\dot3svc\\*","C:\\Windows\\ServicePro files\\*", "C:\\Windows\\panther\\*","C:\\Windows\\RemotePackages\\*" ,"C:\\Windows\\OCR\\*","C:\\Windows\\appcompat\\*","C:\\Windows\\apppa tch\\*","C:\\Windows\\addins\\*", "C:\\Windows\\Setup\\*","C:\\Window s\\Help\\*","C:\\Windows\\SKB\\*","C:\\Windows\\Vss\\*","C:\\Windows\\ Web\\*","C:\\Windows\\servicing\\*","C:\\Windows\\CbsTemp\\*", "C:\\W indows\\Logs\\*","C:\\Windows\\WaaS\\*","C:\\Windows\\twain_32\\*","C: \\Windows\\ShellExperiences\\*","C:\\Windows\\ShellComponents\\*","C:\ \Windows\\PLA\\*", "C:\\Windows\\Migration\\*","C:\\Windows\\debug\\* ","C:\\Windows\\Cursors\\*","C:\\Windows\\Containers\\*","C:\\Windows\ \Boot\\*","C:\\Windows\\bcastdvr\\*", "C:\\Windows\\assembly\\*","C:\ \Windows\\TextInput\\*","C:\\Windows\\security\\*","C:\\Windows\\schem as\\*","C:\\Windows\\SchCache\\*","C:\\Windows\\Resources\\*", "C:\\W indows\\rescache\\*","C:\\Windows\\Provisioning\\*","C:\\Windows\\Prin tDialog\\*","C:\\Windows\\PolicyDefinitions\\*","C:\\Windows\\media\\* ", "C:\\Windows\\Globalization\\*","C:\\Windows\\L2Schemas\\*","C:\\W indows\\LiveKernelReports\\*","C:\\Windows\\ModemLogs\\*","C:\\Windows \\ImmersiveControlPanel\\*", "C:\\$Recycle.Bin\\*")

process where event.type in ("start", "process_started", "info") and process.name : ("wscript.exe","cscript.exe","rundll32.exe","regsvr32.e xe","cmstp.exe","RegAsm.exe","installutil.exe","mshta.exe","RegSvcs.ex e") and /* add suspicious execution paths here */ process.args : ("C: \\PerfLogs\\*","C:\\Users\\Public\\*","C:\\Users\\Default\\*","C:\\Win dows\\Tasks\\*","C:\\Intel\\*", "C:\\AMD\\Temp\\*", "C:\\Windows\\AppReadiness\\*", "C:\\Windows\\ServiceState\\*","C:\\Wi ndows\\security\\*","C:\\Windows\\IdentityCRL\\*","C:\\Windows\\Brandi ng\\*","C:\\Windows\\csc\\*", "C:\\Windows\\DigitalLocker\\*","C:\\Windows\\en-US\\*","C:\\Windows\\ wlansvc\\*","C:\\Windows\\Prefetch\\*","C:\\Windows\\Fonts\\*", "C:\\ Windows\\diagnostics\\*","C:\\Windows\\TAPI\\*","C:\\Windows\\INF\\*", "C:\\Windows\\System32\\Speech\\*","C:\\windows\\tracing\\*", "c:\\wi ndows\\IME\\*","c:\\Windows\\Performance\\*","c:\\windows\\intel\\*"," c:\\windows\\ms\\*","C:\\Windows\\dot3svc\\*","C:\\Windows\\ServicePro files\\*", "C:\\Windows\\panther\\*","C:\\Windows\\RemotePackages\\*" ,"C:\\Windows\\OCR\\*","C:\\Windows\\appcompat\\*","C:\\Windows\\apppa tch\\*","C:\\Windows\\addins\\*", "C:\\Windows\\Setup\\*","C:\\Window s\\Help\\*","C:\\Windows\\SKB\\*","C:\\Windows\\Vss\\*","C:\\Windows\\ Web\\*","C:\\Windows\\servicing\\*","C:\\Windows\\CbsTemp\\*", "C:\\W indows\\Logs\\*","C:\\Windows\\WaaS\\*","C:\\Windows\\twain_32\\*","C: \\Windows\\ShellExperiences\\*","C:\\Windows\\ShellComponents\\*","C:\ \Windows\\PLA\\*", "C:\\Windows\\Migration\\*","C:\\Windows\\debug\\* ","C:\\Windows\\Cursors\\*","C:\\Windows\\Containers\\*","C:\\Windows\ \Boot\\*","C:\\Windows\\bcastdvr\\*", "C:\\Windows\\assembly\\*","C:\ \Windows\\TextInput\\*","C:\\Windows\\security\\*","C:\\Windows\\schem as\\*","C:\\Windows\\SchCache\\*","C:\\Windows\\Resources\\*", "C:\\W indows\\rescache\\*","C:\\Windows\\Provisioning\\*","C:\\Windows\\Prin tDialog\\*","C:\\Windows\\PolicyDefinitions\\*","C:\\Windows\\media\\* ", "C:\\Windows\\Globalization\\*","C:\\Windows\\L2Schemas\\*","C:\\W indows\\LiveKernelReports\\*","C:\\Windows\\ModemLogs\\*","C:\\Windows \\ImmersiveControlPanel\\*")

process where event.type == "start" and process.pe.original_file_name : "xwizard.exe" and ( (process.args : "RunWizard" and process.args : "{*}") or (process.executable != null and not process.executable : ("C:\\Windows\\SysWOW64\\xwizard.exe", "C:\\Windows\\System32\\xwizard.exe") ) )

process where event.type in ("start", "process_started") and process.pe.original_file_name : "xwizard.exe" and ( (process.args : "RunWizard" and process.args : "{*}") or (process.executable != null and not process.executable : ("C:\\Windows\\SysWOW64\\xwizard.exe", "C:\\Windows\\System32\\xwizard.exe") ) )

sequence with maxspan=2h [file where event.type != "deletion" and file.extension : "exe" and (process.name : "WINWORD.EXE" or process.name : "EXCEL.EXE" or process.name : "OUTLOOK.EXE" or process.name : "POWERPNT.EXE" or process.name : "eqnedt32.exe" or process.name : "fltldr.exe" or process.name : "MSPUB.EXE" or process.name : "MSACCESS.EXE") ] by host.id, file.path [process where event.type == "start"] by host.id, process.executable

sequence with maxspan=2h [file where event.type != "deletion" and file.extension : "exe" and (process.name : "WINWORD.EXE" or process.name : "EXCEL.EXE" or process.name : "OUTLOOK.EXE" or process.name : "POWERPNT.EXE" or process.name : "eqnedt32.exe" or process.name : "fltldr.exe" or process.name : "MSPUB.EXE" or process.name : "MSACCESS.EXE") ] by host.id, file.path [process where event.type in ("start", "process_started")] by host.id, process.executable

sequence with maxspan=2h [file where event.type != "deletion" and file.extension : "exe" and (process.name : "AcroRd32.exe" or process.name : "rdrcef.exe" or process.name : "FoxitPhantomPDF.exe" or process.name : "FoxitReader.exe") and not (file.name : "FoxitPhantomPDF.exe" or file.name : "FoxitPhantomPDFUpdater.exe" or file.name : "FoxitReader.exe" or file.name : "FoxitReaderUpdater.exe" or file.name : "AcroRd32.exe" or file.name : "rdrcef.exe") ] by host.id, file.path [process where event.type == "start"] by host.id, process.executable

sequence with maxspan=2h [file where event.type != "deletion" and file.extension : "exe" and (process.name : "AcroRd32.exe" or process.name : "rdrcef.exe" or process.name : "FoxitPhantomPDF.exe" or process.name : "FoxitReader.exe") and not (file.name : "FoxitPhantomPDF.exe" or file.name : "FoxitPhantomPDFUpdater.exe" or file.name : "FoxitReader.exe" or file.name : "FoxitReaderUpdater.exe" or file.name : "AcroRd32.exe" or file.name : "rdrcef.exe") ] by host.id, file.path [process where event.type in ("start", "process_started")] by host.id, process.executable

/* userinit followed by explorer followed by early child process of explorer (unlikely to be launched interactively) within 1m */ sequence by host.id, user.name with maxspan=1m [process where event.type == "start" and process.name : "userinit.exe" and process.parent.name : "winlogon.exe"] [process where event.type == "start" and process.name : "explorer.exe"] [process where event.type == "start" and process.parent.name : "explorer.exe" and /* add suspicious programs here */ process.pe.original_file_name in ("cscript.exe", "wscript.exe", "PowerShell.EXE", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "RegAsm.exe", "MSBuild.exe", "InstallUtil.exe") and /* add potential suspicious paths here */ process.args : ("C:\\Users\\*", "C:\\ProgramData\\*", "C:\\Windows\\Temp\\*", "C:\\Windows\\Tasks\\*", "C:\\PerfLogs\\*", "C:\\Intel\\*") ]

/* userinit followed by explorer followed by early child process of explorer (unlikely to be launched interactively) within 1m */ sequence by host.id, user.name with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "userinit.exe" and process.parent.name : "winlogon.exe"] [process where event.type in ("start", "process_started") and process.name : "explorer.exe"] [process where event.type in ("start", "process_started") and process.parent.name : "explorer.exe" and /* add suspicious programs here */ process.pe.original_file_name in ("cscript.exe", "wscript.exe", "PowerShell.EXE", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "RegAsm.exe", "MSBuild.exe", "InstallUtil.exe") and /* add potential suspicious paths here */ process.args : ("C:\\Users\\*", "C:\\ProgramData\\*", "C:\\Windows\\Temp\\*", "C:\\Windows\\Tasks\\*", "C:\\PerfLogs\\*", "C:\\Intel\\*") ]

event.category:process and event.type:(start or process_started) and process.args:("-e" and const*require*child_process*)

file where file.extension : "dll" and file.path : "C:\\*\\*.exe.local\\*.dll"

process where event.type == "start" and process.name : "cmd.exe" and process.parent.name : "sqlservr.exe" and not process.args : ("\\\\*", "diskfree", "rmdir", "mkdir", "dir", "del", "rename", "bcp", "*XMLNAMESPACES*", "?:\\MSSQL\\Backup\\Jobs\\sql_agent_backup_job.ps1", "K:\\MSSQL\\Backup\\msdb", "K:\\MSSQL\\Backup\\Logins")

process where event.type in ("start", "process_started") and process.name : "cmd.exe" and process.parent.name : "sqlservr.exe"

event.category:process and event.type:(start or process_started) and process.name:cmd.exe and process.parent.name:sqlservr.exe

process where event.type == "start" and process.executable : "\\Device\\Mup\\tsclient\\*.exe"

process where event.type in ("start", "process_started") and process.executable : "\\Device\\Mup\\tsclient\\*.exe"

event.category:process and event.type:(start or process_started) and process.name:"security_authtrampoline" and process.parent.name:(osascript or com.apple.automator.runner or sh or bash or dash or zsh or python* or Python or perl* or php* or ruby or pwsh)

event.category:process and event.type:(start or process_started) and process.name:"security_authtrampoline" and process.parent.name:(osascript or com.apple.automator.runner or sh or bash or dash or zsh or python* or perl* or php* or ruby or pwsh)

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "osascript"] by process.pid [process where event.type in ("start", "process_started") and process.name == "security_authtrampoline"] by process.ppid

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:exploit_event or endgame.event_subtype_full:exploit_event)

event.kind:alert and event.module:endgame and event.action:exploit_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:exploit_event or endgame.event_subtype_full:exploit_event)

event.kind:alert and event.module:endgame and event.action:exploit_event and endgame.metadata.type:prevention

process where event.type == "start" and process.name: ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "New-MailboxExportRequest*"

process where event.type in ("start", "process_started") and process.name: ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "New-MailboxExportRequest*"

process where event.type in ("start", "process_started") and process.name: ("powershell.exe", "pwsh.exe") and process.args : "New- MailboxExportRequest*"

event.kind:alert and not event.module:(endgame or endpoint)

event.kind:alert and not event.module:(endgame or endpoint)

network where network.protocol == "dns" and process.name != null and user.id not in ("S-1-5-19", "S-1-5-20") and event.action == "lookup_requested" and /* Add new external IP lookup services here */ dns.question.name : ( "*api.ipify.org", "*freegeoip.app", "*checkip.amazonaws.com", "*checkip.dyndns.org", "*freegeoip.app", "*icanhazip.com", "*ifconfig.*", "*ipecho.net", "*ipgeoapi.com", "*ipinfo.io", "*ip.anysrc.net", "*myexternalip.com", "*myipaddress.com", "*showipaddress.com", "*whatismyipaddress.com", "*wtfismyip.com", "*ipapi.co", "*ip-lookup.net", "*ipstack.com" ) and /* Insert noisy false positives here */ not process.executable : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\WWAHost.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\System32\\MicrosoftEdgeCP.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Users\\*\\AppData\\Loc al\\Google\\Chrome\\Application\\chrome.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe", "?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe" )

network where network.protocol == "dns" and process.name != null and user.id not in ("S-1-5-19", "S-1-5-20") and event.action == "lookup_requested" and /* Add new external IP lookup services here */ dns.question.name : ( "*api.ipify.org", "*freegeoip.app", "*checkip.amazonaws.com", "*checkip.dyndns.org", "*freegeoip.app", "*icanhazip.com", "*ifconfig.*", "*ipecho.net", "*ipgeoapi.com", "*ipinfo.io", "*ip.anysrc.net", "*myexternalip.com", "*myipaddress.com", "*showipaddress.com", "*whatismyipaddress.com", "*wtfismyip.com" ) and /* Insert noisy false positives here */ not process.executable : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\WWAHost.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\System32\\MicrosoftEdgeCP.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "?:\\Users\\*\\AppData\\Loc al\\Google\\Chrome\\Application\\chrome.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe", "?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe", "?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe" )

event.category:network AND event.type:connection AND server.domain:(ipecho.net OR ipinfo.io OR ifconfig.co OR ifconfig.me OR icanhazip.com OR myexternalip.com OR api.ipify.org OR bot.whatismyipaddress.com OR ip.anysrc.net OR wtfismyip.com) AND NOT http.response.status_code:302 AND status:OK AND NOT _exists_:http.request.referrer

event.category:process and event.type:(start or process_started) and process.name:shred and process.args:("-u" or "--remove" or "-z" or " --zero")

event.action:(executed or process_started) and process.name:shred and process.args:("-u" or "--remove" or "-z" or "--zero")

process where event.type == "start" and user.name == "root" and process.executable : "/usr/bin/chattr" and process.args : ("-*i*", "+*i*") and not process.parent.executable: "/lib/systemd/systemd"

event.category:process and event.type:(start or process_started) and process.name:(chmod or chown or chattr or chgrp) and process.working_directory:(/tmp or /var/tmp or /dev/shm) and not user.name:root

event.action:executed and process.name:(chmod or chown or chattr or chgrp) and process.working_directory:(/tmp or /var/tmp or /dev/shm) and not user.name:root

process where event.type in ("start", "process_started") and process.name : "pluginkit" and process.args : "-e" and process.args : "use" and process.args : "-i" and not process.args : ( "com.google.GoogleDrive.FinderSyncAPIExtension", "com.google.drivefs.findersync", "com.boxcryptor.osx.Rednif", "com.adobe.accmac.ACCFinderSync", "com.microsoft.OneDrive.FinderSync", "com.insynchq.Insync.Insync- Finder-Integration", "com.box.desktop.findersyncext" ) and not process.parent.executable : ( "/Library/Application Support/IDrive forMac/IDriveHelperTools/FinderPluginApp.app/Contents/MacOS/FinderPlug inApp" )

sequence by host.id, user.id with maxspan = 5s [process where event.type in ("start", "process_started") and process.name : "pluginkit" and process.args : "-a"] [process where event.type in ("start", "process_started") and process.name : "pluginkit" and process.args : "-e" and process.args : "use" and process.args : "-i" and not process.args : ( "com.google.GoogleDrive.FinderSyncAPIExtension", "com.google.drivefs.findersync", "com.boxcryptor.osx.Rednif", "com.adobe.accmac.ACCFinderSync", "com.microsoft.OneDrive.FinderSync", "com.insynchq.Insync.Insync-Finder-Integration", "com.box.desktop.findersyncext" ) ]

registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\\DumpType" and registry.data.strings : ("2", "0x00000002") and not (process.executable : "?:\\Windows\\system32\\svchost.exe" and user.id : ("S-1-5-18", "S-1-5-19", "S-1-5-20"))

event.dataset:gcp.audit and event.action:(*.compute.firewalls.insert or google.appengine.*.Firewall.Create*Rule)

event.dataset:(googlecloud.audit or gcp.audit) and event.action:v*.compute.firewalls.insert

event.dataset:googlecloud.audit and event.action:v*.compute.firewalls.insert

event.dataset:gcp.audit and event.action:(*.compute.firewalls.delete or google.appengine.*.Firewall.Delete*Rule)

event.dataset:(googlecloud.audit or gcp.audit) and event.action:v*.compute.firewalls.delete

event.dataset:googlecloud.audit and event.action:v*.compute.firewalls.delete

event.dataset:gcp.audit and event.action:(*.compute.firewalls.patch or google.appengine.*.Firewall.Update*Rule)

event.dataset:(googlecloud.audit or gcp.audit) and event.action:v*.compute.firewalls.patch

event.dataset:googlecloud.audit and event.action:v*.compute.firewalls.patch

event.dataset:gcp.audit and event.action:google.iam.admin.v*.CreateRole and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.CreateRole and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.CreateRole and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.DeleteRole and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.DeleteRole and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.DeleteRole and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.DeleteServiceAccountKey and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.DeleteServiceAccountKey and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.DeleteServiceAccountKey and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create or io.k8s.authorization.rbac.v*.rolebindings.create or io.k8s.authorization.rbac.v*.clusterrolebindings.patch or io.k8s.authorization.rbac.v*.rolebindings.patch) and event.outcome:success and not gcp.audit.authentication_info.principal_email:"system:addon-manager"

event.dataset:(googlecloud.audit or gcp.audit) and event.action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create or io.k8s.authorization.rbac.v*.rolebindings.create or io.k8s.authorization.rbac.v*.clusterrolebindings.patch or io.k8s.authorization.rbac.v*.rolebindings.patch) and event.outcome:success and not gcp.audit.authentication_info.principal_email:"system:addon-manager"

event.dataset:(googlecloud.audit or gcp.audit) and event.action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create or io.k8s.authorization.rbac.v*.rolebindings.create or io.k8s.authorization.rbac.v*.clusterrolebindings.patch or io.k8s.authorization.rbac.v*.rolebindings.patch) and event.outcome:success

event.dataset:gcp.audit and event.action:google.logging.v*.ConfigServiceV*.DeleteBucket and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.logging.v*.ConfigServiceV*.DeleteBucket and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.logging.v*.ConfigServiceV*.DeleteBucket and event.outcome:success

event.dataset:gcp.audit and event.action:google.logging.v*.ConfigServiceV*.DeleteSink and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.logging.v*.ConfigServiceV*.DeleteSink and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.logging.v*.ConfigServiceV*.DeleteSink and event.outcome:success

event.dataset:gcp.audit and event.action:google.logging.v*.ConfigServiceV*.UpdateSink and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.logging.v*.ConfigServiceV*.UpdateSink and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.logging.v*.ConfigServiceV*.UpdateSink and event.outcome:success

event.dataset:gcp.audit and event.action:google.pubsub.v*.Subscriber.CreateSubscription and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.pubsub.v*.Subscriber.CreateSubscription and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.pubsub.v*.Subscriber.CreateSubscription and event.outcome:success

event.dataset:gcp.audit and event.action:google.pubsub.v*.Subscriber.DeleteSubscription and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.pubsub.v*.Subscriber.DeleteSubscription and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.pubsub.v*.Subscriber.DeleteSubscription and event.outcome:success

event.dataset:gcp.audit and event.action:google.pubsub.v*.Publisher.CreateTopic and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.pubsub.v*.Publisher.CreateTopic and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.pubsub.v*.Publisher.CreateTopic and event.outcome:success

event.dataset:gcp.audit and event.action:google.pubsub.v*.Publisher.DeleteTopic and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.pubsub.v*.Publisher.DeleteTopic and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.pubsub.v*.Publisher.DeleteTopic and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.CreateServiceAccount and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.CreateServiceAccount and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.CreateServiceAccount and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.DeleteServiceAccount and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.DeleteServiceAccount and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.DeleteServiceAccount and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.DisableServiceAccount and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.DisableServiceAccount and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.DisableServiceAccount and event.outcome:success

event.dataset:gcp.audit and event.action:google.iam.admin.v*.CreateServiceAccountKey and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:google.iam.admin.v*.CreateServiceAccountKey and event.outcome:success

event.dataset:googlecloud.audit and event.action:google.iam.admin.v*.CreateServiceAccountKey and event.outcome:success

event.dataset:gcp.audit and event.action:"storage.buckets.update" and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:"storage.buckets.update" and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:storage.buckets.update and event.outcome:success

event.dataset:googlecloud.audit and event.action:storage.buckets.update and event.outcome:success

event.dataset:gcp.audit and event.action:"storage.buckets.delete"

event.dataset:(googlecloud.audit or gcp.audit) and event.action:"storage.buckets.delete"

event.dataset:(googlecloud.audit or gcp.audit) and event.action:storage.buckets.delete

event.dataset:googlecloud.audit and event.action:storage.buckets.delete

event.dataset:gcp.audit and event.action:"storage.setIamPermissions" and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:"storage.setIamPermissions" and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:storage.setIamPermissions and event.outcome:success

event.dataset:googlecloud.audit and event.action:storage.setIamPermissions and event.outcome:success

event.dataset:gcp.audit and event.action:v*.compute.networks.delete and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:v*.compute.networks.delete and event.outcome:success

event.dataset:googlecloud.audit and event.action:v*.compute.networks.delete and event.outcome:success

event.dataset:gcp.audit and event.action:(v*.compute.routes.insert or "beta.compute.routes.insert")

event.dataset:(googlecloud.audit or gcp.audit) and event.action:(v*.compute.routes.insert or "beta.compute.routes.insert")

event.dataset:(googlecloud.audit or gcp.audit) and event.action:(v*.compute.routes.insert or beta.compute.routes.insert)

event.dataset:googlecloud.audit and event.action:(v*.compute.routes.insert or beta.compute.routes.insert)

event.dataset:gcp.audit and event.action:v*.compute.routes.delete and event.outcome:success

event.dataset:(googlecloud.audit or gcp.audit) and event.action:v*.compute.routes.delete and event.outcome:success

event.dataset:googlecloud.audit and event.action:v*.compute.routes.delete and event.outcome:success

event.dataset:"google_workspace.admin" and event.action:"CREATE_DATA_TRANSFER_REQUEST" and event.category:"iam" and google_workspace.admin.application.name:Drive*

event.dataset:"google_workspace.admin" and event.action:"2sv_disable"

event.dataset:"google_workspace.admin" and event.category:"iam" and event.action:"ASSIGN_ROLE" and google_workspace.event.type:"DELEGATED_ADMIN_SETTINGS" and google_workspace.admin.role.name : *_ADMIN_ROLE

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:ASSIGN_ROLE

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:ASSIGN_ROLE

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:DELETE_ROLE

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:DELETE_ROLE

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:AUTHORIZE_API_CLIENT_ACCESS

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:AUTHORIZE_API_CLIENT_ACCESS

event.dataset:"google_workspace.admin" and event.action:"CHANGE_APPLICATION_SETTING" and event.category:(iam or configuration) and google_workspace.admin.new_value:"Disabled" and google_workspace.admin.setting.name:BitLocker*

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:CREATE_ROLE

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:CREATE_ROLE

event.dataset:"google_workspace.admin" and event.action:("CREATE_GMAIL_SETTING" or "CHANGE_GMAIL_SETTING") and google_workspace.event.type:"EMAIL_SETTINGS" and google_workspace.admin.setting.name:("EMAIL_ROUTE" or "MESSAGE_SECURITY_RULE")

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:ENFORCE_STRONG_AUTHENTICATION and google_workspace.admin.new_value:false

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:ENFORCE_STRONG_AUTHENTICATION and google_workspace.admin.new_value:false

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:ENFORCE_STRONG_AUTHENTICATION and (gsuite.admin.new_value:false or google_workspace.admin.new_value:false)

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:ENFORCE_STRONG_AUTHENTICATION and gsuite.admin.new_value:false

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:(CHANGE_APPLICATION_SETTING or CREATE_APPLICATION_SETTING) and google_workspace.admin.setting.name:( "Password Management - Enforce strong password" or "Password Management - Password reset frequency" or "Password Management - Enable password reuse" or "Password Management - Enforce password policy at next login" or "Password Management - Minimum password length" or "Password Management - Maximum password length" )

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:(CHANGE_APPLICATION_SETTING or CREATE_APPLICATION_SETTING) and gsuite.admin.setting.name:( "Password Management - Enforce strong password" or "Password Management - Password reset frequency" or "Password Management - Enable password reuse" or "Password Management - Enforce password policy at next login" or "Password Management - Minimum password length" or "Password Management - Maximum password length" ) or google_workspace.admin.setting.name:( "Password Management - Enforce strong password" or "Password Management - Password reset frequency" or "Password Management - Enable password reuse" or "Password Management - Enforce password policy at next login" or "Password Management - Minimum password length" or "Password Management - Maximum password length" )

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:(CHANGE_APPLICATION_SETTING or CREATE_APPLICATION_SETTING) and gsuite.admin.setting.name:( "Password Management - Enforce strong password" or "Password Management - Password reset frequency" or "Password Management - Enable password reuse" or "Password Management - Enforce password policy at next login" or "Password Management - Minimum password length" or "Password Management - Maximum password length" )

event.dataset:"google_workspace.admin" and event.action:"CHANGE_APPLICATION_SETTING" and event.category:(iam or configuration) and google_workspace.event.type:"APPLICATION_SETTINGS" and google_workspace.admin.application.name:"Google Workspace Marketplace" and google_workspace.admin.setting.name:"Apps Access Setting Allowlist access" and google_workspace.admin.new_value:"ALLOW_ALL"

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:(ADD_PRIVILEGE or UPDATE_ROLE)

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:(ADD_PRIVILEGE or UPDATE_ROLE)

event.dataset:"google_workspace.admin" and event.action:"CHANGE_GROUP_SETTING" and event.category:"iam" and ((google_workspace.admin.setting.name:"ALLOW_EXTERNAL_MEMBERS" and google_workspace.admin.new_value:"true") or (google_workspace.admin.setting.name:"WHO_CAN_JOIN" and not (google_workspace.admin.new_value:"INVITED_CAN_JOIN" or google_workspace.admin.new_value:"CAN_REQUEST_TO_JOIN")))

event.dataset:"google_workspace.admin" and event.type:change and event.category:iam and google_workspace.event.type:"USER_SETTINGS" and event.action:"MOVE_USER_TO_ORG_UNIT"

event.code: "5136" and winlog.event_data.AttributeLDAPDisplayName:"gPCMachineExtensionNames" and winlog.event_data.AttributeValue:(*827D319E-6EAC-11D2-A4EA-00C04F7 9F83A* and *803E14A0-B4FB-11D0-A0D0-00A0C90F574B*)

event.code: "5136" and winlog.event_data.AttributeLDAPDisplayName:"gPCMachineExtensionNames" and winlog.event_data.AttributeValue:(*827D319E-6EAC-11D2-A4EA-00C04F 79F83A* and *803E14A0-B4FB-11D0-A0D0-00A0C90F574B*)

event.category:(network OR network_traffic) AND network.protocol:http AND network.transport:tcp AND url.full:/http:\/\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\/cd/ AND destination.port:(53 OR 80 OR 8080 OR 443)

event.category:(network OR network_traffic) AND network.protocol:http AND network.transport:tcp AND url.full:/http:\/\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\/cd/ AND destination.port:(53 OR 80 OR 8080 OR 443)

event.dataset:okta.system and event.action:(system.email.account_unlock.sent_message or system.email.password_reset.sent_message or system.sms.send_account_unlock_message or system.sms.send_password_reset_message or system.voice.send_account_unlock_call or system.voice.send_password_reset_call or user.account.unlock_token)

event.dataset:okta.system and event.action:(system.email.account_unlock.sent_message or system.email.password_reset.sent_message or system.sms.send_account_unlock_message or system.sms.send_password_reset_message or system.voice.send_account_unlock_call or system.voice.send_password_reset_call or user.account.unlock_token)

event.category:process and event.type:start and process.name:(net.exe or sc.exe or taskkill.exe) and process.args:(stop or pause or delete or "/PID" or "/IM" or "/T" or "/F" or "/t" or "/f" or "/im" or "/pid")

event.category:process and event.type:start and process.name:"pkill" and process.args:"-f"

any where /* file events for creation; file change events are not captured by some of the included sources for linux and so may miss this, which is the purpose of the process + command line args logic below */ ( event.category == "file" and event.type in ("change", "creation") and file.path : ("/private/etc/hosts", "/etc/hosts", "?:\\Windows\\System32\\drivers\\etc\\hosts") ) or /* process events for change targeting linux only */ ( event.category == "process" and event.type in ("start") and process.name in ("nano", "vim", "vi", "emacs", "echo", "sed") and process.args : ("/etc/hosts") )

file where event.type in ("change", "creation") and file.path : ("/private/etc/hosts", "/etc/hosts", "?:\\Windows\\System32\\drivers\\etc\\hosts")

event.category:file and event.type:(change or creation) and file.path:("/private/etc/hosts" or "/etc/hosts" or "C:\Windows\System32\drivers\etc\hosts")

event.category:process and event.type:(start or process_started) and process.name:(hping or hping2 or hping3)

process.name:(hping or hping2 or hping3) and event.action:executed

process.name: (hping3 or hping2 or hping) and event.action:executed

process where event.type == "start" and (process.name : "appcmd.exe" or process.pe.original_file_name == "appcmd.exe") and process.args : "/dontLog*:*True" and not process.parent.name : "iissetup.exe"

process where event.type in ("start", "process_started") and (process.name : "appcmd.exe" or process.pe.original_file_name == "appcmd.exe") and process.args : "/dontLog*:*True" and not process.parent.name : "iissetup.exe"

event.category:process and event.type:(start or process_started) and (process.name:appcmd.exe or process.pe.original_file_name:appcmd.exe) and process.args:/dontLog\:\"True\" and not process.parent.name:iissetup.exe

event.category:process and event.type:(start or process_started) and (process.name:appcmd.exe or process.pe.original_file_name:appcmd.exe or winlog.event_data.OriginalFileName:appcmd.exe) and process.args:/dontLog\:\"True\" and not process.parent.name:iissetup.exe

registry where length(registry.data.strings) &gt; 0 and registry.path : ("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*.exe\\Debugger", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*\\Debugger", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess") and /* add FPs here */ not registry.data.strings regex~ ("""C:\\Program Files( \(x86\))?\\ThinKiosk\\thinkiosk\.exe""", """.*\\PSAppDeployToolkit\\.*""")

registry where length(registry.data.strings) &gt; 0 and registry.path : ("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*.exe\\Debugger", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*\\Debugger", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess") and /* add FPs here */ not registry.data.strings regex~ ("""C:\\Program Files( \(x86\))?\\ThinKiosk\\thinkiosk\.exe""", """.*\\PSAppDeployToolkit\\.*""")

registry where length(registry.data.strings) &gt; 0 and registry.path : ("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*.exe\\Debugger", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*\\Debugger", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess", "HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess") and /* add FPs here */ not registry.data.strings : ("C:\\Program Files*\\ThinKiosk\\thinkiosk.exe", "*\\PSAppDeployToolkit\\*")

process where event.type == "start" and (process.pe.original_file_name == "wuauclt.exe" or process.name : "wuauclt.exe") and /* necessary windows update client args to load a dll */ process.args : "/RunHandlerComServer" and process.args : "/UpdateDeploymentProvider" and /* common paths writeable by a standard user where the target DLL can be placed */ process.args : ("C:\\Users\\*.dll", "C:\\ProgramData\\*.dll", "C:\\Windows\\Temp\\*.dll", "C:\\Windows\\Tasks\\*.dll")

process where event.type in ("start", "process_started") and (process.pe.original_file_name == "wuauclt.exe" or process.name : "wuauclt.exe") and /* necessary windows update client args to load a dll */ process.args : "/RunHandlerComServer" and process.args : "/UpdateDeploymentProvider" and /* common paths writeable by a standard user where the target DLL can be placed */ process.args : ("C:\\Users\\*.dll", "C:\\ProgramData\\*.dll", "C:\\Windows\\Temp\\*.dll", "C:\\Windows\\Tasks\\*.dll")

event.category:network_traffic AND network.protocol:http AND status:OK AND destination.port:9200 AND network.direction:inbound AND NOT http.response.headers.content-type:"image/x-icon" AND NOT _exists_:http.request.headers.authorization

event.category:network_traffic AND network.protocol:http AND status:OK AND destination.port:9200 AND network.direction:inbound AND NOT http.response.headers.content-type:"image/x-icon" AND NOT _exists_:http.request.headers.authorization

sequence with maxspan=1m [process where event.type == "start" and process.name : "mshta.exe" and process.args : "-Embedding" ] by host.id, process.entity_id [network where event.type == "start" and process.name : "mshta.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id

sequence with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and process.args : "-Embedding" ] by host.id, process.entity_id [network where event.type == "start" and process.name : "mshta.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id

sequence with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and process.args : "-Embedding" ] by host.id, process.entity_id [network where event.type == "start" and process.name : "mshta.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id

sequence with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and process.args : "-Embedding" ] by host.id, process.entity_id [network where event.type == "start" and process.name : "mshta.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and not source.address in ("127.0.0.1", "::1") ] by host.id, process.entity_id

sequence with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and process.args : "-Embedding" ] by host.id, process.entity_id [network where event.type == "start" and process.name : "mshta.exe" and network.direction == "incoming" and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and not source.address in ("127.0.0.1", "::1") ] by host.id, process.entity_id

sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "mmc.exe" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" and network.direction : ("incoming", "ingress") and network.transport == "tcp" ] by process.entity_id [process where event.type == "start" and process.parent.name : "mmc.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "mmc.exe" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" and network.direction : ("incoming", "ingress") and network.transport == "tcp" ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "mmc.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "mmc.exe" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address not in ("127.0.0.1", "::1") and network.direction : ("incoming", "ingress") and network.transport == "tcp" ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "mmc.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "mmc.exe" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address not in ("127.0.0.1", "::1") and network.direction == "incoming" and network.transport == "tcp" ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "mmc.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=5s [network where event.type == "start" and process.name : "explorer.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and source.ip != "127.0.0.1" and source.ip != "::1" ] by process.entity_id [process where event.type == "start" and process.parent.name : "explorer.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=5s [network where event.type == "start" and process.name : "explorer.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and source.ip != "127.0.0.1" and source.ip != "::1" ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "explorer.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=5s [network where event.type == "start" and process.name : "explorer.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and not source.address in ("127.0.0.1", "::1") ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "explorer.exe" ] by process.parent.entity_id

sequence by host.id with maxspan=5s [network where event.type == "start" and process.name : "explorer.exe" and network.direction == "incoming" and network.transport == "tcp" and source.port &gt; 49151 and destination.port &gt; 49151 and not source.address in ("127.0.0.1", "::1") ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "explorer.exe" ] by process.parent.entity_id

sequence by host.id with maxspan = 30s [network where network.direction : ("incoming", "ingress") and destination.port in (5985, 5986) and network.protocol == "http" and source.ip != "127.0.0.1" and source.ip != "::1" ] [process where event.type == "start" and process.parent.name : "wsmprovhost.exe" and not process.name : "conhost.exe"]

sequence by host.id with maxspan = 30s [network where network.direction : ("incoming", "ingress") and destination.port in (5985, 5986) and network.protocol == "http" and source.address != "127.0.0.1" and source.address != "::1" ] [process where event.type == "start" and process.parent.name : "wsmprovhost.exe" and not process.name : "conhost.exe"]

sequence by host.id with maxspan = 30s [network where network.direction == "incoming" and destination.port in (5985, 5986) and network.protocol == "http" and source.address != "127.0.0.1" and source.address != "::1" ] [process where event.type == "start" and process.parent.name : "wsmprovhost.exe" and not process.name : "conhost.exe"]

sequence by host.id with maxspan=30s [network where process.pid == 4 and network.direction : ("incoming", "ingress") and destination.port in (5985, 5986) and network.protocol == "http" and source.ip != "127.0.0.1" and source.ip != "::1" ] [process where event.type == "start" and process.parent.name : "winrshost.exe" and not process.name : "conhost.exe"]

sequence by host.id with maxspan=30s [network where process.pid == 4 and network.direction : ("incoming", "ingress") and destination.port in (5985, 5986) and network.protocol == "http" and not source.address in ("::1", "127.0.0.1") ] [process where event.type == "start" and process.parent.name : "winrshost.exe" and not process.name : "conhost.exe"]

sequence by host.id with maxspan=30s [network where process.pid == 4 and network.direction == "incoming" and destination.port in (5985, 5986) and network.protocol == "http" and not source.address in ("::1", "127.0.0.1") ] [process where event.type == "start" and process.parent.name : "winrshost.exe" and not process.name : "conhost.exe"]

{ "policy": { "phases": { "hot": { "min_age": "0ms", "actions": { "rollover": { "max_size": "50gb", "max_age": "30d" } } } } } }

sequence by process.entity_id with maxspan = 5m [process where event.type == "start" and not (process.name : "sdbinst.exe" and process.parent.name : "msiexec.exe")] [registry where event.type in ("creation", "change") and registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\*.sdb"]

sequence by process.entity_id with maxspan = 5m [process where event.type in ("start", "process_started") and not (process.name : "sdbinst.exe" and process.parent.name : "msiexec.exe")] [registry where event.type in ("creation", "change") and registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\*.sdb"]

sequence by process.entity_id with maxspan=5m [process where event.type in ("start", "process_started") and not (process.name : "sdbinst.exe" and process.parent.name : "msiexec.exe")] [registry where event.type in ("creation", "change") and wildcard(registry.path, "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\*.sdb")]

registry where registry.path : ("HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\Security Packages*", "HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\OSConfig\\Security Packages*") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe")

registry where registry.path : ("HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\Security Packages*", "HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\OSConfig\\Security Packages*") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe")

registry where registry.path : ("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages*", "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\Security Packages*") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe")

/* the benefit of doing this as an eql sequence vs kql is this will limit to alerting only on the first network connection */ sequence by process.entity_id [process where event.type == "start" and process.name : "installutil.exe"] [network where process.name : "installutil.exe" and network.direction : ("outgoing", "egress")]

/* the benefit of doing this as an eql sequence vs kql is this will limit to alerting only on the first network connection */ sequence by process.entity_id [process where event.type in ("start", "process_started") and process.name : "installutil.exe"] [network where process.name : "installutil.exe" and network.direction : ("outgoing", "egress")]

/* the benefit of doing this as an eql sequence vs kql is this will limit to alerting only on the first network connection */ sequence by process.entity_id [process where event.type in ("start", "process_started") and process.name : "installutil.exe"] [network where process.name : "installutil.exe" and network.direction == "outgoing"]

event.category:process and event.type:(start or process_started) and process.name:perl and process.args:("exec \"/bin/sh\";" or "exec \"/bin/dash\";" or "exec \"/bin/bash\";")

event.action:executed and process.name:perl and process.args:("exec \"/bin/sh\";" or "exec \"/bin/dash\";" or "exec \"/bin/bash\";")

event.category:process and event.type:(start or process_started) and process.name:python* and process.args:("import pty; pty.spawn(\"/bin/sh\")" or "import pty; pty.spawn(\"/bin/dash\")" or "import pty; pty.spawn(\"/bin/bash\")")

event.category:process and event.type:(start or process_started) and process.name:python* and process.args:("import pty; pty.spawn(\"/bin/sh\")" or "import pty; pty.spawn(\"/bin/dash\")" or "import pty; pty.spawn(\"/bin/bash\")")

event.category:process and event.type:(start or process_started) and process.name:python and process.args:("import pty; pty.spawn(\"/bin/sh\")" or "import pty; pty.spawn(\"/bin/dash\")" or "import pty; pty.spawn(\"/bin/bash\")")

event.action:executed and process.name:python and process.args:("import pty; pty.spawn(\"/bin/sh\")" or "import pty; pty.spawn(\"/bin/dash\")" or "import pty; pty.spawn(\"/bin/bash\")")

event.category:(network or network_traffic) and network.transport:udp and destination.port:4500

event.category:(network or network_traffic) and network.transport:udp and destination.port:4500

network.transport:udp and destination.port:4500

event.category:process and event.type:(start or process_started) and process.name:kcc and process.args:copy_cred_cache

event.code:4738 and message:"'Don't Require Preauth' - Enabled"

network where event.type == "start" and network.direction : ("outgoing", "egress") and destination.port == 88 and source.port &gt;= 49152 and not process.executable : ("?:\\Windows\\System32\\lsass.exe", "System", "\\device\\harddiskvolume?\\windows\\system32\\lsass.exe", "?:\\Program Files\\rapid7\\nexpose\\nse\\.DLLCACHE\\nseserv.exe", "?:\\Program Files (x86)\\GFI\\LanGuard 12 Agent\\lnsscomm.exe", "?:\\Program Files (x86)\\SuperScan\\scanner.exe", "?:\\Program Files (x86)\\Nmap\\nmap.exe", "\\device\\harddiskvolume?\\program files (x86)\\nmap\\nmap.exe") and destination.address !="127.0.0.1" and destination.address !="::1" and /* insert false positives here */ not process.name in ("swi_fc.exe", "fsIPcam.exe", "IPCamera.exe", "MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe")

network where event.type == "start" and network.direction : ("outgoing", "egress") and destination.port == 88 and source.port &gt;= 49152 and process.executable != "C:\\Windows\\System32\\lsass.exe" and destination.address !="127.0.0.1" and destination.address !="::1" and /* insert false positives here */ not process.name in ("swi_fc.exe", "fsIPcam.exe", "IPCamera.exe", "MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe")

network where event.type == "start" and network.direction : ("outgoing", "egress") and destination.port == 88 and source.port &gt;= 49152 and process.executable != "C:\\Windows\\System32\\lsass.exe" and destination.address !="127.0.0.1" and destination.address !="::1" and /* insert False Positives here */ not process.name in ("swi_fc.exe", "fsIPcam.exe", "IPCamera.exe", "MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe")

network where event.type == "start" and network.direction == "outgoing" and destination.port == 88 and source.port &gt;= 49152 and process.executable != "C:\\Windows\\System32\\lsass.exe" and destination.address !="127.0.0.1" and destination.address !="::1" and /* insert False Positives here */ not process.name in ("swi_fc.exe", "fsIPcam.exe", "IPCamera.exe", "MicrosoftEdgeCP.exe", "MicrosoftEdge.exe", "iexplore.exe", "chrome.exe", "msedge.exe", "opera.exe", "firefox.exe")

process where event.type == "start" and process.executable : "/usr/sbin/insmod" and process.args : "*.ko"

event.category:process and event.type:(start or process_started) and process.args:((rmmod and sudo) or (modprobe and sudo and ("--remove" or "-r")))

event.action:executed and process.args:(rmmod and sudo or modprobe and sudo and ("--remove" or "-r"))

process where event.type == "start" and process.name : "security" and process.args : "-wa" and process.args : ("find-generic-password", "find-internet-password") and process.args : ("Chrome*", "Chromium", "Opera", "Safari*", "Brave", "Microsoft Edge", "Edge", "Firefox*") and not process.parent.executable : "/Applications/Keeper Password Manager.app/Contents/Frameworks/Keeper Password Manager Helper*/Contents/MacOS/Keeper Password Manager Helper*"

event.category:process and event.type:(start or process_started) and process.name:security and process.args:("find-generic-password" or "find-internet-password")

event.action:modified-user-account and event.code:4738 and winlog.event_data.AllowedToDelegateTo:*krbtgt*

kubernetes.audit.annotations.authorization_k8s_io/decision:"allow" and (kubernetes.audit.user.username:("system:anonymous" or "system:unauthenticated") or not kubernetes.audit.user.username:*) and not kubernetes.audit.objectRef.resource:("healthz" or "livez" or "readyz")

event.dataset: "kubernetes.audit_logs" and kubernetes.audit.user.username: system\:serviceaccount\:* and kubernetes.audit.annotations.authorization_k8s_io/decision: "forbid"

kubernetes.audit.objectRef.resource:"services" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.type:"NodePort"

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.volumes.hostPath.path:("/" or "/proc" or "/root" or "/var" or "/var/run/docker.sock" or "/var/run/crio/crio.sock" or "/var/run/cri-dockerd.sock" or "/var/lib/kubelet" or "/var/lib/kubelet/pki" or "/var/lib/docker/overlay2" or "/etc" or "/etc/kubernetes" or "/etc/kubernetes/manifests" or "/home/admin")

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.volumes.hostPath.path:("/" or "/proc" or "/root" or "/var" or "/var/run/docker.sock" or "/var/run/crio/crio.sock" or "/var/run/cri-dockerd.sock" or "/var/lib/kubelet" or "/var/lib/kubelet/pki" or "/var/lib/docker/overlay2" or "/etc" or "/etc/kubernetes" or "/etc/kubernetes/manifests" or "/home/admin")

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.hostIPC:true

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.hostNetwork:true

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.verb:("create" or "update" or "patch") and kubernetes.audit.requestObject.spec.hostPID:true

kubernetes.audit.objectRef.resource:pods and kubernetes.audit.verb:create and kubernetes.audit.requestObject.spec .containers.securityContext.privileged:true

event.dataset : "kubernetes.audit_logs" and kubernetes.audit.verb : "create" and kubernetes.audit.objectRef.resource : "pods" and kubernetes.audit.objectRef.namespace : "kube-system" and kubernetes.audit.requestObject.spec.serviceAccountName:*controller

kubernetes.audit.verb:"create" and kubernetes.audit.objectRef.resource:("selfsubjectaccessreviews" or "selfsubjectrulesreviews") and kubernetes.audit.user.username:(system\:serviceaccount\:* or system\:node\:*) or kubernetes.audit.impersonatedUser.username:(system\:serviceaccount\:* or system\:node\:*)

kubernetes.audit.verb:"create" and kubernetes.audit.objectRef.resource:("selfsubjectaccessreviews" or "selfsubjectrulesreviews") and kubernetes.audit.user.username:(system\:serviceaccount\:* or system\:node\:*) or kubernetes.audit.impersonatedUser.username:(system\:serviceaccount\:* or system\:node\:*)

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.objectRef.subresource:"exec"

kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.objectRef.subresource:"exec"

event.dataset:"kubernetes.audit_logs" and kubernetes.audit.objectRef.resource:"pods" and kubernetes.audit.objectRef.subresource:"exec"

file where event.type in ("creation", "change") and /* via RDP TSClient mounted share or SMB */ (process.name : "mstsc.exe" or process.pid == 4) and file.path : ("?:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*", "?:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*")

file where event.type in ("creation", "change") and /* via RDP TSClient mounted share or SMB */ (process.name : "mstsc.exe" or process.pid == 4) and file.path : "C:\\*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"

sequence by host.id with maxspan=1m [file where event.type != "deletion" and file.path : ("/System/Library/LaunchAgents/*", "/Library/LaunchAgents/*", "/Users/*/Library/LaunchAgents/*") ] [process where event.type in ("start", "process_started") and process.name == "launchctl" and process.args == "load"]

sequence by host.id with maxspan=1m [file where event.type != "deletion" and file.path : ("/System/Library/LaunchAgents/*", "/Library/LaunchAgents/*", "/Users/*/Library/LaunchAgents/*") ] [process where event.type in ("start", "process_started") and process.name == "launchctl" and process.args == "load"]

sequence by host.id with maxspan=1m [file where event.type != "deletion" and file.path : ("/System/Library/LaunchDaemons/*", "/Library/LaunchDaemons/*")] [process where event.type in ("start", "process_started") and process.name == "launchctl" and process.args == "load"]

sequence by host.id with maxspan=1m [file where event.type != "deletion" and file.path in ("/System/Library/LaunchDaemons/*", "/Library/LaunchDaemons/*")] [process where event.type in ("start", "process_started") and process.name == "launchctl" and process.args == "load"]

sequence by host.id with maxspan=1m [file where event.type != "deletion" and file.path in ("/System/Library/LaunchDaemons/*", " /Library/LaunchDaemons/*")] [process where event.type in ("start", "process_started") and process.name == "launchctl" and process.args == "load"]

process where event.type == "start" and /* launch shells from unusual process */ (process.name == "capsh" and process.args == "--") or /* launching shells from unusual parents or parent+arg combos */ (process.name in ("bash", "sh", "dash","ash") and (process.parent.name in ("byebug","git","ftp","strace")) or /* shells specified in parent args */ /* nice rule is broken in 8.2 */ (process.parent.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") and ( (process.parent.name == "nice") or (process.parent.name == "cpulimit" and process.parent.args == "-f") or (process.parent.name == "find" and process.parent.args == "-exec" and process.parent.args == ";") or (process.parent.name == "flock" and process.parent.args == "-u" and process.parent.args == "/") ) ) or /* shells specified in args */ (process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") and (process.parent.name == "crash" and process.parent.args == "-h") or (process.name == "sensible-pager" and process.parent.name in ("apt", "apt-get") and process.parent.args == "changelog") /* scope to include more sensible-pager invoked shells with different parent process to reduce noise and remove false positives */ ) ) or (process.name == "busybox" and process.args_count == 2 and process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") )or (process.name == "env" and process.args_count == 2 and process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash")) or (process.parent.name in ("vi", "vim") and process.parent.args == "-c" and process.parent.args in (":!/bin/bash", ":!/bin/sh", ":!bash", ":!sh")) or (process.parent.name in ("c89","c99", "gcc") and process.parent.args in ("sh,-s", "bash,-s", "dash,-s", "ash,-s", "/bin/sh,-s", "/bin/bash,-s", "/bin/dash,-s", "/bin/ash,-s") and process.parent.args == "-wrapper") or (process.parent.name == "expect" and process.parent.args == "-c" and process.parent.args in ("spawn /bin/sh;interact", "spawn /bin/bash;interact", "spawn /bin/dash;interact", "spawn sh;interact", "spawn bash;interact", "spawn dash;interact")) or (process.parent.name == "mysql" and process.parent.args == "-e" and process.parent.args in ("\\!*sh", "\\!*bash", "\\!*dash", "\\!*/bin/sh", "\\!*/bin/bash", "\\!*/bin/dash")) or (process.parent.name == "ssh" and process.parent.args == "-o" and process.parent.args in ("ProxyCommand=;sh 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;bash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;dash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/sh 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/bash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/dash 0&lt;&amp;2 1&gt;&amp;2")) or (process.parent.name in ("nawk", "mawk", "awk", "gawk") and process.parent.args : "BEGIN {system(*)}")

process where event.type == "start" and /* launch shells from unusual process */ (process.name == "capsh" and process.args == "--") or /* launching shells from unusual parents or parent+arg combos */ (process.name in ("bash", "sh", "dash","ash") and (process.parent.name in ("byebug","git","ftp")) or /* shells specified in parent args */ /* nice rule is broken in 8.2 */ (process.parent.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") and (process.parent.name == "nice") or (process.parent.name == "cpulimit" and process.parent.args == "-f") or (process.parent.name == "find" and process.parent.args == "-exec" and process.parent.args == ";") or (process.parent.name == "flock" and process.parent.args == "-u" and process.parent.args == "/") ) or /* shells specified in args */ (process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") and (process.parent.name == "crash" and process.parent.args == "-h") or (process.name == "sensible- pager" and process.parent.name in ("apt", "apt-get") and process.parent.args == "changelog") /* scope to include more sensible-pager invoked shells with different parent process to reduce noise and remove false positives */ ) ) or (process.name == "busybox" and process.args_count == 2 and process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash") )or (process.name == "env" and process.args_count == 2 and process.args in ("/bin/sh", "/bin/bash", "/bin/dash", "/bin/ash", "sh", "bash", "dash", "ash")) or (process.parent.name in ("vi", "vim") and process.parent.args == "-c" and process.parent.args in (":!/bin/bash", ":!/bin/sh", ":!bash", ":!sh")) or (process.parent.name in ("c89","c99", "gcc") and process.parent.args in ("sh,-s", "bash,-s", "dash,-s", "ash,-s", "/bin/sh,-s", "/bin/bash,-s", "/bin/dash,-s", "/bin/ash,-s") and process.parent.args == "-wrapper") or (process.parent.name == "expect" and process.parent.args == "-c" and process.parent.args in ("spawn /bin/sh;interact", "spawn /bin/bash;interact", "spawn /bin/dash;interact", "spawn sh;interact", "spawn bash;interact", "spawn dash;interact")) or (process.parent.name == "mysql" and process.parent.args == "-e" and process.parent.args in ("\\!*sh", "\\!*bash", "\\!*dash", "\\!*/bin/sh", "\\!*/bin/bash", "\\!*/bin/dash")) or (process.parent.name == "ssh" and process.parent.args == "-o" and process.parent.args in ("ProxyCommand=;sh 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;bash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;dash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/sh 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/bash 0&lt;&amp;2 1&gt;&amp;2", "ProxyCommand=;/bin/dash 0&lt;&amp;2 1&gt;&amp;2")) or (process.parent.name in ("nawk", "mawk", "awk", "gawk") and process.parent.args : "BEGIN {system(*)}")

sequence with maxspan=1m [process where event.type != "end" and ((process.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe") or process.pe.original_file_name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.dll", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe")) or process.code_signature.trusted == false)] by process.entity_id [process where event.type == "start" and (process.name : "schtasks.exe" or process.pe.original_file_name == "schtasks.exe") and process.args : ("/create", "-create") and process.args : ("/RU", "/SC", "/TN", "/TR", "/F", "/XML") and /* exclude SYSTEM Integrity Level - look for task creations by non-SYSTEM user */ not (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") ] by process.parent.entity_id

sequence with maxspan=1m [process where event.type != "end" and ((process.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe") or process.pe.original_file_name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.dll", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe")) or process.code_signature.trusted == false)] by process.entity_id [process where event.type == "start" and (process.name : "schtasks.exe" or process.pe.original_file_name == "schtasks.exe") and process.args : ("/create", "-create") and process.args : ("/RU", "/SC", "/TN", "/TR", "/F", "/XML") and /* exclude SYSTEM Integrity Level - look for task creations by non-SYSTEM user */ not (process.Ext.token.integrity_level_name : "System" or winlog.event_data.IntegrityLevel : "System") ] by process.parent.entity_id

sequence with maxspan=1m [process where event.type != "end" and ((process.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe") or process.pe.original_file_name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.dll", "powershell_ise.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe")) or process.code_signature.trusted == false)] by process.entity_id [process where event.type == "start" and (process.name : "schtasks.exe" or process.pe.original_file_name == "schtasks.exe") and process.args : ("/create", "-create") and process.args : ("/RU", "/SC", "/TN", "/TR", "/F", "/XML") and /* exclude SYSTEM SIDs - look for task creations by non-SYSTEM user */ not user.id : ("S-1-5-18", "S-1-5-19", "S-1-5-20")] by process.parent.entity_id

sequence with maxspan=1m [process where event.type != "end" and ((process.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe") or process.pe.original_file_name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "WmiPrvSe.exe", "wsmprovhost.exe", "winrshost.exe")) or process.code_signature.trusted == false)] by process.entity_id [process where event.type == "start" and (process.name : "schtasks.exe" or process.pe.original_file_name == "schtasks.exe") and process.args : ("/create", "-create") and process.args : ("/RU", "/SC", "/TN", "/TR", "/F", "/XML") and /* exclude SYSTEM SIDs - look for task creations by non-SYSTEM user */ not user.id : ("S-1-5-18", "S-1-5-19", "S-1-5-20")] by process.parent.entity_id

event.category:process and event.type:(start or process_started) and process.name:schtasks.exe and process.args:(-change or -create or -run or -s or /S or /change or /create or /run)

event.action:"Process Create (rule: ProcessCreate)" and process.name:schtasks.exe and process.args:(-change or -create or -run or -s or /S or /change or /create or /run)

event.action:"Process Create (rule: ProcessCreate)" and process.name:schtasks.exe and process.args:("/create" or "-create" or "/S" or "-s" or "/run" or "-run" or "/change" or "-change")

file where file.name : ("lsass*.dmp", "dumpert.dmp", "Andrew.dmp", "SQLDmpr*.mdmp", "Coredump.dmp") and not (process.executable : ("?:\\Program Files\\Microsoft SQL Server\\*\\Shared\\SqlDumper.exe", "?:\\Windows\\System32\\dllhost.exe") and file.path : ("?:\\Program Files\\Microsoft SQL Server\\*\\Shared\\ErrorDumps\\SQLDmpr*.mdmp", "?:\\*\\Reporting Services\\Logfiles\\SQLDmpr*.mdmp")) and not (process.executable : "?:\\WINDOWS\\system32\\WerFault.exe" and file.path : "?:\\Windows\\System32\\config\\systemprofile\\AppData\\Lo cal\\CrashDumps\\lsass.exe.*.dmp")

file where file.name : ("lsass*.dmp", "dumpert.dmp", "Andrew.dmp", "SQLDmpr*.mdmp", "Coredump.dmp")

event.category:file and file.name:(lsass.DMP or lsass*.dmp or dumpert.dmp or Andrew.dmp or SQLDmpr*.mdmp or Coredump.dmp)

any where event.action == "File System" and event.code == "4656" and winlog.event_data.ObjectName : ( "?:\\Windows\\System32\\lsass.exe", "\\Device\\HarddiskVolume?\\Windows\\System32\\lsass.exe", "\\Device\\HarddiskVolume??\\Windows\\System32\\lsass.exe") and /* The right to perform an operation controlled by an extended access right. */ (winlog.event_data.AccessMask : ("0x1fffff" , "0x1010", "0x120089", "0x1F3FFF") or winlog.event_data.AccessMaskDescription : ("READ_CONTROL", "Read from process memory")) /* Common Noisy False Positives */ and not winlog.event_data.ProcessName : ( "?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\system32\\wbem\\WmiPrvSE.exe", "?:\\Windows\\System32\\dllhost.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\System32\\msiexec.exe", "?:\\ProgramData\\Microsoft\\Windows Defender\\*.exe", "?:\\Windows\\explorer.exe")

sequence by host.id, user.id with maxspan=30s [process where event.type == "start" and event.action == "exec" and process.parent.name : ("installer", "package_script_service") and process.name : ("bash", "sh", "zsh", "python", "osascript", "tclsh*")] [network where event.type == "start" and process.name : ("curl", "osascript", "wget", "python")]

sequence by host.id, user.id with maxspan=30s [process where event.type == "start" and event.action == "exec" and process.parent.name : ("installer", "package_script_service") and process.name : ("bash", "sh", "zsh", "python", "osascript", "tclsh*")] [network where event.type == "start" and process.name : ("curl", "osascript", "wget", "python")]

sequence by process.entity_id with maxspan=1m [process where event.type == "start" and host.os.family == "macos" and process.parent.executable in ("/usr/sbin/installer", "/System/Library/CoreServices/Installer.app/Contents/MacOS/Installer") ] [network where not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id with maxspan=1m [ process where event.type == "start" and host.os.family == "macos" and process.parent.executable in ("/usr/sbin/installer", "/System/Library/CoreServices/Installer.app/Contents/MacOS/Installer") ] [ network where not cidrmatch(destination.ip, "192.168.0.0/16", "10.0.0.0/8", "172.16.0.0/12", "224.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "::1", "FE80::/10", "FF00::/8") ]

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:file_classification_event or endgame.event_subtype_full:file_classification_event)

event.kind:alert and event.module:endgame and event.action:file_classification_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:file_classification_event or endgame.event_subtype_full:file_classification_event)

event.kind:alert and event.module:endgame and event.action:file_classification_event and endgame.metadata.type:prevention

event.dataset:google_workspace.admin and event.provider:admin and event.category:iam and event.action:(ENFORCE_STRONG_AUTHENTICATION or ALLOW_STRONG_AUTHENTICATION) and google_workspace.admin.new_value:false

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:(ENFORCE_STRONG_AUTHENTICATION or ALLOW_STRONG_AUTHENTICATION) and (gsuite.admin.new_value:false or google_workspace.admin.new_value:false)

event.dataset:(gsuite.admin or google_workspace.admin) and event.provider:admin and event.category:iam and event.action:(ENFORCE_STRONG_AUTHENTICATION or ALLOW_STRONG_AUTHENTICATION) and gsuite.admin.new_value:false

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Remove-AntiPhishPolicy" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("Remove-AntiPhishRule" or "Disable-AntiPhishRule") and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Set-DkimSigningConfig" and o365.audit.Parameters.Enabled:False and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Remove-DlpPolicy" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Remove-MalwareFilterPolicy" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("Remove-MalwareFilterRule" or "Disable-MalwareFilterRule") and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-ManagementRoleAssignment" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Disable-SafeAttachmentRule" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"Disable-SafeLinksRule" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-TransportRule" and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("Remove-TransportRule" or "Disable-TransportRule") and event.outcome:success

event.dataset:o365.audit and event.code:"AzureActiveDirectory" and event.action:"Add member to role." and o365.audit.ModifiedProperties.Role_DisplayName.NewValue:"Global Administrator"

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("New-InboxRule" or "Set- InboxRule") and ( o365.audit.Parameters.ForwardTo:* or o365.audit.Parameters.ForwardAsAttachmentTo:* or o365.audit.Parameters.RedirectTo:* ) and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-InboxRule" and ( o365.audit.Parameters.ForwardTo:* or o365.audit.Parameters.ForwardAsAttachmentTo:* or o365.audit.Parameters.RedirectTo:* ) and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-InboxRule" and ( o365.audit.Parameters.ForwardTo:* or o365.audit.Parameters.ForwardAsAttachmentTo:* or o365.audit.Parameters.RedirectTo:* ) and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-InboxRule" and ( o365audit.Parameters.ForwardTo:* or o365audit.Parameters.ForwardAsAttachmentTo:* or o365audit.Parameters.RedirectTo:* ) and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:"New-InboxRule" and event.outcome:success

event.dataset:o365.audit and event.provider:SecurityComplianceCenter and event.category:web and event.action:"Potential ransomware activity" and event.outcome:success

event.dataset:o365.audit and event.provider:MicrosoftTeams and event.category:web and event.action:TeamsTenantSettingChanged and o365.audit.Name:"Allow sideloading and interaction of custom apps" and o365.audit.NewValue:True and event.outcome:success

event.dataset:o365.audit and event.provider:(SkypeForBusiness or MicrosoftTeams) and event.category:web and event.action:"Set- CsTenantFederationConfiguration" and o365.audit.Parameters.AllowFederatedUsers:True and event.outcome:success

event.dataset:o365.audit and event.provider:(SkypeForBusiness or MicrosoftTeams) and event.category:web and event.action:"Set- CsTeamsClientConfiguration" and o365.audit.Parameters.AllowGuestUser:True and event.outcome:success

event.dataset:o365.audit and event.provider:SecurityComplianceCenter and event.category:web and event.action:"Unusual volume of file deletion" and event.outcome:success

event.dataset:o365.audit and event.provider:SecurityComplianceCenter and event.category:web and event.action:"User restricted from sending email" and event.outcome:success

process where event.type == "start" and process.parent.name : "MSBuild.exe" and process.name : ("csc.exe", "iexplore.exe", "powershell.exe")

process where event.type in ("start", "process_started") and process.parent.name : "MSBuild.exe" and process.name : ("csc.exe", "iexplore.exe", "powershell.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:MSBuild.exe and process.name:(csc.exe or iexplore.exe or powershell.exe)

process.parent.name:MSBuild.exe and process.name:(csc.exe or iexplore.exe or powershell.exe)

process where event.type == "start" and process.name : "MSBuild.exe" and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "outlook.exe", "powerpnt.exe", "winword.exe" )

process where event.type in ("start", "process_started") and process.name : "MSBuild.exe" and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "outlook.exe", "powerpnt.exe", "winword.exe" )

event.category:process and event.type:(start or process_started) and process.name:MSBuild.exe and process.parent.name:(eqnedt32.exe or excel.exe or fltldr.exe or msaccess.exe or mspub.exe or outlook.exe or powerpnt.exe or winword.exe)

process.name:MSBuild.exe and process.parent.name:(eqnedt32.exe or excel.exe or fltldr.exe or msaccess.exe or mspub.exe or outlook.exe or powerpnt.exe or winword.exe) and event.action: "Process Create (rule: ProcessCreate)"

process where event.type == "start" and (process.name : "MSBuild.exe" or process.pe.original_file_name == "MSBuild.exe") and process.parent.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "cscript.exe", "wscript.exe", "mshta.exe")

process where event.type == "start" and (process.name : "MSBuild.exe" or process.pe.original_file_name == "MSBuild.exe") and process.parent.name : ("cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe")

event.category:process and event.type: start and process.name:MSBuild.exe and process.parent.name:(cmd.exe or powershell.exe or cscript.exe or wscript.exe)

process.name:MSBuild.exe and process.parent.name:(cmd.exe or powershell.exe or cscript.exe or wscript.exe) and event.action:"Process Create (rule: ProcessCreate)"

process where event.type == "start" and process.name : "MSBuild.exe" and process.parent.name : ("explorer.exe", "wmiprvse.exe")

process where event.type in ("start", "process_started") and process.name : "MSBuild.exe" and process.parent.name : ("explorer.exe", "wmiprvse.exe")

event.category:process and event.type:(start or process_started) and process.name:MSBuild.exe and process.parent.name:(explorer.exe or wmiprvse.exe)

process.name:MSBuild.exe and process.parent.name:(explorer.exe or wmiprvse.exe) and event.action:"Process Create (rule: ProcessCreate)"

process where event.type == "start" and process.pe.original_file_name == "MSBuild.exe" and not process.name : "MSBuild.exe"

process where event.type in ("start", "process_started") and process.pe.original_file_name == "MSBuild.exe" and not process.name : "MSBuild.exe"

event.category:process and event.type:(start or process_started) and process.pe.original_file_name:MSBuild.exe and not process.name: MSBuild.exe

event.category:process and event.type:(start or process_started) and (process.pe.original_file_name:MSBuild.exe or winlog.event_data.OriginalFileName:MSBuild.exe) and not process.name: MSBuild.exe

event.category:process and event.type:(start or process_started) and (pe.original_file_name:MSBuild.exe or winlog.event_data.OriginalFileName:MSBuild.exe) and not process.name: MSBuild.exe

(pe.original_file_name:MSBuild.exe or winlog.event_data.OriginalFileName: MSBuild.exe) and not process.name: MSBuild.exe and event.action: "Process Create (rule: ProcessCreate)"

process where event.type == "start" and process.parent.name : ("UMService.exe", "UMWorkerProcess.exe") and not process.executable : ("?:\\Windows\\System32\\werfault.exe", "?:\\Windows\\System32\\wermgr.exe", "?:\\Program Files\\Microsoft\\Exchange Server\\V??\\Bin\\UMWorkerProcess.exe", "D:\\Exchange 2016\\Bin\\UMWorkerProcess.exe", "E:\\ExchangeServer\\Bin\\UMWorkerProcess.exe")

process where event.type == "start" and process.parent.name : ("UMService.exe", "UMWorkerProcess.exe") and not process.name : ("werfault.exe", "wermgr.exe")

file where event.type == "creation" and process.name : ("UMWorkerProcess.exe", "umservice.exe") and file.extension : ("php", "jsp", "js", "aspx", "asmx", "asax", "cfm", "shtml") and ( file.path : "?:\\inetpub\\wwwroot\\aspnet_client\\*" or (file.path : "?:\\*\\Microsoft\\Exchange Server*\\FrontEnd\\HttpProxy\\owa\\auth\\*" and not (file.path : "?:\\*\\Microsoft\\Exchange Server*\\FrontEnd\\HttpProxy\\owa\\auth\\version\\*" or file.name : ("errorFE.aspx", "expiredpassword.aspx", "frowny.aspx", "GetIdToken.htm", "logoff.aspx", "logon.aspx", "OutlookCN.aspx", "RedirSuiteServiceProxy.aspx", "signout.aspx"))) or (file.path : "?:\\*\\Microsoft\\Exchange Server*\\FrontEnd\\HttpProxy\\ecp\\auth\\*" and not file.name : "TimeoutLogoff.aspx") )

file where event.type == "creation" and process.parent.name : ("UMWorkerProcess.exe", "umservice.exe") and file.extension : ("php", "jsp", "js", "aspx", "asmx", "asax", "cfm", "shtml") and ( file.path : ("C:\\inetpub\\wwwroot\\aspnet_client\\*", "C:\\*\\FrontEnd\\HttpProxy\\owa\\auth\\*") or (file.path : "C:\\*\\FrontEnd\\HttpProxy\\ecp\\auth\\*" and not file.name : "TimeoutLogoff.aspx") )

process where event.type == "start" and process.parent.name : "w3wp.exe" and process.parent.args : "MSExchange*AppPool" and (process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name in ("cmd.exe", "powershell.exe", "pwsh.dll", "powershell_ise.exe"))

process where event.type == "start" and process.parent.name : "w3wp.exe" and process.parent.args : "MSExchange*AppPool" and (process.name : ("cmd.exe", "powershell.exe", "pwsh.exe") or process.pe.original_file_name : ("cmd.exe", "powershell.exe", "pwsh.exe"))

process where event.type == "start" and (process.name : "aspnet_regiis.exe" or process.pe.original_file_name == "aspnet_regiis.exe") and process.args : "connectionStrings" and process.args : "-pdf"

process where event.type in ("start", "process_started") and (process.name : "aspnet_regiis.exe" or process.pe.original_file_name == "aspnet_regiis.exe") and process.args : "connectionStrings" and process.args : "-pdf"

event.category:process and event.type:(start or process_started) and (process.name:aspnet_regiis.exe or process.pe.original_file_name:aspnet_regiis.exe or winlog.event_data.OriginalFileName:aspnet_regiis.exe) and process.args:(connectionStrings and "-pdf")

process where event.type == "start" and (process.name : "appcmd.exe" or process.pe.original_file_name == "appcmd.exe") and process.args : "/list" and process.args : "/text*password"

process where event.type in ("start", "process_started") and (process.name : "appcmd.exe" or process.pe.original_file_name == "appcmd.exe") and process.args : "/list" and process.args : "/text*password"

process where event.type in ("start", "process_started") and (process.name : "appcmd.exe" or process.pe.original_file_name == "appcmd.exe") and process.args : "/list" and process.args : "/text*password"

event.category:process AND event.type:(start OR process_started) AND (process.name:appcmd.exe OR process.pe.original_file_name:appcmd.exe or winlog.event_data.OriginalFileName:appcmd.exe) AND process.args:(/[lL][iI][sS][tT]/ AND /\/[tT][eE][xX][tT]\:[pP][aA][sS][sS][wW][oO][rR][dD]/)

registry where event.type in ("creation", "change") and (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PUAProtection" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\\DisallowExploitProtectionOverride" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Features\\TamperProtection" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIntrusionPreventionSystem" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableScriptScanning" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\EnableControlledFolderAccess" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIOAVProtection" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting\\DisableEnhancedNotifications" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SpynetReporting" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SubmitSamplesConsent" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableBehaviorMonitoring" and registry.data.strings : ("1", "0x00000001"))

registry where event.type in ("creation", "change") and (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PUAProtection" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\\DisallowExploitProtectionOverride" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Features\\TamperProtection" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIntrusionPreventionSystem" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableScriptScanning" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\EnableControlledFolderAccess" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIOAVProtection" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting\\DisableEnhancedNotifications" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen" and registry.data.strings : ("1", "0x00000001")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SpynetReporting" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SubmitSamplesConsent" and registry.data.strings : ("0", "0x00000000")) or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableBehaviorMonitoring" and registry.data.strings : ("1", "0x00000001"))

registry where event.type in ("creation", "change") and (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PUAProtection" and registry.data.strings : "0") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\\DisallowExploitProtectionOverride" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Features\\TamperProtection" and registry.data.strings : "0") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIntrusionPreventionSystem" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableScriptScanning" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\EnableControlledFolderAccess" and registry.data.strings : "0") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIOAVProtection" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting\\DisableEnhancedNotifications" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen" and registry.data.strings : "1") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SpynetReporting" and registry.data.strings : "0") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SubmitSamplesConsent" and registry.data.strings : "0") or (registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableBehaviorMonitoring" and registry.data.strings : "1")

file where file.name : "mimilsa.log" and process.name : "lsass.exe"

event.category:file and file.name:mimilsa.log and process.name:lsass.exe

registry where event.type in ("creation", "change") and registry.path : ( "HKEY_USERS\\*\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable", "HKU\\*\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable" ) and registry.data.strings: ("0", "0x00000000")

registry where event.type in ("creation", "change") and registry.path: "HKEY_USERS\\*\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable" and registry.data.strings: "0"

process where event.type == "start" and (process.name : "bcdedit.exe" or process.pe.original_file_name == "bcdedit.exe") and ( (process.args : "/set" and process.args : "bootstatuspolicy" and process.args : "ignoreallfailures") or (process.args : "no" and process.args : "recoveryenabled") )

process where event.type in ("start", "process_started") and (process.name : "bcdedit.exe" or process.pe.original_file_name == "bcdedit.exe") and ( (process.args : "/set" and process.args : "bootstatuspolicy" and process.args : "ignoreallfailures") or (process.args : "no" and process.args : "recoveryenabled") )

process where event.type in ("start", "process_started") and (process.name : "bcdedit.exe" or process.pe.original_file_name == "bcdedit.exe") and (process.args : "/set" and process.args : "bootstatuspolicy" and process.args : "ignoreallfailures") or (process.args : "no" and process.args : "recoveryenabled")

event.category:process and event.type:(start or process_started) and process.name:bcdedit.exe and process.args:(/set and (bootstatuspolicy and ignoreallfailures or no and recoveryenabled))

event.action:"Process Create (rule: ProcessCreate)" and process.name:bcdedit.exe and process.args:(/set and (bootstatuspolicy and ignoreallfailures or no and recoveryenabled))

event.category:file and not event.type:deletion and file.path:/etc/ld.so.preload

event.category:process and event.type:start and process.name:launchctl and process.args:(setenv and not (JAVA*_HOME or RUNTIME_JAVA_HOME or DBUS_LAUNCHD_SESSION_BUS_SOCKET or ANT_HOME or LG_WEBOS_TV_SDK_HOME or WEBOS_CLI_TV or EDEN_ENV) ) and not process.parent.executable:("/Applications/NoMachine.app/Co ntents/Frameworks/bin/nxserver.bin" or "/usr/local/bin/kr" or "/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin" or "/Applications/IntelliJ IDEA CE.app/Contents/jbr/Contents/Home/lib/jspawnhelper") and not process.args : "*.vmoptions"

event.category:process and event.type:start and process.name:launchctl and process.args:(setenv and not (JAVA*_HOME or RUNTIME_JAVA_HOME or DBUS_LAUNCHD_SESSION_BUS_SOCKET or ANT_HOME or LG_WEBOS_TV_SDK_HOME or WEBOS_CLI_TV or EDEN_ENV) ) and not process.parent.executable:("/Applications/NoMachine.app/Co ntents/Frameworks/bin/nxserver.bin" or "/usr/local/bin/kr" or "/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin" or "/Applications/IntelliJ IDEA CE.app/Contents/jbr/Contents/Home/lib/jspawnhelper")

event.category:process and event.type:start and process.name:launchctl and process.args:(setenv and not (JAVA*_HOME or RUNTIME_JAVA_HOME or DBUS_LAUNCHD_SESSION_BUS_SOCKET or ANT_HOME))

event.category:file and event.type:change and process.name:* and (file.path:(/usr/sbin/sshd or /usr/bin/ssh or /usr/bin/sftp or /usr/bin/scp) or file.name:libkeyutils.so) and not process.name:("dpkg" or "yum" or "dnf" or "dnf-automatic")

event.category:file and event.type:change and process.name:* and (file.path:(/usr/sbin/sshd or /usr/bin/ssh or /usr/bin/sftp or /usr/bin/scp) or file.name:libkeyutils.so) and not process.executable:/usr/bin/dpkg

event.category:process and event.type:start and process.name:defaults and process.args: (com.apple.Safari and write and not ( UniversalSearchEnabled or SuppressSearchSuggestions or WebKitTabToLinksPreferenceKey or ShowFullURLInSmartSearchField or com.apple.Safari.ContentPageGroupIdentifier.WebKit2TabsToLinks ) )

event.category:file and event.type:change and (file.name:pam_*.so or file.path:(/etc/pam.d/* or /private/etc/pam.d/*)) and process.executable: (* and not ( /bin/yum or "/usr/sbin/pam-auth-update" or /usr/libexec/packagekitd or /usr/bin/dpkg or /usr/bin/vim or /usr/libexec/xpcproxy or /usr/bin/bsdtar or /usr/local/bin/brew or /usr/bin/rsync or /usr/bin/yum or /var/lib/docker/*/bin/yum or /var/lib/docker/*/bin/dpkg or ./merged/var/lib/docker/*/bin/dpkg or "/System/Library/Private Frameworks/PackageKit.framework/Versions/A/XPCServices/package_script_ service.xpc/Contents/MacOS/package_script_service" ) ) and not file.path: ( /tmp/snap.rootfs_*/pam_*.so or /tmp/newroot/lib/*/pam_*.so or /private/var/folders/*/T/com .apple.fileprovider.ArchiveService/TemporaryItems/*/lib/security/pam_* .so or /tmp/newroot/usr/lib64/security/pam_*.so )

event.category:file and event.type:change and (file.name:pam_*.so or file.path:(/etc/pam.d/* or /private/etc/pam.d/*)) and process.executable: (* and not ( /bin/yum or "/usr/sbin/pam-auth-update" or /usr/libexec/packagekitd or /usr/bin/dpkg or /usr/bin/vim or /usr/libexec/xpcproxy or /usr/bin/bsdtar or /usr/local/bin/brew or /usr/bin/rsync or /usr/bin/yum or /var/lib/docker/*/bin/yum or /var/lib/docker/*/bin/dpkg or ./merged/var/lib/docker/*/bin/dpkg or "/System/Library/Private Frameworks/PackageKit.framework/Versions/A/XPCServices/package_script_ service.xpc/Contents/MacOS/package_script_service" ) ) and not file.path: ( /tmp/snap.rootfs_*/pam_*.so or /tmp/newroot/lib/*/pam_*.so or /private/var/folders/*/T/com .apple.fileprovider.ArchiveService/TemporaryItems/*/lib/security/pam_* .so or /tmp/newroot/usr/lib64/security/pam_*.so )

event.category:file and event.type:change and (file.name:pam_*.so or file.path:(/etc/pam.d/* or /private/etc/pam.d/*)) and process.executable: (* and not ( /bin/yum or "/usr/sbin/pam-auth- update" or /usr/libexec/packagekitd or /usr/bin/dpkg or /usr/bin/vim or /usr/libexec/xpcproxy or /usr/bin/bsdtar or /usr/local/bin/brew ) )

registry where event.type : ("creation", "change") and registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Control\\Security Providers\\WDigest\\UseLogonCredential" and registry.data.strings : ("1", "0x00000001") and not (process.executable : "?:\\Windows\\System32\\svchost.exe" and user.id : "S-1-5-18")

registry where event.type : ("creation", "change") and registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Control\\Securit yProviders\\WDigest\\UseLogonCredential" and registry.data.strings : ("1", "0x00000001")

registry where event.type in ("creation", "change") and registry.pat h:"HKLM\\SYSTEM\\*ControlSet*\\Control\\SecurityProviders\\WDigest\\Us eLogonCredential" and registry.data.strings:"1"

event.dataset:okta.system and event.action:(application.policy.sign_on.update or application.policy.sign_on.rule.delete)

event.module:okta and event.dataset:okta.system and event.action:(application.policy.sign_on.update or application.policy.sign_on.rule.delete)

process where event.type == "start" and ((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and process.args : "use" and /* including hidden and webdav based online shares such as onedrive */ process.args : ("\\\\*\\*$*", "\\\\*@SSL\\*", "http*") and /* excluding shares deletion operation */ not process.args : "/d*"

process where event.type in ("start", "process_started") and ((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and process.args : "use" and /* including hidden and webdav based online shares such as onedrive */ process.args : ("\\\\*\\*$*", "\\\\*@SSL\\*", "http*") and /* excluding shares deletion operation */ not process.args : "/d*"

sequence by process.entity_id [process where process.name : "MSBuild.exe" and event.type == "start"] [network where process.name : "MSBuild.exe" and not cidrmatch(destination.ip, "127.0.0.1", "::1")]

event.category:network and event.type:connection and process.name:MSBuild.exe and not destination.ip:(127.0.0.1 or "::1")

event.action:"Network connection detected (rule: NetworkConnect)" and process.name:MSBuild.exe and not destination.ip:(127.0.0.1 or "::1")

event.action:"Network connection detected (rule: NetworkConnect)" and process.name:MSBuild.exe and not destination.ip:("127.0.0.1" or "::1")

sequence by process.entity_id with maxspan=10m [process where event.type == "start" and process.name : "mshta.exe" and not process.parent.name : "Microsoft.ConfigurationManagement.exe" and not (process.parent.executable : "C:\\Amazon\\Amazon Assistant\\amazonAssistantService.exe" or process.parent.executable : "C:\\TeamViewer\\TeamViewer.exe") and not process.args : "ADSelfService_Enroll.hta"] [network where process.name : "mshta.exe"]

sequence by process.entity_id with maxspan=10m [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and not process.parent.name : "Microsoft.ConfigurationManagement.exe" and not (process.parent.executable : "C:\\Amazon\\Amazon Assistant\\amazonAssistantService.exe" or process.parent.executable : "C:\\TeamViewer\\TeamViewer.exe") and not process.args : "ADSelfService_Enroll.hta"] [network where process.name : "mshta.exe"]

sequence by process.entity_id with maxspan=2h [process where event.type in ("start", "process_started") and process.name : "mshta.exe" and not process.parent.name : "Microsoft.ConfigurationManagement.exe" and not (process.parent.executable : "C:\\Amazon\\Amazon Assistant\\amazonAssistantService.exe" or process.parent.executable : "C:\\TeamViewer\\TeamViewer.exe") and not process.args : "ADSelfService_Enroll.hta"] [network where process.name : "mshta.exe"]

registry where event.type == "change" and registry.path : ( "HKU\\S-1-5-21-*\\SOFTWARE\\Microsoft\\Office\\*\\Security\\AccessVBOM ", "HKU\\S-1-5-21-*\\SOFTWARE\\Microsoft\\Office\\*\\Security\ \VbaWarnings" ) and registry.data.strings == "0x00000001" and process.name : ("cscript.exe", "wscript.exe", "mshta.exe", "mshta.exe", "winword.exe", "excel.exe")

registry where event.type == "change" and registry.path : ( "HKU\\S-1-5-21-*\\SOFTWARE\\Microsoft\\Office\\*\\Security\\AccessVBOM ", "HKU\\S-1-5-21-*\\SOFTWARE\\Microsoft\\Office\\*\\Security\ \VbaWarnings" ) and registry.data.strings == "0x00000001" and process.name : ("cscript.exe", "wscript.exe", "mshta.exe", "mshta.exe", "winword.exe", "excel.exe")

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Disable Strong Authentication" and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Disable Strong Authentication" and event.outcome:Success

sequence by host.id, source.ip with maxspan=5s [authentication where event.action == "logon-failed" and /* event 4625 need to be logged */ winlog.logon.type : "Network" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1" and not user.name : ("ANONYMOUS LOGON", "-", "*$") and not user.domain == "NT AUTHORITY" and /* noisy failure status codes often associated to authentication misconfiguration */ not winlog.event_data.Status : ("0xC000015B", "0XC000005E", "0XC0000133", "0XC0000192")] with runs=5 [authentication where event.action == "logged-in" and /* event 4624 need to be logged */ winlog.logon.type : "Network" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1" and not user.name : ("ANONYMOUS LOGON", "-", "*$") and not user.domain == "NT AUTHORITY"]

sequence by host.id, source.ip with maxspan=10s [authentication where event.action == "logon-failed" and /* event 4625 need to be logged */ winlog.logon.type : "Network" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1" and not user.name : ("ANONYMOUS LOGON", "-", "*$") and not user.domain == "NT AUTHORITY" and /* noisy failure status codes often associated to authentication misconfiguration : 0xC000015B - The user has not been granted the requested logon type (also called the logon right) at this machine. 0XC000005E - There are currently no logon servers available to service the logon request. 0XC0000133 - Clocks between DC and other computer too far out of sync. 0XC0000192 An attempt was made to logon, but the Netlogon service was not started. */ not winlog.event_data.Status : ("0xC000015B", "0XC000005E", "0XC0000133", "0XC0000192")] with runs=10

sequence by host.id, winlog.process.pid with maxspan=1s /* 2 consecutive vault reads from same pid for web creds */ [any where event.code : "5382" and (winlog.event_data.SchemaFriendlyName : "Windows Web Password Credential" or winlog.event_data.Resource : "http*") and not winlog.event_data.SubjectLogonId : "0x3e7"] [any where event.code : "5382" and (winlog.event_data.SchemaFriendlyName : "Windows Web Password Credential" or winlog.event_data.Resource : "http*") and not winlog.event_data.SubjectLogonId : "0x3e7"]

process where event.type == "start" and event.action == "exec" and process.executable: "/usr/bin/unshare" and not process.parent.executable: ("/usr/bin/udevadm", "*/lib/systemd/systemd-udevd", "/usr/bin/unshare") and not process.args : "/usr/bin/snap"

sequence by process.entity_id [process where (process.name == "nc" or process.name == "ncat" or process.name == "netcat" or process.name == "netcat.openbsd" or process.name == "netcat.traditional") and event.type == "start"] [network where (process.name == "nc" or process.name == "ncat" or process.name == "netcat" or process.name == "netcat.openbsd" or process.name == "netcat.traditional")]

event.category:network and event.type:(access or connection or start) and process.name:(nc or ncat or netcat or netcat.openbsd or netcat.traditional)

process.name:(nc or ncat or netcat or netcat.openbsd or netcat.traditional) and event.action:(bound-socket or connected-to or socket_opened)

process.name: (nc or ncat or netcat or netcat.openbsd or netcat.traditional) and event.action: (connected-to or bound-socket or socket_opened)

sequence by process.entity_id [process where process.name : "certutil.exe" and event.type == "start"] [network where process.name : "certutil.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name : "certutil.exe" and event.type == "start"] [network where process.name : "certutil.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:certutil.exe and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:certutil.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

sequence by process.entity_id [process where process.name : "hh.exe" and event.type == "start"] [network where process.name : "hh.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name : "hh.exe" and event.type == "start"] [network where process.name : "hh.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:hh.exe and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:hh.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:hh.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:10.0.0.0/8 and not destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16

sequence by process.entity_id [process where process.name : "msxsl.exe" and event.type == "start"] [network where process.name : "msxsl.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where process.name : "msxsl.exe" and event.type == "start"] [network where process.name : "msxsl.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:msxsl.exe and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:msxsl.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

sequence by process.entity_id [process where event.type == "start" and process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not ( (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and (process.parent.name : "msiexec.exe" or process.parent.executable : ("C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe")) ) ] [network where process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8") and network.protocol != "dns"]

sequence by process.entity_id [process where event.type == "start" and process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not ( (process.Ext.token.integrity_level_name : "System" or winlog.event_data.IntegrityLevel : "System") and (process.parent.name : "msiexec.exe" or process.parent.executable : ("C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe")) ) ] [network where process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8") and network.protocol != "dns"]

sequence by process.entity_id [process where event.type == "start" and process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not ( user.id == "S-1-5-18" and (process.parent.name : "msiexec.exe" or process.parent.executable : ("C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe")) ) ] [network where process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8") and network.protocol != "dns"]

sequence by process.entity_id [process where event.type == "start" and process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not ( user.id == "S-1-5-18" and (process.parent.name : "msiexec.exe" or process.parent.executable : ("C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe")) ) ] [network where process.name : ("regsvr32.exe", "RegAsm.exe", "RegSvcs.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "169.254.169.254", "172.16.0.0/12", "192.168.0.0/16") and network.protocol != "dns"]

sequence by process.entity_id [process where (process.name : "regsvr32.exe" or process.name : "regsvr64.exe" or process.name : "RegAsm.exe" or process.name : "RegSvcs.exe") and event.type == "start"] [network where (process.name : "regsvr32.exe" or process.name : "regsvr64.exe" or process.name : "RegAsm.exe" or process.name : "RegSvcs.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "169.254.169.254", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:(regsvr32.exe or regsvr64.exe) and not destination.ip:(10.0.0.0/8 or 169.254.169.254 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:(regsvr32.exe or regsvr64.exe) and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 169.254.169.254 or 172.16.0.0/12 or 192.168.0.0/16)

(process.name:regsvr32.exe or process.name:regsvr64.exe) and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:169.254.169.254/32 and not destination.ip:10.0.0.0/8 and not destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16

sequence by process.entity_id [process where (process.name : "expand.exe" or process.name : "extrac32.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and event.type == "start"] [network where (process.name : "expand.exe" or process.name : "extrac32.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where (process.name : "expand.exe" or process.name : "extrac.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and event.type == "start"] [network where (process.name : "expand.exe" or process.name : "extrac.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by process.entity_id [process where (process.name : "expand.exe" or process.name : "extrac.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and event.type == "start"] [network where (process.name : "expand.exe" or process.name : "extrac.exe" or process.name : "ieexec.exe" or process.name : "makecab.exe") and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")]

event.category:network and event.type:connection and process.name:(expand.exe or extrac.exe or ieexec.exe or makecab.exe) and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:(expand.exe or extrac.exe or ieexec.exe or makecab.exe) and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

(process.name:expand.exe or process.name:extrac.exe or process.name:ieexec.exe or process.name:makecab.exe) and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:10.0.0.0/8 and not destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16

registry where registry.data.strings != null and registry.path : "HKL M\\SYSTEM\\*ControlSet*\\Services\\*\\NetworkProvider\\ProviderPath" and /* Excluding default NetworkProviders RDPNP, LanmanWorkstation and webclient. */ not ( user.id : "S-1-5-18" and registry.data.strings in ("%SystemRoot%\\System32\\ntlanman.dll", "%SystemRoot%\\System32\\drprov.dll", "%SystemRoot%\\System32\\davclnt.dll") )

process where event.type == "start" and process.name: ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "Set-CASMailbox*ActiveSyncAllowedDeviceIDs*"

process where event.type in ("start", "process_started") and process.name: ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : "Set-CASMailbox*ActiveSyncAllowedDeviceIDs*"

process where event.type in ("start", "process_started") and process.name: ("powershell.exe", "pwsh.exe") and process.args : "Set- CASMailbox*ActiveSyncAllowedDeviceIDs*"

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("Set-AcceptedDomain" or "Set- MsolDomainFederationSettings" or "Add-FederatedDomain" or "New- AcceptedDomain" or "Remove-AcceptedDomain" or "Remove- FederatedDomain") and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.category:web and event.action:("Set-AcceptedDomain" or "Set- MsolDomainFederationSettings" or "Add-FederatedDomain" or "New- AcceptedDomain" or "Remove-AcceptedDomain" or "Remove- FederatedDomain") and event.outcome:success

event.category:process and event.type:(start or process_started) and process.name:nping

process.name:nping and event.action:executed

process.name: nping and event.action:executed

process where event.type == "start" and ( (process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE", "XCOPY.EXE") and process.args : ("copy", "xcopy", "Copy-Item", "move", "cp", "mv") ) or (process.pe.original_file_name : "esentutl.exe" and process.args : ("*/y*", "*/vss*", "*/d*")) ) and process.args : ("*\\ntds.dit", "*\\config\\SAM", "\\*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\*", "*/system32/config/SAM*")

process where event.type in ("start", "process_started") and ( (process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE", "XCOPY.EXE") and process.args : ("copy", "xcopy", "Copy-Item", "move", "cp", "mv") ) or (process.pe.original_file_name : "esentutl.exe" and process.args : ("*/y*", "*/vss*", "*/d*")) ) and process.args : ("*\\ntds.dit", "*\\config\\SAM", "\\*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\*", "*/system32/config/SAM*")

process where event.type in ("start", "process_started") and process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE", "XCOPY.EXE") and process.args : ("copy", "xcopy", "Copy-Item", "move", "cp", "mv") and process.args : ("*\\ntds.dit", "*\\config\\SAM", "\\*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\*")

registry where registry.path : "HKLM\\SYSTEM\\*ControlSet*\\services\\ LanmanServer\\Parameters\\NullSessionPipes" and registry.data.strings != null

event.dataset:o365.audit and event.provider:SecurityComplianceCenter and event.action:AlertTriggered and rule.name:"Email reported by user as malware or phish"

event.dataset:o365.audit and event.provider:AzureActiveDirectory and event.category:authentication and o365.audit.LogonError:"SsoArtifactInvalidOrExpired"

event.dataset:o365.audit and event.provider:AzureActiveDirectory and event.category:web and o365.audit.LogonError:"SsoArtifactInvalidOrExpired"

event.dataset:o365.audit and event.provider:Exchange and event.action:Add-MailboxPermission and o365.audit.Parameters.AccessRights:(FullAccess or SendAs or SendOnBehalf) and event.outcome:success and not user.id : "NT AUTHORITY\SYSTEM (Microsoft.Exchange.Servicehost)"

event.dataset:o365.audit and event.provider:Exchange and event.action:Add-MailboxPermission and o365.audit.Parameters.AccessRights:(FullAccess or SendAs or SendOnBehalf) and event.outcome:success and not user.id : "NT AUTHORITY\SYSTEM (Microsoft.Exchange.Servicehost)"

event.dataset:o365.audit and event.provider:Exchange and event.action:Add-MailboxPermission and o365.audit.Parameters.AccessRights:(FullAccess or SendAs or SendOnBehalf) and event.outcome:success

event.dataset:o365.audit and event.provider:Exchange and event.action:Set-MailboxAuditBypassAssociation and event.outcome:success

event.dataset:okta.system and event.category:authentication and event.outcome:failure

event.module:okta and event.dataset:okta.system and event.category:authentication and event.outcome:failure

event.dataset:okta.system and event.action:user.session.impersonation.initiate

event.dataset:o365.audit and event.provider:OneDrive and event.code:SharePointFileOperation and event.action:FileMalwareDetected

sequence by host.id, process.entity_id with maxspan = 5s [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : "taskschd.dll" or file.name : "taskschd.dll") and process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe")] [network where process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and destination.port == 135 and not destination.address in ("127.0.0.1", "::1")]

sequence by host.id, process.entity_id with maxspan = 5s [library where dll.name : "taskschd.dll" and process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe")] [network where process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and destination.port == 135 and not destination.address in ("127.0.0.1", "::1")]

sequence by host.id, process.entity_id with maxspan = 5s [library where dll.name : "taskschd.dll" and process.name : ("powershell.exe", "pwsh.exe")] [network where process.name : ("powershell.exe", "pwsh.exe") and destination.port == 135 and not destination.address in ("127.0.0.1", "::1")]

sequence by host.id, process.entity_id with maxspan = 5s [library where file.name: "taskschd.dll" and process.name: ("powershell.exe", "pwsh.exe")] [network where process.name : ("powershell.exe", "pwsh.exe") and destination.port == 135 and not destination.address in ("127.0.0.1", "::1")]

sequence by host.id, user.id with maxspan=5m [process where event.type == "start" and process.Ext.token.integrity_level_name != "system" and ( process.pe.original_file_name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe", "eqnedt32.exe", "fltldr.exe", "mspub.exe", "msaccess.exe", "powershell.exe", "pwsh.exe", "cscript.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "msbuild.exe", "mshta.exe", "wmic.exe", "cmstp.exe", "msxsl.exe") or process.executable : ("?:\\Users\\*.exe", "?:\\ProgramData\\*.exe", "?:\\Windows\\Microsoft.NET\\*.exe", "?:\\Windows\\Temp\\*.exe", "?:\\Windows\\Tasks\\*") or process.code_signature.trusted != true ) ] by process.pid [process where event.type == "start" and process.parent.Ext.real.pid &gt; 0 and /* process.parent.Ext.real.pid is only populated if the parent process pid doesn't match */ not (process.name : "msedge.exe" and process.parent.name : "sihost.exe") ] by process.parent.Ext.real.pid

sequence by host.id, user.id with maxspan=5m [process where event.type == "start" and process.Ext.token.integrity_level_name != "system" and ( process.pe.original_file_name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe", "eqnedt32.exe", "fltldr.exe", "mspub.exe", "msaccess.exe", "powershell.exe", "pwsh.exe", "cscript.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "msbuild.exe", "mshta.exe", "wmic.exe", "cmstp.exe", "msxsl.exe") or process.executable : ("?:\\Users\\*.exe", "?:\\ProgramData\\*.exe", "?:\\Windows\\Microsoft.NET\\*.exe", "?:\\Windows\\Temp\\*.exe", "?:\\Windows\\Tasks\\*") or process.code_signature.trusted != true ) ] by process.pid [process where event.type == "start" and process.parent.Ext.real.pid &gt; 0 and /* process.parent.Ext.real.pid is only populated if the parent process pid doesn't match */ not (process.name : "msedge.exe" and process.parent.name : "sihost.exe") ] by process.parent.Ext.real.pid

process where event.type == "start" and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "fsinfo" and process.args : "drives"

process where event.type in ("start", "process_started") and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "fsinfo" and process.args : "drives"

process where event.type in ("start", "process_started") and (process.name : "fsutil.exe" or process.pe.original_file_name == "fsutil.exe") and process.args : "fsinfo" and process.args : "drives"

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:token_protection_event or endgame.event_subtype_full:token_protection_event)

event.kind:alert and event.module:endgame and event.action:token_protection_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:token_protection_event or endgame.event_subtype_full:token_protection_event)

event.kind:alert and event.module:endgame and event.action:token_protection_event and endgame.metadata.type:prevention

process where event.type == "start" and process.parent.name : "svchost.exe" and process.parent.args : "BITS" and not process.executable : ("?:\\Windows\\System32\\WerFaultSecure.exe", "?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\wermgr.exe", "?:\\WINDOWS\\system32\\directxdatabaseupdater.exe")

event.category:file and not event.type:deletion and file.path:/Library/DirectoryServices/PlugIns/*.dsplug

event.category : file and event.action : modification and file.path : /Users/*/Library/Preferences/com.apple.dock.plist and not process.name : (xpcproxy or cfprefsd or plutil or jamf or PlistBuddy or InstallerRemotePluginService)

event.category : file and event.action : modification and file.path : /Users/*/Library/Preferences/com.apple.dock.plist and not process.name : (xpcproxy or cfprefsd or plutil or jamf or PlistBuddy or InstallerRemotePluginService)

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "com.apple.foundation.UserScriptService"] by process.pid [process where event.type in ("start", "process_started") and process.name in ("osascript", "python", "tcl", "node", "perl", "ruby", "php", "bash", "csh", "zsh", "sh") and not process.args : "/Users/*/Library/Application Support/iTerm2/Scripts/AutoLaunch/*.scpt" ] by process.parent.pid

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "com.apple.foundation.UserScriptService"] by process.pid [process where event.type in ("start", "process_started") and process.name in ("osascript", "python", "tcl", "node", "perl", "ruby", "php", "bash", "csh", "zsh", "sh")] by process.parent.pid

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "com.apple.foundation.UserScriptService"] by process.pid [process where event.type in ("start", "process_started") and process.name in ("osascript", "sh")] by process.parent.pid

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "com.apple.foundation.UserScriptService"] by process.pid [process where event.type in ("start", "process_started") and process.name in ("osascript", "sh")] by process.ppid

registry where /* length(registry.data.strings) &gt; 0 and */ registry.path : ("HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\ \", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\Cu rrentVersion\\Policies\\Explorer\\Run\\", "HKU\\*\\S oftware\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\ ", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersi on\\Policies\\Explorer\\Run\\")

registry where /* length(registry.data.strings) &gt; 0 and */ registry.path : ("HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\ \", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\Policies\\Explorer\\Run\\", "HKU\\*\\ Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\ \", "HKLM\\Software\\Microsoft\\Windows\\CurrentVers ion\\Policies\\Explorer\\Run\\")

registry where /* length(registry.data.strings) &gt; 0 and */ registry.path : ("HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\", "HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\ \", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\Policies\\Explorer\\Run\\", "HKLM\\S oftware\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\ ")

file where event.type != "deletion" and file.extension in ("sh", "desktop") and file.path : ( "/home/*/.config/autostart/*", "/root/.config/autostart/*", "/home/*/.kde/Autostart/*", "/root/.kde/Autostart/*", "/home/*/.kde4/Autostart/*", "/root/.kde4/Autostart/*", "/home/*/.kde/share/autostart/*", "/root/.kde/share/autostart/*", "/home/*/.kde4/share/autostart/*", "/root/.kde4/share/autostart/*", "/home/*/.local/share/autostart/*", "/root/.local/share/autostart/*", "/home/*/.config/autostart-scripts/*", "/root/.config/autostart- scripts/*", "/etc/xdg/autostart/*", "/usr/share/autostart/*" ) and not process.name in ("yum", "dpkg", "install", "dnf", "teams", "yum-cron", "dnf-automatic")

file where event.type != "deletion" and file.extension in ("sh", "desktop") and file.path : ( "/home/*/.config/autostart/*", "/root/.config/autostart/*", "/home/*/.kde/Autostart/*", "/root/.kde/Autostart/*", "/home/*/.kde4/Autostart/*", "/root/.kde4/Autostart/*", "/home/*/.kde/share/autostart/*", "/root/.kde/share/autostart/*", "/home/*/.kde4/share/autostart/*", "/root/.kde4/share/autostart/*", "/home/*/.local/share/autostart/*", "/root/.local/share/autostart/*", "/home/*/.config/autostart-scripts/*", "/root/.config/autostart- scripts/*", "/etc/xdg/autostart/*", "/usr/share/autostart/*" )

process where event.type == "start" and process.name == "defaults" and process.args == "write" and process.args in ("LoginHook", "LogoutHook") and not process.args : ( "Support/JAMF/ManagementFrameworkScripts/logouthook.sh", "Support/JAMF/ManagementFrameworkScripts/loginhook.sh", "/Library/Application Support/JAMF/ManagementFrameworkScripts/logouthook.sh", "/Library/Application Support/JAMF/ManagementFrameworkScripts/loginhook.sh" )

process where event.type in ("start", "process_started") and process.name == "defaults" and process.args == "write" and process.args in ("LoginHook", "LogoutHook")

file where event.type != "deletion" and file.extension : ("wll","xll","ppa","ppam","xla","xlam") and file.path : ( "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Word\\Startup\\*", "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\AddIns\\*", "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\XLSTART\\*" )

file where event.type != "deletion" and wildcard(file.extension,"wll","xll","ppa","ppam","xla","xlam") and wildcard(file.path, "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Word\\Startup\\*", "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\AddIns\\*", "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\XLSTART\\*")

file where event.type != "deletion" and file.path : "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Outlook\\VbaProject.OTM"

file where event.type != "deletion" and wildcard(file.path, "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Outlook\\VbaProject.OTM")

file where event.type != "deletion" and file.path : "?:\\Windows\\Tasks\\*" and file.extension : "job"

process where event.type == "start" and process.parent.name : "CompatTelRunner.exe" and process.args : "-cv*" and not process.name : ("conhost.exe", "DeviceCensus.exe", "CompatTelRunner.exe", "DismHost.exe", "rundll32.exe", "powershell.exe")

process where event.type in ("start", "process_started") and process.parent.name : "CompatTelRunner.exe" and process.args : "-cv*" and not process.name : ("conhost.exe", "DeviceCensus.exe", "CompatTelRunner.exe", "DismHost.exe", "rundll32.exe", "powershell.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:(CompatTelRunner.exe or compattelrunner.exe) and process.args:-cv* and not process.name:(conhost.exe or DeviceCensus.exe or devicecensus.exe or CompatTelRunner.exe or compattelrunner.exe or DismHost.exe or dismhost.exe or rundll32.exe or powershell.exe)

event.category:process and event.type:(start or process_started) and process.parent.name:(CompatTelRunner.exe or compattelrunner.exe) and not process.name:(conhost.exe or DeviceCensus.exe or devicecensus.exe or CompatTelRunner.exe or compattelrunner.exe or DismHost.exe or dismhost.exe or rundll32.exe)

process where event.type == "start" and process.parent.executable : "C:\\Windows\\System32\\svchost.exe" and process.parent.args : "UsoSvc" and not process.executable : ("?:\\ProgramData\\M icrosoft\\Windows\\UUS\\Packages\\*\\amd64\\MoUsoCoreWorker.exe", "?:\\Windows\\System32\\UsoClient.exe", "?:\\Windows\\System32\\MusNotification.exe", "?:\\Windows\\System32\\MusNotificationUx.exe", "?:\\Windows\\System32\\MusNotifyIcon.exe", "?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\WerMgr.exe", "?:\\Windows\\UUS\\amd64\\MoUsoCoreWorker.exe", "?:\\Windows\\System32\\MoUsoCoreWorker.exe", "?:\\Windows\\UUS\\amd64\\UsoCoreWorker.exe", "?:\\Windows\\System32\\UsoCoreWorker.exe", "?:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeC2RClient.exe") and not process.name : ("MoUsoCoreWorker.exe", "OfficeC2RClient.exe")

process where event.type == "start" and process.parent.executable : "C:\\Windows\\System32\\svchost.exe" and process.parent.args : "UsoSvc" and not process.executable : ("?:\\ProgramData\\M icrosoft\\Windows\\UUS\\Packages\\*\\amd64\\MoUsoCoreWorker.exe", "?:\\Windows\\System32\\UsoClient.exe", "?:\\Windows\\System32\\MusNotification.exe", "?:\\Windows\\System32\\MusNotificationUx.exe", "?:\\Windows\\System32\\MusNotifyIcon.exe", "?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\WerMgr.exe", "?:\\Windows\\UUS\\amd64\\MoUsoCoreWorker.exe", "?:\\Windows\\System32\\MoUsoCoreWorker.exe", "?:\\Windows\\UUS\\amd64\\UsoCoreWorker.exe", "?:\\Windows\\System32\\UsoCoreWorker.exe", "?:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeC2RClient.exe")

process where event.type == "start" and process.parent.executable : "C:\\Windows\\System32\\svchost.exe" and process.parent.args : "UsoSvc" and not process.executable : ( "C:\\Windows\\System32\\UsoClient.exe", "C:\\Windows\\System32\\MusNotification.exe", "C:\\Windows\\System32\\MusNotificationUx.exe", "C:\\Windows\\System32\\MusNotifyIcon.exe", "C:\\Windows\\System32\\WerFault.exe", "C:\\Windows\\System32\\WerMgr.exe" )

event.category:process and event.type:(start or process_started) and process.parent.name:svchost.exe and process.parent.args:(UsoSvc or usosvc) and not process.name:(UsoClient.exe or usoclient.exe or MusNotification.exe or musnotification.exe or MusNotificationUx.exe or musnotificationux.exe)

process where event.type == "start" and (process.name : "wmic.exe" or process.pe.original_file_name == "wmic.exe") and process.args : "create" and process.args : ("ActiveScriptEventConsumer", "CommandLineEventConsumer")

process where event.type in ("start", "process_started") and (process.name : "wmic.exe" or process.pe.original_file_name == "wmic.exe") and process.args : "create" and process.args : ("ActiveScriptEventConsumer", "CommandLineEventConsumer")

process where event.type in ("start", "process_started") and (process.name : "wmic.exe" or process.pe.original_file_name == "wmic.exe") and process.args : "create" and process.args : ("ActiveScriptEventConsumer", "CommandLineEventConsumer")

registry where registry.data.strings != null and process.name : "WmiPrvSe.exe" and registry.path : ( "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\Policies\\Explorer\\Run\\*", "HKLM\\S oftware\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\ *", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\RunOnceEx\\*", "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ServiceDLL", "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ImagePath", "HKEY_USERS\\*\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*", "HKEY_USERS\\*\\Environment\\UserInitMprLogonScript", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKEY_USERS\\* \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shel l", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\W indows\\System\\Scripts\\Logoff\\Script", "HKEY_USER S\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logon\\ Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microso ft\\Windows\\System\\Scripts\\Shutdown\\Script", "HK EY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\ Startup\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun" )

registry where registry.data.strings != null and process.name : "WmiPrvSe.exe" and registry.path : ( "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\Policies\\Explorer\\Run\\*", "HKLM\\S oftware\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\ *", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\RunOnceEx\\*", "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ServiceDLL", "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ImagePath", "HKEY_USERS\\*\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*", "HKEY_USERS\\*\\Environment\\UserInitMprLogonScript", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKEY_USERS\\ *\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\She ll", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\ \Windows\\System\\Scripts\\Logoff\\Script", "HKEY_U SERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logo n\\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Mic rosoft\\Windows\\System\\Scripts\\Shutdown\\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Script s\\Startup\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun" )

file where event.type != "deletion" and user.domain != "NT AUTHORITY" and /* detect shortcuts created by wscript.exe or cscript.exe */ (file.path : "C:\\*\\Programs\\Startup\\*.lnk" and process.name : ("wscript.exe", "cscript.exe")) or /* detect vbs or js files created by any process */ file.path : ("C:\\*\\Programs\\Startup\\*.vbs", "C:\\*\\Programs\\Startup\\*.vbe", "C:\\*\\Programs\\Startup\\*.wsh", "C:\\*\\Programs\\Startup\\*.wsf", "C:\\*\\Programs\\Startup\\*.js")

file where event.type != "deletion" and user.domain != "NT AUTHORITY" and /* detect shortcuts created by wscript.exe or cscript.exe */ (file.path : "C:\\*\\Programs\\Startup\\*.lnk" and process.name : ("wscript.exe", "cscript.exe")) or /* detect vbs or js files created by any process */ file.path : ("C:\\*\\Programs\\Startup\\*.vbs", "C:\\*\\Programs\\Startup\\*.vbe", "C:\\*\\Programs\\Startup\\*.wsh", "C:\\*\\Programs\\Startup\\*.wsf", "C:\\*\\Programs\\Startup\\*.js")

registry where registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Services\\PortProxy\\v4tov4\\*"

registry where registry.path : "HKLM\\SYSTEM\\ControlSet*\\Services\\PortProxy\\v4tov4\\*"

event.dataset:(azure.activitylogs or azure.auditlogs or o365.audit) and ( azure.activitylogs.operation_name:"Consent to application" or azure.auditlogs.operation_name:"Consent to application" or o365.audit.Operation:"Consent to application." ) and event.outcome:(Success or success)

event.dataset:(azure.activitylogs or azure.auditlogs or o365.audit) and ( azure.activitylogs.operation_name:"Consent to application" or azure.auditlogs.operation_name:"Consent to application" or o365.audit.Operation:"Consent to application." ) and event.outcome:(Success or success)

event.dataset:(azure.activitylogs or azure.auditlogs) and ( azure.activitylogs.operation_name:"Consent to application" or azure.auditlogs.operation_name:"Consent to application" ) and event.outcome:success

event.category:(network OR network_traffic) AND type:(tls OR http) AND network.transport:tcp AND destination.domain:/[a-zA-Z]{4,5}\.(pw|us|club|info|site|top)/ AND NOT destination.domain:zoom.us

event.category:(network OR network_traffic) AND type:(tls OR http) AND network.transport:tcp AND destination.domain:/[a-zA-Z]{4,5}\.(pw|us|club|info|site|top)/ AND NOT destination.domain:zoom.us

event.dataset:okta.system and event.action:(application.integration.rate_limit_exceeded or system.org.rate_limit.warning or system.org.rate_limit.violation or core.concurrency.org.limit.violation)

event.module:okta and event.dataset:okta.system and event.action:(application.integration.rate_limit_exceeded or system.org.rate_limit.warning or system.org.rate_limit.violation or core.concurrency.org.limit.violation)

sequence by user.email with maxspan=10m [any where event.module == "okta" and event.action == "user.mfa.okta_verify.deny_push"] [any where event.module == "okta" and event.action == "user.mfa.okta_verify.deny_push"] [any where event.module == "okta" and event.action == "user.authentication.sso"]

event.category:process and event.type:(start or process_started) and process.name:(dscl or dseditgroup) and process.args:(("/Groups/admin" or admin) and ("-a" or "-append"))

process where event.type == "start" and process.name : "sdbinst.exe"

process where event.type in ("start", "process_started") and process.name : "sdbinst.exe"

event.category:process and event.type:(start or process_started) and process.name:sdbinst.exe

event.code:1 and process.name:sdbinst.exe

sequence by host.id, user.name with maxspan = 5s [library where dll.name : "IEProxy.dll" and process.name : ("rundll32.exe", "regsvr32.exe")] [process where event.type == "start" and process.parent.name : "iexplore.exe" and process.parent.args : "-Embedding"] /* IE started via COM in normal conditions makes few connections, mainly to Microsoft and OCSP related domains, add FPs here */ [network where network.protocol == "dns" and process.name : "iexplore.exe" and not dns.question.name : ( "*.microsoft.com", "*.digicert.com", "*.msocsp.com", "*.windowsupdate.com", "*.bing.com", "*.identrust.com", "*.sharepoint.com", "*.office365.com", "*.office.com" ) ] /* with runs=5 */

sequence by host.id, user.id with maxspan = 5s [library where dll.name : "IEProxy.dll" and process.name : ("rundll32.exe", "regsvr32.exe")] [process where event.type == "start" and process.parent.name : "iexplore.exe" and process.parent.args : "-Embedding"] /* IE started via COM in normal conditions makes few connections, mainly to Microsoft and OCSP related domains, add FPs here */ [network where network.protocol == "dns" and process.name : "iexplore.exe" and not dns.question.name : ( "*.microsoft.com", "*.digicert.com", "*.msocsp.com", "*.windowsupdate.com", "*.bing.com", "*.identrust.com", "*.sharepoint.com", "*.office365.com", "*.office.com" ) ]

sequence by host.id, process.entity_id with maxspan = 1s [process where event.type == "start" and process.parent.name : "iexplore.exe" and process.parent.args : "-Embedding"] /* IE started via COM in normal conditions makes few connections, mainly to Microsoft and OCSP related domains, add FPs here */ [network where network.protocol == "dns" and process.name : "iexplore.exe" and not dns.question.name : ( "*.microsoft.com", "*.digicert.com", "*.msocsp.com", "*.windowsupdate.com", "*.bing.com", "*.identrust.com" ) ]

sequence by host.id, process.entity_id with maxspan = 1s [process where event.type:"start" and process.parent.name:"iexplore.exe" and process.parent.args:"-Embedding"] /* IE started via COM in normal conditions makes few connections, mainly to Microsoft and OCSP related domains, add FPs here */ [network where network.protocol : "dns" and process.name:"iexplore.exe" and not wildcard(dns.question.name, "*.microsoft.com", "*.digicert.com", "*.msocsp.com", "*.windowsupdate.com", "*.bing.com", "*.identrust.com") ]

process where event.type in ("start", "process_started", "info") and process.name in ( "Microsoft Edge", "chrome.exe", "Google Chrome", "google- chrome-stable", "google-chrome-beta", "google-chrome", "msedge.exe") and process.args : ("-- remote-debugging-port=*", "--remote-debugging- targets=*", "--remote-debugging-pipe=*") and process.args : "--user-data-dir=*" and not process.args:"--remote- debugging-port=0"

process where event.type in ("start", "process_started", "info") and process.name in ( "Microsoft Edge", "chrome.exe", "Google Chrome", "google- chrome-stable", "google-chrome-beta", "google-chrome", "msedge.exe") and process.args : ("-- remote-debugging-port=*", "--remote-debugging- targets=*", "--remote-debugging-pipe=*") and process.args : "--user-data-dir=*" and not process.args:"--remote- debugging-port=0"

any where event.action == "Directory Service Access" and event.code == "4662" and winlog.event_data.Properties : ( /* Control Access Rights/Permissions Symbol */ "*DS-Replication-Get-Changes*", "*DS-Replication-Get-Changes-All*", "*DS-Replication-Get-Changes- In-Filtered-Set*", /* Identifying GUID used in ACE */ "*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*", "*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*", "*89e95b76-444d-4c62-991a-0facbeda640c*") /* The right to perform an operation controlled by an extended access right. */ and winlog.event_data.AccessMask : "0x100" and not winlog.event_data.SubjectUserName : ("*$", "MSOL_*")

any where event.action == "Directory Service Access" and event.code == "4662" and winlog.event_data.Properties : ( /* Control Access Rights/Permissions Symbol */ "*DS-Replication-Get-Changes*", "*DS-Replication-Get-Changes-All*", "*DS-Replication-Get-Changes- In-Filtered-Set*", /* Identifying GUID used in ACE */ "*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*", "*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*", "*89e95b76-444d-4c62-991a-0facbeda640c*") /* The right to perform an operation controlled by an extended access right. */ and winlog.event_data.AccessMask : "0x100" and not winlog.event_data.SubjectUserName : ("*$", "MSOL_*")

process where event.code == "10" and /* LSASS requesting DuplicateHandle access right to another process */ process.name : "lsass.exe" and winlog.event_data.GrantedAccess == "0x40" and /* call is coming from an unknown executable region */ winlog.event_data.CallTrace : "*UNKNOWN*"

process where event.code == "10" and /* LSASS requesting DuplicateHandle access right to another process */ process.name : "lsass.exe" and winlog.event_data.GrantedAccess == "0x40" and /* call is coming from an unknown executable region */ winlog.event_data.CallTrace : "*UNKNOWN*"

process where event.code == "10" and winlog.event_data.TargetImage : "?:\\WINDOWS\\system32\\lsass.exe" and /* DLLs exporting MiniDumpWriteDump API to create an lsass mdmp*/ winlog.event_data.CallTrace : ("*dbghelp*", "*dbgcore*") and /* case of lsass crashing */ not process.executable : ("?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\WerFaultSecure.exe")

process where event.code == "10" and winlog.event_data.TargetImage : "?:\\WINDOWS\\system32\\lsass.exe" and /* DLLs exporting MiniDumpWriteDump API to create an lsass mdmp*/ winlog.event_data.CallTrace : ("*dbghelp*", "*dbgcore*") and /* case of lsass crashing */ not process.executable : ("?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\WerFaultSecure.exe")

process where event.code == "10" and winlog.event_data.TargetImage : "?:\\WINDOWS\\system32\\lsass.exe" and /* DLLs exporting MiniDumpWriteDump API to create an lsass mdmp*/ winlog.event_data.CallTrace : ("*dbhelp*", "*dbgcore*") and /* case of lsass crashing */ not process.executable : ("?:\\Windows\\System32\\WerFault.exe", "?:\\Windows\\System32\\WerFaultSecure.exe")

sequence by process.entity_id with maxspan=1m [process where event.category == "process" and process.name : "rundll32.exe"] [process where event.category == "process" and event.dataset : "windows.sysmon_operational" and event.code == "7" and (file.pe.original_file_name : "COMSVCS.DLL" or file.pe.imphash : "EADBCCBB324829ACB5F2BBE87E5549A8") and /* renamed COMSVCS */ not file.name : "COMSVCS.DLL"]

sequence by process.entity_id [process where event.type == "start" and (process.name : "MSBuild.exe" or process.pe.original_file_name == "MSBuild.exe")] [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : ("vaultcli.dll", "SAMLib.DLL") or file.name : ("vaultcli.dll", "SAMLib.DLL"))]

sequence by process.entity_id [process where event.type == "start" and (process.name : "MSBuild.exe" or process.pe.original_file_name == "MSBuild.exe")] [library where dll.name : ("vaultcli.dll", "SAMLib.DLL")]

event.category:process and event.type:change and (process.pe.original_file_name:(vaultcli.dll or SAMLib.DLL) or dll.name:(vaultcli.dll or SAMLib.DLL)) and process.name: MSBuild.exe

event.category:process and event.type:change and (winlog.event_data.OriginalFileName:(vaultcli.dll or SAMLib.DLL) or dll.name:(vaultcli.dll or SAMLib.DLL)) and process.name: MSBuild.exe

(winlog.event_data.OriginalFileName: (vaultcli.dll or SAMLib.DLL) or dll.name: (vaultcli.dll or SAMLib.DLL)) and process.name: MSBuild.exe and event.action: "Image loaded (rule: ImageLoad)"

process where event.type == "start" and /* update here with any new lolbas with dump capability */ (process.pe.original_file_name == "procdump" and process.args : "-ma") or (process.name : "ProcessDump.exe" and not process.parent.executable regex~ """C:\\Program Files( \(x86\))?\\Cisco Systems\\.*""") or (process.pe.original_file_name == "WriteMiniDump.exe" and not process.parent.executable regex~ """C:\\Program Files( \(x86\))?\\Steam\\.*""") or (process.pe.original_file_name == "RUNDLL32.EXE" and (process.args : "MiniDump*" or process.command_line : "*comsvcs.dll*#24*")) or (process.pe.original_file_name == "RdrLeakDiag.exe" and process.args : "/fullmemdmp") or (process.pe.original_file_name == "SqlDumper.exe" and process.args : "0x01100*") or (process.pe.original_file_name == "TTTracer.exe" and process.args : "-dumpFull" and process.args : "-attach") or (process.pe.original_file_name == "ntdsutil.exe" and process.args : "create*full*") or (process.pe.original_file_name == "diskshadow.exe" and process.args : "/s")

process where event.type in ("start", "process_started") and /* update here with any new lolbas with dump capability */ (process.pe.original_file_name == "procdump" and process.args : "-ma") or (process.name : "ProcessDump.exe" and not process.parent.executable regex~ """C:\\Program Files( \(x86\))?\\Cisco Systems\\.*""") or (process.pe.original_file_name == "WriteMiniDump.exe" and not process.parent.executable regex~ """C:\\Program Files( \(x86\))?\\Steam\\.*""") or (process.pe.original_file_name == "RUNDLL32.EXE" and (process.args : "MiniDump*" or process.command_line : "*comsvcs.dll*#24*")) or (process.pe.original_file_name == "RdrLeakDiag.exe" and process.args : "/fullmemdmp") or (process.pe.original_file_name == "SqlDumper.exe" and process.args : "0x01100*") or (process.pe.original_file_name == "TTTracer.exe" and process.args : "-dumpFull" and process.args : "-attach") or (process.pe.original_file_name == "ntdsutil.exe" and process.args : "create*full*") or (process.pe.original_file_name == "diskshadow.exe" and process.args : "/s")

process where event.type in ("start", "process_started") and /* update here with any new lolbas with dump capability */ (process.pe.original_file_name == "procdump" and process.args : "-ma") or (process.name : "ProcessDump.exe" and not process.parent.executable : "C:\\Program Files*\\Cisco Systems\\*.exe") or (process.pe.original_file_name == "WriteMiniDump.exe" and not process.parent.executable : "C:\\Program Files*\\Steam\\*.exe") or (process.pe.original_file_name == "RUNDLL32.EXE" and (process.args : "MiniDump*" or process.command_line : "*comsvcs.dll*#24*")) or (process.pe.original_file_name == "RdrLeakDiag.exe" and process.args : "/fullmemdmp") or (process.pe.original_file_name == "SqlDumper.exe" and process.args : "0x01100*") or (process.pe.original_file_name == "TTTracer.exe" and process.args : "-dumpFull" and process.args : "-attach") or (process.pe.original_file_name == "ntdsutil.exe" and process.args : "create*full*") or (process.pe.original_file_name == "diskshadow.exe" and process.args : "/s")

event.category:process and event.type:(start or process_started) and process.name:setenforce and process.args:0

event.action:executed and process.name:setenforce and process.args:0

process where event.type == "start" and (process.pe.original_file_name == "MsMpEng.exe" and not process.name : "MsMpEng.exe") or (process.name : "MsMpEng.exe" and not process.executable : ("?:\\ProgramData\\Microsoft\\Windows Defender\\*.exe", "?:\\Program Files\\Windows Defender\\*.exe", "?:\\Program Files (x86)\\Windows Defender\\*.exe", "?:\\Program Files\\Microsoft Security Client\\*.exe", "?:\\Program Files (x86)\\Microsoft Security Client\\*.exe"))

process where event.type == "start" and (process.pe.original_file_name == "MsMpEng.exe" and not process.name : "MsMpEng.exe") or (process.name : "MsMpEng.exe" and not process.executable : ("?:\\ProgramData\\Microsoft\\Windows Defender\\*.exe", "?:\\Program Files\\Windows Defender\\*.exe", "?:\\Program Files (x86)\\Windows Defender\\*.exe"))

process where event.type == "start" and process.pe.original_file_name in ("WinWord.exe", "EXPLORER.EXE", "w3wp.exe", "DISM.EXE") and not (process.name : ("winword.exe", "explorer.exe", "w3wp.exe", "Dism.exe") or process.executable : ("?:\\Windows\\explorer.exe", "?:\\Program Files\\Microsoft Office\\root\\Office*\\WINWORD.EXE", "?:\\Program Files?(x86)\\Microsoft Office\\root\\Office*\\WINWORD.EXE", "?:\\Windows\\System32\\Dism.exe", "?:\\Windows\\SysWOW64\\Dism.exe", "?:\\Windows\\System32\\inetsrv\\w3wp.exe") )

event.category:process and event.type:(start or process_started) and process.pe.original_file_name:(WinWord.exe or EXPLORER.EXE or w3wp.exe or DISM.EXE) and not (process.name:(winword.exe or WINWORD.EXE or explorer.exe or w3wp.exe or Dism.exe) or process.executable:("C:\Windows\explorer.exe" or C\:\\Program?Files\\Microsoft?Office\\root\\Office*\\WINWORD.EXE or C\ :\\Program?Files?\(x86\)\\Microsoft?Office\\root\\Office*\\WINWORD.EXE or "C:\Windows\System32\Dism.exe" or "C:\Windows\SysWOW64\Dism.exe" or "C:\Windows\System32\inetsrv\w3wp.exe"))

event.category:process and event.type:(start or process_started) and (process.pe.original_file_name:(WinWord.exe or EXPLORER.EXE or w3wp.exe or DISM.EXE) or winlog.event_data.OriginalFileName:(WinWord.exe or EXPLORER.EXE or w3wp.exe or DISM.EXE)) and not (process.name:(winword.exe or WINWORD.EXE or explorer.exe or w3wp.exe or Dism.exe) or process.executable:("C:\Windows\explorer.exe" or C\:\\Program?Files\\Microsoft?Office\\root\\Office*\\WINWORD.EXE or C\ :\\Program?Files?\(x86\)\\Microsoft?Office\\root\\Office*\\WINWORD.EXE or "C:\Windows\System32\Dism.exe" or "C:\Windows\SysWOW64\Dism.exe" or "C:\Windows\System32\inetsrv\w3wp.exe"))

event.category:process and event.type:(start or process_started) and process.name:(iodine or iodined)

process.name:(iodine or iodined) and event.action:executed

process.name: (iodine or iodined) and event.action:executed

event.category:process and event.type:start and process.name:nslookup.exe and process.args:(-querytype=* or -qt=* or -q=* or -type=*)

process where event.type == "start" and process.name : "fltMC.exe" and process.args : "unload"

process where event.type in ("start", "process_started") and process.name : "fltMC.exe" and process.args : "unload"

process where event.type in ("start", "process_started") and process.name : "fltMC.exe" and process.args : "unload"

event.category:process and event.type:(start or process_started) and process.name:fltMC.exe

event.code:1 and process.name:fltMC.exe

event.category:process and event.type:(start or process_started) and process.name:dscl and process.args:(IsHidden and create and (true or 1 or yes))

event.category:process and powershell.file.script_block_text:( (DumpCreds and DumpCerts) or "sekurlsa::logonpasswords" or ("crypto::certificates" and "CERT_SYSTEM_STORE_LOCAL_MACHINE") )

sequence by host.id with maxspan=1m [network where event.action == "connection_attempted" and process.name : "java" and /* outbound connection attempt to LDAP, RMI or DNS standard ports by JAVA process */ destination.port in (1389, 389, 1099, 53, 5353)] by process.pid [process where event.type == "start" and /* Suspicious JAVA child process */ process.parent.name : "java" and process.name : ("sh", "bash", "dash", "ksh", "tcsh", "zsh", "curl", "perl*", "python*", "ruby*", "php*", "wget")] by process.parent.pid

event.category:process and event.type:start and process.args:("-action" and ("-kerberoast" or askhash or asktgs or asktgt or s4u or ("-ticket" and ptt) or (dump and (tickets or keytab))))

event.category:process and event.type:start and process.args:("-action" and ("-kerberoast" or askhash or asktgs or asktgt or s4u or ("-ticket" and ptt) or (dump and (tickets or keytab))))

sequence by host.id with maxspan=30s [network where event.type == "start" and process.pid == 4 and destination.port == 445 and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.ip != "127.0.0.1" and source.ip != "::1" ] by process.entity_id /* add more executable extensions here if they are not noisy in your environment */ [file where event.type in ("creation", "change") and process.pid == 4 and file.extension : ("exe", "dll", "bat", "cmd")] by process.entity_id

sequence by host.id with maxspan=30s [network where event.type == "start" and process.pid == 4 and destination.port == 445 and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.address != "127.0.0.1" and source.address != "::1" ] by process.entity_id /* add more executable extensions here if they are not noisy in your environment */ [file where event.type in ("creation", "change") and process.pid == 4 and file.extension : ("exe", "dll", "bat", "cmd")] by process.entity_id

sequence by host.id with maxspan=30s [network where event.type == "start" and process.pid == 4 and destination.port == 445 and network.direction == "incoming" and network.transport == "tcp" and source.address != "127.0.0.1" and source.address != "::1" ] by process.entity_id /* add more executable extensions here if they are not noisy in your environment */ [file where event.type in ("creation", "change") and process.pid == 4 and file.extension : ("exe", "dll", "bat", "cmd")] by process.entity_id

sequence by host.id, source.ip, user.name with maxspan=10s [authentication where event.action in ("ssh_login", "user_login") and event.outcome == "failure" and source.ip != null and source.ip != "0.0.0.0" and source.ip != "::" ] with runs=10

process where event.type == "start" and process.name : "rundll32.exe" and /* Rundll32 WbeDav Client */ process.args : ("?:\\Windows\\System32\\davclnt.dll,DavSetCookie", "?:\\Windows\\SysWOW64\\davclnt.dll,DavSetCookie") and /* Access to named pipe via http */ process.args : ("http*/print/pipe/*", "http*/pipe/spoolss", "http*/pipe/srvsvc")

process where event.type in ("start", "process_started") and process.name : "rundll32.exe" and /* Rundll32 WbeDav Client */ process.args : ("?:\\Windows\\System32\\davclnt.dll,DavSetCookie", "?:\\Windows\\SysWOW64\\davclnt.dll,DavSetCookie") and /* Access to named pipe via http */ process.args : ("http*/print/pipe/*", "http*/pipe/spoolss", "http*/pipe/srvsvc")

registry where event.type == "change" and registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\Authentication Packages" and /* exclude SYSTEM SID - look for changes by non-SYSTEM user */ not user.id : "S-1-5-18"

process where event.code:"4688" and process.executable : "?:\\Windows\\System32\\lsass.exe" and process.parent.executable : "?:\\Windows\\System32\\lsass.exe"

event.category:process and event.code:10 and winlog.event_data.TargetImage:("C:\\Windows\\system32\\lsass.exe" or "c:\\Windows\\system32\\lsass.exe" or "c:\\Windows\\System32\\lsass.exe")

event.category:process and event.type:start and process.name:"sshd- keygen-wrapper" and process.parent.name:launchd

event.category:file and not event.type:deletion and file.name:~$*.zip and host.os.type:macos

event.category:file and not event.type:deletion and file.name:~$*.zip

process where event.type == "start" and process.parent.name : ("Utilman.exe", "winlogon.exe") and user.name == "SYSTEM" and process.args : ( "C:\\Windows\\System32\\osk.exe", "C:\\Windows\\System32\\Magnify.exe", "C:\\Windows\\System32\\Narrator.exe", "C:\\Windows\\System32\\Sethc.exe", "utilman.exe", "ATBroker.exe", "DisplaySwitch.exe", "sethc.exe" ) and not process.pe.original_file_name in ( "osk.exe", "sethc.exe", "utilman2.exe", "DisplaySwitch.exe", "ATBroker.exe", "ScreenMagnifier.exe", "SR.exe", "Narrator.exe", "magnify.exe", "MAGNIFY.EXE" ) /* uncomment once in winlogbeat to avoid bypass with rogue process with matching pe original file name */ /* and process.code_signature.subject_name == "Microsoft Windows" and process.code_signature.status == "trusted" */

process where event.type in ("start", "process_started", "info") and process.parent.name : ("Utilman.exe", "winlogon.exe") and user.name == "SYSTEM" and process.args : ( "C:\\Windows\\System32\\osk.exe", "C:\\Windows\\System32\\Magnify.exe", "C:\\Windows\\System32\\Narrator.exe", "C:\\Windows\\System32\\Sethc.exe", "utilman.exe", "ATBroker.exe", "DisplaySwitch.exe", "sethc.exe" ) and not process.pe.original_file_name in ( "osk.exe", "sethc.exe", "utilman2.exe", "DisplaySwitch.exe", "ATBroker.exe", "ScreenMagnifier.exe", "SR.exe", "Narrator.exe", "magnify.exe", "MAGNIFY.EXE" ) /* uncomment once in winlogbeat to avoid bypass with rogue process with matching pe original file name */ /* and process.code_signature.subject_name == "Microsoft Windows" and process.code_signature.status == "trusted" */

event.category:process and event.type:(start or process_started) and process.parent.name:winlogon.exe and not process.name:(atbroker.exe or displayswitch.exe or magnify.exe or narrator.exe or osk.exe or sethc.exe or utilman.exe)

event.code:1 and process.parent.name:winlogon.exe and process.name:(atbroker.exe or displayswitch.exe or magnify.exe or narrator.exe or osk.exe or sethc.exe or utilman.exe)

event.code:1 and process.parent.name:winlogon.exe and (process.name:atbroker.exe or process.name:displayswitch.exe or process.name:magnify.exe or process.name:narrator.exe or process.name:osk.exe or process.name:sethc.exe or process.name:utilman.exe)

file where event.type == "change" and process.executable : ("/usr/sbin/sshd", "/usr/bin/ssh") and ( (file.name : (".*", "~*", "*~") and not file.name : (".cache", ".viminfo", ".bash_history")) or file.extension : ("in", "out", "ini", "h", "gz", "so", "sock", "sync", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9") or file.path : ( "/private/etc/*--", "/usr/share/*", "/usr/include/*", "/usr/local/include/*", "/private/tmp/*", "/private/var/tmp/*", "/usr/tmp/*", "/usr/share/man/*", "/usr/local/share/*", "/usr/lib/*.so.*", "/private/etc/ssh/.sshd_auth", "/usr/bin/ssd", "/private/var/opt/power", "/private/etc/ssh/ssh_known_hosts", "/private/var/html/lol", "/private/var/log/utmp", "/private/var/lib", "/var/run/sshd/sshd.pid", "/var/run/nscd/ns.pid", "/var/run/udev/ud.pid", "/var/run/udevd.pid" ) )

file where event.type == "change" and process.executable : ("/usr/sbin/sshd", "/usr/bin/ssh") and ( file.name : (".*", "~*") or file.extension : ("in", "out", "ini", "h", "gz", "so", "sock", "sync", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9") or file.path : ( "/private/etc/*--", "/usr/share/*", "/usr/include/*", "/usr/local/include/*", "/private/tmp/*", "/private/var/tmp/*", "/usr/tmp/*", "/usr/share/man/*", "/usr/local/share/*", "/usr/lib/*.so.*", "/private/etc/ssh/.sshd_auth", "/usr/bin/ssd", "/private/var/opt/power", "/private/etc/ssh/ssh_known_hosts", "/private/var/html/lol", "/private/var/log/utmp", "/private/var/lib", "/var/run/sshd/sshd.pid", "/var/run/nscd/ns.pid", "/var/run/udev/ud.pid", "/var/run/udevd.pid" ) )

event.dataset:o365.audit and event.provider:(Exchange or AzureActiveDirectory) and event.category:authentication and event.action:("UserLoginFailed" or "PasswordLogonInitialAuthUsingPassword")

event.dataset:o365.audit and event.provider:(Exchange or AzureActiveDirectory) and event.category:authentication and event.action:("UserLoginFailed" or "PasswordLogonInitialAuthUsingPassword")

event.dataset:o365.audit and event.provider:(Exchange or AzureActiveDirectory) and event.category:authentication and event.action:("UserLoginFailed" or "PasswordLogonInitialAuthUsingPassword") and event.outcome:success

event.dataset:o365.audit and event.provider:(Exchange or AzureActiveDirectory) and event.category:authentication and event.action:("UserLoginFailed" or "PasswordLogonInitialAuthUsingPassword") and event.outcome:failure

event.dataset:o365.audit and event.provider:AzureActiveDirectory and event.category:authentication and event.action:UserLoginFailed and event.outcome:failure

event.category:"file" and not event.type:"deletion" and file.path:/Users/*/.atom/init.coffee and not process.name:(Atom or xpcproxy) and not user.name:root

event.category:"file" and not event.type:"deletion" and file.name:"com.apple.loginwindow.plist" and process.name:(* and not (systemmigrationd or DesktopServicesHelper or diskmanagementd or rsync or launchd or cfprefsd or xpcproxy or ManagedClient or MCXCompositor or backupd or "iMazing Profile Editor" ))

event.category:"file" and not event.type:"deletion" and file.name:"com.apple.loginwindow.plist" and process.name:(* and not (systemmigrationd or DesktopServicesHelper or diskmanagementd or rsync or launchd or cfprefsd or xpcproxy or ManagedClient or MCXCompositor))

event.category:"file" and not event.type:"deletion" and file.path:(/private/etc/periodic/* or /private/etc/defaults/periodic.conf or /private/etc/periodic.conf)

registry where event.type:"change" and registry.path:"HKLM\\SYSTEM\\ *ControlSet*\\Services\\W32Time\\TimeProviders\\*" and registry.data.strings:"*.dll"

registry where event.type in ("creation", "change") and registry.path : ("HKLM\\SYSTEM\\*ControlSet*\\Control\\Print\\Monitors\\*", "HKLM\ \SYSTEM\\*ControlSet*\\Control\\Print\\Environments\\Windows*\\Print Processors\\*") and registry.data.strings : "*.dll" and /* exclude SYSTEM SID - look for changes by non-SYSTEM user */ not user.id : "S-1-5-18"

registry where event.type in ("creation", "change") and registry.path : ("HKLM\\SYSTEM\\*ControlSet*\\Control\\Print\\Monitors\\*", "HLLM\ \SYSTEM\\*ControlSet*\\Control\\Print\\Environments\\Windows*\\Print Processors\\*") and registry.data.strings : "*.dll" and /* exclude SYSTEM SID - look for changes by non-SYSTEM user */ not user.id : "S-1-5-18"

process where event.type in ("start", "process_started") and process.name:"scp" and process.args:"StrictHostKeyChecking=no" and process.command_line:("scp *localhost:/*", "scp *127.0.0.1:/*") and not process.args:"vagrant@*127.0.0.1*"

process where event.type in ("start", "process_started") and process.name:"scp" and process.args:"StrictHostKeyChecking=no" and process.command_line:("scp *localhost:/*", "scp *127.0.0.1:/*") and not process.args:"vagrant@*127.0.0.1*"

process where event.type in ("start", "process_started") and process.name : "sqlite*" and process.args : "/*/Application Support/com.apple.TCC/TCC.db" and not process.parent.executable : "/Library/Bitdefender/AVP/product/bin/*"

process where event.type in ("start", "process_started") and process.name : "sqlite*" and process.args : "/*/Application Support/com.apple.TCC/TCC.db"

iam where event.action == "renamed-user-account" and /* machine account name renamed to user like account name */ winlog.event_data.OldTargetUserName : "*$" and not winlog.event_data.NewTargetUserName : "*$"

process where event.type == "start" and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and ( (process.name : "elevation_service.exe" and not process.pe.original_file_name == "elevation_service.exe") or (process.parent.name : "elevation_service.exe" and process.name : ("rundll32.exe", "cmd.exe", "powershell.exe")) )

process where event.type == "start" and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and ( (process.name : "elevation_service.exe" and not process.pe.original_file_name == "elevation_service.exe") or (process.parent.name : "elevation_service.exe" and process.name : ("rundll32.exe", "cmd.exe", "powershell.exe")) )

process where event.type == "start" and (process.Ext.token.integrity_level_name : "System" or winlog.event_data.IntegrityLevel : "System") and ( (process.name : "elevation_service.exe" and not process.pe.original_file_name == "elevation_service.exe") or (process.parent.name : "elevation_service.exe" and process.name : ("rundll32.exe", "cmd.exe", "powershell.exe")) )

process where event.type == "start" and user.id : "S-1-5-18" and ( (process.name : "elevation_service.exe" and not process.pe.original_file_name == "elevation_service.exe") or (process.parent.name : "elevation_service.exe" and process.name : ("rundll32.exe", "cmd.exe", "powershell.exe")) )

file where file.path : "/*GCONV_PATH*"

event.category:process and event.type:start and process.args:(echo and *NOPASSWD*ALL*)

sequence with maxspan=5s [process where event.type == "start" and not process.parent.executable : "C:\\Windows\\SoftwareDistribution\\*.exe"] by host.id, process.executable, process.parent.entity_id [file where event.type == "change" and event.action == "overwrite" and file.extension == "exe"] by host.id, file.path, process.entity_id

event.category:process and powershell.file.script_block_text : ( (VirtualAlloc or VirtualAllocEx or VirtualProtect or LdrLoadDll or LoadLibrary or LoadLibraryA or LoadLibraryEx or GetProcAddress or OpenProcess or OpenProcessToken or AdjustTokenPrivileges) and (WriteProcessMemory or CreateRemoteThread or NtCreateThreadEx or CreateThread or QueueUserAPC or SuspendThread or ResumeThread or GetDelegateForFunctionPointer) )

event.category:process and powershell.file.script_block_text : ( (VirtualAlloc or VirtualAllocEx or VirtualProtect or LdrLoadDll or LoadLibrary or LoadLibraryA or LoadLibraryEx or GetProcAddress or OpenProcess or OpenProcessToken or AdjustTokenPrivileges) and (WriteProcessMemory or CreateRemoteThread or NtCreateThreadEx or CreateThread or QueueUserAPC or SuspendThread or ResumeThread or GetDelegateForFunctionPointer) )

event.category:process and powershell.file.script_block_text : ( (VirtualAlloc or VirtualAllocEx or VirtualProtect or LdrLoadDll or LoadLibrary or LoadLibraryA or LoadLibraryEx or GetProcAddress or OpenProcess or OpenProcessToken or AdjustTokenPrivileges) and (WriteProcessMemory or CreateRemoteThread or NtCreateThreadEx or CreateThread or QueueUserAPC or SuspendThread or ResumeThread) )

process where event.type == "start" and process.args : "-s" and process.args : "-d" and process.args : "rssocks"

sequence by host.id, user.id with maxspan=1m [authentication where event.outcome == "success" and event.action == "logged-in" and winlog.logon.type == "Network" and not user.name == "ANONYMOUS LOGON" and not user.domain == "NT AUTHORITY" and source.ip != "127.0.0.1" and source.ip !="::1"] [file where event.action == "creation" and process.name : "svchost.exe" and file.Ext.header_bytes : "72656766*" and user.id : "S-1-5-21-*" and file.size &gt;= 30000 and not file.path : ("?:\\Windows\\system32\\HKEY_LOCAL_MACHINE_SOFTWARE_Micr osoft_*.registry", "?:\\Users\\*\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat.LOG?", "?:\\Users\\*\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat", "?:\\Users\\*\\ntuser.dat.LOG?", "?:\\Users\\*\\NTUSER.DAT")]

sequence by host.id, user.id with maxspan=1m [authentication where event.outcome == "success" and winlog.logon.type == "Network" and not user.name == "ANONYMOUS LOGON" and not user.domain == "NT AUTHORITY" and source.ip != "127.0.0.1" and source.ip !="::1"] [file where event.action == "creation" and process.name : "svchost.exe" and file.Ext.header_bytes : "72656766*" and user.id : "S-1-5-21-*" and file.size &gt;= 30000]

/* Identifies the modification of RDP Shadow registry or the execution of processes indicative of active shadow RDP session */ any where (event.category == "registry" and registry.path : "HKLM\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\\Shadow" ) or (event.category == "process" and (process.name : ("RdpSaUacHelper.exe", "RdpSaProxy.exe") and process.parent.name : "svchost.exe") or (process.pe.original_file_name : "mstsc.exe" and process.args : "/shadow:*") )

/* Identifies the modification of RDP Shadow registry or the execution of processes indicative of active shadow RDP session */ any where (event.category == "registry" and registry.path : "HKLM\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\\Shadow" ) or (event.category == "process" and (process.name : ("RdpSaUacHelper.exe", "RdpSaProxy.exe") and process.parent.name : "svchost.exe") or (process.pe.original_file_name : "mstsc.exe" and process.args : "/shadow:*") )

process where event.type == "start" and /* RDP port and usual SSH tunneling related switches in command line */ process.args : "*:3389" and process.args : ("-L", "-P", "-R", "-pw", "-ssh")

process where event.type in ("start", "process_started") and /* RDP port and usual SSH tunneling related switches in command line */ process.args : "*:3389" and process.args : ("-L", "-P", "-R", "-pw", "-ssh")

process where event.type in ("start", "process_started", "info") and /* RDP port and usual SSH tunneling related switches in commandline */ wildcard(process.args, "*:3389") and wildcard(process.args,"-L", "-P", "-R", "-pw", "-ssh")

process where event.type in ("start", "process_started", "info") and /* RDP port and usual SSH tunneling related switches in commandline */ wildcard(process.args, "*:3389") and wildcard(process.args,"-L", "-P", "-R", "-pw", "-ssh")

process where event.type in ("start", "process_started") and process.name in ("sh", "bash", "zsh", "dash", "zmodload") and process.args : ("*/dev/tcp/*", "*/dev/udp/*", "*zsh/net/tcp*", "*zsh/net/udp*") and /* noisy FPs */ not (process.parent.name : "timeout" and process.executable : "/var/lib/docker/overlay*") and not process.command_line : ("*/dev/tcp/sirh_db/*", "*/dev/tcp/remoteiot.com/*", "*dev/tcp/elk.stag.one/*", "*dev/tcp/kafka/*", "*/dev/tcp/$0/$1*", "*/dev/tcp/127.*", "*/dev/udp/127.*", "*/dev/tcp/localhost/*") and not process.parent.command_line : "runc init"

process where event.type in ("start", "process_started") and process.name in ("sh", "bash", "zsh", "dash", "zmodload") and process.args:("*/dev/tcp/*", "*/dev/udp/*", "zsh/net/tcp", "zsh/net/udp")

file where event.type == "change" and file.name : "*AAA.AAA"

file where event.type == "change" and wildcard(file.name,"*AAA.AAA")

event.category:file AND event.type:change AND file.name:/.+A+\.AAA/

event.action:"Directory Service Changes" and event.code:"5136" and winlog.event_data.AttributeLDAPDisplayName:"msDS-KeyCredentialLink"

/* Incoming RDP followed by a new RunMRU string value set to cmd, powershell, taskmgr or tsclient, followed by process execution within 1m */ sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "svchost.exe" and destination.port == 3389 and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.ip != "127.0.0.1" and source.ip != "::1" ] [registry where process.name : "explorer.exe" and registry.path : ("HKEY_USERS\\*\\Software\\Micro soft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\*") and registry.data.strings : ("cmd.exe*", "powershell.exe*", "taskmgr*", "\\\\tsclient\\*.exe\\*") ] [process where event.type == "start" and (process.parent.name : ("cmd.exe", "powershell.exe", "taskmgr.exe") or process.args : ("\\\\tsclient\\*.exe")) and not process.name : "conhost.exe" ]

/* Incoming RDP followed by a new RunMRU string value set to cmd, powershell, taskmgr or tsclient, followed by process execution within 1m */ sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "svchost.exe" and destination.port == 3389 and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.ip != "127.0.0.1" and source.ip != "::1" ] [registry where process.name : "explorer.exe" and registry.path : ("HKEY_USERS\\*\\Software\\Micr osoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\*") and registry.data.strings : ("cmd.exe*", "powershell.exe*", "taskmgr*", "\\\\tsclient\\*.exe\\*") ] [process where event.type in ("start", "process_started") and (process.parent.name : ("cmd.exe", "powershell.exe", "taskmgr.exe") or process.args : ("\\\\tsclient\\*.exe")) and not process.name : "conhost.exe" ]

/* Incoming RDP followed by a new RunMRU string value set to cmd, powershell, taskmgr or tsclient, followed by process execution within 1m */ sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "svchost.exe" and destination.port == 3389 and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.address != "127.0.0.1" and source.address != "::1" ] [registry where process.name : "explorer.exe" and registry.path : ("HKEY_USERS\\*\\Software\\Micr osoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\*") and registry.data.strings : ("cmd.exe*", "powershell.exe*", "taskmgr*", "\\\\tsclient\\*.exe\\*") ] [process where event.type in ("start", "process_started") and (process.parent.name : ("cmd.exe", "powershell.exe", "taskmgr.exe") or process.args : ("\\\\tsclient\\*.exe")) and not process.name : "conhost.exe" ]

/* Incoming RDP followed by a new RunMRU string value set to cmd, powershell, taskmgr or tsclient, followed by process execution within 1m */ sequence by host.id with maxspan=1m [network where event.type == "start" and process.name : "svchost.exe" and destination.port == 3389 and network.direction == "incoming" and network.transport == "tcp" and source.address != "127.0.0.1" and source.address != "::1" ] [registry where process.name : "explorer.exe" and registry.path : ("HKEY_USERS\\*\\Software\\Microsoft\\Windows\\Current Version\\Explorer\\RunMRU\\*") and registry.data.strings : ("cmd.exe*", "powershell.exe*", "taskmgr*", "\\\\tsclient\\*.exe\\*") ] [process where event.type in ("start", "process_started") and (process.parent.name : ("cmd.exe", "powershell.exe", "taskmgr.exe") or process.args : ("\\\\tsclient\\*.exe")) and not process.name : "conhost.exe" ]

event.category:process and event.type:(start or process_started) and process.name:(bash or dash or ash or zsh or "python*" or "perl*" or "php*") and process.parent.name:("apache" or "nginx" or "www" or "apache2" or "httpd" or "www-data")

event.category:process and event.type:(start or process_started) and process.name:(bash or dash) and user.name:(apache or nginx or www or "www-data")

process.name:(bash or dash) and user.name:(apache or nginx or www or "www-data") and event.action:executed

process.name:bash and user.name:(apache or www or www-data) and event.action:executed

process.name: bash and user.name: (apache or www or "wwww-data") and event.action:executed

sequence by host.id, source.ip with maxspan=10s [authentication where event.action in ("ssh_login", "user_login") and event.outcome == "failure" and source.ip != null and source.ip != "0.0.0.0" and source.ip != "::" and user.name in ("*root*" , "*admin*")] with runs=3

sequence by host.id, source.ip, user.name with maxspan=3s [authentication where event.action in ("ssh_login", "user_login") and event.outcome == "failure" and source.ip != null and source.ip != "0.0.0.0" and source.ip != "::" ] with runs=2 [authentication where event.action in ("ssh_login", "user_login") and event.outcome == "success" and source.ip != null and source.ip != "0.0.0.0" and source.ip != "::" ]

sequence by host.id, process.entity_id with maxspan = 5s [process where event.type:"start" and process.name : ("wermgr.exe", "WerFault.exe") and process.args_count == 1] [network where process.name : ("wermgr.exe", "WerFault.exe") and network.protocol != "dns" and network.direction : ("outgoing", "egress") and destination.ip !="::1" and destination.ip !="127.0.0.1" ]

sequence by host.id, process.entity_id with maxspan = 5s [process where event.type:"start" and process.name : ("wermgr.exe", "WerFault.exe") and process.args_count == 1] [network where process.name : ("wermgr.exe", "WerFault.exe") and network.protocol != "dns" and network.direction == "outgoing" and destination.ip !="::1" and destination.ip !="127.0.0.1" ]

event.category:process and event.type:(start or process_started) and process.name:WerFault.exe and not process.args:((("-u" or "-pss") and "-p" and "-s") or ("/h" and "/shared") or ("-k" and "-lcq"))

event.category:process and powershell.file.script_block_text : ( KerberosRequestorSecurityToken )

event.category:process and powershell.file.script_block_text : ( KerberosRequestorSecurityToken )

event.category:process and ( powershell.file.script_block_text : (GetAsyncKeyState or NtUserGetAsyncKeyState or GetKeyboardState or "Get-Keystrokes") or powershell.file.script_block_text : ( (SetWindowsHookA or SetWindowsHookW or SetWindowsHookEx or SetWindowsHookExA or NtUserSetWindowsHookEx) and (GetForegroundWindow or GetWindowTextA or GetWindowTextW or "WM_KEYBOARD_LL") ) )

event.category:process and ( powershell.file.script_block_text : (GetAsyncKeyState or NtUserGetAsyncKeyState or GetKeyboardState or "Get-Keystrokes") or powershell.file.script_block_text : ( (SetWindowsHookA or SetWindowsHookW or SetWindowsHookEx or SetWindowsHookExA or NtUserSetWindowsHookEx) and (GetForegroundWindow or GetWindowTextA or GetWindowTextW or "WM_KEYBOARD_LL") ) )

event.category:process and ( powershell.file.script_block_text : (GetAsyncKeyState or NtUserGetAsyncKeyState or GetKeyboardState or Get-Keystrokes) or powershell.file.script_block_text : ((SetWindowsHookA or SetWindowsHookW or SetWindowsHookEx or SetWindowsHookExA or NtUserSetWindowsHookEx) and (GetForegroundWindow or GetWindowTextA or GetWindowTextW or WM_KEYBOARD_LL)) )

event.category:process and powershell.file.script_block_text:(MiniDumpWriteDump or MiniDumpWithFullMemory or pmuDetirWpmuDiniM)

event.code:"4104" and powershell.file.script_block_text:(MiniDumpWriteDump or MiniDumpWithFullMemory or pmuDetirWpmuDiniM)

event.category:process and powershell.file.script_block_text:( "New-InMemoryModule" or "Add-Win32Type" or psenum or DefineDynamicAssembly or DefineDynamicModule or "Reflection.TypeAttributes" or "Reflection.Emit.OpCodes" or "Reflection.Emit.CustomAttributeBuilder" or "Runtime.InteropServices.DllImportAttribute" )

event.category:process and powershell.file.script_block_text:( "New-InMemoryModule" or "Add-Win32Type" or psenum or DefineDynamicAssembly or DefineDynamicModule or "Reflection.TypeAttributes" or "Reflection.Emit.OpCodes" or "Reflection.Emit.CustomAttributeBuilder" or "Runtime.InteropServices.DllImportAttribute" )

event.category:process and powershell.file.script_block_text:( New-InMemoryModule or Add-Win32Type or psenum or DefineDynamicAssembly or DefineDynamicModule or Reflection.TypeAttributes or Reflection.Emit.OpCodes or Reflection.Emit.CustomAttributeBuilder or Runtime.InteropServices.DllImportAttribute )

registry where event.type == "change" and registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlock Logging\\EnableScriptBlockLogging" and registry.data.strings : ("0", "0x00000000")

registry where event.type == "change" and registry.path : "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlock Logging\\EnableScriptBlockLogging" and registry.data.strings : ("0", "0x00000000")

event.category:process and powershell.file.script_block_text:( "Invoke-TokenManipulation" or "ImpersonateNamedPipeClient" or "NtImpersonateThread" or ( "STARTUPINFOEX" and "UpdateProcThreadAttribute" ) or ( "AdjustTokenPrivileges" and "SeDebugPrivilege" ) or ( ("DuplicateToken" or "DuplicateTokenEx") and ("SetThreadToken" or "ImpersonateLoggedOnUser" or "CreateProcessWithTokenW" or "CreatePRocessAsUserW" or "CreateProcessAsUserA") ) )

event.category:process and powershell.file.script_block_text:( "Invoke-ShareFinder" or "Invoke-ShareFinderThreaded" or ( "shi1_netname" and "shi1_remark" ) or ( "NetShareEnum" and "NetApiBufferFree" ) )

event.category:process and powershell.file.script_block_text : ( NetShareEnum or NetWkstaUserEnum or NetSessionEnum or NetLocalGroupEnum or NetLocalGroupGetMembers or DsGetSiteName or DsEnumerateDomainTrusts or WTSEnumerateSessionsEx or WTSQuerySessionInformation or LsaGetLogonSessionData or QueryServiceObjectSecurity )

event.category:process and powershell.file.script_block_text : ( NetShareEnum or NetWkstaUserEnum or NetSessionEnum or NetLocalGroupEnum or NetLocalGroupGetMembers or DsGetSiteName or DsEnumerateDomainTrusts or WTSEnumerateSessionsEx or WTSQuerySessionInformation or LsaGetLogonSessionData or QueryServiceObjectSecurity )

event.code:"4104" and powershell.file.script_block_text : ( NetShareEnum or NetWkstaUserEnum or NetSessionEnum or NetLocalGroupEnum or NetLocalGroupGetMembers or DsGetSiteName or DsEnumerateDomainTrusts or WTSEnumerateSessionsEx or WTSQuerySessionInformation or LsaGetLogonSessionData or QueryServiceObjectSecurity )

event.category:process and powershell.file.script_block_text : ( ( "System.IO.Compression.DeflateStream" or "System.IO.Compression.GzipStream" or "IO.Compression.DeflateStream" or "IO.Compression.GzipStream" ) and FromBase64String )

event.category:process and powershell.file.script_block_text : ( ( "System.IO.Compression.DeflateStream" or "System.IO.Compression.GzipStream" or "IO.Compression.DeflateStream" or "IO.Compression.GzipStream" ) and FromBase64String )

event.category:process and powershell.file.script_block_text : ( (System.IO.Compression.DeflateStream or System.IO.Compression.GzipStream or IO.Compression.DeflateStream or IO.Compression.GzipStream) and FromBase64String )

event.category:process and powershell.file.script_block_text : ( "Get-MicrophoneAudio" or (waveInGetNumDevs and mciSendStringA) )

event.category:process and powershell.file.script_block_text : ( "Get-MicrophoneAudio" or (waveInGetNumDevs and mciSendStringA) )

event.category:process and powershell.file.script_block_text : ( Get-MicrophoneAudio or (waveInGetNumDevs and mciSendStringA) )

event.code:"4104" and powershell.file.script_block_text : ( Get-MicrophoneAudio or (waveInGetNumDevs and mciSendStringA) )

event.category:process and powershell.file.script_block_text : ( CopyFromScreen and ("System.Drawing.Bitmap" or "Drawing.Bitmap") )

event.category:process and powershell.file.script_block_text : ( CopyFromScreen and ("System.Drawing.Bitmap" or "Drawing.Bitmap") )

event.category:process and powershell.file.script_block_text : ( CopyFromScreen and (System.Drawing.Bitmap or Drawing.Bitmap) )

sequence by host.id, source.ip with maxspan=10s [authentication where event.action == "logon-failed" and winlog.logon.type : "Network" and source.ip != null and source.ip != "127.0.0.1" and source.ip != "::1" and user.name : "*admin*" and /* noisy failure status codes often associated to authentication misconfiguration */ not winlog.event_data.Status : ("0xC000015B", "0XC000005E", "0XC0000133", "0XC0000192")] with runs=5

process where event.type == "start" and process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE") and process.args : "echo" and process.args : "&gt;" and process.args : "\\\\.\\pipe\\*"

process where event.type in ("start", "process_started") and process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE") and process.args : "echo" and process.args : "&gt;" and process.args : "\\\\.\\pipe\\*"

process where event.type in ("start", "process_started") and process.pe.original_file_name in ("Cmd.Exe", "PowerShell.EXE") and process.args : "echo" and process.args : "&gt;" and process.args : "\\\\.\\pipe\\*"

file where event.action : "Pipe Created*" and /* normal sysmon named pipe creation events truncate the pipe keyword */ file.name : "\\*\\Pipe\\*"

event.category:file and not event.type:deletion and file.path:/private/var/at/tabs/root and not process.executable:/usr/bin/crontab

registry where registry.path : ("HKEY_USERS\\*\\Environment\\windir", "HKEY_USERS\\*\\Environment\\systemroot") and not registry.data.strings : ("C:\\windows", "%SystemRoot%")

registry where registry.path : ("HKEY_USERS\\*\\Environment\\windir", "HKEY_USERS\\*\\Environment\\systemroot") and not registry.data.strings : ("C:\\windows", "%SystemRoot%")

{ "username": "detection-engine-admin", "has_all_requested": false, "cluster": { "monitor_ml": true, "manage_ccr": false, "manage_index_templates": true, "monitor_watcher": true, "monitor_transform": true, "read_ilm": true, "manage_api_key": false, "manage_security": false, "manage_own_api_key": false, "manage_saml": false, "all": false, "manage_ilm": true, "manage_ingest_pipelines": true, "read_ccr": false, "manage_rollup": true, "monitor": true, "manage_watcher": true, "manage": true, "manage_transform": true, "manage_token": false, "manage_ml": true, "manage_pipeline": true, "monitor_rollup": true, "transport_client": true, "create_snapshot": true }, "index": { ".siem-signals-detection-engine": { "all": false, "manage_ilm": true, "read": false, "create_index": true, "read_cross_cluster": false, "index": false, "monitor": true, "delete": false, "manage": true, "delete_index": true, "create_doc": false, "view_index_metadata": true, "create": false, "manage_follow_index": true, "manage_leader_index": true, "write": false } }, "application": {} "is_authenticated": true <a id="CO17-1"></a><i class="conum" data-value="1"></i> "has_encryption_key": true <a id="CO17-2"></a><i class="conum" data-value="2"></i> }

process where event.type == "start" and process.parent.name : "hh.exe" and process.name : ("mshta.exe", "cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "cscript.exe", "wscript.exe")

process where event.type in ("start", "process_started") and process.parent.name : "hh.exe" and process.name : ("mshta.exe", "cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "cscript.exe", "wscript.exe")

process where event.type in ("start", "process_started") and process.parent.name : "hh.exe" and process.name : ("mshta.exe", "cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "cscript.exe", "wscript.exe")

process where event.type in ("start", "process_started") and process.parent.name : "hh.exe" and process.name : ("mshta.exe", "cmd.exe", "powershell.exe", "pwsh.exe", "cscript.exe", "wscript.exe")

event.category:process and event.type:(start or process_started) and process.name:hh.exe

event.code:1 and process.name:hh.exe

sequence by host.id with maxspan=1m [authentication where event.action:"logged-in" and event.outcome == "success" and user.id:"S-1-5-21-*" and /* seclogon service */ process.name == "svchost.exe" and winlog.event_data.LogonProcessName : "seclogo*" and source.ip == "::1" ] by winlog.event_data.TargetLogonId [process where event.type == "start"] by winlog.event_data.TargetLogonId

process where event.type == "start" and /* add suspicious execution paths here */ process.executable : ("C:\\PerfLogs\\*.exe","C:\\Users\\ Public\\*.exe","C:\\Windows\\Tasks\\*.exe","C:\\Intel\\*.exe","C:\\AMD \\Temp\\*.exe","C:\\Windows\\AppReadiness\\*.exe", "C:\\Windows\\Servi ceState\\*.exe","C:\\Windows\\security\\*.exe","C:\\Windows\\IdentityC RL\\*.exe","C:\\Windows\\Branding\\*.exe","C:\\Windows\\csc\\*.exe", "C:\\Windows\\DigitalLocker\\*.exe","C:\\Windows\\en-US\\*.exe","C:\\W indows\\wlansvc\\*.exe","C:\\Windows\\Prefetch\\*.exe","C:\\Windows\\F onts\\*.exe", "C:\\Windows\\diagnostics\\*.exe","C:\\Windows\\TAPI\\* .exe","C:\\Windows\\INF\\*.exe","C:\\Windows\\System32\\Speech\\*.exe" ,"C:\\windows\\tracing\\*.exe", "c:\\windows\\IME\\*.exe","c:\\Window s\\Performance\\*.exe","c:\\windows\\intel\\*.exe","c:\\windows\\ms\\* .exe","C:\\Windows\\dot3svc\\*.exe", "C:\\Windows\\panther\\*.exe","C :\\Windows\\RemotePackages\\*.exe","C:\\Windows\\OCR\\*.exe","C:\\Wind ows\\appcompat\\*.exe","C:\\Windows\\apppatch\\*.exe","C:\\Windows\\ad dins\\*.exe", "C:\\Windows\\Setup\\*.exe","C:\\Windows\\Help\\*.exe", "C:\\Windows\\SKB\\*.exe","C:\\Windows\\Vss\\*.exe","C:\\Windows\\Web\ \*.exe","C:\\Windows\\servicing\\*.exe","C:\\Windows\\CbsTemp\\*.exe", "C:\\Windows\\Logs\\*.exe","C:\\Windows\\WaaS\\*.exe","C:\\Windows\\Sh ellExperiences\\*.exe","C:\\Windows\\ShellComponents\\*.exe","C:\\Wind ows\\PLA\\*.exe", "C:\\Windows\\Migration\\*.exe","C:\\Windows\\debug \\*.exe","C:\\Windows\\Cursors\\*.exe","C:\\Windows\\Containers\\*.exe ","C:\\Windows\\Boot\\*.exe","C:\\Windows\\bcastdvr\\*.exe", "C:\\Win dows\\assembly\\*.exe","C:\\Windows\\TextInput\\*.exe","C:\\Windows\\s ecurity\\*.exe","C:\\Windows\\schemas\\*.exe","C:\\Windows\\SchCache\\ *.exe","C:\\Windows\\Resources\\*.exe", "C:\\Windows\\rescache\\*.exe ","C:\\Windows\\Provisioning\\*.exe","C:\\Windows\\PrintDialog\\*.exe" ,"C:\\Windows\\PolicyDefinitions\\*.exe","C:\\Windows\\media\\*.exe", "C:\\Windows\\Globalization\\*.exe","C:\\Windows\\L2Schemas\\*.exe","C :\\Windows\\LiveKernelReports\\*.exe","C:\\Windows\\ModemLogs\\*.exe", "C:\\Windows\\ImmersiveControlPanel\\*.exe") and not process.name : ( "SpeechUXWiz.exe","SystemSettings.exe","TrustedInstaller.exe","PrintDi alog.exe","MpSigStub.exe","LMS.exe","mpam-*.exe") and not process.executable : ("?:\\Intel\\Wireless\\WUSetupLauncher.exe", "?:\\Intel\\Wireless\\Setup.exe", "?:\\Intel\\Move Mouse.exe", "?:\\windows\\Panther\\DiagTrackRunner.exe", "?:\\Windows\\servicing\\GC64\\tzupd.exe", "?:\\Users\\Public\\res\\RemoteLite.exe", "?:\\Users\\Public\\IBM\\ClientSolutions\\*.exe", "?:\\Users\\Public\\Documents\\syspin.exe", "?:\\Users\\Public\\res\\FileWatcher.exe") /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

process where event.type in ("start", "process_started", "info") and /* add suspicious execution paths here */ process.executable : ("C:\\P erfLogs\\*.exe","C:\\Users\\Public\\*.exe","C:\\Windows\\Tasks\\*.exe" ,"C:\\Intel\\*.exe","C:\\AMD\\Temp\\*.exe","C:\\Windows\\AppReadiness\ \*.exe", "C:\\Windows\\ServiceState\\*.exe","C:\\Windows\\security\\*. exe","C:\\Windows\\IdentityCRL\\*.exe","C:\\Windows\\Branding\\*.exe", "C:\\Windows\\csc\\*.exe", "C:\\Windows\\DigitalLocker\\*.exe","C:\\Windows\\en-US\\*.exe","C:\\W indows\\wlansvc\\*.exe","C:\\Windows\\Prefetch\\*.exe","C:\\Windows\\F onts\\*.exe", "C:\\Windows\\diagnostics\\*.exe","C:\\Windows\\TAPI\\* .exe","C:\\Windows\\INF\\*.exe","C:\\Windows\\System32\\Speech\\*.exe" ,"C:\\windows\\tracing\\*.exe", "c:\\windows\\IME\\*.exe","c:\\Window s\\Performance\\*.exe","c:\\windows\\intel\\*.exe","c:\\windows\\ms\\* .exe","C:\\Windows\\dot3svc\\*.exe", "C:\\Windows\\panther\\*.exe","C :\\Windows\\RemotePackages\\*.exe","C:\\Windows\\OCR\\*.exe","C:\\Wind ows\\appcompat\\*.exe","C:\\Windows\\apppatch\\*.exe","C:\\Windows\\ad dins\\*.exe", "C:\\Windows\\Setup\\*.exe","C:\\Windows\\Help\\*.exe", "C:\\Windows\\SKB\\*.exe","C:\\Windows\\Vss\\*.exe","C:\\Windows\\Web\ \*.exe","C:\\Windows\\servicing\\*.exe","C:\\Windows\\CbsTemp\\*.exe", "C:\\Windows\\Logs\\*.exe","C:\\Windows\\WaaS\\*.exe","C:\\Windows\\Sh ellExperiences\\*.exe","C:\\Windows\\ShellComponents\\*.exe","C:\\Wind ows\\PLA\\*.exe", "C:\\Windows\\Migration\\*.exe","C:\\Windows\\debug \\*.exe","C:\\Windows\\Cursors\\*.exe","C:\\Windows\\Containers\\*.exe ","C:\\Windows\\Boot\\*.exe","C:\\Windows\\bcastdvr\\*.exe", "C:\\Win dows\\assembly\\*.exe","C:\\Windows\\TextInput\\*.exe","C:\\Windows\\s ecurity\\*.exe","C:\\Windows\\schemas\\*.exe","C:\\Windows\\SchCache\\ *.exe","C:\\Windows\\Resources\\*.exe", "C:\\Windows\\rescache\\*.exe ","C:\\Windows\\Provisioning\\*.exe","C:\\Windows\\PrintDialog\\*.exe" ,"C:\\Windows\\PolicyDefinitions\\*.exe","C:\\Windows\\media\\*.exe", "C:\\Windows\\Globalization\\*.exe","C:\\Windows\\L2Schemas\\*.exe","C :\\Windows\\LiveKernelReports\\*.exe","C:\\Windows\\ModemLogs\\*.exe", "C:\\Windows\\ImmersiveControlPanel\\*.exe") and not process.name : ( "SpeechUXWiz.exe","SystemSettings.exe","TrustedInstaller.exe","PrintDi alog.exe","MpSigStub.exe","LMS.exe","mpam-*.exe") and not process.executable : ("?:\\Intel\\Wireless\\WUSetupLauncher.exe", "?:\\Intel\\Wireless\\Setup.exe", "?:\\Intel\\Move Mouse.exe", "?:\\windows\\Panther\\DiagTrackRunner.exe", "?:\\Windows\\servicing\\GC64\\tzupd.exe", "?:\\Users\\Public\\res\\RemoteLite.exe", "?:\\Users\\Public\\IBM\\ClientSolutions\\*.exe", "?:\\Users\\Public\\Documents\\syspin.exe", "?:\\Users\\Public\\res\\FileWatcher.exe") /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

process where event.type in ("start", "process_started", "info") and /* add suspicious execution paths here */ process.executable : ("C:\\P erfLogs\\*.exe","C:\\Users\\Public\\*.exe","C:\\Users\\Default\\*.exe" ,"C:\\Windows\\Tasks\\*.exe","C:\\Intel\\*.exe","C:\\AMD\\Temp\\*.exe" ,"C:\\Windows\\AppReadiness\\*.exe", "C:\\Windows\\ServiceState\\*.exe ","C:\\Windows\\security\\*.exe","C:\\Windows\\IdentityCRL\\*.exe","C: \\Windows\\Branding\\*.exe","C:\\Windows\\csc\\*.exe", "C:\\Windows\\DigitalLocker\\*.exe","C:\\Windows\\en-US\\*.exe","C:\\W indows\\wlansvc\\*.exe","C:\\Windows\\Prefetch\\*.exe","C:\\Windows\\F onts\\*.exe", "C:\\Windows\\diagnostics\\*.exe","C:\\Windows\\TAPI\\* .exe","C:\\Windows\\INF\\*.exe","C:\\Windows\\System32\\Speech\\*.exe" ,"C:\\windows\\tracing\\*.exe", "c:\\windows\\IME\\*.exe","c:\\Window s\\Performance\\*.exe","c:\\windows\\intel\\*.exe","c:\\windows\\ms\\* .exe","C:\\Windows\\dot3svc\\*.exe","C:\\Windows\\ServiceProfiles\\*.e xe", "C:\\Windows\\panther\\*.exe","C:\\Windows\\RemotePackages\\*.ex e","C:\\Windows\\OCR\\*.exe","C:\\Windows\\appcompat\\*.exe","C:\\Wind ows\\apppatch\\*.exe","C:\\Windows\\addins\\*.exe", "C:\\Windows\\Set up\\*.exe","C:\\Windows\\Help\\*.exe","C:\\Windows\\SKB\\*.exe","C:\\W indows\\Vss\\*.exe","C:\\Windows\\Web\\*.exe","C:\\Windows\\servicing\ \*.exe","C:\\Windows\\CbsTemp\\*.exe", "C:\\Windows\\Logs\\*.exe","C: \\Windows\\WaaS\\*.exe","C:\\Windows\\twain_32\\*.exe","C:\\Windows\\S hellExperiences\\*.exe","C:\\Windows\\ShellComponents\\*.exe","C:\\Win dows\\PLA\\*.exe", "C:\\Windows\\Migration\\*.exe","C:\\Windows\\debu g\\*.exe","C:\\Windows\\Cursors\\*.exe","C:\\Windows\\Containers\\*.ex e","C:\\Windows\\Boot\\*.exe","C:\\Windows\\bcastdvr\\*.exe", "C:\\Wi ndows\\assembly\\*.exe","C:\\Windows\\TextInput\\*.exe","C:\\Windows\\ security\\*.exe","C:\\Windows\\schemas\\*.exe","C:\\Windows\\SchCache\ \*.exe","C:\\Windows\\Resources\\*.exe", "C:\\Windows\\rescache\\*.ex e","C:\\Windows\\Provisioning\\*.exe","C:\\Windows\\PrintDialog\\*.exe ","C:\\Windows\\PolicyDefinitions\\*.exe","C:\\Windows\\media\\*.exe", "C:\\Windows\\Globalization\\*.exe","C:\\Windows\\L2Schemas\\*.exe","C :\\Windows\\LiveKernelReports\\*.exe","C:\\Windows\\ModemLogs\\*.exe", "C:\\Windows\\ImmersiveControlPanel\\*.exe") and not process.name : ( "SpeechUXWiz.exe","SystemSettings.exe","TrustedInstaller.exe","PrintDi alog.exe","MpSigStub.exe","LMS.exe","mpam-*.exe") /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

process.name:MSBuild.exe and event.action:"CreateRemoteThread detected (rule: CreateRemoteThread)"

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:kernel_shellcode_event or endgame.event_subtype_full:kernel_shellcode_event)

event.kind:alert and event.module:endgame and event.action:kernel_shellcode_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:kernel_shellcode_event or endgame.event_subtype_full:kernel_shellcode_event)

event.kind:alert and event.module:endgame and event.action:kernel_shellcode_event and endgame.metadata.type:prevention

process where event.type == "start" and user.id == "0" and process.executable regex~ """/var/run/\w+\.(pid|lock|reboot)"""

sequence by host.id with maxspan=5s [process where event.type == "end" and process.code_signature.trusted == false and not process.executable : ("C:\\Windows\\SoftwareDistribution\\*.exe", "C:\\Windows\\WinSxS\\*.exe") ] by process.executable [file where event.type == "deletion" and file.extension : ("exe", "scr", "com") and not process.executable : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\System32\\drvinst.exe") and not file.path : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe") ] by file.path

sequence by host.id with maxspan=5s [process where event.type == "end" and process.code_signature.trusted == false and not process.executable : ("C:\\Windows\\SoftwareDistribution\\*.exe", "C:\\Windows\\WinSxS\\*.exe") ] by process.executable [file where event.type == "deletion" and file.extension : ("exe", "scr", "com") and not process.executable : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\System32\\drvinst.exe") and not file.path : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe") ] by file.path

sequence by host.id with maxspan=5s [process where event.type == "end" and process.code_signature.trusted == false and not process.executable : ("C:\\Windows\\SoftwareDistribution\\*.exe", "C:\\Windows\\WinSxS\\*.exe") ] by process.executable [file where event.type == "deletion" and file.extension : ("exe", "scr", "com")] by file.path

process where event.type == "start" and process.executable : "C:\\*Program*Files*\\*.exe" and not process.executable : ("C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe", "C:\\Users\\*.exe", "C:\\ProgramData\\*.exe")

process where event.type in ("start", "process_started", "info") and /* capture both fake program files directory in process executable as well as if passed in process args as a dll*/ process.args : ("C:\\*Program*Files*\\*", "C:\\*Program*Files*\\*") and not process.args : ("C:\\Program Files\\*", "C:\\Program Files (x86)\\*")

process where event.type in ("start", "process_started") and process.name : "osascript" and process.command_line : "osascript*display dialog*password*"

process where event.type in ("start", "process_started") and process.name:"osascript" and process.args:"-e" and process.args:"password"

sequence by process.entity_id [process where process.name : "PsExec.exe" and event.type == "start" and /* This flag suppresses the display of the license dialog and may indicate that psexec executed for the first time in the machine */ process.args : "-accepteula" and not process.executable : ("?:\\ProgramData\\Docu snap\\Discovery\\discovery\\plugins\\17\\Bin\\psexec.exe", "?:\\Docusnap 11\\Bin\\psexec.exe", "?:\\Program Files\\Docusnap X\\Bin\\psexec.exe", "?:\\Program Files\\Docusnap X\\Tools\\dsDNS.exe") and not process.parent.executable : "?:\\Program Files (x86)\\Cynet\\Cynet Scanner\\CynetScanner.exe"] [network where process.name : "PsExec.exe"]

sequence by process.entity_id [process where process.name : "PsExec.exe" and event.type == "start"] [network where process.name : "PsExec.exe"]

event.category:network and event.type:connection and process.name:PsExec.exe

process.name:PsExec.exe and event.action:"Network connection detected (rule: NetworkConnect)"

process.name:PsExec.exe and event.action:"Network connection detected (rule: NetworkConnect)"

event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:ransomware_event or endgame.event_subtype_full:ransomware_event)

event.kind:alert and event.module:endgame and event.action:ransomware_event and endgame.metadata.type:detection

event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:ransomware_event or endgame.event_subtype_full:ransomware_event)

event.kind:alert and event.module:endgame and event.action:ransomware_event and endgame.metadata.type:prevention

registry where event.type in ("creation", "change") and registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Control\\Terminal Server\\fDenyTSConnections" and registry.data.strings : ("0", "0x00000000") and not (process.name : "svchost.exe" and user.domain == "NT AUTHORITY") and not process.executable : "C:\\Windows\\System32\\SystemPropertiesRemote.exe"

registry where registry.path : "HKLM\\SYSTEM\\ControlSet*\\Control\\Terminal Server\\fDenyTSConnections" and registry.data.strings == "0" and not (process.name : "svchost.exe" and user.domain == "NT AUTHORITY") and not process.executable : "C:\\Windows\\System32\\SystemPropertiesRemote.exe"

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:3389 or event.dataset:zeek.rdp) and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:3389 or event.dataset:zeek.rdp) and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:3389 or event.dataset:zeek.rdp) and not source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport:tcp and destination.port:3389 and not source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport: tcp and destination.port: 3389 and ( network.direction: inbound or ( not source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

registry where /* uncomment once stable length(bytes_written_string) &gt; 0 and */ registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Control\\Session Manager\\AppCertDLLs\\*"

registry where /* uncomment once stable length(bytes_written_string) &gt; 0 and */ registry.path : "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\AppCertDLLs\\*"

registry where registry.path : ("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls", "HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe", "C:\\Program Files\\Commvault\\ContentStore*\\Base\\cvd.exe", "C:\\Program Files (x86)\\Commvault\\ContentStore*\\Base\\cvd.exe")

registry where registry.path : ("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls", "HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe", "C:\\Program Files\\Commvault\\ContentStore*\\Base\\cvd.exe", "C:\\Program Files (x86)\\Commvault\\ContentStore*\\Base\\cvd.exe")

sequence by host.id with maxspan=5m [authentication where event.action == "logged-in" and winlog.logon.type == "Network" and event.outcome == "success" and not user.name == "ANONYMOUS LOGON" and not winlog.event_data.SubjectUserName : "*$" and not user.domain == "NT AUTHORITY" and source.ip != "127.0.0.1" and source.ip !="::1"] by winlog.event_data.TargetLogonId [iam where event.action == "changed-computer-account" and /* if DnsHostName value equal a DC DNS hostname then it's highly suspicious */ winlog.event_data.DnsHostName : "??*"] by winlog.event_data.SubjectLogonId

process where event.type == "start" and (process.name : "netsh.exe" or process.pe.original_file_name == "netsh.exe") and process.args : ("localport=3389", "RemoteDesktop", "group=\"remote desktop\"") and process.args : ("action=allow", "enable=Yes", "enable")

process where event.type in ("start", "process_started") and (process.name : "netsh.exe" or process.pe.original_file_name == "netsh.exe") and process.args : ("localport=3389", "RemoteDesktop", "group=\"remote desktop\"") and process.args : ("action=allow", "enable=Yes", "enable")

sequence with maxspan=1m [file where event.type in ("creation", "change") and process.pid == 4 and file.extension : "exe"] by host.id, file.path [process where event.type == "start"] by host.id, process.executable

sequence with maxspan=1m [file where event.type in ("creation", "change") and process.pid == 4 and file.extension : "exe"] by host.id, file.path [process where event.type in ("start", "process_started")] by host.id, process.executable

process where event.type == "start" and process.name : ("cmd.exe", "powershell.exe", "robocopy.exe", "xcopy.exe") and process.args : ("copy*", "move*", "cp", "mv") and process.args : "*$*"

process where event.type in ("start", "process_started") and process.name : ("cmd.exe", "powershell.exe", "robocopy.exe", "xcopy.exe") and process.args : ("copy*", "move*", "cp", "mv") and process.args : "*$*"

process where event.type in ("start", "process_started") and process.name : ("cmd.exe", "powershell.exe", "robocopy.exe", "xcopy.exe") and process.args : ("copy*", "move*", "cp", "mv") and process.args : "*$*"

file where event.type == "creation" and process.name : "TeamViewer.exe" and file.extension : ("exe", "dll", "scr", "com", "bat", "ps1", "vbs", "vbe", "js", "wsh", "hta")

event.category:file and event.type:creation and process.name:TeamViewer.exe and file.extension:(exe or dll or scr or com or bat or ps1 or vbs or vbe or js or wsh or hta)

process where event.type == "start" and (process.name : "desktopimgdownldr.exe" or process.pe.original_file_name == "desktopimgdownldr.exe") and process.args : "/lockscreenurl:http*"

process where event.type in ("start", "process_started") and (process.name : "desktopimgdownldr.exe" or process.pe.original_file_name == "desktopimgdownldr.exe") and process.args : "/lockscreenurl:http*"

event.category:process and event.type:(start or process_started) and (process.name:desktopimgdownldr.exe or process.pe.original_file_name:desktopimgdownldr.exe) and process.args:/lockscreenurl\:http*

event.category:process and event.type:(start or process_started) and (process.name:desktopimgdownldr.exe or process.pe.original_file_name:desktopimgdownldr.exe or winlog.event_data.OriginalFileName:desktopimgdownldr.exe) and process.args:/lockscreenurl\:http*

process where event.type == "start" and (process.name : "MpCmdRun.exe" or process.pe.original_file_name == "MpCmdRun.exe") and process.args : "-DownloadFile" and process.args : "-url" and process.args : "-path"

event.category:process and event.type:(start or process_started) and (process.name:MpCmdRun.exe or process.pe.original_file_name:MpCmdRun.exe) and process.args:(("-DownloadFile" or "-downloadfile") and "-url" and "-path")

event.category:process and event.type:(start or process_started) and (process.name:MpCmdRun.exe or process.pe.original_file_name:MpCmdRun.exe or winlog.event_data.OriginalFileName:MpCmdRun.exe) and process.args:(("-DownloadFile" or "-downloadfile") and "-url" and "-path")

sequence by host.id, process.entity_id with maxspan=30s [network where process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and network.protocol == "dns" and not dns.question.name : ("localhost", "*.microsoft.com", "*.azureedge.net", "*.powershellgallery.com", "*.windowsupdate.com", "metadata.google.internal") and not user.domain : "NT AUTHORITY"] [file where process.name : "powershell.exe" and event.type == "creation" and file.extension : ("exe", "dll", "ps1", "bat") and not file.name : "__PSScriptPolicy*.ps1"]

sequence by host.id, process.entity_id with maxspan=30s [network where process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and network.protocol == "dns" and not dns.question.name : ("localhost", "*.microsoft.com", "*.azureedge.net", "*.powershellgallery.com", "*.windowsupdate.com", "metadata.google.internal") and not user.domain : "NT AUTHORITY"] [file where process.name : "powershell.exe" and event.type == "creation" and file.extension : ("exe", "dll", "ps1", "bat") and not file.name : "__PSScriptPolicy*.ps1"]

sequence by host.id, process.entity_id with maxspan=30s [network where process.name : "powershell.exe" and network.protocol == "dns" and not dns.question.name : ("localhost", "*.microsoft.com", "*.azureedge.net", "*.powershellgallery.com", "*.windowsupdate.com", "metadata.google.internal") and not user.domain : "NT AUTHORITY"] [file where process.name : "powershell.exe" and event.type == "creation" and file.extension : ("exe", "dll", "ps1", "bat") and not file.name : "__PSScriptPolicy*.ps1"]

sequence by host.id, process.entity_id [network where process.name : ("wscript.exe", "cscript.exe") and network.protocol != "dns" and network.direction : ("outgoing", "egress") and network.type == "ipv4" and destination.ip != "127.0.0.1" ] [file where event.type == "creation" and file.extension : ("exe", "dll")]

sequence by host.id, process.entity_id [network where process.name : ("wscript.exe", "cscript.exe") and network.protocol != "dns" and network.direction == "outgoing" and network.type == "ipv4" and destination.ip != "127.0.0.1" ] [file where event.type == "creation" and file.extension : ("exe", "dll")]

sequence by host.id with maxspan=1m [authentication where event.action == "logged-in" and winlog.logon.type == "Network" and event.outcome == "success" and not user.name == "ANONYMOUS LOGON" and not winlog.event_data.SubjectUserName : "*$" and not user.domain == "NT AUTHORITY" and source.ip != "127.0.0.1" and source.ip !="::1"] by winlog.event_data.TargetLogonId [iam where event.action == "scheduled-task-created"] by winlog.event_data.SubjectLogonId

sequence with maxspan=1s [network where process.name : "services.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id [process where event.type == "start" and process.parent.name : "services.exe" and not (process.name : "svchost.exe" and process.args : "tiledatamodelsvc") and not (process.name : "msiexec.exe" and process.args : "/V") and not process.executable : ("?:\\Windows\\ADCR_Agent\\adcrsvc.exe", "?:\\Windows\\System32\\VSSVC.exe", "?:\\Windows\\servicing\\TrustedInstaller.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Program Files\\*.exe", "?:\\Windows\\PSEXESVC.EXE", "?:\\Windows\\System32\\sppsvc.exe", "?:\\Windows\\System32\\wbem\\WmiApSrv.exe", "?:\\WINDOWS\\RemoteAuditService.exe", "?:\\Windows\\VeeamVssSupport\\VeeamGuestHelper.exe", "?:\\Windows\\VeeamLogShipper\\VeeamLogShipper.exe", "?:\\Windows\\CAInvokerService.exe", "?:\\Windows\\System32\\upfc.exe", "?:\\Windows\\AdminArsenal\\PDQ*.exe", "?:\\Windows\\System32\\vds.exe", "?:\\Windows\\Veeam\\Backup\\VeeamDeploymentSvc.exe", "?:\\Windows\\ProPatches\\Scheduler\\STSchedEx.exe", "?:\\Windows\\System32\\certsrv.exe", "?:\\Windows\\eset-remote-install-service.exe", "?:\\Pella Corporation\\Pella Order Management\\GPAutoSvc.exe", "?:\\Pella Corporation\\OSCToGPAutoService\\OSCToGPAutoSvc.exe", "?:\\Pella Corporation\\Pella Order Management\\GPAutoSvc.exe", "?:\\Windows\\SysWOW64\\NwxExeSvc\\NwxExeSvc.exe", "?:\\Windows\\System32\\taskhostex.exe") ] by host.id, process.parent.entity_id

sequence with maxspan=1s [network where process.name : "services.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and not (process.name : "svchost.exe" and process.args : "tiledatamodelsvc") and not (process.name : "msiexec.exe" and process.args : "/V") and not process.executable : ("?:\\Windows\\ADCR_Agent\\adcrsvc.exe", "?:\\Windows\\System32\\VSSVC.exe", "?:\\Windows\\servicing\\TrustedInstaller.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Program Files\\*.exe", "?:\\Windows\\PSEXESVC.EXE", "?:\\Windows\\System32\\sppsvc.exe", "?:\\Windows\\System32\\wbem\\WmiApSrv.exe", "?:\\WINDOWS\\RemoteAuditService.exe", "?:\\Windows\\VeeamVssSupport\\VeeamGuestHelper.exe", "?:\\Windows\\VeeamLogShipper\\VeeamLogShipper.exe", "?:\\Windows\\CAInvokerService.exe", "?:\\Windows\\System32\\upfc.exe", "?:\\Windows\\AdminArsenal\\PDQ*.exe", "?:\\Windows\\System32\\vds.exe", "?:\\Windows\\Veeam\\Backup\\VeeamDeploymentSvc.exe", "?:\\Windows\\ProPatches\\Scheduler\\STSchedEx.exe", "?:\\Windows\\System32\\certsrv.exe", "?:\\Windows\\eset-remote-install-service.exe", "?:\\Pella Corporation\\Pella Order Management\\GPAutoSvc.exe", "?:\\Pella Corporation\\OSCToGPAutoService\\OSCToGPAutoSvc.exe", "?:\\Pella Corporation\\Pella Order Management\\GPAutoSvc.exe", "?:\\Windows\\SysWOW64\\NwxExeSvc\\NwxExeSvc.exe", "?:\\Windows\\System32\\taskhostex.exe") ] by host.id, process.parent.entity_id

sequence with maxspan=1s [network where process.name : "services.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" ] by host.id, process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and not (process.name : "svchost.exe" and process.args : "tiledatamodelsvc") and not (process.name : "msiexec.exe" and process.args : "/V") /* uncomment if psexec is noisy in your environment */ /* and not process.name : "PSEXESVC.exe" */ ] by host.id, process.parent.entity_id

sequence with maxspan=1s [network where process.name : "services.exe" and network.direction : ("incoming", "ingress") and network.transport == "tcp" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address not in ("127.0.0.1", "::1") ] by host.id, process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and not (process.name : "svchost.exe" and process.args : "tiledatamodelsvc") and not (process.name : "msiexec.exe" and process.args : "/V") /* uncomment if psexec is noisy in your environment */ /* and not process.name : "PSEXESVC.exe" */ ] by host.id, process.parent.entity_id

sequence with maxspan=1s [network where process.name : "services.exe" and network.direction == "incoming" and network.transport == "tcp" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address not in ("127.0.0.1", "::1") ] by host.id, process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and not (process.name : "svchost.exe" and process.args : "tiledatamodelsvc") and not (process.name : "msiexec.exe" and process.args : "/V") /* uncomment if psexec is noisy in your environment */ /* and not process.name : "PSEXESVC.exe" */ ] by host.id, process.parent.entity_id

/* Task Scheduler service incoming connection followed by TaskCache registry modification */ sequence by host.id, process.entity_id with maxspan = 1m [network where process.name : "svchost.exe" and network.direction : ("incoming", "ingress") and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.ip != "127.0.0.1" and source.ip != "::1" ] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

/* Task Scheduler service incoming connection followed by TaskCache registry modification */ sequence by host.id, process.entity_id with maxspan = 1m [network where process.name : "svchost.exe" and network.direction : ("incoming", "ingress") and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address != "127.0.0.1" and source.address != "::1" ] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

/* Task Scheduler service incoming connection followed by TaskCache registry modification */ sequence by host.id, process.entity_id with maxspan = 1m [network where process.name : "svchost.exe" and network.direction == "incoming" and source.port &gt;= 49152 and destination.port &gt;= 49152 and source.address != "127.0.0.1" and source.address != "::1" ] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

event.category:process and event.type:(start or process_started) and process.name:systemsetup and process.args:("-setremotelogin" and on) and not process.parent.executable : /usr/local/jamf/bin/jamf

event.category:process and event.type:(start or process_started) and process.name:systemsetup and process.args:("-setremotelogin" and on)

event.category:process and event.type:(start or process_started) and process.name:systemsetup and process.args:("-f" and "-setremotelogin" and on)

process where event.type == "start" and ((process.name : "nbtstat.exe" and process.args : ("-n", "-s")) or (process.name : "arp.exe" and process.args : "-a"))

process where event.type in ("start", "process_started") and ((process.name : "nbtstat.exe" and process.args : ("-n", "-s")) or (process.name : "arp.exe" and process.args : "-a"))

process where event.type in ("start", "process_started") and (process.name : "nbtstat.exe" and process.args : ("-n", "-s")) or (process.name : "arp.exe" and process.args : "-a")

process where event.type == "start" and process.pe.original_file_name : "AutoIt*.exe" and not process.name : "AutoIt*.exe"

process where event.type in ("start", "process_started", "info") and process.pe.original_file_name : "AutoIt*.exe" and not process.name : "AutoIt*.exe"

event.category:process AND event.type:(start OR process_started) AND ( process.pe.original_file_name:/[aA][uU][tT][oO][iI][tT]\d\.[eE][xX][eE ]/ OR winlog.event_data.OriginalFileName:/[aA][uU][tT][oO][iI][tT]\d\. [eE][xX][eE]/) AND NOT process.name:/[aA][uU][tT][oO][iI][tT]\d{1,3}\.[eE][xX][eE]/

event.category:(network or network_traffic) and network.protocol:http and (url.extension:(ps1 or rar) or url.path:(*.ps1 or *.rar)) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network OR network_traffic) AND network.protocol:http AND url.path:/.*(rar|ps1)/ AND source.ip:(10.0.0.0\/8 OR 172.16.0.0\/12 OR 192.168.0.0\/16)

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and not source.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1") and destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

network.transport:tcp and destination.port:135 and not source.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1") and destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

network.transport: tcp and destination.port: 135 and ( network.direction: inbound or ( not source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport:tcp and destination.port:135 and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport: tcp and destination.port: 135 and ( network.direction: outbound or ( source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

sequence by host.id with maxspan = 30s [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : "taskschd.dll" or file.name : "taskschd.dll") and process.name : ("cscript.exe", "wscript.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe")] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

sequence by host.id with maxspan = 30s [library where dll.name : "taskschd.dll" and process.name : ("cscript.exe", "wscript.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe")] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

sequence by host.id with maxspan = 30s [library where dll.name : "taskschd.dll" and process.name : ("cscript.exe", "wscript.exe", "powershell.exe")] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

sequence by host.id with maxspan = 30s [library where file.name : "taskschd.dll" and process.name : ("cscript.exe", "wscript.exe", "powershell.exe")] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions"]

(event.code: "5136" and winlog.event_data.AttributeLDAPDisplayName:("gPCMachineExtensionNames" or "gPCUserExtensionNames") and winlog.event_data.AttributeValue:(* CAB54552-DEEA-4691-817E-ED4A4D1AFC72* and *AADCED64-746C-4633-A97C-D61349046527*)) or (event.code: "5145" and winlog.event_data.ShareName: "\\\\*\\SYSVOL" and winlog.event_data.RelativeTargetName: *ScheduledTasks.xml and (message: WriteData or winlog.event_data.AccessList: *%%4417*))

(event.code: "5136" and winlog.event_data.AttributeLDAPDisplayName:("gPCMachineExtensionNames" or "gPCUserExtensionNames") and winlog.event_data.AttributeValue:( *CAB54552-DEEA-4691-817E-ED4A4D1AFC72* and *AADCED64-746C-4633-A97C-D61349046527*)) or (event.code: "5145" and winlog.event_data.ShareName: "\\\\*\\SYSVOL" and winlog.event_data.RelativeTargetName: *ScheduledTasks.xml and (message: WriteData or winlog.event_data.AccessList: *%%4417*))

registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\Configuration\\EnableAt" and registry.data.strings : ("1", "0x00000001")

registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\Configuration\\EnableAt" and registry.data.strings : ("1", "0x00000001")

registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\Configuration\\EnableAt" and registry.data.strings == "1"

file where event.type != "deletion" and file.name: "com.apple.screensaver.*.plist" and file.path : ( "/Users/*/Library/Preferences/ByHost/*", "/Library/Managed Preferences/*", "/System/Library/Preferences/*" ) and /* Filter OS processes modifying screensaver plist files */ not process.executable : ( "/usr/sbin/cfprefsd", "/usr/libexec/xpcproxy", "/System/Library/CoreServices/ManagedClie nt.app/Contents/Resources/MCXCompositor", "/System/Library/CoreSer vices/ManagedClient.app/Contents/MacOS/ManagedClient" )

process where event.type == "start" and (process.pe.original_file_name:"vaultcmd.exe" or process.name:"vaultcmd.exe") and process.args:"/list*"

process where event.type in ("start", "process_started") and (process.pe.original_file_name:"vaultcmd.exe" or process.name:"vaultcmd.exe") and process.args:"/list*"

curl -X GET "&lt;kibana host&gt;:&lt;port&gt;/s/siem/api/detection_engine/rules/_find" -H 'kbn-xsrf: kibana' -u &lt;username&gt;:&lt;password&gt;

process where event.type == "start" and (process.name:"wmic.exe" or process.pe.original_file_name:"wmic.exe") and process.args:"/namespace:\\\\root\\SecurityCenter2" and process.args:"Get"

process where event.type in ("start", "process_started") and (process.name:"wmic.exe" or process.pe.original_file_name:"wmic.exe") and process.args:"/namespace:\\\\root\\SecurityCenter2" and process.args:"Get"

process where event.type == "start" and process.name : "grep" and user.id != "0" and not process.parent.executable : "/Library/Application Support/*" and process.args : ("Little Snitch*", "Avast*", "Avira*", "ESET*", "BlockBlock*", "360Sec*", "LuLu*", "KnockKnock*", "kav", "KIS", "RTProtectionDaemon*", "Malware*", "VShieldScanner*", "WebProtection*", "webinspectord*", "McAfee*", "isecespd*", "macmnsvc*", "masvc*", "kesl*", "avscan*", "guard*", "rtvscand*", "symcfgd*", "scmdaemon*", "symantec*", "sophos*", "osquery*", "elastic-endpoint*" ) and not (process.args : "Avast" and process.args : "Passwords")

event.category : process and event.type : (start or process_started) and process.name : grep and process.args : ("Little Snitch" or Avast* or Avira* or ESET* or esets_* or BlockBlock or 360* or LuLu or KnockKnock* or kav or KIS or RTProtectionDaemon or Malware* or VShieldScanner or WebProtection or webinspectord or McAfee* or isecespd* or macmnsvc* or masvc or kesl or avscan or guard or rtvscand or symcfgd or scmdaemon or symantec or elastic-endpoint )

event.category:process and event.type:start and process.name:(zip or tar or gzip or hdiutil or 7z) and process.args: ( /root/.ssh/id_rsa or /root/.ssh/id_rsa.pub or /root/.ssh/id_ed25519 or /root/.ssh/id_ed25519.pub or /root/.ssh/authorized_keys or /root/.ssh/authorized_keys2 or /root/.ssh/known_hosts or /root/.bash_history or /etc/hosts or /home/*/.ssh/id_rsa or /home/*/.ssh/id_rsa.pub or /home/*/.ssh/id_ed25519 or /home/*/.ssh/id_ed25519.pub or /home/*/.ssh/authorized_keys or /home/*/.ssh/authorized_keys2 or /home/*/.ssh/known_hosts or /home/*/.bash_history or /root/.aws/credentials or /root/.aws/config or /home/*/.aws/credentials or /home/*/.aws/config or /root/.docker/config.json or /home/*/.docker/config.json or /etc/group or /etc/passwd or /etc/shadow or /etc/gshadow )

event.action: "Authorization Policy Change" and event.code:4704 and winlog.event_data.PrivilegeList:"SeEnableDelegationPrivilege"

sequence by process.entity_id with maxspan = 1m [process where event.type == "start" and (process.name : "sc.exe" or process.pe.original_file_name : "sc.exe") and process.args : "\\\\*" and process.args : ("binPath=*", "binpath=*") and process.args : ("create", "config", "failure", "start")] [network where process.name : "sc.exe" and destination.ip != "127.0.0.1"]

sequence by process.entity_id with maxspan = 1m [process where event.type in ("start", "process_started") and (process.name : "sc.exe" or process.pe.original_file_name : "sc.exe") and process.args : "\\\\*" and process.args : ("binPath=*", "binpath=*") and process.args : ("create", "config", "failure", "start")] [network where process.name : "sc.exe" and destination.ip != "127.0.0.1"]

sequence by process.entity_id with maxspan=1m [process where event.type in ("start", "process_started") and /* uncomment once in winlogbeat */ (process.name == "sc.exe" /* or process.pe.original_file_name == "sc.exe" */ ) and /* case insensitive */ wildcard(process.args, "\\\\*") and wildcard(process.args, "binPath=*", "binpath=*") and (process.args : "create" or process.args : "config" or process.args : "failure" or process.args : "start")] [network where process.name : "sc.exe" and destination.ip != "127.0.0.1"]

process where event.type == "start" and (process.name : "sc.exe" or process.pe.original_file_name == "sc.exe") and process.parent.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe","powershell.exe", "pwsh.exe") and process.args:("config", "create", "start", "delete", "stop", "pause") and /* exclude SYSTEM SID - look for service creations by non-SYSTEM user */ not user.id : "S-1-5-18"

process where event.type == "start" and (process.name : "sc.exe" or process.pe.original_file_name == "sc.exe") and process.parent.name : ("cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe","powershell.exe", "pwsh.exe") and process.args:("config", "create", "start", "delete", "stop", "pause") and /* exclude SYSTEM SID - look for service creations by non-SYSTEM user */ not user.id : "S-1-5-18"

event.category:process and event.type:(start or process_started) and process.name:sc.exe and process.args:(config or create or failure or start)

event.action:"Process Create (rule: ProcessCreate)" and process.name:sc.exe and process.args:(config or create or failure or start)

event.action:"Process Create (rule: ProcessCreate)" and process.name:sc.exe and process.args:("create" or "config" or "failure" or "start")

sequence by host.id with maxspan=5m [authentication where /* event 4624 need to be logged */ event.action == "logged-in" and event.outcome == "success" and /* authenticate locally using relayed kerberos Ticket */ winlog.event_data.AuthenticationPackageName :"Kerberos" and winlog.logon.type == "Network" and cidrmatch(source.ip, "127.0.0.0/8", "::1") and source.port &gt; 0] by winlog.event_data.TargetLogonId [any where /* event 4697 need to be logged */ event.action : "service-installed"] by winlog.event_data.SubjectLogonId

event.category:process AND event.type:(start OR process_started) AND process.name:chmod AND process.args:("+s" OR "u+s" OR /4[0-9]{3}/ OR g+s OR /2[0-9]{3}/) AND NOT process.args: ( /.*\/Applications\/VirtualBox.app\/.+/ OR /\/usr\/local\/lib\/python.+/ OR /\/var\/folders\/.+\/FP.*nstallHelper/ OR /\/Library\/Filesystems\/.+/ OR /\/usr\/lib\/virtualbox\/.+/ OR /\/Library\/Application.*/ OR "/run/postgresql" OR "/var/crash" OR "/var/run/postgresql" OR /\/usr\/bin\/.+/ OR /\/usr\/local\/share\/.+/ OR /\/Applications\/.+/ OR /\/usr\/libexec\/.+/ OR "/var/metrics" OR /\/var\/lib\/dpkg\/.+/ OR /\/run\/log\/journal\/.*/ OR \/Users\/*\/.minikube\/bin\/docker-machine-driver-hyperkit ) AND NOT process.parent.executable: ( /\/var\/lib\/docker\/.+/ OR "/System/Library/PrivateFrame works/PackageKit.framework/Versions/A/XPCServices/package_script_servi ce.xpc/Contents/MacOS/package_script_service" OR "/var/lib/dpkg/info/whoopsie.postinst" )

event.category:process AND event.type:(start OR process_started) AND process.name:chmod AND process.args:("+s" OR "u+s" OR /4[0-9]{3}/ OR g+s OR /2[0-9]{3}/)

event.category:process AND event.type:(start or process_started) AND process.name:chmod AND process.args:(u+s OR /4[0-9]{3}/) AND NOT user.name:root

event.action:(executed OR process_started) AND process.name:chmod AND process.args:(u+s OR /4[0-9]{3}/) AND NOT user.name:root

process where event.type == "start" and event.action == "exec" and user.name == "root" and process.args : "/etc/shadow" and not process.executable: ("/usr/bin/find", "/usr/bin/cmp", "/bin/ls", "/usr/sbin/restorecon", "/usr/bin/uniq") and not process.parent.executable: "/bin/dracut"

event.dataset:o365.audit and event.provider:SharePoint and event.code:SharePointFileOperation and event.action:FileMalwareDetected

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "osascript"] by process.pid [process where event.type in ("start", "process_started") and process.name == "sh" and process.args == "-c"] by process.parent.pid

sequence by host.id with maxspan=5s [process where event.type in ("start", "process_started", "info") and process.name == "osascript"] by process.pid [process where event.type in ("start", "process_started") and process.name == "sh" and process.args == "-c"] by process.ppid

process where event.type == "start" and process.name : "control.exe" and process.parent.name : "WorkFolders.exe" and not process.executable : ("?:\\Windows\\System32\\control.exe", "?:\\Windows\\SysWOW64\\control.exe")

process where event.type in ("start","process_started") and process.name : "control.exe" and process.parent.name : "WorkFolders.exe" and not process.executable : ("?:\\Windows\\System32\\control.exe", "?:\\Windows\\SysWOW64\\control.exe")

registry where event.type:"change" and registry.path: ( "HKLM\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllPutSignedDataMsg\\{*}\\Dll", "HKLM\\SOFTWARE\\WOW643 2Node\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllPutSignedDataMsg\\{*}\\Dll", "HKLM\\SOFTWARE\\Micros oft\\Cryptography\\Providers\\Trust\\FinalPolicy\\{*}\\$Dll", "HKL M\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\Providers\\Trust\\F inalPolicy\\{*}\\$Dll" ) and registry.data.strings:"*.dll"

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(139 or 445) or event.dataset:zeek.smb) and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(139 or 445) or event.dataset:zeek.smb) and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(139 or 445) or event.dataset:zeek.smb) and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport:tcp and destination.port:(139 or 445) and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport: tcp and destination.port: (139 or 445) and ( network.direction: outbound or ( source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:26 or (event.dataset:zeek.smtp and destination.port:26))

event.category:(network or network_traffic) and network.transport:tcp and (destination.port:26 or (event.dataset:zeek.smtp and destination.port:26))

network.transport:tcp and destination.port:26

event.category:process and event.type:(start or process_started) and process.name:defaults and process.args:(write and "-bool" and (com.apple.SoftwareUpdate or /Library/Preferences/com.apple.SoftwareUpdate.plist) and not (TRUE or true))

event.category:process and event.type:(start or process_started) and process.name:defaults and process.args:(write and "-bool" and (com.apple.SoftwareUpdate or /Library/Preferences/com.apple.SoftwareUpdate.plist) and not (TRUE or true))

registry where registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\Start" and registry.data.strings : ("4", "0x00000004") and process.name : ( "SolarWinds.BusinessLayerHost*.exe", "ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe", "NetFlowService*.exe", "SolarWinds.Administration*.exe", "SolarWinds.Collector.Service*.exe" , "SolarwindsDiagnostics*.exe")

registry where registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\Start" and registry.data.strings : ("4", "0x00000004") and process.name : ( "SolarWinds.BusinessLayerHost*.exe", "ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe", "NetFlowService*.exe", "SolarWinds.Administration*.exe", "SolarWinds.Collector.Service*.exe" , "SolarwindsDiagnostics*.exe")

registry where registry.path : "HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\Start" and registry.data.strings == "4" and process.name : ( "SolarWinds.BusinessLayerHost*.exe", "ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe", "NetFlowService*.exe", "SolarWinds.Administration*.exe", "SolarWinds.Collector.Service*.exe" , "SolarwindsDiagnostics*.exe")

event.category:file and event.type:(change or creation) and file.name:("authorized_keys" or "authorized_keys2") and not process.executable: (/Library/Developer/CommandLineTools/usr/bin/git or /usr/local/Cellar/maven/*/libexec/bin/mvn or /Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or /usr/bin/vim or /usr/local/Cellar/coreutils/*/bin/gcat or /usr/bin/bsdtar or /usr/bin/nautilus or /usr/bin/scp or /usr/bin/touch or /var/lib/docker/* or /usr/bin/google_guest_agent)

event.category:file and event.type:(change or creation) and file.name:("authorized_keys" or "authorized_keys2") and not process.executable: (/Library/Developer/CommandLineTools/usr/bin/git or /usr/local/Cellar/maven/*/libexec/bin/mvn or /Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or /usr/bin/vim or /usr/local/Cellar/coreutils/*/bin/gcat or /usr/bin/bsdtar or /usr/bin/nautilus or /usr/bin/scp or /usr/bin/touch or /var/lib/docker/* or /usr/bin/google_guest_agent)

event.category:file and event.type:(change or creation) and file.name:("authorized_keys" or "authorized_keys2") and not process.executable: (/Library/Developer/CommandLineTools/usr/bin/git or /usr/local/Cellar/maven/*/libexec/bin/mvn or /Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or /usr/bin/vim or /usr/local/Cellar/coreutils/*/bin/gcat or /usr/bin/bsdtar or /usr/bin/nautilus or /usr/bin/scp or /usr/bin/touch or /var/lib/docker/*)

sequence by host.id, process.entity_id with maxspan=5s [process where event.type == "start" and process.code_signature.trusted == false and /* suspicious paths can be added here */ process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe", "C:\\Windows\\Temp\\*.exe", "C:\\Windows\\Tasks\\*.exe", "C:\\Intel\\*.exe", "C:\\PerfLogs\\*.exe") ] [file where event.type != "deletion" and user.domain != "NT AUTHORITY" and file.path : ("C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*", "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*") ]

sequence by host.id, process.entity_id with maxspan=5s [process where event.type in ("start", "process_started") and process.code_signature.trusted == false and /* suspicious paths can be added here */ process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe", "C:\\Windows\\Temp\\*.exe", "C:\\Windows\\Tasks\\*.exe", "C:\\Intel\\*.exe", "C:\\PerfLogs\\*.exe") ] [file where event.type != "deletion" and user.domain != "NT AUTHORITY" and file.path : ("C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*", "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*") ]

( event.code:5136 and winlog.event_data.AttributeLDAPDisplayName:(gPCMachineExtensionNames or gPCUserExtensionNames) and winlog.event_data.AttributeValue:(*42 B5FAAE-6536-11D2-AE5A-0000F87571E3* and (*40B66650-4972-11D1-A7CA-0000F87571E3* or *40B6664F-4972-11D1-A7CA-0000F87571E3*)) ) or ( event.code:5145 and winlog.event_data.ShareName:\\\\*\\SYSVOL and winlog.event_data.RelativeTargetName:(*\\scripts.ini or *\\psscripts.ini) and (message:WriteData or winlog.event_data.AccessList:*%%4417*) )

registry where registry.data.strings != null and registry.path : ( /* Machine Hive */ "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explore r\\Run\\*", "HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*", /* Users Hive */ "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion \\RunOnceEx\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\Cu rrentVersion\\Policies\\Explorer\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*" ) and /* add common legitimate changes without being too restrictive as this is one of the most abused AESPs */ not registry.data.strings : "ctfmon.exe /n" and not (registry.value : "Application Restart #*" and process.name : "csrss.exe") and user.id not in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and not registry.data.strings : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe") and not process.executable : ("?:\\Windows\\System32\\msiexec.exe", "?:\\Windows\\SysWOW64\\msiexec.exe") and not (process.name : "OneDriveSetup.exe" and registry.value : ("Delete Cached Standalone Update Binary", "Delete Cached Update Binary", "amd64", "Uninstall *") and registry.data.strings : "?:\\Windows\\system32\\cmd.exe /q /c * \"?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\*\"")

registry where registry.data.strings != null and registry.path : ( /* Machine Hive */ "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explore r\\Run\\*", "HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*", /* Users Hive */ "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersio n\\RunOnceEx\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\C urrentVersion\\Policies\\Explorer\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*" ) and /* add common legitimate changes without being too restrictive as this is one of the most abused AESPs */ not registry.data.strings : "ctfmon.exe /n" and not (registry.value : "Application Restart #*" and process.name : "csrss.exe") and user.id not in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and not registry.data.strings : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe") and not process.executable : ("?:\\Windows\\System32\\msiexec.exe", "?:\\Windows\\SysWOW64\\msiexec.exe") and not (process.name : "OneDriveSetup.exe" and registry.value : ("Delete Cached Standalone Update Binary", "Delete Cached Update Binary", "amd64", "Uninstall *") and registry.data.strings : "?:\\Windows\\system32\\cmd.exe /q /c * \"?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\*\"")

registry where /* length(registry.data.strings) &gt; 0 and */ registry.path : ( /* Machine Hive */ "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\*", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion \\Policies\\Explorer\\Run\\*", "HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*", /* Users Hive */ "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\ \*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersio n\\RunOnceEx\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\ CurrentVersion\\Explorer\\User Shell Folders\\*", "HKEY_USERS\\* \\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows\\Curre ntVersion\\Policies\\Explorer\\Run\\*", "HKEY_USERS\\*\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*" ) and /* add here common legit changes without making too restrictive as this is one of the most abused AESPs */ not registry.data.strings : "ctfmon.exe /n" and not (registry.value : "Application Restart #*" and process.name : "csrss.exe") and user.domain != "NT AUTHORITY" and not registry.data.strings : ("C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe")

file where event.type != "deletion" and user.domain != "NT AUTHORITY" and file.path : ("C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*", "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*") and process.name : ("cmd.exe", "powershell.exe", "wmic.exe", "mshta.exe", "pwsh.exe", "cscript.exe", "wscript.exe", "regsvr32.exe", "RegAsm.exe", "rundll32.exe", "EQNEDT32.EXE", "WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE", "iexplore.exe", "InstallUtil.exe")

file where event.type != "deletion" and user.domain != "NT AUTHORITY" and file.path : ("C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*", "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*") and process.name : ("cmd.exe", "powershell.exe", "wmic.exe", "mshta.exe", "pwsh.exe", "cscript.exe", "wscript.exe", "regsvr32.exe", "RegAsm.exe", "rundll32.exe", "EQNEDT32.EXE", "WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE", "iexplore.exe", "InstallUtil.exe")

file where event.type in ("change", "creation") and file.extension : "py" and file.path : ( "/Users/*/Library/Application Support/Sublime Text*/Packages/*.py", "/Applications/Sublime Text.app/Contents/MacOS/sublime.py" ) and not process.executable : ( "/Applications/Sublime Text*.app/Contents/*", "/usr/local/Cellar/git/*/bin/git", "/Library/Developer/CommandLineTools/usr/bin/git", "/usr/libexec/xpcproxy", "/System/Library/PrivateFrameworks/Desk topServicesPriv.framework/Versions/A/Resources/DesktopServicesHelper" )

file where event.type in ("change", "creation") and file.extension : "py" and file.path : ( "/Users/*/Library/Application Support/Sublime Text*/Packages/*.py", "/Applications/Sublime Text.app/Contents/MacOS/sublime.py" ) and not process.executable : ( "/Applications/Sublime Text*.app/Contents/MacOS/Sublime Text*", "/usr/local/Cellar/git/*/bin/git", "/usr/libexec/xpcproxy", "/System/Library/PrivateFrameworks/Des ktopServicesPriv.framework/Versions/A/Resources/DesktopServicesHelper" , "/Applications/Sublime Text.app/Contents/MacOS/plugin_host" )

event.category:file and event.type:change and file.path:(/etc/sudoers* or /private/etc/sudoers*)

event.category:file and event.type:change and file.path:/etc/sudoers

event.module:file_integrity and event.action:updated and file.path:/etc/sudoers

event.category:process and event.type:start and process.name:(sudo or sudoedit) and process.args:(*\\ and ("-i" or "-s"))

network where event.type == "protocol" and network.protocol == "http" and process.name : ("ConfigurationWizard.exe", "NetFlowService.exe", "NetflowDatabaseMaintenance.exe", "SolarWinds.Administration.exe", "SolarWinds.BusinessLayerHost.exe", "SolarWinds.BusinessLayerHostx64.exe", "SolarWinds.Collector.Service.exe", "SolarwindsDiagnostics.exe") and ( ( (http.request.body.content : "*/swip/Upload.ashx*" and http.request.body.content : ("POST*", "PUT*")) or (http.request.body.content : ("*/swip/SystemDescription*", "*/swip/Events*") and http.request.body.content : ("GET*", "HEAD*")) ) and not http.request.body.content : "*solarwinds.com*" )

network where event.type == "protocol" and network.protocol == "http" and process.name : ("ConfigurationWizard.exe", "NetFlowService.exe", "NetflowDatabaseMaintenance.exe", "SolarWinds.Administration.exe", "SolarWinds.BusinessLayerHost.exe", "SolarWinds.BusinessLayerHostx64.exe", "SolarWinds.Collector.Service.exe", "SolarwindsDiagnostics.exe") and (http.request.body.content : "*/swip/Upload.ashx*" and http.request.body.content : ("POST*", "PUT*")) or (http.request.body.content : ("*/swip/SystemDescription*", "*/swip/Events*") and http.request.body.content : ("GET*", "HEAD*")) and not http.request.body.content : "*solarwinds.com*"

event.category:network and event.type:protocol and network.protocol:http and process.name:( ConfigurationWizard.exe or NetFlowService.exe or NetflowDatabaseMaintenance.exe or SolarWinds.Administration.exe or SolarWinds.BusinessLayerHost.exe or SolarWinds.BusinessLayerHostx64.exe or SolarWinds.Collector.Service.exe or SolarwindsDiagnostics.exe) and http.request.body.content:(( (*/swip/Upload.ashx* and (POST* or PUT*)) or (*/swip/SystemDescription* and (GET* or HEAD*)) or (*/swip/Events* and (GET* or HEAD*))) and not *solarwinds.com*)

process where event.type == "start" and process.name : ("csc.exe", "vbc.exe") and process.parent.name : ("wscript.exe", "mshta.exe", "cscript.exe", "wmic.exe", "svchost.exe", "rundll32.exe", "cmstp.exe", "regsvr32.exe")

process where event.type in ("start", "process_started") and process.name : ("csc.exe", "vbc.exe") and process.parent.name : ("wscript.exe", "mshta.exe", "cscript.exe", "wmic.exe", "svchost.exe", "rundll32.exe", "cmstp.exe", "regsvr32.exe")

event.category:process and event.type:(start or process_started) and process.name:(csc.exe or vbc.exe) and process.parent.name:(wscript.exe or mshta.exe or wscript.exe or wmic.exe or svchost.exe or rundll32.exe or cmstp.exe or regsvr32.exe)

event.category:process and powershell.file.script_block_text : ( "[System.Reflection.Assembly]::Load" or "[Reflection.Assembly]::Load" )

event.category:process and powershell.file.script_block_text : ( "[System.Reflection.Assembly]::Load" or "[Reflection.Assembly]::Load" )

event.dataset:okta.system and event.action:user.account.report_suspicious_activity_by_enduser

event.module:okta and event.dataset:okta.system and event.action:user.account.report_suspicious_activity_by_enduser

sequence by host.id with maxspan=30s [process where event.type in ("start", "process_started") and process.name == "automator"] [network where process.name:"com.apple.automator.runner"]

process where event.type in ("start", "process_started") and process.parent.name : ("Google Chrome", "Google Chrome Helper*", "firefox", "Opera", "Safari", "com.apple.WebKit.WebContent", "Microsoft Edge") and process.name : ("sh", "bash", "dash", "ksh", "tcsh", "zsh", "curl", "wget", "python*", "perl*", "php*", "osascript", "pwsh") and process.command_line != null and not process.command_line : "*/Library/Application Support/Microsoft/MAU*/Microsoft AutoUpdate.app/Contents/MacOS/msupdate*" and not process.args : ( "hw.model", "IOPlatformExpertDevice", "/Volumes/Google Chrome/Google Chrome.app/Contents/Frameworks/*/Resources/install.sh", "-- defaults-torrc", "*Chrome.app", "Framework.framework/Versi ons/*/Resources/keystone_promote_preflight.sh", "/Users/*/Library/Application Support/Google/Chrome/recovery/*/ChromeRecovery", "$DISPLAY", "*GIO_LAUNCHED_DESKTOP_FILE_PID=$$*", "/opt/homebrew/*", "/usr/local/*brew*" )

process where event.type in ("start", "process_started") and process.parent.name : ("Google Chrome", "Google Chrome Helper*", "firefox", "Opera", "Safari", "com.apple.WebKit.WebContent", "Microsoft Edge") and process.name : ("sh", "bash", "dash", "ksh", "tcsh", "zsh", "curl", "wget", "python*", "perl*", "php*", "osascript", "pwsh") and process.command_line != null and not process.args : ( "/Library/Application Support/Microsoft/MAU*/Microsoft AutoUpdate.app/Contents/MacOS/msupdate", "hw.model", "IOPlatformExpertDevice", "/Volumes/Google Chrome/Google Chrome.app/Contents/Frameworks/*/Resources/install.sh", "-- defaults-torrc", "Chrome.app", "Framework.framework/Vers ions/*/Resources/keystone_promote_preflight.sh", "/Users/*/Library/Application Support/Google/Chrome/recovery/*/ChromeRecovery", "$DISPLAY", "GIO_LAUNCHED_DESKTOP_FILE_PID=$$" )

event.category:file and event.action:modification and file.path:/Users/*/Library/Calendars/*.calendar/Events/*.ics and process.executable: (* and not ( /System/Library/* or /System/Applications/Calendar.app/Contents/MacOS/* or /System/Applications/Mail.app/Contents/MacOS/Mail or /usr/libexec/xpcproxy or /sbin/launchd or /Applications/* ) )

event.category:file and event.action:modification and file.path:/Users/*/Library/Calendars/*.calendar/Events/*.ics and process.executable: (* and not ( /System/Library/* or /System/Applications/Calendar.app/Contents/MacOS/* or /usr/libexec/xpcproxy or /sbin/launchd or /Applications/* ) )

process where event.type == "start" and (process.name : "certutil.exe" or process.pe.original_file_name == "CertUtil.exe") and process.args : ("?decode", "?encode", "?urlcache", "?verifyctl", "?encodehex", "?decodehex", "?exportPFX")

process where event.type == "start" and (process.name : "certutil.exe" or process.pe.original_file_name == "CertUtil.exe") and process.args : ("?decode", "?encode", "?urlcache", "?verifyctl", "?encodehex", "?decodehex", "?exportPFX")

process where event.type == "start" and (process.name : "certutil.exe" or process.pe.original_file_name == "CertUtil.exe") and process.args : ("?decode", "?encode", "?urlcache", "?verifyctl", "?encodehex", "?decodehex")

process where event.type == "start" and (process.name : "certutil.exe" or process.pe.original_file_name == "CertUtil.exe") and process.args : ("?decode", "?encode")

event.category:process and event.type:(start or process_started) and process.name:certutil.exe and process.args:(-decode or -encode or /decode or /encode)

event.action:"Process Create (rule: ProcessCreate)" and process.name:certutil.exe and process.args:(-decode or -encode or /decode or /encode)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"certutil.exe" and process.args:("-encode" or "/encode" or "-decode" or "/decode")

event.category:process and event.type:(start or process_started) and process.parent.name:com.adobe.ARMDC.SMJobBlessHelper and user.name:root and not process.executable: (/Library/PrivilegedHelperTools/com.adobe.ARMDC.SMJobBlessHelper or /usr/bin/codesign or /private/var/folders/zz/*/T/download/ARMDCHammer or /usr/sbin/pkgutil or /usr/bin/shasum or /usr/bin/perl* or /usr/sbin/spctl or /usr/sbin/installer or /usr/bin/csrutil)

event.category:process and event.type:(start or process_started) and process.parent.name:com.adobe.ARMDC.SMJobBlessHelper and user.name:root and not process.executable: (/Library/PrivilegedHelperTools/com.adobe.ARMDC.SMJobBlessHelper or /usr/bin/codesign or /private/var/folders/zz/*/T/download/ARMDCHammer or /usr/sbin/pkgutil or /usr/bin/shasum or /usr/bin/perl* or /usr/sbin/spctl or /usr/sbin/installer)

process where event.type == "start" and process.parent.name : "WmiPrvSE.exe" and process.name : "cmd.exe" and process.args : "\\\\127.0.0.1\\*" and process.args : ("2&gt;&amp;1", "1&gt;")

process where event.type in ("start", "process_started") and process.parent.name : "WmiPrvSE.exe" and process.name : "cmd.exe" and process.args : "\\\\127.0.0.1\\*" and process.args : ("2&gt;&amp;1", "1&gt;")

process where event.type in ("start", "process_started") and process.parent.name == "WmiPrvSE.exe" and process.name == "cmd.exe" and wildcard(process.args, "\\\\127.0.0.1\\*") and process.args in ("2&gt;&amp;1", "1&gt;")

file where event.type != "deletion" and process.name != null and file.path : "/private/var/at/tabs/*" and not process.executable == "/usr/bin/crontab"

file where event.type != "deletion" and process.name != null and file.path : "/private/var/at/tabs/*" and not process.executable == "/usr/bin/crontab"

any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and ( /* compatible with Elastic Endpoint Library Events */ (dll.name : ("wlbsctrl.dll", "wbemcomn.dll", "WptsExtensions.dll", "Tsmsisrv.dll", "TSVIPSrv.dll", "Msfte.dll", "wow64log.dll", "WindowsCoreDeviceInfo.dll", "Ualapi.dll", "wlanhlp.dll", "phoneinfo.dll", "EdgeGdi.dll", "cdpsgshims.dll", "windowsperformancerecordercontrol.dll", "diagtrack_win.dll") and (dll.code_signature.trusted == false or dll.code_signature.exists == false)) or /* compatible with Sysmon EventID 7 - Image Load */ (file.name : ("wlbsctrl.dll", "wbemcomn.dll", "WptsExtensions.dll", "Tsmsisrv.dll", "TSVIPSrv.dll", "Msfte.dll", "wow64log.dll", "WindowsCoreDeviceInfo.dll", "Ualapi.dll", "wlanhlp.dll", "phoneinfo.dll", "EdgeGdi.dll", "cdpsgshims.dll", "windowsperformancerecordercontrol.dll", "diagtrack_win.dll") and not file.code_signature.status == "Valid") )

library where dll.name : ( "wlbsctrl.dll", "wbemcomn.dll", "WptsExtensions.dll", "Tsmsisrv.dll", "TSVIPSrv.dll", "Msfte.dll", "wow64log.dll", "WindowsCoreDeviceInfo.dll", "Ualapi.dll", "wlanhlp.dll", "phoneinfo.dll", "EdgeGdi.dll", "cdpsgshims.dll", "windowsperformancerecordercontrol.dll", "diagtrack_win.dll" ) and not (dll.code_signature.subject_name : ("Microsoft Windows", "Microsoft Corporation") and dll.code_signature.status : "trusted")

library where dll.name : ( "wlbsctrl.dll", "wbemcomn.dll", "WptsExtensions.dll", "Tsmsisrv.dll", "TSVIPSrv.dll", "Msfte.dll", "wow64log.dll", "WindowsCoreDeviceInfo.dll", "Ualapi.dll", "wlanhlp.dll", "phoneinfo.dll", "EdgeGdi.dll", "cdpsgshims.dll", "windowsperformancerecordercontrol.dll", "diagtrack_win.dll" ) and not (dll.code_signature.subject_name : "Microsoft Windows" and dll.code_signature.status : "trusted")

process where event.type in ("start", "process_started") and process.parent.name : "emond" and process.name : ( "bash", "dash", "sh", "tcsh", "csh", "zsh", "ksh", "fish", "Python", "python*", "perl*", "php*", "osascript", "pwsh", "curl", "wget", "cp", "mv", "touch", "echo", "base64", "launchctl")

process where event.type == "start" and process.name : ("esensor.exe", "elastic-endpoint.exe") and process.parent.executable != null and /* add FPs here */ not process.parent.executable : ("C:\\Program Files\\Elastic\\*", "C:\\Windows\\System32\\services.exe", "C:\\Windows\\System32\\WerFault*.exe", "C:\\Windows\\System32\\wermgr.exe")

process where event.type in ("start", "process_started", "info") and process.name : ("esensor.exe", "elastic-endpoint.exe") and process.parent.executable != null and /* add FPs here */ not process.parent.executable : ("C:\\Program Files\\Elastic\\*", "C:\\Windows\\System32\\services.exe", "C:\\Windows\\System32\\WerFault*.exe", "C:\\Windows\\System32\\wermgr.exe")

process where event.type in ("start", "process_started", "info") and process.name : ("esensor.exe", "elastic-endpoint.exe") and process.parent.executable != null and /* add FPs here */ not process.parent.executable : ("C:\\Program Files\\Elastic\\*", "C:\\Windows\\System32\\services.exe", "C:\\Windows\\System32\\WerFault*.exe", "C:\\Windows\\System32\\wermgr.exe")

event.category:process and event.type:(start or process_started) and process.name:(esensor.exe or "elastic-endpoint.exe" or "elastic- agent.exe") and not process.parent.executable:"C:\Windows\System32\services.exe"

process where event.type == "start" and process.executable : "C:\\*" and (process.working_directory : "?:\\" and not process.working_directory: "C:\\") and process.parent.name : "explorer.exe" and process.name : ("rundll32.exe", "mshta.exe", "powershell.exe", "pwsh.exe", "cmd.exe", "regsvr32.exe", "cscript.exe", "wscript.exe")

process where event.type == "start" and length(process.name) &gt; 0 and length(process.name) == 5 and host.os.name == "Windows" and length(process.pe.original_file_name) &gt; 5

process where event.type in ("start", "process_started") and length(process.name) &gt; 0 and length(process.name) == 5 and host.os.name == "Windows" and length(process.pe.original_file_name) &gt; 5

process where event.type == "start" and /* Schedule service cmdline on Win10+ */ process.parent.name : "svchost.exe" and process.parent.args : "Schedule" and /* add suspicious programs here */ process.pe.original_file_name in ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) and /* add suspicious paths here */ process.args : ( "C:\\Users\\*", "C:\\ProgramData\\*", "C:\\Windows\\Temp\\*", "C:\\Windows\\Tasks\\*", "C:\\PerfLogs\\*", "C:\\Intel\\*", "C:\\Windows\\Debug\\*", "C:\\HP\\*") and not (process.name : "cmd.exe" and process.args : "?:\\*.bat" and process.working_directory : "?:\\Windows\\System32\\") and not (process.name : "cscript.exe" and process.args : "?:\\Windows\\system32\\calluxxprovider.vbs") and not (process.name : "powershell.exe" and process.args : ("-File", "-PSConsoleFile") and user.id : "S-1-5-18") and not (process.name : "msiexec.exe" and user.id : "S-1-5-18")

process where event.type == "start" and /* Schedule service cmdline on Win10+ */ process.parent.name : "svchost.exe" and process.parent.args : "Schedule" and /* add suspicious programs here */ process.pe.original_file_name in ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) and /* add suspicious paths here */ process.args : ( "C:\\Users\\*", "C:\\ProgramData\\*", "C:\\Windows\\Temp\\*", "C:\\Windows\\Tasks\\*", "C:\\PerfLogs\\*", "C:\\Intel\\*", "C:\\Windows\\Debug\\*", "C:\\HP\\*")

process where event.type == "start" and /* Schedule service cmdline on Win10+ */ process.parent.name : "svchost.exe" and process.parent.args : "Schedule" and /* add suspicious programs here */ process.pe.original_file_name in ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) and /* add suspicious paths here */ process.args : ( "C:\\Users\\*", "C:\\ProgramData\\*", "C:\\Windows\\Temp\\*", "C:\\Windows\\Tasks\\*", "C:\\PerfLogs\\*", "C:\\Intel\\*", "C:\\Windows\\Debug\\*", "C:\\HP\\*")

process where event.type == "start" and ( process.name : ("cscript.exe", "wscript.exe", "powershell.exe", "rundll32.exe", "cmd.exe", "mshta.exe", "regsvr32.exe") or process.pe.original_file_name in ("cscript.exe", "wscript.exe", "PowerShell.EXE", "RUNDLL32.EXE", "Cmd.Exe", "MSHTA.EXE", "REGSVR32.EXE") ) and /* Explorer started via DCOM */ process.parent.name : "explorer.exe" and process.parent.args : "-Embedding" and not process.parent.args: ( /* Noisy CLSID_SeparateSingleProcessExplorerHost Explorer COM Class IDs */ "/factory,{5BD95610-9434-43C2-886C-57852CC8A120}", "/factory,{ceff45ee-c862-41de-aee2-a022c81eda92}" )

process where event.type in ("start", "process_started") and ( process.name : ("cscript.exe", "wscript.exe", "powershell.exe", "rundll32.exe", "cmd.exe", "mshta.exe", "regsvr32.exe") or process.pe.original_file_name in ("cscript.exe", "wscript.exe", "PowerShell.EXE", "RUNDLL32.EXE", "Cmd.Exe", "MSHTA.EXE", "REGSVR32.EXE") ) and /* Explorer started via DCOM */ process.parent.name : "explorer.exe" and process.parent.args : "-Embedding" and not process.parent.args: ( /* Noisy CLSID_SeparateSingleProcessExplorerHost Explorer COM Class IDs */ "/factory,{5BD95610-9434-43C2-886C-57852CC8A120}", "/factory,{ceff45ee-c862-41de-aee2-a022c81eda92}" )

process where event.type in ("start", "process_started") and process.name : ("cscript.exe", "wscript.exe", "powershell.exe", "rundll32.exe", "cmd.exe", "mshta.exe", "regsvr32.exe") and /* Explorer started via DCOM */ process.parent.name : "explorer.exe" and process.parent.args : "-Embedding"

file where event.action == "creation" and user.name == "root" and file.path : ("/etc/ld.so.conf.d/*", "/etc/cron.d/*", "/etc/sudoers.d/*", "/etc/rc.d/init.d/*", "/etc/systemd/system/*") and not process.executable : ("*/dpkg", "*/yum", "*/apt", "*/dnf", "*/systemd")

event.category:process and event.type:(start or process_started) and process.name:.* and process.parent.executable:/sbin/launchd

sequence by user.id with maxspan=5m [file where event.action in ("creation", "rename") and file.extension : ("htm", "html") and file.path : ("?:\\Users\\*\\Downloads\\*", "?:\\Users\\*\\Content.Outlook\\*", "?:\\Users\\*\\AppData\\Local\\Temp\\Temp?_*", "?:\\Users\\*\\AppData\\Local\\Temp\\7z*", "?:\\Users\\*\\AppData\\Local\\Temp\\Rar$*") and ((file.Ext.entropy &gt;= 5 and file.size &gt;= 150000) or file.size &gt;= 1000000)] [process where event.action == "start" and ( (process.name in ("chrome.exe", "msedge.exe", "brave.exe", "whale.exe", "browser.exe", "dragon.exe", "vivaldi.exe", "opera.exe") and process.args == "-- single-argument") or (process.name == "iexplore.exe" and process.args_count == 2) or (process.name in ("firefox.exe", "waterfox.exe") and process.args == "-url") ) and process.args : ("?:\\Users\\*\\Downloads\\*.htm*", "?:\\Users\\*\\Content.Outlook\\*.htm*", "?:\\Users\\*\\AppData\\Local\\Temp\\Temp?_*.htm*", "?:\\Users\\*\\AppData\\Local\\Temp\\7z*.htm*", "?:\\Users\\*\\AppData\\Local\\Temp\\Rar$*.htm*")]

any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and process.name : ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and (dll.name : "taskschd.dll" or file.name : "taskschd.dll")

library where process.name : ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and event.action : "load" and event.category : "library" and dll.name : "taskschd.dll"

library where process.name in ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and event.action == "load" and event.category == "library" and file.name == "taskschd.dll"

registry where registry.path : "HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ImagePath" and /* add suspicious registry ImagePath values here */ registry.data.strings : ("%COMSPEC%*", "*\\.\\pipe\\*")

process where event.type in ("start", "process_started") and process.parent.name : "java" and process.name : ("sh", "bash", "dash", "ksh", "tcsh", "zsh", "curl", "wget")

process where event.type in ("start", "process_started") and process.parent.name : "java" and process.name : ("sh", "bash", "dash", "ksh", "tcsh", "zsh", "curl", "wget") and process.args : "-jar" and process.args : "*.jar" and /* Add any FP's here */ not process.executable : ("/Users/*/.sdkman/*", "/Library/Java/JavaVirtualMachines/*") and not process.args : ("/usr/local/*", "/Users/*/github.com/*", "/Users/*/src/*")

process where event.code == "10" and winlog.event_data.TargetImage : "?:\\WINDOWS\\system32\\lsass.exe" and /* seclogon service accessing lsass */ winlog.event_data.CallTrace : "*seclogon.dll*" and process.name : "svchost.exe" and /* PROCESS_CREATE_PROCESS &amp; PROCESS_DUP_HANDLE &amp; PROCESS_QUERY_INFORMATION */ winlog.event_data.GrantedAccess == "0x14c0"

process where event.type in ("start", "process_started") and process.parent.name:("Microsoft Word", "Microsoft PowerPoint", "Microsoft Excel") and process.name: ( "bash", "dash", "sh", "tcsh", "csh", "zsh", "ksh", "fish", "python*", "perl*", "php*", "osascript", "pwsh", "curl", "wget", "cp", "mv", "base64", "launchctl" ) and /* noisy false positives related to product version discovery and office errors reporting */ not process.args: ( "ProductVersion", "hw.model", "ioreg", "ProductName", "ProductUserVisibleVersion", "ProductBuildVersion", "/Library/Application Support/Microsoft/MERP*/Microsoft Error Reporting.app/Contents/MacOS/Microsoft Error Reporting" )

process where event.type in ("start", "process_started") and process.parent.name:("Microsoft Word", "Microsoft PowerPoint", "Microsoft Excel") and process.name: ( "bash", "dash", "sh", "tcsh", "csh", "zsh", "ksh", "fish", "python*", "perl*", "php*", "osascript", "pwsh", "curl", "wget", "cp", "mv", "base64", "launchctl" ) and /* noisy false positives related to product version discovery and office errors reporting */ not process.args: ( "ProductVersion", "hw.model", "ioreg", "ProductName", "ProductUserVisibleVersion", "ProductBuildVersion", "/Library/Application Support/Microsoft/MERP*/Microsoft Error Reporting.app/Contents/MacOS/Microsoft Error Reporting" )

process where event.type in ("start", "process_started") and process.parent.name:("Microsoft Word", "Microsoft PowerPoint", "Microsoft Excel") and process.name: ( "bash", "dash", "sh", "tcsh", "csh", "zsh", "ksh", "fish", "python*", "perl*", "php*", "osascript", "pwsh", "curl", "wget", "cp", "mv", "base64", "launchctl" )

sequence by process.entity_id with maxspan=5m [process where event.type == "start" and process.name : ("wscript.exe", "cscript.exe", "mshta.exe", "wmic.exe", "regsvr32.exe", "svchost.exe", "dllhost.exe", "cmstp.exe")] [file where event.type != "deletion" and file.name : ("wscript.exe.log", "cscript.exe", "mshta.exe.log", "wmic.exe.log", "svchost.exe.log", "dllhost.exe.log", "cmstp.exe.log", "regsvr32.exe.log")]

sequence by process.entity_id with maxspan=5m [process where event.type == "start" and process.name : ("wscript.exe", "cscript.exe", "mshta.exe", "wmic.exe", "regsvr32.exe", "svchost.exe", "dllhost.exe", "cmstp.exe")] [file where event.type != "deletion" and file.name : ("wscript.exe.log", "cscript.exe", "mshta.exe.log", "wmic.exe.log", "svchost.exe.log", "dllhost.exe.log", "cmstp.exe.log", "regsvr32.exe.log")]

event.category:file and not event.type:deletion and file.name:(wscript.exe.log or mshta.exe.log or wscript.exe.log or wmic.exe.log or svchost.exe.log or dllhost.exe.log or cmstp.exe.log or regsvr32.exe.log)

process where event.type == "start" and (process.pe.original_file_name == "msdt.exe" or process.name : "msdt.exe") and ( process.args : ("IT_RebrowseForFile=*", "ms- msdt:/id", "ms-msdt:-id", "*FromBase64*") or (process.args : "-af" and process.args : "/skip" and process.parent.name : ("explorer.exe", "cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe", "rundll32.exe", "regsvr32.exe") and process.args : ("?:\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml", "PCWDiagnostic.xml", "?:\\Users\\Public\\*", "?:\\Windows\\Temp\\*")) or (process.pe.original_file_name == "msdt.exe" and not process.name : "msdt.exe" and process.name != null) or (process.pe.original_file_name == "msdt.exe" and not process.executable : ("?:\\Windows\\system32\\msdt.exe", "?:\\Windows\\SysWOW64\\msdt.exe")) )

process where event.type in ("start", "process_started") and (process.pe.original_file_name == "msdt.exe" or process.name : "msdt.exe") and ( process.args : ("IT_RebrowseForFile=*", "ms- msdt:/id", "ms-msdt:-id", "*FromBase64*") or (process.args : "-af" and process.args : "/skip" and process.parent.name : ("explorer.exe", "cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe", "rundll32.exe", "regsvr32.exe") and process.args : ("?:\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml", "PCWDiagnostic.xml", "?:\\Users\\Public\\*", "?:\\Windows\\Temp\\*")) or (process.pe.original_file_name == "msdt.exe" and not process.name : "msdt.exe" and process.name != null) or (process.pe.original_file_name == "msdt.exe" and not process.executable : ("?:\\Windows\\system32\\msdt.exe", "?:\\Windows\\SysWOW64\\msdt.exe")) )

process where event.type in ("start", "process_started") and (process.pe.original_file_name == "msdt.exe" or process.name : "msdt.exe") and ( process.args : ("IT_RebrowseForFile=*", "ms- msdt:/id", "ms-msdt:-id", "*FromBase64*") or (process.args : "-af" and process.args : "/skip" and process.parent.name : ("explorer.exe", "cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe", "rundll32.exe", "regsvr32.exe") and process.args : ("?:\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml", "PCWDiagnostic.xml", "?:\\Users\\Public\\*", "?:\\Windows\\Temp\\*")) or (process.pe.original_file_name == "msdt.exe" and not process.name : "msdt.exe" and process.name != null) or (process.pe.original_file_name == "msdt.exe" and not process.executable : ("?:\\Windows\\system32\\msdt.exe", "?:\\Windows\\SysWOW64\\msdt.exe")) )

process where event.type == "start" and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe", "outlook.exe") and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "control.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe", "msdt.exe")

process where event.type in ("start", "process_started") and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe", "outlook.exe") and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "control.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe", "msdt.exe")

process where event.type in ("start", "process_started") and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe", "outlook.exe") and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "control.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe", "msdt.exe")

process where event.type in ("start", "process_started") and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe") and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "control.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe")

process where event.type in ("start", "process_started") and process.parent.name : ("eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe") and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:(eqnedt32.exe or excel.exe or fltldr.exe or msaccess.exe or mspub.exe or powerpnt.exe or winword.exe) and process.name:(Microsoft.Workflow.Compiler.exe or arp.exe or atbroker.exe or bginfo.exe or bitsadmin.exe or cdb.exe or certutil.exe or cmd.exe or cmstp.exe or cscript.exe or csi.exe or dnx.exe or dsget.exe or dsquery.exe or forfiles.exe or fsi.exe or ftp.exe or gpresult.exe or hostname.exe or ieexec.exe or iexpress.exe or installutil.exe or ipconfig.exe or mshta.exe or msxsl.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or odbcconf.exe or ping.exe or powershell.exe or pwsh.exe or qprocess.exe or quser.exe or qwinsta.exe or rcsi.exe or reg.exe or regasm.exe or regsvcs.exe or regsvr32.exe or sc.exe or schtasks.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or wmic.exe or wscript.exe or xwizard.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:(eqnedt32.exe or excel.exe or fltldr.exe or msaccess.exe or mspub.exe or powerpnt.exe or winword.exe) and process.name:(Microsoft.Workflow.Compiler.exe or arp.exe or atbroker.exe or bginfo.exe or bitsadmin.exe or cdb.exe or certutil.exe or cmd.exe or cmstp.exe or cscript.exe or csi.exe or dnx.exe or dsget.exe or dsquery.exe or forfiles.exe or fsi.exe or ftp.exe or gpresult.exe or hostname.exe or ieexec.exe or iexpress.exe or installutil.exe or ipconfig.exe or mshta.exe or msxsl.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or odbcconf.exe or ping.exe or powershell.exe or pwsh.exe or qprocess.exe or quser.exe or qwinsta.exe or rcsi.exe or reg.exe or regasm.exe or regsvcs.exe or regsvr32.exe or sc.exe or schtasks.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or wmic.exe or wscript.exe or xwizard.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:("winword.exe" or "excel.exe" or "powerpnt.exe" or "eqnedt32.exe" or "fltldr.exe" or "mspub.exe" or "msaccess.exe") and process.name:("arp.exe" or "dsquery.exe" or "dsget.exe" or "gpresult.exe" or "hostname.exe" or "ipconfig.exe" or "nbtstat.exe" or "net.exe" or "net1.exe" or "netsh.exe" or "netstat.exe" or "nltest.exe" or "ping.exe" or "qprocess.exe" or "quser.exe" or "qwinsta.exe" or "reg.exe" or "sc.exe" or "systeminfo.exe" or "tasklist.exe" or "tracert.exe" or "whoami.exe" or "bginfo.exe" or "cdb.exe" or "cmstp.exe" or "csi.exe" or "dnx.exe" or "fsi.exe" or "ieexec.exe" or "iexpress.exe" or "installutil.exe" or "Microsoft.Workflow.Compiler.exe" or "msbuild.exe" or "mshta.exe" or "msxsl.exe" or "odbcconf.exe" or "rcsi.exe" or "regsvr32.exe" or "xwizard.exe" or "atbroker.exe" or "forfiles.exe" or "schtasks.exe" or "regasm.exe" or "regsvcs.exe" or "cmd.exe" or "cscript.exe" or "powershell.exe" or "pwsh.exe" or "wmic.exe" or "wscript.exe" or "bitsadmin.exe" or "certutil.exe" or "ftp.exe")

process where event.type == "start" and process.parent.name : "outlook.exe" and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe")

process where event.type in ("start", "process_started") and process.parent.name : "outlook.exe" and process.name : ("Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:outlook.exe and process.name:(Microsoft.Workflow.Compiler.exe or arp.exe or atbroker.exe or bginfo.exe or bitsadmin.exe or cdb.exe or certutil.exe or cmd.exe or cmstp.exe or cscript.exe or csi.exe or dnx.exe or dsget.exe or dsquery.exe or forfiles.exe or fsi.exe or ftp.exe or gpresult.exe or hostname.exe or ieexec.exe or iexpress.exe or installutil.exe or ipconfig.exe or mshta.exe or msxsl.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or odbcconf.exe or ping.exe or powershell.exe or pwsh.exe or qprocess.exe or quser.exe or qwinsta.exe or rcsi.exe or reg.exe or regasm.exe or regsvcs.exe or regsvr32.exe or sc.exe or schtasks.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or wmic.exe or wscript.exe or xwizard.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:outlook.exe and process.name:(Microsoft.Workflow.Compiler.exe or arp.exe or atbroker.exe or bginfo.exe or bitsadmin.exe or cdb.exe or certutil.exe or cmd.exe or cmstp.exe or cscript.exe or csi.exe or dnx.exe or dsget.exe or dsquery.exe or forfiles.exe or fsi.exe or ftp.exe or gpresult.exe or hostname.exe or ieexec.exe or iexpress.exe or installutil.exe or ipconfig.exe or mshta.exe or msxsl.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or odbcconf.exe or ping.exe or powershell.exe or pwsh.exe or qprocess.exe or quser.exe or qwinsta.exe or rcsi.exe or reg.exe or regasm.exe or regsvcs.exe or regsvr32.exe or sc.exe or schtasks.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or wmic.exe or wscript.exe or xwizard.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:"outlook.exe" and process.name:("arp.exe" or "dsquery.exe" or "dsget.exe" or "gpresult.exe" or "hostname.exe" or "ipconfig.exe" or "nbtstat.exe" or "net.exe" or "net1.exe" or "netsh.exe" or "netstat.exe" or "nltest.exe" or "ping.exe" or "qprocess.exe" or "quser.exe" or "qwinsta.exe" or "reg.exe" or "sc.exe" or "systeminfo.exe" or "tasklist.exe" or "tracert.exe" or "whoami.exe" or "bginfo.exe" or "cdb.exe" or "cmstp.exe" or "csi.exe" or "dnx.exe" or "fsi.exe" or "ieexec.exe" or "iexpress.exe" or "installutil.exe" or "Microsoft.Workflow.Compiler.exe" or "msbuild.exe" or "mshta.exe" or "msxsl.exe" or "odbcconf.exe" or "rcsi.exe" or "regsvr32.exe" or "xwizard.exe" or "atbroker.exe" or "forfiles.exe" or "schtasks.exe" or "regasm.exe" or "regsvcs.exe" or "cmd.exe" or "cscript.exe" or "powershell.exe" or "pwsh.exe" or "wmic.exe" or "wscript.exe" or "bitsadmin.exe" or "certutil.exe" or "ftp.exe")

sequence by process.entity_id with maxspan=1m [network where event.type == "start" and event.action == "connection_attempted" and user.id == "0" and not process.executable : ("/bin/ssh", "/sbin/ssh", "/usr/lib/systemd/systemd", "/usr/sbin/sshd")] [process where event.action == "session_id_change" and user.id == "0" and not process.executable : ("/bin/ssh", "/sbin/ssh", "/usr/lib/systemd/systemd", "/usr/sbin/sshd")]

sequence by process.entity_id with maxspan=1m [network where event.type == "start" and event.action == "connection_attempted" and user.id == "0" and not process.executable : ("/bin/ssh", "/sbin/ssh", "/usr/lib/systemd/systemd", "/usr/sbin/sshd")] [process where event.action == "session_id_change" and user.id == "0" and not process.executable : ("/bin/ssh", "/sbin/ssh", "/usr/lib/systemd/systemd", "/usr/sbin/sshd")]

sequence by process.entity_id with maxspan=1m [network where event.type == "start" and event.action == "connection_attempted" and user.id == "0" and not process.executable : ("/bin/ssh", "/sbin/ssh", "/usr/lib/systemd/systemd")] [process where event.action == "session_id_change" and user.id == "0"]

process where event.type == "start" and process.parent.name : ("AcroRd32.exe", "Acrobat.exe", "FoxitPhantomPDF.exe", "FoxitReader.exe") and process.name : ("arp.exe", "dsquery.exe", "dsget.exe", "gpresult.exe", "hostname.exe", "ipconfig.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "ping.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "reg.exe", "sc.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "bginfo.exe", "cdb.exe", "cmstp.exe", "csi.exe", "dnx.exe", "fsi.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "Microsoft.Workflow.Compiler.exe", "msbuild.exe", "mshta.exe", "msxsl.exe", "odbcconf.exe", "rcsi.exe", "regsvr32.exe", "xwizard.exe", "atbroker.exe", "forfiles.exe", "schtasks.exe", "regasm.exe", "regsvcs.exe", "cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "wmic.exe", "wscript.exe", "bitsadmin.exe", "certutil.exe", "ftp.exe")

process where event.type in ("start", "process_started") and process.parent.name : ("AcroRd32.exe", "Acrobat.exe", "FoxitPhantomPDF.exe", "FoxitReader.exe") and process.name : ("arp.exe", "dsquery.exe", "dsget.exe", "gpresult.exe", "hostname.exe", "ipconfig.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "ping.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "reg.exe", "sc.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "bginfo.exe", "cdb.exe", "cmstp.exe", "csi.exe", "dnx.exe", "fsi.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "Microsoft.Workflow.Compiler.exe", "msbuild.exe", "mshta.exe", "msxsl.exe", "odbcconf.exe", "rcsi.exe", "regsvr32.exe", "xwizard.exe", "atbroker.exe", "forfiles.exe", "schtasks.exe", "regasm.exe", "regsvcs.exe", "cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "wmic.exe", "wscript.exe", "bitsadmin.exe", "certutil.exe", "ftp.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:(AcroRd32.exe or Acrobat.exe or FoxitPhantomPDF.exe or FoxitReader.exe) and process.name:(arp.exe or dsquery.exe or dsget.exe or gpresult.exe or hostname.exe or ipconfig.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or ping.exe or qprocess.exe or quser.exe or qwinsta.exe or reg.exe or sc.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or bginfo.exe or cdb.exe or cmstp.exe or csi.exe or dnx.exe or fsi.exe or ieexec.exe or iexpress.exe or installutil.exe or Microsoft.Workflow.Compiler.exe or msbuild.exe or mshta.exe or msxsl.exe or odbcconf.exe or rcsi.exe or regsvr32.exe or xwizard.exe or atbroker.exe or forfiles.exe or schtasks.exe or regasm.exe or regsvcs.exe or cmd.exe or cscript.exe or powershell.exe or pwsh.exe or wmic.exe or wscript.exe or bitsadmin.exe or certutil.exe or ftp.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:(AcroRd32.exe or Acrobat.exe or FoxitPhantomPDF.exe or FoxitReader.exe) and process.name:(arp.exe or dsquery.exe or dsget.exe or gpresult.exe or hostname.exe or ipconfig.exe or nbtstat.exe or net.exe or net1.exe or netsh.exe or netstat.exe or nltest.exe or ping.exe or qprocess.exe or quser.exe or qwinsta.exe or reg.exe or sc.exe or systeminfo.exe or tasklist.exe or tracert.exe or whoami.exe or bginfo.exe or cdb.exe or cmstp.exe or csi.exe or dnx.exe or fsi.exe or ieexec.exe or iexpress.exe or installutil.exe or Microsoft.Workflow.Compiler.exe or msbuild.exe or mshta.exe or msxsl.exe or odbcconf.exe or rcsi.exe or regsvr32.exe or xwizard.exe or atbroker.exe or forfiles.exe or schtasks.exe or regasm.exe or regsvcs.exe or cmd.exe or cscript.exe or powershell.exe or pwsh.exe or wmic.exe or wscript.exe or bitsadmin.exe or certutil.exe or ftp.exe)

event.category:process and powershell.file.script_block_text : ( TVqQAAMAAAAEAAAA )

event.category:process and powershell.file.script_block_text : ( TVqQAAMAAAAEAAAA )

event.code:"4104" and powershell.file.script_block_text : ( TVqQAAMAAAAEAAAA )

any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : ("System.Management.Automation.ni.dll", "System.Management.Automation.dll") or file.name : ("System.Management.Automation.ni.dll", "System.Management.Automation.dll")) and /* add false positives relevant to your environment here */ not process.executable : ("C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe", "C:\\Windows\\System32\\sdiagnhost.exe") and not process.executable regex~ """C:\\Program Files( \(x86\))?\\*\.exe""" and not process.name : ( "Altaro.SubAgent.exe", "AppV_Manage.exe", "azureadconnect.exe", "CcmExec.exe", "configsyncrun.exe", "choco.exe", "ctxappvservice.exe", "DVLS.Console.exe", "edgetransport.exe", "exsetup.exe", "forefrontactivedirectoryconnector.exe", "InstallUtil.exe", "JenkinsOnDesktop.exe", "Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe", "mmc.exe", "mscorsvw.exe", "msexchangedelivery.exe", "msexchangefrontendtransport.exe", "msexchangehmworker.exe", "msexchangesubmission.exe", "msiexec.exe", "MsiExec.exe", "noderunner.exe", "NServiceBus.Host.exe", "NServiceBus.Host32.exe", "NServiceBus.Hosting.Azure.HostProcess.exe", "OuiGui.WPF.exe", "powershell.exe", "powershell_ise.exe", "pwsh.exe", "SCCMCliCtrWPF.exe", "ScriptEditor.exe", "ScriptRunner.exe", "sdiagnhost.exe", "servermanager.exe", "setup100.exe", "ServiceHub.VSDetouredHost.exe", "SPCAF.Client.exe", "SPCAF.SettingsEditor.exe", "SQLPS.exe", "telemetryservice.exe", "UMWorkerProcess.exe", "w3wp.exe", "wsmprovhost.exe" )

library where dll.name : ("System.Management.Automation.ni.dll", "System.Management.Automation.dll") and /* add false positives relevant to your environment here */ not process.executable : ("C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe", "C:\\Windows\\System32\\sdiagnhost.exe") and not process.executable regex~ """C:\\Program Files( \(x86\))?\\*\.exe""" and not process.name : ( "Altaro.SubAgent.exe", "AppV_Manage.exe", "azureadconnect.exe", "CcmExec.exe", "configsyncrun.exe", "choco.exe", "ctxappvservice.exe", "DVLS.Console.exe", "edgetransport.exe", "exsetup.exe", "forefrontactivedirectoryconnector.exe", "InstallUtil.exe", "JenkinsOnDesktop.exe", "Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe", "mmc.exe", "mscorsvw.exe", "msexchangedelivery.exe", "msexchangefrontendtransport.exe", "msexchangehmworker.exe", "msexchangesubmission.exe", "msiexec.exe", "MsiExec.exe", "noderunner.exe", "NServiceBus.Host.exe", "NServiceBus.Host32.exe", "NServiceBus.Hosting.Azure.HostProcess.exe", "OuiGui.WPF.exe", "powershell.exe", "powershell_ise.exe", "pwsh.exe", "SCCMCliCtrWPF.exe", "ScriptEditor.exe", "ScriptRunner.exe", "sdiagnhost.exe", "servermanager.exe", "setup100.exe", "ServiceHub.VSDetouredHost.exe", "SPCAF.Client.exe", "SPCAF.SettingsEditor.exe", "SQLPS.exe", "telemetryservice.exe", "UMWorkerProcess.exe", "w3wp.exe", "wsmprovhost.exe" )

library where dll.name : ("System.Management.Automation.ni.dll", "System.Management.Automation.dll") and /* add false positives relevant to your environment here */ not process.executable : ("C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe", "C:\\Windows\\System32\\sdiagnhost.exe", "C:\\Program Files*\\*.exe") and not process.name : ( "Altaro.SubAgent.exe", "AppV_Manage.exe", "azureadconnect.exe", "CcmExec.exe", "configsyncrun.exe", "choco.exe", "ctxappvservice.exe", "DVLS.Console.exe", "edgetransport.exe", "exsetup.exe", "forefrontactivedirectoryconnector.exe", "InstallUtil.exe", "JenkinsOnDesktop.exe", "Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe", "mmc.exe", "mscorsvw.exe", "msexchangedelivery.exe", "msexchangefrontendtransport.exe", "msexchangehmworker.exe", "msexchangesubmission.exe", "msiexec.exe", "MsiExec.exe", "noderunner.exe", "NServiceBus.Host.exe", "NServiceBus.Host32.exe", "NServiceBus.Hosting.Azure.HostProcess.exe", "OuiGui.WPF.exe", "powershell.exe", "powershell_ise.exe", "pwsh.exe", "SCCMCliCtrWPF.exe", "ScriptEditor.exe", "ScriptRunner.exe", "sdiagnhost.exe", "servermanager.exe", "setup100.exe", "ServiceHub.VSDetouredHost.exe", "SPCAF.Client.exe", "SPCAF.SettingsEditor.exe", "SQLPS.exe", "telemetryservice.exe", "UMWorkerProcess.exe", "w3wp.exe", "wsmprovhost.exe" )

library where file.name : ("System.Management.Automation.ni.dll", "System.Management.Automation.dll") and /* add false positives relevant to your environment here */ not process.executable : ("C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe", "C:\\Windows\\System32\\sdiagnhost.exe", "C:\\Program Files*\\*.exe") and not process.name : ( "Altaro.SubAgent.exe", "AppV_Manage.exe", "azureadconnect.exe", "CcmExec.exe", "configsyncrun.exe", "choco.exe", "ctxappvservice.exe", "DVLS.Console.exe", "edgetransport.exe", "exsetup.exe", "forefrontactivedirectoryconnector.exe", "InstallUtil.exe", "JenkinsOnDesktop.exe", "Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe", "mmc.exe", "mscorsvw.exe", "msexchangedelivery.exe", "msexchangefrontendtransport.exe", "msexchangehmworker.exe", "msexchangesubmission.exe", "msiexec.exe", "MsiExec.exe", "noderunner.exe", "NServiceBus.Host.exe", "NServiceBus.Host32.exe", "NServiceBus.Hosting.Azure.HostProcess.exe", "OuiGui.WPF.exe", "powershell.exe", "powershell_ise.exe", "pwsh.exe", "SCCMCliCtrWPF.exe", "ScriptEditor.exe", "ScriptRunner.exe", "sdiagnhost.exe", "servermanager.exe", "setup100.exe", "ServiceHub.VSDetouredHost.exe", "SPCAF.Client.exe", "SPCAF.SettingsEditor.exe", "SQLPS.exe", "telemetryservice.exe", "UMWorkerProcess.exe", "w3wp.exe", "wsmprovhost.exe" )

file where event.type : "deletion" and not process.name : ("spoolsv.exe", "dllhost.exe", "explorer.exe") and file.path : "?:\\Windows\\System32\\spool\\drivers\\x64\\3\\*.dll"

sequence by host.id with maxspan=30s [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Print\\Printers\\*\\SpoolDirectory" and registry.data.strings : "C:\\Windows\\System32\\spool\\drivers\\x64\\4"] [registry where registry.path : "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Print\\Printers\\*\\CopyFiles\\Payload\\Module" and registry.data.strings : "C:\\Windows\\System32\\spool\\drivers\\x64\\4\\*"]

file where event.type != "deletion" and process.name : "spoolsv.exe" and file.extension : ("exe", "dll") and not file.path : ("?:\\Windows\\System32\\spool\\*", "?:\\Windows\\Temp\\*", "?:\\Users\\*")

event.category:file and not event.type:deletion and process.name:spoolsv.exe and file.extension:(exe or dll) and not file.path:(C\:\\Windows\\System32\\spool\\* or C\:\\Windows\\Temp\\* or C\:\\Users\\*)

file where event.type != "deletion" and file.extension : "spl" and file.path : "?:\\Windows\\System32\\spool\\PRINTERS\\*" and not process.name : ("spoolsv.exe", "printfilterpipelinesvc.exe", "PrintIsolationHost.exe", "splwow64.exe", "msiexec.exe", "poqexec.exe")

event.category:file and not event.type:deletion and file.extension:(spl or SPL) and file.path:C\:\\Windows\\System32\\spool\\PRINTERS\\* and not process.name:(spoolsv.exe or printfilterpipelinesvc.exe or PrintIsolationHost.exe or splwow64.exe or msiexec.exe or poqexec.exe)

process where event.code == "10" and length(winlog.event_data.CallTrace) &gt; 0 and /* Sysmon CallTrace starting with unknown memory module instead of ntdll which host Windows NT Syscalls */ not winlog.event_data.CallTrace : ("?:\\WINDOWS\\SYSTEM32\\ntdll.dll*", "?:\\WINDOWS\\SysWOW64\\ntdll.dll*", "?:\\Windows\\System32\\wow64cpu.dll*", "?:\\WINDOWS\\System32\\wow64win.dll*", "?:\\Windows\\System32\\win32u.dll*") and not winlog.event_data.TargetImage : ("?:\\Program Files (x86)\\Malwarebytes Anti-Exploit\\mbae-svc.exe", "?:\\Program Files\\Cisco\\AMP\\*\\sfc.exe", "?:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\*\\msedgewebview2.exe", "?:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\*\\AcroCEF.exe") and not (process.executable : ("?:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe", "?:\\Program Files (x86)\\World of Warcraft\\_classic_\\WowClassic.exe") and not winlog.event_data.TargetImage : "?:\\WINDOWS\\system32\\lsass.exe")

process where event.code == "10" and length(winlog.event_data.CallTrace) &gt; 0 and /* Sysmon CallTrace starting with unknown memory module instead of ntdll which host Windows NT Syscalls */ not winlog.event_data.CallTrace : ("?:\\WINDOWS\\SYSTEM32\\ntdll.dll*", "?:\\WINDOWS\\SysWOW64\\ntdll.dll*")

sequence by host.id with maxspan=1m [process where event.code == "1" and /* sysmon process creation */ process.parent.name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe", "eqnedt32.exe", "fltldr.exe", "mspub.exe", "msaccess.exe","cscript.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "mshta.exe", "wmic.exe", "cmstp.exe", "msxsl.exe") and /* noisy FP patterns */ not (process.parent.name : "EXCEL.EXE" and process.executable : "?:\\Program Files\\Microsoft Office\\root\\Office*\\ADDINS\\*.exe") and not (process.executable : "?:\\Windows\\splwow64.exe" and process.args in ("8192", "12288") and process.parent.name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe")) and not (process.parent.name : "rundll32.exe" and process.parent.args : (" ?:\\WINDOWS\\Installer\\MSI*.tmp,zzzzInvokeManagedCustomActionOutOfPro c", "--no-sandbox")) and not (process.executable : ("?:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\*\\msedgewebview2.exe", "?:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe", "?:\\Windows\\SysWOW64\\DWWIN.EXE") and process.parent.name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe")) and not (process.parent.name : "regsvr32.exe" and process.parent.args : ("?:\\Program Files\\*", "?:\\Program Files (x86)\\*")) ] by process.parent.entity_id, process.entity_id [process where event.code == "10" and /* Sysmon process access event from unknown module */ winlog.event_data.CallTrace : "*UNKNOWN*"] by process.entity_id, winlog.event_data.TargetProcessGUID

sequence by host.id with maxspan=1m [process where event.code == "1" and /* sysmon process creation */ process.parent.name : ("winword.exe", "excel.exe", "outlook.exe", "powerpnt.exe", "eqnedt32.exe", "fltldr.exe", "mspub.exe", "msaccess.exe", "powershell.exe", "pwsh.exe", "cscript.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "mshta.exe", "wmic.exe", "cmstp.exe", "msxsl.exe")] by process.parent.entity_id, process.entity_id [process where event.code == "10" and /* Sysmon process access event from unknown module */ winlog.event_data.CallTrace : "*UNKNOWN*"] by process.entity_id, winlog.event_data.TargetProcessGUID

process where event.type == "start" and process.pe.original_file_name : "psexesvc.exe" and not process.name : "PSEXESVC.exe"

process where event.type in ("start", "process_started", "info") and process.pe.original_file_name : "psexesvc.exe" and not process.name : "PSEXESVC.exe"

event.category:process and event.type:(start or process_started) and (process.pe.original_file_name:(psexesvc.exe or PSEXESVC.exe) or winlog.event_data.OriginalFileName:(psexesvc.exe or PSEXESVC.exe)) and process.parent.name:services.exe and not process.name:(psexesvc.exe or PSEXESVC.exe)

any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : "mstscax.dll" or file.name : "mstscax.dll") and /* depending on noise in your env add here extra paths */ process.executable : ( "C:\\Windows\\*", "C:\\Users\\Public\\*", "C:\\Users\\Default\\*", "C:\\Intel\\*", "C:\\PerfLogs\\*", "C:\\ProgramData\\*", "\\Device\\Mup\\*", "\\\\*" ) and /* add here FPs */ not process.executable : ("C:\\Windows\\System32\\mstsc.exe", "C:\\Windows\\SysWOW64\\mstsc.exe")

library where dll.name : "mstscax.dll" and /* depending on noise in your env add here extra paths */ process.executable : ( "C:\\Windows\\*", "C:\\Users\\Public\\*", "C:\\Users\\Default\\*", "C:\\Intel\\*", "C:\\PerfLogs\\*", "C:\\ProgramData\\*", "\\Device\\Mup\\*", "\\\\*" ) and /* add here FPs */ not process.executable : ("C:\\Windows\\System32\\mstsc.exe", "C:\\Windows\\SysWOW64\\mstsc.exe")

library where file.name == "mstscax.dll" and /* depending on noise in your env add here extra paths */ wildcard(process.executable, "C:\\Windows\\*", "C:\\Users\\Public\\*", "C:\\Users\\Default\\*", "C:\\Intel\\*", "C:\\PerfLogs\\*", "C:\\ProgramData\\*", "\\Device\\Mup\\*", "\\\\*") and /* add here FPs */ not process.executable in ("C:\\Windows\\System32\\mstsc.exe", "C:\\Windows\\SysWOW64\\mstsc.exe")

sequence by host.id, winlog.event_data.SubjectLogonId with maxspan=1m [iam where event.action == "logged-in-special" and winlog.event_data.PrivilegeList : "SeBackupPrivilege" and /* excluding accounts with existing privileged access */ not winlog.event_data.PrivilegeList : "SeDebugPrivilege"] [any where event.action == "Detailed File Share" and winlog.event_data.RelativeTargetName : "winreg"]

sequence by host.id, winlog.event_data.SubjectLogonId with maxspan=1m [iam where event.action == "logged-in-special" and winlog.event_data.PrivilegeList : "SeBackupPrivilege"] [any where event.action == "Detailed File Share" and winlog.event_data.RelativeTargetName : "winreg"]

sequence by process.entity_id with maxspan=2m [process where event.type == "start" and (process.code_signature.subject_name in ("Microsoft Corporation", "Microsoft Windows") and process.code_signature.trusted == true) and not process.executable : ( "?:\\Windows\\System32\\cscript.exe", "?:\\Windows\\SysWOW64\\cscript.exe", "?:\\Program Files (x86)\\Internet Explorer\\iexplore.exe", "?:\\Program Files\\Internet Explorer\\iexplore.exe", "?:\\Windows\\SystemAp ps\\Microsoft.MicrosoftEdge_*\\MicrosoftEdge.exe", "?:\\Windows\\system32\\msiexec.exe", "?:\\Windows\\SysWOW64\\msiexec.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\system32\\taskhostw.exe", "?:\\windows\\system32\\inetsrv\\w3wp.exe", "?:\\windows\\SysWOW64\\inetsrv\\w3wp.exe", "?:\\Windows\\system32\\wscript.exe", "?:\\Windows\\SysWOW64\\wscript.exe", "?:\\Windows\\system32\\mobsync.exe", "?:\\Windows\\SysWOW64\\mobsync.exe", "?:\\Windows\\System32\\cmd.exe", "?:\\Windows\\SysWOW64\\cmd.exe")] [library where event.type == "start" and dll.name : "scrobj.dll"]

sequence by process.entity_id with maxspan=2m [process where event.type == "start" and (process.code_signature.subject_name in ("Microsoft Corporation", "Microsoft Windows") and process.code_signature.trusted == true) and not process.executable : ( "?:\\Windows\\System32\\cscript.exe", "?:\\Windows\\SysWOW64\\cscript.exe", "?:\\Program Files (x86)\\Internet Explorer\\iexplore.exe", "?:\\Program Files\\Internet Explorer\\iexplore.exe", "?:\\Windows\\SystemAp ps\\Microsoft.MicrosoftEdge_*\\MicrosoftEdge.exe", "?:\\Windows\\system32\\msiexec.exe", "?:\\Windows\\SysWOW64\\msiexec.exe", "?:\\Windows\\System32\\smartscreen.exe", "?:\\Windows\\system32\\taskhostw.exe", "?:\\windows\\system32\\inetsrv\\w3wp.exe", "?:\\windows\\SysWOW64\\inetsrv\\w3wp.exe", "?:\\Windows\\system32\\wscript.exe", "?:\\Windows\\SysWOW64\\wscript.exe", "?:\\Windows\\system32\\mobsync.exe", "?:\\Windows\\SysWOW64\\mobsync.exe", "?:\\Windows\\System32\\cmd.exe", "?:\\Windows\\SysWOW64\\cmd.exe")] [library where event.type == "start" and dll.name : "scrobj.dll"]

/* add winlogbeat-* when process.code_signature.* fields are populated */ sequence by process.entity_id with maxspan = 2m [process where event.type in ("start", "process_started") and /* uncomment once in winlogbeat */ /* process.code_signature.subject_name : "Microsoft Corporation" and process.code_signature.trusted : true and */ not process.name : ( "cscript.exe", "iexplore.exe", "MicrosoftEdge.exe", "msiexec.exe", "smartscreen.exe", "taskhostw.exe", "w3wp.exe", "wscript.exe")] [library where event.type == "start" and dll.name : "scrobj.dll"]

/* add winlogbeat-* when process.code_signature.* fields are populated */ sequence by process.entity_id with maxspan=2m [process where event.type in ("start", "process_started") and /* uncomment once in winlogbeat */ /* process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true and */ not (process.name : "cscript.exe" or process.name : "iexplore.exe" or process.name : "MicrosoftEdge.exe" or process.name : "msiexec.exe" or process.name : "smartscreen.exe" or process.name : "taskhostw.exe" or process.name : "w3wp.exe" or process.name : "wscript.exe")] [library where event.type == "start" and file.name : "scrobj.dll"]

process where event.type == "start" and process.parent.name: ("SolarWinds.BusinessLayerHost.exe", "SolarWinds.BusinessLayerHostx64.exe") and not process.name : ( "APMServiceControl*.exe", "ExportToPDFCmd*.Exe", "SolarWinds.Credentials.Orion.WebApi*.exe", "SolarWinds.Orion.Topology.Calculator*.exe", "Database- Maint.exe", "SolarWinds.Orion.ApiPoller.Service.exe", "WerFault.exe", "WerMgr.exe", "SolarWinds.BusinessLayerHost.exe", "SolarWinds.BusinessLayerHostx64.exe") and not process.executable : ("?:\\Windows\\SysWOW64\\ARP.EXE", "?:\\Windows\\SysWOW64\\lodctr.exe", "?:\\Windows\\SysWOW64\\unlodctr.exe")

process where event.type in ("start", "process_started") and process.parent.name: ("SolarWinds.BusinessLayerHost.exe", "SolarWinds.BusinessLayerHostx64.exe") and not process.name : ( "APMServiceControl*.exe", "ExportToPDFCmd*.Exe", "SolarWinds.Credentials.Orion.WebApi*.exe", "SolarWinds.Orion.Topology.Calculator*.exe", "Database- Maint.exe", "SolarWinds.Orion.ApiPoller.Service.exe", "WerFault.exe", "WerMgr.exe")

registry where registry.path : ( "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\Common Startup", "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\Common Startup", "HKEY_USERS\\*\\Software\\Microsoft\\Wi ndows\\CurrentVersion\\Explorer\\User Shell Folders\\Startup", "H KEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ Shell Folders\\Startup" ) and registry.data.strings != null and /* Normal Startup Folder Paths */ not registry.data.strings : ( "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup", "%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup", "%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup", "C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup" )

process where event.type == "start" and process.parent.name : "WerFault.exe" and not process.name : ("cofire.exe", "psr.exe", "VsJITDebugger.exe", "TTTracer.exe", "rundll32.exe", "LogiOptionsMgr.exe") and not process.args : ("/LOADSAVEDWINDOWS", "/restore", "RestartByRestartManager*", "--restarted", "createdump", "dontsend", "/watson")

process where event.type in ("start", "process_started") and process.parent.name : "WerFault.exe" and not process.name : ("cofire.exe", "psr.exe", "VsJITDebugger.exe", "TTTracer.exe", "rundll32.exe", "LogiOptionsMgr.exe") and not process.args : ("/LOADSAVEDWINDOWS", "/restore", "RestartByRestartManager*", "--restarted", "createdump", "dontsend", "/watson")

event.category:process and event.type:(start or process_started) and process.parent.name:WerFault.exe and not process.name:(cofire.exe or psr.exe or VsJITDebugger.exe or TTTracer.exe or rundll32.exe)

sequence by process.entity_id with maxspan = 2m [process where event.type == "start" and (process.name : "WMIC.exe" or process.pe.original_file_name : "wmic.exe") and process.args : ("format*:*", "/format*:*", "*-format*:*") and not process.command_line : "* /format:table *"] [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : ("jscript.dll", "vbscript.dll") or file.name : ("jscript.dll", "vbscript.dll"))]

sequence by process.entity_id with maxspan = 2m [process where event.type in ("start", "process_started") and (process.name : "WMIC.exe" or process.pe.original_file_name : "wmic.exe") and process.args : ("format*:*", "/format*:*", "*-format*:*") and not process.command_line : "* /format:table *"] [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : ("jscript.dll", "vbscript.dll") or file.name : ("jscript.dll", "vbscript.dll"))]

sequence by process.entity_id with maxspan = 2m [process where event.type in ("start", "process_started") and (process.name : "WMIC.exe" or process.pe.original_file_name : "wmic.exe") and process.args : ("format*:*", "/format*:*", "*-format*:*") and not process.command_line : "* /format:table *"] [library where event.type == "start" and dll.name : ("jscript.dll", "vbscript.dll")]

sequence by process.entity_id with maxspan=2m [process where event.type in ("start", "process_started") and (process.name : "WMIC.exe" or process.pe.original_file_name == "wmic.exe") and wildcard(process.args, "format*:*", "/format*:*", "*-format*:*") and not wildcard(process.command_line, "* /format:table *")] [library where event.type == "start" and file.name in ("jscript.dll", "vbscript.dll")]

any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and process.name : ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and (dll.name : "wmiutils.dll" or file.name : "wmiutils.dll")

library where process.name : ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and event.action : "load" and event.category : "library" and dll.name : "wmiutils.dll"

library where process.name in ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "MSPUB.EXE", "MSACCESS.EXE") and event.action == "load" and event.category == "library" and file.name == "wmiutils.dll"

process where event.type == "start" and process.parent.name : "Zoom.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe")

process where event.type in ("start", "process_started", "info") and process.parent.name : "Zoom.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe")

process where event.type in ("start", "process_started", "info") and process.parent.name : "Zoom.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe")

event.category:process and event.type:(start or process_started) and process.parent.name:Zoom.exe and not process.name:(Zoom.exe or WerFault.exe or airhost.exe or CptControl.exe or CptHost.exe or cpthost.exe or CptInstall.exe or CptService.exe or Installer.exe or zCrashReport.exe or Zoom_launcher.exe or zTscoder.exe or plugin_Launcher.exe or mDNSResponder.exe or zDevHelper.exe or APcptControl.exe or CrashSender*.exe or aomhost64.exe or Magnify.exe or m_plugin_launcher.exe or com.zoom.us.zTranscode.exe or RoomConnector.exe or tabtip.exe or Explorer.exe or chrome.exe or firefox.exe or iexplore.exe or outlook.exe or lync.exe or ApplicationFrameHost.exe or ZoomAirhostInstaller.exe or narrator.exe or NVDA.exe or Magnify.exe or Outlook.exe or m_plugin_launcher.exe or mphost.exe or APcptControl.exe or winword.exe or excel.exe or powerpnt.exe or ONENOTE.EXE or wpp.exe or debug_message.exe or zAssistant.exe or msiexec.exe or msedge.exe or dwm.exe or vcredist_x86.exe or Controller.exe or Installer.exe or CptInstall.exe or Zoom_launcher.exe or ShellExperienceHost.exe or wps.exe)

process where event.type == "start" and process.parent.name : "svchost.exe" and process.name : "cmd.exe" and not process.args : ("??:\\Program Files\\Npcap\\CheckStatus.bat?", "?:\\Program Files\\Npcap\\CheckStatus.bat", "\\system32\\cleanmgr.exe", "?:\\Windows\\system32\\silcollector.cmd", "\\system32\\AppHostRegistrationVerifier.exe", "\\system32\\ServerManagerLauncher.exe", "dir", "?:\\Program Files\\*", "?:\\Program Files (x86)\\*", "?:\\Windows\\LSDeployment\\Lspush.exe", "(x86)\\FMAuditOnsite\\watchdog.bat", "?:\\ProgramData\\chocolatey\\bin\\choco-upgrade-all.bat", "Files\\Npcap\\CheckStatus.bat") and /* very noisy pattern - bat or cmd script executed via scheduled tasks */ not (process.parent.args : "netsvcs" and process.args : ("?:\\*.bat", "?:\\*.cmd"))

process where event.type == "start" and process.parent.name : "svchost.exe" and process.name : "cmd.exe" and not (process.pe.original_file_name : "cmd.exe" and process.args : ( "??:\\Program Files\\Npcap\\CheckStatus.bat?", "?:\\Program Files\\Npcap\\CheckStatus.bat", "\\system32\\cleanmgr.exe", "?:\\Windows\\system32\\silcollector.cmd", "\\system32\\AppHostRegistrationVerifier.exe", "\\system32\\ServerManagerLauncher.exe"))

process where event.type == "start" and process.parent.name : "svchost.exe" and process.name : "cmd.exe" and not (process.pe.original_file_name : "cmd.exe" and process.args : ( "??:\\Program Files\\Npcap\\CheckStatus.bat?", "?:\\Program Files\\Npcap\\CheckStatus.bat", "\\system32\\cleanmgr.exe", "?:\\Windows\\system32\\silcollector.cmd", "\\system32\\AppHostRegistrationVerifier.exe", "\\system32\\ServerManagerLauncher.exe"))

process where event.type in ("start", "process_started") and process.parent.name : "svchost.exe" and process.name : "cmd.exe" and not (process.pe.original_file_name == "Cmd.Exe" and process.args : "?:\\Program Files\\Npcap\\CheckStatus.bat??")

event.category:process and event.type:(start or process_started) and process.parent.name:svchost.exe and process.name:cmd.exe

process.parent.name:svchost.exe and process.name:cmd.exe

process where event.type in ("start","process_created") and process.pe.original_file_name in ("Cmd.Exe","PowerShell.EXE") and /* Create Symbolic Link to Shadow Copies */ process.args : ("*mklink*", "*SymbolicLink*") and process.command_line : ("*HarddiskVolumeShadowCopy*")

process where event.type in ("start","process_created") and process.pe.original_file_name in ("Cmd.Exe","PowerShell.EXE") and /* Create Symbolic Link to Shadow Copies */ process.args : ("*mklink*", "*SymbolicLink*") and process.command_line : ("*HarddiskVolumeShadowCopy*")

process where event.type in ("start", "process_started") and process.pe.original_file_name == "Cmd.Exe" and process.args : "*mklink*" and process.args : "*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*"

event.category:process and event.type:(start or process_started) and process.args:("/private/var/db/SystemKey" or "/var/db/SystemKey")

event.category:process and event.type:(start or process_started) and process.args:"/private/var/db/SystemKey"

file where event.type == "deletion" and file.path : ( "/var/run/utmp", "/var/log/wtmp", "/var/log/btmp", "/var/log/lastlog", "/var/log/faillog", "/var/log/syslog", "/var/log/messages", "/var/log/secure", "/var/log/auth.log" ) and not process.name : ("gzip")

file where event.type == "deletion" and file.path : ( "/var/run/utmp", "/var/log/wtmp", "/var/log/btmp", "/var/log/lastlog", "/var/log/faillog", "/var/log/syslog", "/var/log/messages", "/var/log/secure", "/var/log/auth.log" )

process where event.type == "start" and process.parent.name : "services.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe") and /* Third party FP's */ not process.args : "NVDisplay.ContainerLocalSystem"

process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe") and /* Third party FP's */ not process.args : "NVDisplay.ContainerLocalSystem"

process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and process.name : ("cmd.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe") and /* Third party FP's */ not process.args : "NVDisplay.ContainerLocalSystem"

process where event.type in ("start", "process_started") and process.parent.name : "services.exe" and process.name : ("cmd.exe", "powershell.exe") and /* Third party FP's */ not process.args : "NVDisplay.ContainerLocalSystem"

event.category:process and event.type:(start or process_started) and process.parent.name:services.exe and process.name:(cmd.exe or powershell.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:services.exe and process.name:(cmd.exe or powershell.exe)

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:"services.exe" and process.name:("cmd.exe" or "powershell.exe")

process where event.type in ("start", "process_started") and ( ((process.args : ("rm", "echo") or (process.args : "ln" and process.args : "-sf" and process.args : "/dev/null") or (process.args : "truncate" and process.args : "-s0")) and process.args : (".bash_history", "/root/.bash_history", "/home/*/.bash_history","/Users/.bash_history", "/Users/*/.bash_history", ".zsh_history", "/root/.zsh_history", "/home/*/.zsh_history", "/Users/.zsh_history", "/Users/*/.zsh_history")) or (process.name : "history" and process.args : "-c") or (process.args : "export" and process.args : ("HISTFILE=/dev/null", "HISTFILESIZE=0")) or (process.args : "unset" and process.args : "HISTFILE") or (process.args : "set" and process.args : "history" and process.args : "+o") )

process where event.type in ("start", "process_started") and ( (process.args : ("rm", "echo") and process.args : (".bash_history", "/root/.bash_history", "/home/*/.bash_history")) or (process.name : "history" and process.args : "-c") or (process.args : "export" and process.args : ("HISTFILE=/dev/null", "HISTFILESIZE=0")) or (process.args : "unset" and process.args : "HISTFILE") or (process.args : "set" and process.args : "history" and process.args : "+o") )

event.category:process AND event.type:(start or process_started) AND process.name:rm AND process.args:/\/(home\/.{1,255}|root)\/\.bash_history/

event.category : process and event.type : (start or process_started) and process.name : mount_apfs and process.args : (/System/Volumes/Data and noowners)

event.category:(network or network_traffic) and network.transport:tcp and destination.port:23

event.category:(network or network_traffic) and network.transport:tcp and destination.port:23

network.transport:tcp and destination.port:23

sequence by host.id, winlog.event_data.TaskName with maxspan=5m [iam where event.action == "scheduled-task-created"] [iam where event.action == "scheduled-task-deleted"]

file where event.type == "deletion" and ( /* Veeam Related Backup Files */ (file.extension : ("VBK", "VIB", "VBM") and not process.executable : ("?:\\Windows\\Veeam\\Backup\\*", "?:\\Program Files\\Veeam\\Backup and Replication\\*", "?:\\Program Files (x86)\\Veeam\\Backup and Replication\\*")) or /* Veritas Backup Exec Related Backup File */ (file.extension : "BKF" and not process.executable : ("?:\\Program Files\\Veritas\\Backup Exec\\*", "?:\\Program Files (x86)\\Veritas\\Backup Exec\\*")) )

event.dataset:okta.system and event.action:security.threat.detected

event.module:okta and event.dataset:okta.system and event.action:security.threat.detected

file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*

file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*

process where event.type == "start" and process.name : "touch" and user.id != "0" and process.args : ("-r", "-t", "-a*","-m*") and not process.args : ("/usr/lib/go-*/bin/go", "/usr/lib/dracut/dracut- functions.sh", "/tmp/KSInstallAction.*/m/.patch/*")

process where event.type in ("start", "process_started") and process.name : "touch" and process.args : ("-r", "-t", "-a*","-m*")

process where event.type in ("start", "process_started") and process.name == "touch" and wildcard(process.args, "-r", "-t", "-a*","-m*")

process where event.type == "start" and process.executable : "C:\\*\\AppData\\*\\Temp\\IDC*.tmp\\*.exe" and process.parent.name : "ieinstal.exe" and process.parent.args : "-Embedding" /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

process where event.type in ("start", "process_started") and process.executable : "C:\\*\\AppData\\*\\Temp\\IDC*.tmp\\*.exe" and process.parent.name : "ieinstal.exe" and process.parent.args : "-Embedding" /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

process where event.type in ("start", "process_started", "info") and wildcard(process.executable, "C:\\*\\AppData\\*\\Temp\\IDC*.tmp\\*.exe") and process.parent.name == "ieinstal.exe" and process.parent.args == "-Embedding" /* uncomment once in winlogbeat */ /* and not (process.code_signature.subject_name == "Microsoft Corporation" and process.code_signature.trusted == true) */

file where event.type : "change" and process.name : "dllhost.exe" and /* Known modules names side loaded into process running with high or system integrity level for UAC Bypass, update here for new modules */ file.name : ("wow64log.dll", "comctl32.dll", "DismCore.dll", "OskSupport.dll", "duser.dll", "Accessibility.ni.dll") and /* has no impact on rule logic just to avoid OS install related FPs */ not file.path : ("C:\\Windows\\SoftwareDistribution\\*", "C:\\Windows\\WinSxS\\*")

process where event.type == "start" and process.args : ("C:\\Windows \\system32\\*.exe", "C:\\Windows \\SysWOW64\\*.exe")

process where event.type in ("start", "process_started") and process.args : ("C:\\Windows \\system32\\*.exe", "C:\\Windows \\SysWOW64\\*.exe")

process where event.type == "start" and process.name : "Clipup.exe" and not process.executable : "C:\\Windows\\System32\\ClipUp.exe" and process.parent.name : "dllhost.exe" and /* CLSID of the Elevated COM Interface IEditionUpgradeManager */ process.parent.args : "/Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}"

process where event.type in ("start", "process_started") and process.name : "Clipup.exe" and not process.executable : "C:\\Windows\\System32\\ClipUp.exe" and process.parent.name : "dllhost.exe" and /* CLSID of the Elevated COM Interface IEditionUpgradeManager */ process.parent.args : "/Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}"

process where event.type in ("start", "process_started", "info") and process.name == "Clipup.exe" and process.executable != "C:\\Windows\\System32\\ClipUp.exe" and process.parent.name == "dllhost.exe" and /* CLSID of the Elevated COM Interface IEditionUpgradeManager */ wildcard(process.parent.args,"/Processid:{B D54C901-076B-434E-B6C7-17C531F4AB41}")

process where event.type == "start" and process.args : "/autoclean" and process.args : "/d" and not process.executable : ("C:\\Windows\\System32\\cleanmgr.exe", "C:\\Windows\\SysWOW64\\cleanmgr.exe", "C:\\Windows\\System32\\taskhostw.exe")

process where event.type in ("start", "process_started") and process.args:"/autoclean" and process.args:"/d" and not process.executable : ("C:\\Windows\\System32\\cleanmgr.exe", "C:\\Windows\\SysWOW64\\cleanmgr.exe")

event.category:process and event.type:(start or process_started) and process.args:(/autoclean or /AUTOCLEAN) and process.parent.name:svchost.exe and not process.executable:("C:\Windows\System32\cleanmgr.exe" or "C:\Windows\SysWOW64\cleanmgr.exe")

process where event.type == "start" and process.parent.name == "dllhost.exe" and process.parent.args in ("/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}", "/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}") and process.pe.original_file_name != "WerFault.exe"

process where event.type in ("start", "process_started") and process.parent.name == "dllhost.exe" and process.parent.args in ("/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}", "/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}") and process.pe.original_file_name != "WerFault.exe"

process where event.type == "start" and process.parent.name == "mmc.exe" and /* process.Ext.token.integrity_level_name == "high" can be added in future for tuning */ /* args of the Windows Firewall SnapIn */ process.parent.args == "WF.msc" and process.name != "WerFault.exe"

process where event.type in ("start", "process_started") and process.parent.name == "mmc.exe" and /* process.Ext.token.integrity_level_name == "high" can be added in future for tuning */ /* args of the Windows Firewall SnapIn */ process.parent.args == "WF.msc" and process.name != "WerFault.exe"

event.dataset:okta.system and event.action:app.generic.unauth_app_access_attempt

registry where /* uncomment once stable length(registry.data.strings) &gt; 0 and */ registry.path : ( "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Serve r\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Serve r\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\\*", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Run", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\IconServiceLib", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\AppSetup", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Taskman", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\VmApplet", "HKLM\\SOFTWARE\\Micros oft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*", "HKLM \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shel l", "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scrip ts\\Logoff\\Script", "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windo ws\\System\\Scripts\\Logon\\Script", "HKLM\\SOFTWARE\\Policies\\ Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script", "HKLM\\S OFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Startup\\Scrip t", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion \\Policies\\Explorer\\Run\\*", "HKEY_USERS\\*\\SOFTWARE\\Microso ft\\Windows\\CurrentVersion\\Policies\\System\\Shell", "HKEY_USE RS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logoff \\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Window s\\System\\Scripts\\Logon\\Script", "HKEY_USERS\\*\\SOFTWARE\\Po licies\\Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Script s\\Startup\\Script", "HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\*\\ShellComponent", "HKLM\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnConnect\\MicrosoftActiveSync", "HKLM\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnDisconnect\\MicrosoftActiveSync", "HKLM\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKLM\\SOFTWARE\\Microsoft\\Command Processor\\Autorun", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*\\VerifierDlls", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GpExtensions\\*\\DllName", "HKLM\\SYSTEM\\ControlSet*\\Control\\SafeBoot\\AlternateShell", "HKLM\\SYSTEM\\ControlSet*\\Control\\Terminal Server\\Wds\\rdpwd\\StartupPrograms", "HKLM\\SYSTEM\\ControlSet*\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\BootExecute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\SetupExecute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\Execute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\S0InitialCommand", "HKLM\\SYSTEM\\ControlSet*\\Control\\ServiceControlManagerExtension", "HKLM\\SYSTEM\\ControlSet*\\Control\\BootVerificationProgram\\ImagePat h", "HKLM\\SYSTEM\\Setup\\CmdLine", "HKEY_USERS\\*\\Environment\\UserInitMprLogonScript") and not registry.data.strings : ("C:\\Windows\\system32\\userinit.exe", "cmd.exe", "C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe") and not (process.name : "rundll32.exe" and registry.path : "*\\Software\\Microsoft\\Internet Explorer\\Extensions\\*\\Script") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe", "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe")

registry where /* uncomment once stable length(registry.data.strings) &gt; 0 and */ registry.path : ( "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Serve r\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\*", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Serve r\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\\*", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Run", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\IconServiceLib", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\AppSetup", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Taskman", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\VmApplet", "HKLM\\SOFTWARE\\Micros oft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*", "HKLM \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shel l", "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scrip ts\\Logoff\\Script", "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windo ws\\System\\Scripts\\Logon\\Script", "HKLM\\SOFTWARE\\Policies\\ Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script", "HKLM\\S OFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Startup\\Scrip t", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion \\Policies\\Explorer\\Run\\*", "HKEY_USERS\\*\\SOFTWARE\\Microso ft\\Windows\\CurrentVersion\\Policies\\System\\Shell", "HKEY_USE RS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logoff \\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Window s\\System\\Scripts\\Logon\\Script", "HKEY_USERS\\*\\SOFTWARE\\Po licies\\Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script", "HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Script s\\Startup\\Script", "HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\*\\ShellComponent", "HKLM\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnConnect\\MicrosoftActiveSync", "HKLM\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnDisconnect\\MicrosoftActiveSync", "HKLM\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKLM\\SOFTWARE\\Microsoft\\Command Processor\\Autorun", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script", "HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*\\VerifierDlls", "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GpExtensions\\*\\DllName", "HKLM\\SYSTEM\\ControlSet*\\Control\\SafeBoot\\AlternateShell", "HKLM\\SYSTEM\\ControlSet*\\Control\\Terminal Server\\Wds\\rdpwd\\StartupPrograms", "HKLM\\SYSTEM\\ControlSet*\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\BootExecute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\SetupExecute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\Execute", "HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\S0InitialCommand", "HKLM\\SYSTEM\\ControlSet*\\Control\\ServiceControlManagerExtension", "HKLM\\SYSTEM\\ControlSet*\\Control\\BootVerificationProgram\\ImagePat h", "HKLM\\SYSTEM\\Setup\\CmdLine", "HKEY_USERS\\*\\Environment\\UserInitMprLogonScript") and not registry.data.strings : ("C:\\Windows\\system32\\userinit.exe", "cmd.exe", "C:\\Program Files (x86)\\*.exe", "C:\\Program Files\\*.exe") and not (process.name : "rundll32.exe" and registry.path : "*\\Software\\Microsoft\\Internet Explorer\\Extensions\\*\\Script") and not process.executable : ("C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\SysWOW64\\msiexec.exe", "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*\\MsMpEng.exe", "C:\\Program Files\\*.exe", "C:\\Program Files (x86)\\*.exe")

process where event.type == "start" and process.parent.name == "ScreenSaverEngine"

sequence with maxspan=1h [process where event.type == "start" and (process.name : "rundll32.exe" or process.pe.original_file_name == "RUNDLL32.EXE") and process.args_count == 1 ] by process.entity_id [process where event.type == "start" and process.parent.name : "rundll32.exe" ] by process.parent.entity_id

sequence with maxspan=1h [process where event.type in ("start", "process_started") and (process.name : "rundll32.exe" or process.pe.original_file_name == "RUNDLL32.EXE") and process.args_count == 1 ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "rundll32.exe" ] by process.parent.entity_id

sequence with maxspan=1h [process where event.type in ("start", "process_started") and /* uncomment once in winlogbeat */ (process.name : "rundll32.exe" /* or process.pe.original_file_name == "RUNDLL32.EXE" */ ) and process.args_count &lt; 2 ] by process.entity_id [process where event.type in ("start", "process_started") and process.parent.name : "rundll32.exe" ] by process.parent.entity_id

process where event.type == "start" and process.parent.pid == 4 and not process.executable : ("Registry", "MemCompression", "?:\\Windows\\System32\\smss.exe")

process where event.type in ("start", "process_started") and process.parent.pid == 4 and not process.executable : ("Registry", "MemCompression", "?:\\Windows\\System32\\smss.exe")

event.category:process and event.type:(start or process_started) and process.parent.pid:4 and not process.executable:(Registry or MemCompression or "C:\Windows\System32\smss.exe")

process where event.type == "start" and process.parent.name : "dns.exe" and not process.name : "conhost.exe"

event.category:process and event.type:start and process.parent.name:dns.exe and not process.name:conhost.exe

file where event.type != "deletion" and file.extension : ("exe", "dll") and process.name : ("smss.exe", "autochk.exe", "csrss.exe", "wininit.exe", "services.exe", "lsass.exe", "winlogon.exe", "userinit.exe", "LogonUI.exe")

event.category:file and not event.type:deletion and file.extension:(exe or dll) and process.name:(smss.exe or autochk.exe or csrss.exe or wininit.exe or services.exe or lsass.exe or winlogon.exe or userinit.exe or LogonUI.exe)

file where event.type == "creation" and file.path : "C:\\*:*" and not file.path : "C:\\*:zone.identifier*" and not process.executable : ("?:\\windows\\System32\\svchost.exe", "?:\\Windows\\System32\\inetsrv\\w3wp.exe", "?:\\Windows\\explorer.exe", "?:\\Windows\\System32\\sihost.exe", "?:\\Windows\\System32\\PickerHost.exe", "?:\\Windows\\System32\\SearchProtocolHost.exe", "?:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe", "?:\\Program Files\\Rivet Networks\\SmartByte\\SmartByteNetworkService.exe", "?:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe", "?:\\Program Files\\ExpressConnect\\ExpressConnectNetworkService.exe", "?:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe", "?:\\Program Files\\Google\\Chrome\\Application\\chrome.exe", "?:\\Program Files\\Mozilla Firefox\\firefox.exe") and file.extension : ( "pdf", "dll", "png", "exe", "dat", "com", "bat", "cmd", "sys", "vbs", "ps1", "hta", "txt", "vbe", "js", "wsh", "docx", "doc", "xlsx", "xls", "pptx", "ppt", "rtf", "gif", "jpg", "png", "bmp", "img", "iso" )

file where event.type == "creation" and file.path : "C:\\*:*" and not file.path : "C:\\*:zone.identifier*" and file.extension : ( "pdf", "dll", "png", "exe", "dat", "com", "bat", "cmd", "sys", "vbs", "ps1", "hta", "txt", "vbe", "js", "wsh", "docx", "doc", "xlsx", "xls", "pptx", "ppt", "rtf", "gif", "jpg", "png", "bmp", "img", "iso" )

file where process.name : "dns.exe" and event.type in ("creation", "deletion", "change") and not file.name : "dns.log"

event.category:file and process.name:dns.exe and event.type:(creation or deletion or change) and not file.name:dns.log

event.category:file and process.name:dns.exe and not file.name:dns.log

sequence by process.entity_id with maxspan=5m [process where event.type == "start" and /* known applocker bypasses */ (process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "control.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "installutil.exe" or process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "MSBuild.exe" or process.name : "msdt.exe" or process.name : "mshta.exe" or process.name : "msiexec.exe" or process.name : "msxsl.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "regsvr32.exe" or process.name : "xwizard.exe")] [network where (process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "control.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "installutil.exe" or process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "MSBuild.exe" or process.name : "msdt.exe" or process.name : "mshta.exe" or process.name : "msiexec.exe" or process.name : "msxsl.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "regsvr32.exe" or process.name : "xwizard.exe")]

sequence by process.entity_id with maxspan=5m [process where event.type in ("start", "process_started") and /* known applocker bypasses */ (process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "control.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "installutil.exe" or process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "MSBuild.exe" or process.name : "msdt.exe" or process.name : "mshta.exe" or process.name : "msiexec.exe" or process.name : "msxsl.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "regsvr32.exe" or process.name : "xwizard.exe")] [network where (process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "control.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "installutil.exe" or process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "MSBuild.exe" or process.name : "msdt.exe" or process.name : "mshta.exe" or process.name : "msiexec.exe" or process.name : "msxsl.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "regsvr32.exe" or process.name : "xwizard.exe")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type == "start" and process.name : "dllhost.exe" and process.args_count == 1] [network where process.name : "dllhost.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "dllhost.exe" and process.args_count == 1] [network where process.name : "dllhost.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24", "198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type == "start" and process.name : "rundll32.exe" and process.args_count == 1] [network where process.name : "rundll32.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "rundll32.exe" and process.args_count == 1] [network where process.name : "rundll32.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "127.0.0.0/8", "169.254.0.0/16", "172.16.0.0/12", "192.0.0.0/24", "192.0.0.0/29", "192.0.0.8/32", "192.0.0.9/32", "192.0.0.10/32", "192.0.0.170/32", "192.0.0.171/32", "192.0.2.0/24", "192.31.196.0/24", "192.52.193.0/24", "192.168.0.0/16", "192.88.99.0/24", "224.0.0.0/4", "100.64.0.0/10", "192.175.48.0/24","198.18.0.0/15", "198.51.100.0/24", "203.0.113.0/24", "240.0.0.0/4", "::1", "FE80::/10", "FF00::/8")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type in ("start", "process_started") and process.name : "rundll32.exe" and process.args_count == 1] [network where process.name : "rundll32.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.0/8", "FE80::/10", "::1/128")]

sequence by host.id, process.entity_id with maxspan=1m [process where event.type in ("start", "process_started", "info") and process.name : "rundll32.exe" and process.args_count == 1] [network where process.name : "rundll32.exe" and network.protocol != "dns" and network.direction == "outgoing" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.0/8")]

sequence by process.entity_id [process where process.name : "rundll32.exe" and event.type == "start"] [network where process.name : "rundll32.exe" and not cidrmatch(destination.ip, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.0/8")]

event.category:network and event.type:connection and process.name:rundll32.exe and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or 127.0.0.0/8)

process.name:rundll32.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or 127.0.0.0/8)

process.name:rundll32.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

process.name:rundll32.exe and event.action:"Network connection detected (rule: NetworkConnect)" and not destination.ip:10.0.0.0/8 and not destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16

process where event.type == "start" and process.parent.name != null and ( /* suspicious parent processes */ (process.name:"autochk.exe" and not process.parent.name:"smss.exe") or (process.name:("fontdrvhost.exe", "dwm.exe") and not process.parent.name:("wininit.exe", "winlogon.exe")) or (process.name:("consent.exe", "RuntimeBroker.exe", "TiWorker.exe") and not process.parent.name:"svchost.exe") or (process.name:"SearchIndexer.exe" and not process.parent.name:"services.exe") or (process.name:"SearchProtocolHost.exe" and not process.parent.name:("SearchIndexer.exe", "dllhost.exe")) or (process.name:"dllhost.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"smss.exe" and not process.parent.name:("System", "smss.exe")) or (process.name:"csrss.exe" and not process.parent.name:("smss.exe", "svchost.exe")) or (process.name:"wininit.exe" and not process.parent.name:"smss.exe") or (process.name:"winlogon.exe" and not process.parent.name:"smss.exe") or (process.name:("lsass.exe", "LsaIso.exe") and not process.parent.name:"wininit.exe") or (process.name:"LogonUI.exe" and not process.parent.name:("wininit.exe", "winlogon.exe")) or (process.name:"services.exe" and not process.parent.name:"wininit.exe") or (process.name:"svchost.exe" and not process.parent.name:("MsMpEng.exe", "services.exe")) or (process.name:"spoolsv.exe" and not process.parent.name:"services.exe") or (process.name:"taskhost.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"taskhostw.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"userinit.exe" and not process.parent.name:("dwm.exe", "winlogon.exe")) or (process.name:("wmiprvse.exe", "wsmprovhost.exe", "winrshost.exe") and not process.parent.name:"svchost.exe") or /* suspicious child processes */ (process.parent.name:("SearchProtocolHost.exe", "taskhost.exe", "csrss.exe") and not process.name:("werfault.exe", "wermgr.exe", "WerFaultSecure.exe")) or (process.parent.name:"autochk.exe" and not process.name:("chkdsk.exe", "doskey.exe", "WerFault.exe")) or (process.parent.name:"smss.exe" and not process.name:("autochk.exe", "smss.exe", "csrss.exe", "wininit.exe", "winlogon.exe", "setupcl.exe", "WerFault.exe")) or (process.parent.name:"wermgr.exe" and not process.name:("WerFaultSecure.exe", "wermgr.exe", "WerFault.exe")) or (process.parent.name:"conhost.exe" and not process.name:("mscorsvw.exe", "wermgr.exe", "WerFault.exe", "WerFaultSecure.exe")) )

process where event.type in ("start", "process_started") and process.parent.name != null and ( /* suspicious parent processes */ (process.name:"autochk.exe" and not process.parent.name:"smss.exe") or (process.name:("fontdrvhost.exe", "dwm.exe") and not process.parent.name:("wininit.exe", "winlogon.exe")) or (process.name:("consent.exe", "RuntimeBroker.exe", "TiWorker.exe") and not process.parent.name:"svchost.exe") or (process.name:"SearchIndexer.exe" and not process.parent.name:"services.exe") or (process.name:"SearchProtocolHost.exe" and not process.parent.name:("SearchIndexer.exe", "dllhost.exe")) or (process.name:"dllhost.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"smss.exe" and not process.parent.name:("System", "smss.exe")) or (process.name:"csrss.exe" and not process.parent.name:("smss.exe", "svchost.exe")) or (process.name:"wininit.exe" and not process.parent.name:"smss.exe") or (process.name:"winlogon.exe" and not process.parent.name:"smss.exe") or (process.name:("lsass.exe", "LsaIso.exe") and not process.parent.name:"wininit.exe") or (process.name:"LogonUI.exe" and not process.parent.name:("wininit.exe", "winlogon.exe")) or (process.name:"services.exe" and not process.parent.name:"wininit.exe") or (process.name:"svchost.exe" and not process.parent.name:("MsMpEng.exe", "services.exe")) or (process.name:"spoolsv.exe" and not process.parent.name:"services.exe") or (process.name:"taskhost.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"taskhostw.exe" and not process.parent.name:("services.exe", "svchost.exe")) or (process.name:"userinit.exe" and not process.parent.name:("dwm.exe", "winlogon.exe")) or (process.name:("wmiprvse.exe", "wsmprovhost.exe", "winrshost.exe") and not process.parent.name:"svchost.exe") or /* suspicious child processes */ (process.parent.name:("SearchProtocolHost.exe", "taskhost.exe", "csrss.exe") and not process.name:("werfault.exe", "wermgr.exe", "WerFaultSecure.exe")) or (process.parent.name:"autochk.exe" and not process.name:("chkdsk.exe", "doskey.exe", "WerFault.exe")) or (process.parent.name:"smss.exe" and not process.name:("autochk.exe", "smss.exe", "csrss.exe", "wininit.exe", "winlogon.exe", "setupcl.exe", "WerFault.exe")) or (process.parent.name:"wermgr.exe" and not process.name:("WerFaultSecure.exe", "wermgr.exe", "WerFault.exe")) or (process.parent.name:"conhost.exe" and not process.name:("mscorsvw.exe", "wermgr.exe", "WerFault.exe", "WerFaultSecure.exe")) )

event.category:process and event.type:(start or process_started) and process.parent.executable:* and (process.parent.name:autochk.exe and not process.name:(chkdsk.exe or doskey.exe or WerFault.exe) or process.parent.name:smss.exe and not process.name:(autochk.exe or smss.exe or csrss.exe or wininit.exe or winlogon.exe or WerFault.exe) or process.name:autochk.exe and not process.parent.name:smss.exe or process.name:(fontdrvhost.exe or dwm.exe) and not process.parent.name:(wininit.exe or winlogon.exe) or process.name:(consent.exe or RuntimeBroker.exe or TiWorker.exe) and not process.parent.name:svchost.exe or process.name:wermgr.exe and not process.parent.name:(svchost.exe or TiWorker.exe) or process.name:SearchIndexer.exe and not process.parent.name:services.exe or process.name:SearchProtocolHost.exe and not process.parent.name:(SearchIndexer.exe or dllhost.exe) or process.name:dllhost.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:smss.exe and not process.parent.name:(System or smss.exe) or process.name:csrss.exe and not process.parent.name:(smss.exe or svchost.exe) or process.name:wininit.exe and not process.parent.name:smss.exe or process.name:winlogon.exe and not process.parent.name:smss.exe or process.name:(lsass.exe or LsaIso.exe) and not process.parent.name:wininit.exe or process.name:LogonUI.exe and not process.parent.name:(wininit.exe or winlogon.exe) or process.name:services.exe and not process.parent.name:wininit.exe or process.name:svchost.exe and not process.parent.name:(MsMpEng.exe or services.exe) or process.name:spoolsv.exe and not process.parent.name:services.exe or process.name:taskhost.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:taskhostw.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:userinit.exe and not process.parent.name:(dwm.exe or winlogon.exe))

event.category:process and event.type:(start or process_started) and process.parent.executable:* and (process.name:smss.exe and not process.parent.name:(System or smss.exe) or process.name:csrss.exe and not process.parent.name:(smss.exe or svchost.exe) or process.name:wininit.exe and not process.parent.name:smss.exe or process.name:winlogon.exe and not process.parent.name:smss.exe or process.name:lsass.exe and not process.parent.name:wininit.exe or process.name:LogonUI.exe and not process.parent.name:(wininit.exe or winlogon.exe) or process.name:services.exe and not process.parent.name:wininit.exe or process.name:svchost.exe and not process.parent.name:(MsMpEng.exe or services.exe) or process.name:spoolsv.exe and not process.parent.name:services.exe or process.name:taskhost.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:taskhostw.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:userinit.exe and not process.parent.name:(dwm.exe or winlogon.exe))

event.action:"Process Create (rule: ProcessCreate)" and process.parent.executable:* and (process.name:smss.exe and not process.parent.name:(System or smss.exe) or process.name:csrss.exe and not process.parent.name:(smss.exe or svchost.exe) or process.name:wininit.exe and not process.parent.name:smss.exe or process.name:winlogon.exe and not process.parent.name:smss.exe or process.name:lsass.exe and not process.parent.name:wininit.exe or process.name:LogonUI.exe and not process.parent.name:(wininit.exe or winlogon.exe) or process.name:services.exe and not process.parent.name:wininit.exe or process.name:svchost.exe and not process.parent.name:(MsMpEng.exe or services.exe) or process.name:spoolsv.exe and not process.parent.name:services.exe or process.name:taskhost.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:taskhostw.exe and not process.parent.name:(services.exe or svchost.exe) or process.name:userinit.exe and not process.parent.name:(dwm.exe or winlogon.exe))

event.action:"Process Create (rule: ProcessCreate)" and process.parent.executable:* and ( (process.name:"smss.exe" and not process.parent.name:("System" or "smss.exe")) or (process.name:"csrss.exe" and not process.parent.name:("smss.exe" or "svchost.exe")) or (process.name:"wininit.exe" and not process.parent.name:"smss.exe") or (process.name:"winlogon.exe" and not process.parent.name:"smss.exe") or (process.name:"lsass.exe" and not process.parent.name:"wininit.exe") or (process.name:"LogonUI.exe" and not process.parent.name:("winlogon.exe" or "wininit.exe")) or (process.name:"services.exe" and not process.parent.name:"wininit.exe") or (process.name:"svchost.exe" and not process.parent.name:("services.exe" or "MsMpEng.exe")) or (process.name:"spoolsv.exe" and not process.parent.name:"services.exe") or (process.name:"taskhost.exe" and not process.parent.name:("services.exe" or "svchost.exe")) or (process.name:"taskhostw.exe" and not process.parent.name:("services.exe" or "svchost.exe")) or (process.name:"userinit.exe" and not process.parent.name:("dwm.exe" or "winlogon.exe")) )

process where event.type == "start" and process.name : "cmd.exe" and process.parent.name : ("lsass.exe", "csrss.exe", "epad.exe", "regsvr32.exe", "dllhost.exe", "LogonUI.exe", "wermgr.exe", "spoolsv.exe", "jucheck.exe", "jusched.exe", "ctfmon.exe", "taskhostw.exe", "GoogleUpdate.exe", "sppsvc.exe", "sihost.exe", "slui.exe", "SIHClient.exe", "SearchIndexer.exe", "SearchProtocolHost.exe", "FlashPlayerUpdateService.exe", "WerFault.exe", "WUDFHost.exe", "unsecapp.exe", "wlanext.exe" )

process where event.type in ("start", "process_started") and process.name : "cmd.exe" and process.parent.name : ("lsass.exe", "csrss.exe", "epad.exe", "regsvr32.exe", "dllhost.exe", "LogonUI.exe", "wermgr.exe", "spoolsv.exe", "jucheck.exe", "jusched.exe", "ctfmon.exe", "taskhostw.exe", "GoogleUpdate.exe", "sppsvc.exe", "sihost.exe", "slui.exe", "SIHClient.exe", "SearchIndexer.exe", "SearchProtocolHost.exe", "FlashPlayerUpdateService.exe", "WerFault.exe", "WUDFHost.exe", "unsecapp.exe", "wlanext.exe" )

event.category:process and event.type:(start or process_started) and process.name:cmd.exe and process.parent.name:(lsass.exe or csrss.exe or notepad.exe or regsvr32.exe or dllhost.exe or LogonUI.exe or wermgr.exe or spoolsv.exe or jucheck.exe or jusched.exe or ctfmon.exe or taskhostw.exe or GoogleUpdate.exe or sppsvc.exe or sihost.exe or slui.exe or SIHClient.exe or SearchIndexer.exe or SearchProtocolHost.exe or FlashPlayerUpdateService.exe or WerFault.exe or WUDFHost.exe or unsecapp.exe or wlanext.exe)

registry where registry.path : ("HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ServiceDLL", "HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ImagePath") and not registry.data.strings : ("?:\\windows\\system32\\Drivers\\*.sys", "\\SystemRoot\\System32\\drivers\\*.sys", "\\??\\?:\\Windows\\system32\\Drivers\\*.SYS", "system32\\DRIVERS\\USBSTOR") and not (process.name : "procexp??.exe" and registry.data.strings : "?:\\*\\procexp*.sys") and not process.executable : ("?:\\Program Files\\*.exe", "?:\\Program Files (x86)\\*.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Windows\\winsxs\\*\\TiWorker.exe", "?:\\Windows\\System32\\drvinst.exe", "?:\\Windows\\System32\\services.exe", "?:\\Windows\\System32\\msiexec.exe", "?:\\Windows\\System32\\regsvr32.exe")

registry where registry.path : ("HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ServiceDLL", "HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ImagePath") and not registry.data.strings : ("C:\\windows\\system32\\Drivers\\*.sys", "\\SystemRoot\\System32\\drivers\\*.sys", "system32\\DRIVERS\\USBSTOR") and not (process.name : "procexp??.exe" and registry.data.strings : "C:\\*\\procexp*.sys") and not process.executable : ("C:\\Program Files*\\*.exe", "C:\\Windows\\System32\\svchost.exe", "C:\\Windows\\winsxs\\*\\TiWorker.exe", "C:\\Windows\\System32\\drvinst.exe", "C:\\Windows\\System32\\services.exe", "C:\\Windows\\System32\\msiexec.exe", "C:\\Windows\\System32\\regsvr32.exe")

process where event.type == "start" and process.parent.name : "spoolsv.exe" and (?process.Ext.token.integrity_level_name : "System" or ?winlog.event_data.IntegrityLevel : "System") and /* exclusions for FP control below */ not process.name : ("splwow64.exe", "PDFCreator.exe", "acrodist.exe", "spoolsv.exe", "msiexec.exe", "route.exe", "WerFault.exe") and not process.command_line : "*\\WINDOWS\\system32\\spool\\DRIVERS*" and not (process.name : "net.exe" and process.command_line : ("*stop*", "*start*")) and not (process.name : ("cmd.exe", "powershell.exe") and process.command_line : ("*.spl*", "*\\program files*", "*route add*")) and not (process.name : "netsh.exe" and process.command_line : ("*add portopening*", "*rule name*")) and not (process.name : "regsvr32.exe" and process.command_line : "*PrintConfig.dll*")

process where event.type == "start" and process.parent.name : "spoolsv.exe" and (process.Ext.token.integrity_level_name : "System" or winlog.event_data.IntegrityLevel : "System") and /* exclusions for FP control below */ not process.name : ("splwow64.exe", "PDFCreator.exe", "acrodist.exe", "spoolsv.exe", "msiexec.exe", "route.exe", "WerFault.exe") and not process.command_line : "*\\WINDOWS\\system32\\spool\\DRIVERS*" and not (process.name : "net.exe" and process.command_line : ("*stop*", "*start*")) and not (process.name : ("cmd.exe", "powershell.exe") and process.command_line : ("*.spl*", "*\\program files*", "*route add*")) and not (process.name : "netsh.exe" and process.command_line : ("*add portopening*", "*rule name*")) and not (process.name : "regsvr32.exe" and process.command_line : "*PrintConfig.dll*")

process where event.type == "start" and process.parent.name : "spoolsv.exe" and user.id : "S-1-5-18" and /* exclusions for FP control below */ not process.name : ("splwow64.exe", "PDFCreator.exe", "acrodist.exe", "spoolsv.exe", "msiexec.exe", "route.exe", "WerFault.exe") and not process.command_line : "*\\WINDOWS\\system32\\spool\\DRIVERS*" and not (process.name : "net.exe" and process.command_line : ("*stop*", "*start*")) and not (process.name : ("cmd.exe", "powershell.exe") and process.command_line : ("*.spl*", "*\\program files*", "*route add*")) and not (process.name : "netsh.exe" and process.command_line : ("*add portopening*", "*rule name*")) and not (process.name : "regsvr32.exe" and process.command_line : "*PrintConfig.dll*")

process where event.type == "start" and process.args : "?:\\*:*" and process.args_count == 1

process where event.type in ("start", "process_started") and process.args : "C:\\*:*"

sequence by process.entity_id [process where (process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "xwizard.exe") and event.type == "start"] [network where (process.name : "Microsoft.Workflow.Compiler.exe" or process.name : "bginfo.exe" or process.name : "cdb.exe" or process.name : "cmstp.exe" or process.name : "csi.exe" or process.name : "dnx.exe" or process.name : "fsi.exe" or process.name : "ieexec.exe" or process.name : "iexpress.exe" or process.name : "odbcconf.exe" or process.name : "rcsi.exe" or process.name : "xwizard.exe")]

event.category:network and event.type:connection and process.name:(Microsoft.Workflow.Compiler.exe or bginfo.exe or cdb.exe or cmstp.exe or csi.exe or dnx.exe or fsi.exe or ieexec.exe or iexpress.exe or odbcconf.exe or rcsi.exe or xwizard.exe)

event.action:"Network connection detected (rule: NetworkConnect)" and process.name:(Microsoft.Workflow.Compiler.exe or bginfo.exe or cdb.exe or cmstp.exe or csi.exe or dnx.exe or fsi.exe or ieexec.exe or iexpress.exe or odbcconf.exe or rcsi.exe or xwizard.exe)

event.action:"Network connection detected (rule: NetworkConnect)" and process.name:(bginfo.exe or cdb.exe or cmstp.exe or csi.exe or dnx.exe or fsi.exe or ieexec.exe or iexpress.exe or Microsoft.Workflow.Compiler.exe or odbcconf.exe or rcsi.exe or xwizard.exe)

process where event.type == "start" and process.parent.name : "svchost.exe" and /* based on svchost service arguments -s svcname where the service is known to be childless */ process.parent.args : ("WdiSystemHost","LicenseManager", "StorSvc","CDPSvc","cdbhsvc","BthAvctpSvc","SstpSvc","WdiServiceHost", "imgsvc","TrkWks","WpnService","IKEEXT","PolicyAgent","CryptSvc", "netprofm","ProfSvc","StateRepository","camsvc","LanmanWorkstation", "NlaSvc","EventLog","hidserv","DisplayEnhancementService","ShellHWDete ction", "AppHostSvc","fhsvc","CscService","PushToInstall") and /* unknown FPs can be added here */ not process.name : ("WerFault.exe","WerFaultSecure.exe","wermgr.exe") and not (process.executable : "?:\\Windows\\System32\\RelPost.exe" and process.parent.args : "WdiSystemHost") and not (process.name : "rundll32.exe" and process.args : "?:\\WINDOWS\\System32\\winethc.dll,ForceProxyDetectionOnNextRun" and process.parent.args : "WdiServiceHost") and not (process.executable : ("?:\\Program Files\\*", "?:\\Program Files (x86)\\*", "?:\\Windows\\System32\\Kodak\\kds_i4x50\\lib\\lexexe.exe") and process.parent.args : "imgsvc")

process where event.type in ("start", "process_started") and process.parent.name : "svchost.exe" and /* based on svchost service arguments -s svcname where the service is known to be childless */ process.parent.args : ("WdiSystemHost","LicenseManager", "StorSvc","CDPSvc","cdbhsvc","BthAvctpSvc","SstpSvc","WdiServiceHost", "imgsvc","TrkWks","WpnService","IKEEXT","PolicyAgent","CryptSvc", "netprofm","ProfSvc","StateRepository","camsvc","LanmanWorkstation", "NlaSvc","EventLog","hidserv","DisplayEnhancementService","ShellHWDete ction", "AppHostSvc","fhsvc","CscService","PushToInstall") and /* unknown FPs can be added here */ not process.name : ("WerFault.exe","WerFaultSecure.exe","wermgr.exe") and not (process.executable : "?:\\Windows\\System32\\RelPost.exe" and process.parent.args : "WdiSystemHost") and not (process.name : "rundll32.exe" and process.args : "?:\\WINDOWS\\System32\\winethc.dll,ForceProxyDetectionOnNextRun" and process.parent.args : "WdiServiceHost") and not (process.executable : ("?:\\Program Files\\*", "?:\\Program Files (x86)\\*", "?:\\Windows\\System32\\Kodak\\kds_i4x50\\lib\\lexexe.exe") and process.parent.args : "imgsvc")

process where event.type in ("start", "process_started") and process.parent.name : "svchost.exe" and /* based on svchost service arguments -s svcname where the service is known to be childless */ process.parent.args : ("WdiSystemHost","LicenseManager", "StorSvc","CDPSvc","cdbhsvc","BthAvctpSvc","SstpSvc","WdiServiceHost", "imgsvc","TrkWks","WpnService","IKEEXT","PolicyAgent","CryptSvc", "netprofm","ProfSvc","StateRepository","camsvc","LanmanWorkstation", "NlaSvc","EventLog","hidserv","DisplayEnhancementService","ShellHWDete ction", "AppHostSvc","fhsvc","CscService","PushToInstall") and /* unknown FPs can be added here */ not process.name : ("WerFault.exe","WerFaultSecure.exe","wermgr.exe")

process where event.type == "start" and process.name : ("net.exe", "net1.exe") and not process.parent.name : "net.exe" and (process.args : "user" and process.args : ("/ad", "/add"))

process where event.type in ("start", "process_started") and process.name : ("net.exe", "net1.exe") and not process.parent.name : "net.exe" and (process.args : "user" and process.args : ("/ad", "/add"))

event.category:process and event.type:(start or process_started) and process.name:(net.exe or net1.exe) and not process.parent.name:net.exe and process.args:(user and (/ad or /add))

event.action:"Process Create (rule: ProcessCreate)" and process.name:(net.exe or net1.exe) and not process.parent.name:net.exe and process.args:(user and (/ad or /add))

event.action:"Process Create (rule: ProcessCreate)" and process.name:("net.exe" or "net1.exe") and not process.parent.name:"net.exe" and process.args:("user" and ("/add" or "/ad"))

event.action:"Directory Service Changes" and event.code:5136 and winlog.event_data.ObjectClass:"user" and winlog.event_data.AttributeLDAPDisplayName:"servicePrincipalName"

event.action:"Directory Service Changes" and event.code:5136 and winlog.event_data.ObjectClass:"user" and winlog.event_data.AttributeLDAPDisplayName:"servicePrincipalName"

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add owner to application" and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add owner to application" and event.outcome:Success

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add owner to service principal" and event.outcome:(Success or success)

event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add owner to service principal" and event.outcome:Success

iam where event.action == "added-member-to-group" and group.name : ("Admin*", "Local Administrators", "Domain Admins", "Enterprise Admins", "Backup Admins", "Schema Admins", "DnsAdmins", "Exchange Organization Administrators")

event.category:iam and event.action:"added-member-to-group" and group.name:(Administrators or "Local Administrators" or "Domain Admins" or "Enterprise Admins" or "Backup Admins" or "Schema Admins" or "DnsAdmins")

event.category:process and event.type:(start or process_started) and process.args:("/sys/class/dmi/id/bios_version" or "/sys/class/dmi/id/product_name" or "/sys/class/dmi/id/chassis_vendor" or "/proc/scsi/scsi" or "/proc/ide/hd0/model") and not user.name:root

event.action:executed and process.args:("/sys/class/dmi/id/bios_version" or "/sys/class/dmi/id/product_name" or "/sys/class/dmi/id/chassis_vendor" or "/proc/scsi/scsi" or "/proc/ide/hd0/model") and not user.name:root

process where event.type == "start" and process.name in ("grep", "egrep") and user.id != "0" and process.args : ("parallels*", "vmware*", "virtualbox*") and process.args : "Manufacturer*" and not process.parent.executable in ("/Applications/Docker.app/Contents/MacOS/Docker", "/usr/libexec/kcare/virt-what")

process where event.type == "start" and process.name in ("grep", "egrep") and user.id != "0" and process.args : ("parallels*", "vmware*", "virtualbox*") and process.args : "Manufacturer*" and not process.parent.executable in ("/Applications/Docker.app/Contents/MacOS/Docker", "/usr/libexec/kcare/virt-what")

process where event.type in ("start", "process_started") and ( (process.name : "networksetup" and process.args : "-connectpppoeservice") or (process.name : "scutil" and process.args : "--nc" and process.args : "start") or (process.name : "osascript" and process.command_line : "osascript*set VPN to service*") )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and not source.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" ) and destination.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and not source.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1") and destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and not source.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1") and destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)

network.transport: tcp and (destination.port &gt;= 5800 and destination.port &lt;= 5810) and ( network.direction: inbound or ( not source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or "::1" or "FE80::/10" or "FF00::/8" )

event.category:(network or network_traffic) and network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport:tcp and destination.port &gt;= 5800 and destination.port &lt;= 5810 and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 or "::1")

network.transport: tcp and (destination.port &gt;= 5800 and destination.port &lt;= 5810) and ( network.direction: outbound or ( source.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip: (10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) ) )

process where event.type == "start" and (process.name : "vssadmin.exe" or process.pe.original_file_name == "VSSADMIN.EXE") and process.args in ("delete", "resize") and process.args : "shadows*"

process where event.type in ("start", "process_started") and (process.name : "vssadmin.exe" or process.pe.original_file_name == "VSSADMIN.EXE") and process.args in ("delete", "resize") and process.args : "shadows*"

process where event.type in ("start", "process_started") and event.action == "start" and (process.name : "vssadmin.exe" or process.pe.original_file_name == "VSSADMIN.EXE") and process.args in ("delete", "resize") and process.args : "shadows*"

process where event.type in ("start", "process_started") and (process.name : "vssadmin.exe" or process.pe.original_file_name == "VSSADMIN.EXE") and process.args : "delete" and process.args : "shadows"

event.category:process and event.type:(start or process_started) and process.name:vssadmin.exe and process.args:(delete and shadows)

event.action:"Process Create (rule: ProcessCreate)" and process.name:vssadmin.exe and process.args:(delete and shadows)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"vssadmin.exe" and process.args:("delete" and "shadows")

process where event.type == "start" and process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : ("*Get-WmiObject*", "*gwmi*", "*Get-CimInstance*", "*gcim*") and process.args : ("*Win32_ShadowCopy*") and process.args : ("*.Delete()*", "*Remove-WmiObject*", "*rwmi*", "*Remove-CimInstance*", "*rcim*")

process where event.type in ("start", "process_started") and process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : ("*Get-WmiObject*", "*gwmi*", "*Get- CimInstance*", "*gcim*") and process.args : ("*Win32_ShadowCopy*") and process.args : ("*.Delete()*", "*Remove-WmiObject*", "*rwmi*", "*Remove-CimInstance*", "*rcim*")

process where event.type in ("start", "process_started") and process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") and process.args : ("*Get-WmiObject*", "*gwmi*", "*Get- CimInstance*", "*gcim*") and process.args : ("*Win32_ShadowCopy*") and process.args : ("*.Delete()*", "*Remove-WmiObject*", "*rwmi*", "*Remove-CimInstance*", "*rcim*")

process where event.type == "start" and (process.name : "WMIC.exe" or process.pe.original_file_name == "wmic.exe") and process.args : "delete" and process.args : "shadowcopy"

process where event.type in ("start", "process_started") and (process.name : "WMIC.exe" or process.pe.original_file_name == "wmic.exe") and process.args : "delete" and process.args : "shadowcopy"

event.category:process and event.type:(start or process_started) and process.name:WMIC.exe and process.args:(delete and shadowcopy)

event.action:"Process Create (rule: ProcessCreate)" and process.name:WMIC.exe and process.args:(delete and shadowcopy)

event.action:"Process Create (rule: ProcessCreate)" and process.name:"WMIC.exe" and process.args:("shadowcopy" and "delete")

http.response.status_code:403 and http.request.method:post

http.response.status_code:403 and http.request.method:post

user_agent.original:"sqlmap/1.3.11#stable (http://sqlmap.org)"

user_agent.original:"sqlmap/1.3.11#stable (http://sqlmap.org)"

http.response.status_code:405

http.response.status_code:405

event.category : process and event.type : start and process.name : networksetup and process.args : (("-setwebproxy" or "-setsecurewebproxy" or "-setautoproxyurl") and not (Bluetooth or off)) and not process.parent.executable : ("/Library/PrivilegedHelperTools/com.80pct.FreedomHelper" or "/Applications/Fiddler Everywhere.app/Contents/Resources/app/out/WebServer/Fiddler.WebUi" or "/usr/libexec/xpcproxy")

event.category:process and event.type:start and process.name:networksetup and process.args:("-setwebproxy" or "-setsecurewebproxy" or "-setautoproxyurl")

file where event.type == "deletion" and file.path : ("C:\\inetpub\\logs\\LogFiles\\*.log", "/var/log/apache*/access.log", "/etc/httpd/logs/access_log", "/var/log/httpd/access_log", "/var/www/*/logs/access.log")

file where event.type == "deletion" and file.path : ("C:\\inetpub\\logs\\LogFiles\\*.log", "/var/log/apache*/access.log", "/etc/httpd/logs/access_log", "/var/log/httpd/access_log", "/var/www/*/logs/access.log")

process where event.type == "start" and process.parent.name : ("w3wp.exe", "httpd.exe", "nginx.exe", "php.exe", "php-cgi.exe", "tomcat.exe") and process.name : ("cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "wmic.exe", "wscript.exe")

process where event.type == "start" and process.parent.name : ("w3wp.exe", "httpd.exe", "nginx.exe", "php.exe", "php-cgi.exe", "tomcat.exe") and process.name : ("cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "powershell_ise.exe", "wmic.exe", "wscript.exe")

process where event.type == "start" and process.parent.name : ("w3wp.exe", "httpd.exe", "nginx.exe", "php.exe", "php-cgi.exe", "tomcat.exe") and process.name : ("cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "wmic.exe", "wscript.exe")

process where event.type == "start" and process.name : "whoami.exe" and ( (/* scoped for whoami execution under system privileges */ (user.domain : ("NT AUTHORITY", "NT-AUTORITÄT", "AUTORITE NT", "IIS APPPOOL") or user.id : ("S-1-5-18", "S-1-5-19", "S-1-5-20")) and not (process.parent.name : "cmd.exe" and process.parent.args : ("chcp 437&gt;nul 2&gt;&amp;1 &amp; C:\\WINDOWS\\System32\\whoami.exe /groups", "chcp 437&gt;nul 2&gt;&amp;1 &amp; %systemroot%\\system32\\whoami /user", "C:\\WINDOWS\\System32\\whoami.exe /groups", "*WINDOWS\\system32\\config\\systemprofile*")) and not (process.parent.executable : "C:\\Windows\\system32\\inetsrv\\appcmd.exe" and process.parent.args : "LIST") and not process.parent.executable : ("C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe", "C:\\Program Files\\Cohesity\\cohesity_windows_agent_service.exe")) or process.parent.name : ("wsmprovhost.exe", "w3wp.exe", "wmiprvse.exe", "rundll32.exe", "regsvr32.exe") )

process where event.type in ("start", "process_started") and process.name : "whoami.exe"

event.category:process and event.type:(start or process_started) and process.name:whoami.exe

process.name:whoami.exe and event.code:1

event.provider:"Microsoft-Windows-Audit-CVE" and message:"[CVE-2020-0601]"

registry where event.type in ("creation", "change") and ( ( registry.path:"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings: ("1", "0x00000001") ) or ( registry.path:"HKLM\\System\\*ControlSet*\\Services\\WinDefend\\Start" and registry.data.strings in ("3", "4", "0x00000003", "0x00000004") ) ) and not process.executable : ("?:\\WINDOWS\\system32\\services.exe", "?:\\Windows\\System32\\svchost.exe", "?:\\Program Files (x86)\\Trend Micro\\Security Agent\\NTRmv.exe")

registry where event.type in ("creation", "change") and ( ( registry.path:"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings: ("1", "0x00000001") ) or ( registry.path:"HKLM\\System\\*ControlSet*\\Services\\WinDefend\\Start" and registry.data.strings in ("3", "4", "0x00000003", "0x00000004") ) )

registry where event.type in ("creation", "change") and ((registry.path:"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware" and registry.data.strings:"1") or (registry.path:"HKLM\\System\\ControlSet*\\Services\\WinDefend\\Start" and registry.data.strings in ("3", "4")))

process where event.type == "start" and (process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name in ("powershell.exe", "pwsh.dll", "powershell_ise.exe")) and process.args : ("*Add-MpPreference*", "*Set-MpPreference*") and process.args : ("*-Exclusion*")

process where event.type == "start" and (process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name in ("powershell.exe", "pwsh.dll", "powershell_ise.exe")) and process.args : ("*Add- MpPreference*-Exclusion*", "*Set-MpPreference*-Exclusion*")

process where event.type == "start" and (process.name : ("powershell.exe", "pwsh.exe") or process.pe.original_file_name : ("powershell.exe", "pwsh.exe")) and process.args : ("*Add- MpPreference*-Exclusion*", "*Set-MpPreference*-Exclusion*")

event.action:("audit-log-cleared" or "Log clear")

process where event.action == "start" and (process.name : ("powershell.exe", "pwsh.exe", "powershell_ise.exe") or process.pe.original_file_name == "PowerShell.EXE") and process.args : "*Set-NetFirewallProfile*" and (process.args : "*-Enabled*" and process.args : "*False*") and (process.args : "*-All*" or process.args : ("*Public*", "*Domain*", "*Private*"))

process where event.type == "start" and ((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and (process.args : "view" or (process.args : "time" and process.args : "\\\\*")) /* expand when ancestry is available and not descendant of [process where event.type == "start" and process.name : "cmd.exe" and ((process.parent.name : "userinit.exe") or (process.parent.name : "gpscript.exe") or (process.parent.name : "explorer.exe" and process.args : "C:\\*\\Start Menu\\Programs\\Startup\\*.bat*"))] */

process where event.type in ("start", "process_started") and ((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and (process.args : "view" or (process.args : "time" and process.args : "\\\\*")) /* expand when ancestry is available and not descendant of [process where event.type == ("start", "process_started") and process.name : "cmd.exe" and ((process.parent.name : "userinit.exe") or (process.parent.name : "gpscript.exe") or (process.parent.name : "explorer.exe" and process.args : "C:\\*\\Start Menu\\Programs\\Startup\\*.bat*"))] */

process where event.type in ("start", "process_started") and ((process.name : "net.exe" or process.pe.original_file_name == "net.exe") or ((process.name : "net1.exe" or process.pe.original_file_name == "net1.exe") and not process.parent.name : "net.exe")) and (process.args : "view" or (process.args : "time" and process.args : "\\\\*")) /* expand when ancestory is available and not descendant of [process where event.type == ("start", "process_started") and process.name : "cmd.exe" and ((process.parent.name : "userinit.exe") or (process.parent.name : "gpscript.exe") or (process.parent.name : "explorer.exe" and process.args : "C:\\*\\Start Menu\\Programs\\Startup\\*.bat*"))] */

file where event.type == "creation" and /* regf file header */ file.Ext.header_bytes : "72656766*" and file.size &gt;= 30000 and process.pid == 4 and user.id : "s-1-5-21*"

process where event.type == "start" and process.parent.name : ("cscript.exe", "wscript.exe") and process.name : "powershell.exe"

process where event.type in ("start", "process_started") and process.parent.name : ("cscript.exe", "wscript.exe") and process.name : "powershell.exe"

event.category:process and event.type:(start or process_started) and process.parent.name:(cscript.exe or wscript.exe) and process.name:powershell.exe

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:(cscript.exe or wscript.exe) and process.name:powershell.exe

event.action:"Process Create (rule: ProcessCreate)" and process.parent.name:("wscript.exe" or "cscript.exe") and process.name:"powershell.exe"

sequence by host.id with maxspan = 5s [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : "wmiutils.dll" or file.name : "wmiutils.dll") and process.name : ("wscript.exe", "cscript.exe")] [process where event.type == "start" and process.parent.name : "wmiprvse.exe" and user.domain != "NT AUTHORITY" and (process.pe.original_file_name : ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) or process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe") ) ]

sequence by host.id with maxspan = 5s [any where (event.category == "library" or (event.category == "process" and event.action : "Image loaded*")) and (dll.name : "wmiutils.dll" or file.name : "wmiutils.dll") and process.name : ("wscript.exe", "cscript.exe")] [process where event.type in ("start", "process_started") and process.parent.name : "wmiprvse.exe" and user.domain != "NT AUTHORITY" and (process.pe.original_file_name : ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) or process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe") ) ]

sequence by host.id with maxspan = 5s [library where dll.name : "wmiutils.dll" and process.name : ("wscript.exe", "cscript.exe")] [process where event.type in ("start", "process_started") and process.parent.name : "wmiprvse.exe" and user.domain != "NT AUTHORITY" and (process.pe.original_file_name : ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) or process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe") ) ]

sequence by host.id with maxspan=5s [library where file.name : "wmiutils.dll" and process.name : ("wscript.exe", "cscript.exe")] [process where event.type in ("start", "process_started") and process.parent.name : "wmiprvse.exe" and user.domain != "NT AUTHORITY" and (process.pe.original_file_name in ( "cscript.exe", "wscript.exe", "PowerShell.EXE", "Cmd.Exe", "MSHTA.EXE", "RUNDLL32.EXE", "REGSVR32.EXE", "MSBuild.exe", "InstallUtil.exe", "RegAsm.exe", "RegSvcs.exe", "msxsl.exe", "CONTROL.EXE", "EXPLORER.EXE", "Microsoft.Workflow.Compiler.exe", "msiexec.exe" ) or process.executable : ("C:\\Users\\*.exe", "C:\\ProgramData\\*.exe") ) ]

event.action:"service-installed" and (winlog.event_data.ClientProcessId:"0" or winlog.event_data.ParentProcessId:"0")

sequence by host.id with maxspan = 2s /* Accepted Incoming RPC connection by Winmgmt service */ [network where process.name : "svchost.exe" and network.direction : ("incoming", "ingress") and source.ip != "127.0.0.1" and source.ip != "::1" and source.port &gt;= 49152 and destination.port &gt;= 49152 ] /* Excluding Common FPs Nessus and SCCM */ [process where event.type == "start" and process.parent.name : "WmiPrvSE.exe" and not process.args : ("C:\\windows\\temp\\nessus_*.txt", "C:\\windows\\TEMP\\nessus_*.TMP", "C:\\Windows\\CCM\\SystemTemp\\*", "C:\\Windows\\CCMCache\\*", "C:\\CCM\\Cache\\*") ]

sequence by host.id with maxspan = 2s /* Accepted Incoming RPC connection by Winmgmt service */ [network where process.name : "svchost.exe" and network.direction : ("incoming", "ingress") and source.ip != "127.0.0.1" and source.ip != "::1" and source.port &gt;= 49152 and destination.port &gt;= 49152 ] /* Excluding Common FPs Nessus and SCCM */ [process where event.type in ("start", "process_started") and process.parent.name : "WmiPrvSE.exe" and not process.args : ("C:\\windows\\temp\\nessus_*.txt", "C:\\windows\\TEMP\\nessus_*.TMP", "C:\\Windows\\CCM\\SystemTemp\\*", "C:\\Windows\\CCMCache\\*", "C:\\CCM\\Cache\\*") ]

sequence by host.id with maxspan = 2s /* Accepted Incoming RPC connection by Winmgmt service */ [network where process.name : "svchost.exe" and network.direction : ("incoming", "ingress") and source.address != "127.0.0.1" and source.address != "::1" and source.port &gt;= 49152 and destination.port &gt;= 49152 ] /* Excluding Common FPs Nessus and SCCM */ [process where event.type in ("start", "process_started") and process.parent.name : "WmiPrvSE.exe" and not process.args : ("C:\\windows\\temp\\nessus_*.txt", "C:\\windows\\TEMP\\nessus_*.TMP", "C:\\Windows\\CCM\\SystemTemp\\*", "C:\\Windows\\CCMCache\\*", "C:\\CCM\\Cache\\*") ]

sequence by host.id with maxspan = 2s /* Accepted Incoming RPC connection by Winmgmt service */ [network where process.name : "svchost.exe" and network.direction == "incoming" and source.address != "127.0.0.1" and source.address != "::1" and source.port &gt;= 49152 and destination.port &gt;= 49152 ] /* Excluding Common FPs Nessus and SCCM */ [process where event.type in ("start", "process_started") and process.parent.name : "WmiPrvSE.exe" and not process.args : ("C:\\windows\\temp\\nessus_*.txt", "C:\\windows\\TEMP\\nessus_*.TMP", "C:\\Windows\\CCM\\SystemTemp\\*", "C:\\Windows\\CCMCache\\*", "C:\\CCM\\Cache\\*") ]

event.type:creation and event.module:zoom and event.dataset:zoom.webhook and event.action:meeting.created and not zoom.meeting.password:*

event.category:(network or network_traffic) and destination.port:53 and (event.dataset:zeek.dns or type:dns or event.type:connection) and network.bytes &gt; 60000

file where event.type == "creation" and user.id == "0" and file.path regex~ """/var/run/\w+\.(pid|lock|reboot)""" and file.extension in ("pid","lock","reboot") and /* handle common legitimate files */ not file.name in ( "auditd.pid", "python*", "apport.pid", "apport.lock", "kworker*", "gdm3.pid", "sshd.pid", "acpid.pid", "unattended-upgrades.lock", "unattended- upgrades.pid", "cmd.pid", "cron*.pid", "yum.pid", "netconfig.pid", "docker.pid", "atd.pid", "lfd.pid", "atop.pid", "nginx.pid", "dhclient.pid", "smtpd.pid", "stunnel.pid" )

file where event.type == "creation" and user.id == "0" and file.path regex~ """/var/run/\w+\.(pid|lock|reboot)""" and file.extension in ("pid","lock","reboot") and /* handle common legitimate files */ not file.name in ( "auditd.pid", "python*", "apport.pid", "apport.lock", "kworker*", "gdm3.pid", "sshd.pid", "acpid.pid", "unattended-upgrades.lock", "unattended- upgrades.pid", "cmd.pid", "cron*.pid" )